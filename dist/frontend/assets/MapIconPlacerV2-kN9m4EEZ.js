import{j as n}from"./index-Dtevmlj4.js";import{r as c}from"./vendor-DCFZ6SsY.js";import"./store-CIj0PUzs.js";import"./ui-CleIVWQA.js";class q{constructor(t={}){this.endpoints={rust:t.rustUrl||"http://localhost:3001",java:t.javaUrl||"http://localhost:8080",python:t.pythonUrl||"http://localhost:7500"},this.cache=new Map,this.listeners=new Map,this.ws=null}async tick(t){var o,l;try{const d=await fetch(`${this.endpoints.rust}/api/v2/tick`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_tw:((o=t.temporal)==null?void 0:o.tw)||0,current_te:((l=t.temporal)==null?void 0:l.te)||0,entities:this.extractEntities(t),resources:t.resources,regulators:t.regulators})});if(!d.ok)throw new Error(`V2 tick failed: ${d.status}`);const p=await d.json();return this.emit("tick",p),p}catch(d){return console.error("V2 Tick Error:",d),this.fallbackTick(t)}}calculateDrift(t,o){return t-o}calculateComplexEnergy(t,o){return{real:t*Math.cos(o),imaginary:t*Math.sin(o),magnitude:t,phase:o,toString(){return`${this.real.toFixed(1)} + ${this.imaginary.toFixed(1)}i`}}}calculateInterference(t,o){if(!t.energy_complex||!o.energy_complex)return 0;const l=t.energy_complex.phi??t.energy_complex.phase??0,d=o.energy_complex.phi??o.energy_complex.phase??0,p=l-d,k=this.getDistance(t.position,o.position);return k>10?0:Math.cos(p)*(1-k/10)}detectParadoxes(t){var l,d;const o=[];return Math.abs(t.temporal.tw-t.temporal.te)>10&&o.push({type:"excessive_drift",severity:"major",entities:["global"]}),t.temporal.debt>50&&o.push({type:"temporal_debt",severity:"critical",debt:t.temporal.debt}),((d=(l=t.regulators)==null?void 0:l.overload)==null?void 0:d.stack)>=10&&o.push({type:"overload_explosion",severity:"critical"}),o}async upsertEntity(t){return(await fetch(`${this.endpoints.rust}/api/v2/entity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async activateVince(t,o=1){return fetch(`${this.endpoints.rust}/api/v2/regulators/vince`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:t,intensity:o})}).then(l=>l.json())}async activateAnna(t=5,o=null){return fetch(`${this.endpoints.rust}/api/v2/regulators/anna`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({decay_rate:t,zone:o})}).then(l=>l.json())}async triggerOverload(){return fetch(`${this.endpoints.rust}/api/v2/regulators/overload`,{method:"POST"}).then(t=>t.json())}renderTemporalDisplay(t,o,l=0){const d=Math.abs(t-o),p=d>5?"danger":d>2?"warning":"",k=l>50?"critical":l>20?"warning":"";return`
            <div class="v2-temporal-display">
                <div class="time-values">
                    <span class="tw">TW: ${t.toFixed(1)}</span>
                    <span class="te">TE: ${o.toFixed(1)}</span>
                    <span class="drift ${p}">Δt: ${d.toFixed(1)}</span>
                </div>
                ${l>0?`
                    <div class="debt ${k}">
                        💸 Dette: ${l.toFixed(1)}
                    </div>
                `:""}
            </div>
        `}renderEnergyComplex(t){if(!t)return"";const o=this.calculateComplexEnergy(t.amplitude||t.A||0,t.phase||t.phi||0);return`
            <div class="v2-energy-complex">
                <div class="energy-value">${o.toString()}</div>
                <div class="energy-bar">
                    <div class="real-part" style="width: ${o.real}%"></div>
                    <div class="imaginary-part" style="width: ${o.imaginary}%"></div>
                </div>
            </div>
        `}renderRegulators(t){return t?`
            <div class="v2-regulators">
                ${t.vince?`
                    <div class="regulator vince ${t.vince.active?"active":""}">
                        <span class="name">Vince</span>
                        <span class="status">${t.vince.active?"⚡":"💤"}</span>
                    </div>
                `:""}
                ${t.anna?`
                    <div class="regulator anna ${t.anna.active?"active":""}">
                        <span class="name">Anna</span>
                        <span class="decay">-${t.anna.decayRate||5}%</span>
                    </div>
                `:""}
                ${t.overload?`
                    <div class="regulator overload">
                        <span class="name">Overload</span>
                        <span class="stack">${t.overload.stack||0}/10</span>
                    </div>
                `:""}
            </div>
        `:""}connectWebSocket(t=8001){this.ws||(this.ws=new WebSocket(`ws://localhost:${t}`),this.ws.onopen=()=>{console.log("✅ V2 WebSocket connected"),this.emit("ws:connected")},this.ws.onmessage=o=>{const l=JSON.parse(o.data);this.emit("ws:message",l),l.type==="tick"?this.emit("tick",l.payload):l.type==="paradox"&&this.emit("paradox",l.payload)},this.ws.onerror=o=>{console.error("WebSocket error:",o),this.emit("ws:error",o)},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.ws=null,this.emit("ws:disconnected")})}on(t,o){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(o)}off(t,o){const l=this.listeners.get(t);if(l){const d=l.indexOf(o);d>-1&&l.splice(d,1)}}emit(t,o){const l=this.listeners.get(t);l&&l.forEach(d=>d(o))}extractEntities(t){var l,d;const o=[];return(l=t.temporal)!=null&&l.entities&&(t.temporal.entities instanceof Map?t.temporal.entities.forEach((p,k)=>{o.push({id:k,...p})}):Array.isArray(t.temporal.entities)&&o.push(...t.temporal.entities)),t.heroPosition&&!o.find(p=>p.id==="hero")&&o.push({id:"hero",position:t.heroPosition,te:((d=t.temporal)==null?void 0:d.te)||0,energy_complex:t.energy||{A:50,phi:0}}),o}getDistance(t,o){if(!t||!o)return 1/0;const l=t.x-o.x,d=t.y-o.y;return Math.sqrt(l*l+d*d)}fallbackTick(t){var l,d,p;console.warn("Using fallback tick (backend unavailable)");const o=JSON.parse(JSON.stringify(t));return o.temporal&&(o.temporal.tw+=1,o.temporal.te+=.95,Math.abs(o.temporal.tw-o.temporal.te)>5&&(o.temporal.debt=(o.temporal.debt||0)+.1)),{new_tw:((l=o.temporal)==null?void 0:l.tw)||0,new_te:((d=o.temporal)==null?void 0:d.te)||0,debt:((p=o.temporal)==null?void 0:p.debt)||0,paradoxes:this.detectParadoxes(o)}}injectStyles(){if(document.getElementById("v2-adapter-styles"))return;const t=document.createElement("style");t.id="v2-adapter-styles",t.textContent=`
            .v2-temporal-display {
                background: linear-gradient(135deg, #1a1d3a, #2a2d4a);
                border: 1px solid #4a4d6a;
                border-radius: 8px;
                padding: 10px;
                margin: 10px 0;
                font-family: monospace;
            }
            
            .v2-temporal-display .time-values {
                display: flex;
                justify-content: space-around;
                gap: 15px;
            }
            
            .v2-temporal-display .tw { color: #667eea; }
            .v2-temporal-display .te { color: #48bb78; }
            .v2-temporal-display .drift { color: #ed8936; }
            .v2-temporal-display .drift.warning { color: #f6ad55; }
            .v2-temporal-display .drift.danger { color: #fc8181; }
            
            .v2-temporal-display .debt {
                margin-top: 8px;
                text-align: center;
                padding: 4px;
                border-radius: 4px;
                background: rgba(255,100,100,0.1);
            }
            
            .v2-temporal-display .debt.warning { background: rgba(255,200,100,0.2); }
            .v2-temporal-display .debt.critical { 
                background: rgba(255,50,50,0.3);
                animation: pulse 1s infinite;
            }
            
            .v2-energy-complex {
                background: #1a1d3a;
                border: 1px solid #4a4d6a;
                border-radius: 6px;
                padding: 8px;
                margin: 8px 0;
            }
            
            .v2-energy-complex .energy-bar {
                display: flex;
                height: 20px;
                border-radius: 4px;
                overflow: hidden;
                margin-top: 5px;
            }
            
            .v2-energy-complex .real-part {
                background: linear-gradient(90deg, #667eea, #764ba2);
            }
            
            .v2-energy-complex .imaginary-part {
                background: linear-gradient(90deg, #f093fb, #f5576c);
            }
            
            .v2-regulators {
                display: flex;
                gap: 10px;
                margin: 10px 0;
            }
            
            .v2-regulators .regulator {
                background: #2a2d4a;
                border: 1px solid #4a4d6a;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .v2-regulators .regulator.active {
                border-color: #667eea;
                box-shadow: 0 0 10px rgba(102,126,234,0.5);
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
        `,document.head.appendChild(t)}}typeof window<"u"&&(window.V2Adapter=q);typeof module<"u"&&module.exports&&(module.exports=q);function ae({mapWidth:u,mapHeight:t,miniMapWidth:o=200,miniMapHeight:l=150,entities:d=[],viewportX:p,viewportY:k,viewportWidth:_,viewportHeight:g,onViewportChange:M,style:a,backgroundColor:P="#1a1a2e",borderColor:j="#667eea",viewportColor:N="rgba(102, 126, 234, 0.3)",entityColor:h="#ffffff"}){const I=c.useRef(null),$=c.useRef(!1),z=o/u,S=l/t,J=c.useCallback(()=>{const O=I.current;if(!O)return;const x=O.getContext("2d");x&&(x.fillStyle=P,x.fillRect(0,0,o,l),d.forEach(C=>{const f=C.x*z,D=C.y*S,B=(C.size||2)*Math.min(z,S);C.icon?(x.font=`${B*2}px Arial`,x.textAlign="center",x.textBaseline="middle",x.fillText(C.icon,f,D)):(x.fillStyle=C.color||h,x.beginPath(),x.arc(f,D,B,0,Math.PI*2),x.fill())}),x.strokeStyle=j,x.lineWidth=2,x.strokeRect(p*z,k*S,_*z,g*S),x.fillStyle=N,x.fillRect(p*z,k*S,_*z,g*S),x.strokeStyle=j,x.lineWidth=1,x.strokeRect(0,0,o,l))},[d,p,k,_,g,z,S,o,l,P,j,N,h]);c.useEffect(()=>{J()},[J]);const A=c.useCallback(O=>{if(!M)return;const x=I.current;if(!x)return;const C=x.getBoundingClientRect(),f=O.clientX-C.left,D=O.clientY-C.top,B=f/z-_/2,F=D/S-g/2,v=Math.max(0,Math.min(u-_,B)),U=Math.max(0,Math.min(t-g,F));M(v,U),$.current=!0},[M,z,S,_,g,u,t]),W=c.useCallback(O=>{if(!$.current||!M)return;const x=I.current;if(!x)return;const C=x.getBoundingClientRect(),f=O.clientX-C.left,D=O.clientY-C.top,B=f/z-_/2,F=D/S-g/2,v=Math.max(0,Math.min(u-_,B)),U=Math.max(0,Math.min(t-g,F));M(v,U)},[M,z,S,_,g,u,t]),E=c.useCallback(()=>{$.current=!1},[]);return n.jsxs("div",{style:{position:"absolute",top:20,right:20,border:`2px solid ${j}`,borderRadius:8,overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",cursor:M?"grab":"default",...a},children:[n.jsx("canvas",{ref:I,width:o,height:l,onMouseDown:A,onMouseMove:W,onMouseUp:E,onMouseLeave:E,style:{display:"block",cursor:$.current?"grabbing":"grab"}}),n.jsxs("div",{style:{position:"absolute",bottom:5,left:5,fontSize:10,color:"rgba(255,255,255,0.5)",pointerEvents:"none"},children:[Math.round(p),",",Math.round(k)]})]})}function se(u,t=50){const[o,l]=c.useState(u),d=c.useRef([u]),p=c.useRef(0),k=c.useCallback(h=>{l(I=>{const $=typeof h=="function"?h(I):h;return p.current<d.current.length-1&&(d.current=d.current.slice(0,p.current+1)),d.current.push($),d.current.length>t?d.current.shift():p.current++,$})},[t]),_=c.useCallback(()=>p.current>0?(p.current--,l(d.current[p.current]),!0):!1,[]),g=c.useCallback(()=>p.current<d.current.length-1?(p.current++,l(d.current[p.current]),!0):!1,[]),M=p.current>0,a=p.current<d.current.length-1,P=c.useCallback(()=>{d.current=[u],p.current=0,l(u)},[u]),j=c.useCallback(()=>({states:[...d.current],currentIndex:p.current}),[]),N=c.useCallback(h=>{(h.metaKey||h.ctrlKey)&&!h.shiftKey&&h.key==="z"?(h.preventDefault(),_()):((h.metaKey||h.ctrlKey)&&h.shiftKey&&h.key==="z"||(h.metaKey||h.ctrlKey)&&h.key==="y")&&(h.preventDefault(),g())},[_,g]);return{state:o,setState:k,undo:_,redo:g,canUndo:M,canRedo:a,reset:P,getHistory:j,handleKeyPress:N}}const H={"🏞️ Terrains":{mountain:"⛰️",volcano:"🌋",forest:"🌲",desert:"🏜️",ocean:"🌊",island:"🏝️",cave:"🕳️",snow:"❄️",swamp:"🌿",plains:"🌾",castle:"🏰",city:"🏙️"},"⚔️ Combats":{sword:"⚔️",shield:"🛡️",bow:"🏹",axe:"🪓",spear:"🔱",dagger:"🗡️",bomb:"💣",explosion:"💥",fire:"🔥",ice:"🧊",lightning:"⚡",skull:"💀"},"🏗️ Bâtiments":{castle:"🏰",tower:"🗼",house:"🏠",hut:"🛖",temple:"⛩️",church:"⛪",mosque:"🕌",synagogue:"🕍",ruins:"🏚️",pyramid:"🔺",tent:"⛺",fortress:"🏯"},"💎 Ressources":{gold:"🪙",gem:"💎",crystal:"🔮",chest:"📦",key:"🗝️",potion:"🧪",scroll:"📜",book:"📖",herb:"🌿",mushroom:"🍄",apple:"🍎",bread:"🍞"},"🐉 Créatures":{dragon:"🐉",unicorn:"🦄",phoenix:"🦅",wolf:"🐺",bear:"🐻",spider:"🕷️",snake:"🐍",bat:"🦇",goblin:"👺",troll:"👹",ghost:"👻",skeleton:"🦴"},"📍 Marqueurs":{flag:"🚩",pin:"📍",compass:"🧭",telescope:"🔭",torch:"🔦",campfire:"🔥",signpost:"🪧",question:"❓",exclamation:"❗",checkpoint:"✅",waypoint:"🎯",spawn:"🏁"},"⏰ Temporel":{clock:"⏰",hourglass:"⌛",pendulum:"🕰️",calendar:"📅",moon:"🌙",sun:"☀️",timestar:"⭐",paradox:"🌀"}};function ue(u={}){var Z;const{state:t,setState:o,undo:l,redo:d,canUndo:p,canRedo:k,handleKeyPress:_}=se([]),[g,M]=c.useState(null),[a,P]=c.useState(null),[j,N]=c.useState("place"),[h,I]=c.useState([]),[$,z]=c.useState(""),[S,J]=c.useState(new Set(Object.keys(H))),[A,W]=c.useState(null),[E,O]=c.useState(!1),[x,C]=c.useState("offline"),[f,D]=c.useState({tw:0,te:0,drift:0,debt:0}),[B,F]=c.useState([]),[v,U]=c.useState({vince:{active:!1,intensity:0},anna:{active:!1,decayRate:5},overload:{stack:0}}),ee=c.useRef(null),te=c.useRef(1),w=c.useRef(null),V=c.useRef(null),[K,ne]=c.useState({x:0,y:0,width:800,height:600});c.useEffect(()=>(document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)),[_]),c.useEffect(()=>{console.log("🚀 Initialisation V2 Adapter..."),w.current=new q({rustUrl:"http://localhost:3001",javaUrl:"http://localhost:8082",pythonUrl:"http://localhost:7500"});const e=w.current;return e.injectStyles(),e.connectWebSocket(8001),e.on("ws:connected",()=>{console.log("✅ WebSocket connecté"),O(!0)}),e.on("ws:disconnected",()=>{console.log("❌ WebSocket déconnecté"),O(!1)}),e.on("tick",i=>{D({tw:i.new_tw||0,te:i.new_te||0,drift:Math.abs((i.new_tw||0)-(i.new_te||0)),debt:i.debt||0})}),e.on("paradox",i=>{F(i),i.length>0&&console.warn("⚠️ Paradoxes détectés:",i)}),fetch(`${e.endpoints.rust}/health`).then(i=>i.ok&&C("online")).catch(()=>C("offline")),()=>{e.ws&&e.ws.close(),V.current&&clearInterval(V.current)}},[]),c.useEffect(()=>{if(!(!w.current||!E))return V.current=setInterval(async()=>{const e={temporal:{tw:f.tw+.1,te:f.te+.095,entities:t.map(i=>{var r;return{id:i.id,position:i.position_6d,energy_complex:i.energy_complex||{A:50,phi:0},te:((r=i.temporal)==null?void 0:r.te)||f.te}})},resources:{},regulators:v};try{const i=await w.current.tick(e),r=w.current.detectParadoxes({temporal:{tw:i.new_tw,te:i.new_te,debt:i.debt},regulators:v});r.length>0&&F(r)}catch{const r=w.current.fallbackTick(e);D({tw:r.new_tw,te:r.new_te,drift:Math.abs(r.new_tw-r.new_te),debt:r.debt})}},100),()=>{V.current&&clearInterval(V.current)}},[E,t,f,v]);const G=c.useCallback((e,i)=>{var s,b,y,m,T;if(!g||j!=="place")return;const r={id:`icon_${Date.now()}_${te.current++}`,emoji:g.emoji,name:g.name,category:g.category,position_6d:{x:e,y:i,z:0,t:f.tw,c:1,psi:Math.random()},size:60,rotation:0,opacity:1,energy_complex:{A:50+Math.random()*50,phi:Math.random()*Math.PI*2},temporal:{tw:f.tw,te:f.te,cycle:g.category==="⏰ Temporel"?7:void 0}};o([...t,r]),(s=u.onPlace)==null||s.call(u,{id:r.id,emoji:r.emoji,name:r.name,category:r.category,position_6d:r.position_6d,size:r.size,rotation:r.rotation,opacity:r.opacity});try{(T=w.current)==null||T.upsertEntity({id:r.id,position:{x:r.position_6d.x,y:r.position_6d.y},te:((b=r.temporal)==null?void 0:b.te)??f.te,energy_complex:{A:(y=r.energy_complex)==null?void 0:y.A,phi:(m=r.energy_complex)==null?void 0:m.phi}})}catch(R){console.warn("Upsert entity failed (placeIcon):",R)}w.current&&E&&w.current.ws.send(JSON.stringify({type:"entity_placed",payload:r}))},[g,j,t,f,E,u]),L=c.useCallback((e,i)=>{var T,R,Q;const r=t.find(Y=>Y.id===e),s=t.find(Y=>Y.id===i);if(!r||!s)return;const b=((T=w.current)==null?void 0:T.getDistance(r.position_6d,s.position_6d))||0,y=((R=w.current)==null?void 0:R.calculateInterference({position:r.position_6d,energy_complex:r.energy_complex},{position:s.position_6d,energy_complex:s.energy_complex}))||0,m={id:`conn_${Date.now()}`,from:e,to:i,type:b<100?"spatial":Math.abs(r.position_6d.t-s.position_6d.t)>1?"temporal":"causal",strength:Math.max(.3,1-b/500),interference:y};I([...h,m]),(Q=u.onConnect)==null||Q.call(u,e,i,m.type)},[t,h,u]),re=c.useCallback(e=>{const i=e.currentTarget.getBoundingClientRect(),r=e.clientX-i.left,s=e.clientY-i.top;if(j==="connect"&&A){const b=t.find(y=>{const m=Math.abs(y.position_6d.x-r),T=Math.abs(y.position_6d.y-s);return m<y.size/2&&T<y.size/2});b&&b.id!==A&&(L(A,b.id),W(null),N("place"))}else j==="place"&&G(r,s)},[j,A,t,G,L]),oe=async()=>{var i,r;const e={entity_type:"MAP_6D",name:`Map_${Date.now()}`,position_6d:{x:0,y:0,z:0,t:f.tw,c:1,psi:.5},icons:t,connections:h,temporal_state:f,regulators:v};try{const s=((r=(i=w.current)==null?void 0:i.endpoints)==null?void 0:r.java)||"http://localhost:8082",y=await(await fetch(`${s}/api/interstice/upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();alert(`✅ Map sauvegardée! ID: ${y.interstice_id}`)}catch(s){console.error("❌ Erreur sauvegarde:",s),alert("Erreur de sauvegarde - Vérifiez que l'orchestrateur est lancé")}},X=async e=>{if(w.current)try{e==="vince"?(await w.current.activateVince((a==null?void 0:a.position_6d)||{x:0,y:0,z:0},1),U({...v,vince:{active:!0,intensity:1}})):e==="anna"?(await w.current.activateAnna(10),U({...v,anna:{active:!0,decayRate:10}})):e==="overload"&&(await w.current.triggerOverload(),U({...v,overload:{stack:v.overload.stack+1}}))}catch(i){console.error(`Erreur activation ${e}:`,i)}},ie=()=>{const e={version:"v2_6d",timestamp:new Date().toISOString(),icons:t,connections:h,temporal:f,regulators:v},i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download=`map_v2_6d_${Date.now()}.json`,s.click()};return n.jsxs("div",{style:{display:"flex",height:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:[n.jsxs("div",{style:{width:320,background:"linear-gradient(180deg, #1a1a2e, #16213e)",padding:20,overflowY:"auto",borderRight:"3px solid #764ba2",boxShadow:"5px 0 20px rgba(0,0,0,0.5)"},children:[n.jsxs("div",{style:{marginBottom:20,textAlign:"center",position:"sticky",top:-20,background:"linear-gradient(180deg, #1a1a2e, #16213e)",padding:"10px 0",zIndex:100},children:[n.jsx("h2",{style:{fontSize:"1.8em",marginBottom:10,textShadow:"2px 2px 4px rgba(0,0,0,0.5)",background:"linear-gradient(45deg, #667eea, #764ba2)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"🎨 Palette d'Icônes V2"}),n.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"center",marginBottom:10},children:[n.jsxs("span",{style:{fontSize:12,padding:"4px 8px",borderRadius:15,background:E?"rgba(72, 187, 120, 0.3)":"rgba(255, 100, 100, 0.3)",border:`1px solid ${E?"#48bb78":"#ff6464"}`,color:E?"#48bb78":"#ff6464"},children:[E?"🟢":"🔴"," WebSocket"]}),n.jsxs("span",{style:{fontSize:12,padding:"4px 8px",borderRadius:15,background:x==="online"?"rgba(72, 187, 120, 0.3)":"rgba(255, 100, 100, 0.3)",border:`1px solid ${x==="online"?"#48bb78":"#ff6464"}`,color:x==="online"?"#48bb78":"#ff6464"},children:[x==="online"?"🟢":"🔴"," Orchestrateur"]})]}),n.jsxs("div",{style:{background:"rgba(102, 126, 234, 0.1)",border:"1px solid #667eea",borderRadius:10,padding:8,marginBottom:10,fontSize:11,fontFamily:"monospace"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-around",marginBottom:5},children:[n.jsxs("span",{style:{color:"#667eea"},children:["TW: ",f.tw.toFixed(1)]}),n.jsxs("span",{style:{color:"#48bb78"},children:["TE: ",f.te.toFixed(1)]}),n.jsxs("span",{style:{color:f.drift>5?"#ff6464":"#ed8936"},children:["Δt: ",f.drift.toFixed(1)]})]}),f.debt>0&&n.jsxs("div",{style:{color:f.debt>50?"#ff6464":"#f6ad55",textAlign:"center"},children:["💸 Dette: ",f.debt.toFixed(1)]}),B.length>0&&n.jsxs("div",{style:{color:"#ff6464",textAlign:"center",marginTop:5},children:["⚠️ ",B.length," paradoxe(s)"]})]}),n.jsx("input",{type:"text",placeholder:"🔍 Rechercher...",value:$,onChange:e=>z(e.target.value),style:{width:"100%",padding:10,border:"2px solid #764ba2",background:"rgba(15, 52, 96, 0.8)",color:"white",borderRadius:10,fontSize:16}})]}),Object.entries(H).map(([e,i])=>{const r=Object.entries(i).filter(([s])=>$===""||s.toLowerCase().includes($.toLowerCase()));return r.length===0&&$!==""?null:n.jsxs("div",{style:{marginBottom:25,background:"rgba(15, 52, 96, 0.3)",borderRadius:10,padding:10,border:"1px solid rgba(118, 75, 162, 0.3)"},children:[n.jsxs("div",{onClick:()=>{const s=new Set(S);s.has(e)?s.delete(e):s.add(e),J(s)},style:{background:"linear-gradient(90deg, #0f3460, #1e5f8e)",padding:10,borderRadius:8,marginBottom:10,cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold"},children:[n.jsx("span",{children:e}),n.jsx("span",{children:S.has(e)?"▼":"▶"})]}),S.has(e)&&n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8,padding:5},children:r.map(([s,b])=>n.jsxs("div",{onClick:()=>M({emoji:b,name:s,category:e}),style:{width:60,height:60,background:(g==null?void 0:g.name)===s?"rgba(102, 126, 234, 0.5)":"rgba(15, 52, 96, 0.5)",border:(g==null?void 0:g.name)===s?"2px solid #667eea":"1px solid rgba(255,255,255,0.1)",borderRadius:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:y=>{y.currentTarget.style.transform="scale(1.1)",y.currentTarget.style.background="rgba(102, 126, 234, 0.3)"},onMouseLeave:y=>{y.currentTarget.style.transform="scale(1)",y.currentTarget.style.background=(g==null?void 0:g.name)===s?"rgba(102, 126, 234, 0.5)":"rgba(15, 52, 96, 0.5)"},title:s,children:[n.jsx("span",{style:{fontSize:30},children:b}),n.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.7)",marginTop:2},children:s.slice(0,8)})]},s))})]},e)})]}),n.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden"},children:[n.jsxs("div",{style:{position:"absolute",top:20,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",borderRadius:25,padding:"10px 20px",display:"flex",gap:15,zIndex:100},children:[n.jsx("button",{onClick:()=>N("place"),style:{padding:"8px 20px",background:j==="place"?"#667eea":"transparent",border:"2px solid #667eea",borderRadius:20,color:"white",cursor:"pointer"},children:"✏️ Placer"}),n.jsx("button",{onClick:()=>N("connect"),style:{padding:"8px 20px",background:j==="connect"?"#667eea":"transparent",border:"2px solid #667eea",borderRadius:20,color:"white",cursor:"pointer"},children:"🔗 Connecter"}),n.jsx("button",{onClick:()=>N("delete"),style:{padding:"8px 20px",background:j==="delete"?"#ff4444":"transparent",border:"2px solid #ff4444",borderRadius:20,color:"white",cursor:"pointer"},children:"🗑️ Supprimer"}),n.jsx("button",{onClick:oe,style:{padding:"8px 20px",background:"linear-gradient(135deg, #48bb78, #38a169)",border:"none",borderRadius:20,color:"white",cursor:"pointer",fontWeight:"bold"},children:"💾 Sauvegarder V2"}),n.jsx("button",{onClick:ie,style:{padding:"8px 20px",background:"linear-gradient(135deg, #ed8936, #dd6b20)",border:"none",borderRadius:20,color:"white",cursor:"pointer",fontWeight:"bold"},children:"📥 Exporter"})]}),n.jsxs("div",{style:{position:"absolute",top:80,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.6)",borderRadius:15,padding:"8px 15px",display:"flex",gap:10,zIndex:99},children:[n.jsxs("button",{onClick:()=>X("vince"),style:{padding:"5px 15px",background:v.vince.active?"#667eea":"transparent",border:"1px solid #667eea",borderRadius:10,color:"white",cursor:"pointer",fontSize:12},children:["⚡ Vince ",v.vince.active&&`(${v.vince.intensity})`]}),n.jsxs("button",{onClick:()=>X("anna"),style:{padding:"5px 15px",background:v.anna.active?"#48bb78":"transparent",border:"1px solid #48bb78",borderRadius:10,color:"white",cursor:"pointer",fontSize:12},children:["🌀 Anna ",v.anna.active&&`(-${v.anna.decayRate}%)`]}),n.jsxs("button",{onClick:()=>X("overload"),style:{padding:"5px 15px",background:v.overload.stack>0?"#ff6464":"transparent",border:"1px solid #ff6464",borderRadius:10,color:"white",cursor:"pointer",fontSize:12},children:["💥 Overload (",v.overload.stack,"/10)"]})]}),n.jsxs("div",{ref:ee,onClick:re,style:{width:"100%",height:"100%",background:"radial-gradient(circle at center, rgba(102, 126, 234, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%)",cursor:j==="place"&&g?"crosshair":j==="connect"?"cell":j==="delete"?"not-allowed":"default",position:"relative"},children:[t.map(e=>{var i;return n.jsxs("div",{onClick:r=>{r.stopPropagation(),j==="delete"?(o(t.filter(s=>s.id!==e.id)),I(h.filter(s=>s.from!==e.id&&s.to!==e.id))):j==="connect"?A?A!==e.id&&(L(A,e.id),W(null)):W(e.id):P(e)},style:{position:"absolute",left:e.position_6d.x-e.size/2,top:e.position_6d.y-e.size/2,width:e.size,height:e.size,fontSize:e.size*.7,display:"flex",alignItems:"center",justifyContent:"center",transform:`rotate(${e.rotation}deg) scale(${1+e.position_6d.z*.1})`,opacity:e.opacity*(1-e.position_6d.psi*.3),cursor:"pointer",background:(a==null?void 0:a.id)===e.id?"rgba(102, 126, 234, 0.3)":A===e.id?"rgba(72, 187, 120, 0.3)":"transparent",border:(a==null?void 0:a.id)===e.id?"2px solid #667eea":A===e.id?"2px solid #48bb78":"none",borderRadius:10,transition:"all 0.2s",animation:(i=e.temporal)!=null&&i.cycle?`pulse ${e.temporal.cycle}s infinite`:void 0},children:[e.emoji,e.category==="⏰ Temporel"&&n.jsx("div",{style:{position:"absolute",bottom:-5,right:-5,fontSize:10,background:"rgba(102, 126, 234, 0.8)",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:Math.floor(e.position_6d.t)})]},e.id)}),n.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"temporal-gradient",children:[n.jsx("stop",{offset:"0%",stopColor:"#667eea",stopOpacity:"0.8"}),n.jsx("stop",{offset:"50%",stopColor:"#764ba2",stopOpacity:"0.5"}),n.jsx("stop",{offset:"100%",stopColor:"#667eea",stopOpacity:"0.8"})]}),n.jsxs("linearGradient",{id:"causal-gradient",children:[n.jsx("stop",{offset:"0%",stopColor:"#48bb78",stopOpacity:"0.8"}),n.jsx("stop",{offset:"100%",stopColor:"#38a169",stopOpacity:"0.3"})]})]}),h.map(e=>{const i=t.find(s=>s.id===e.from),r=t.find(s=>s.id===e.to);return!i||!r?null:n.jsxs("g",{children:[n.jsx("line",{x1:i.position_6d.x,y1:i.position_6d.y,x2:r.position_6d.x,y2:r.position_6d.y,stroke:e.type==="temporal"?"url(#temporal-gradient)":e.type==="causal"?"url(#causal-gradient)":"rgba(237, 137, 54, 0.5)",strokeWidth:2+(e.interference||0)*3,strokeDasharray:e.type==="temporal"?"10,5":e.type==="causal"?"5,3":"0",opacity:e.strength}),e.interference&&e.interference>.5&&n.jsxs("circle",{cx:(i.position_6d.x+r.position_6d.x)/2,cy:(i.position_6d.y+r.position_6d.y)/2,r:5+e.interference*10,fill:"none",stroke:"#f093fb",strokeWidth:"1",opacity:e.interference,children:[n.jsx("animate",{attributeName:"r",from:5+e.interference*10,to:10+e.interference*15,dur:"2s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"opacity",from:e.interference,to:"0",dur:"2s",repeatCount:"indefinite"})]})]},e.id)})]})]}),n.jsxs("div",{style:{position:"absolute",bottom:20,right:20,width:200,height:150,background:"rgba(0,0,0,0.8)",border:"2px solid #667eea",borderRadius:10,padding:5},children:[n.jsxs("div",{style:{color:"white",fontSize:11,marginBottom:5,display:"flex",justifyContent:"space-between"},children:[n.jsx("span",{children:"Minimap"}),n.jsxs("span",{style:{fontSize:9,color:"#667eea"},children:[t.length," icônes | ",h.length," liens"]})]}),n.jsxs("div",{style:{width:"100%",height:"calc(100% - 20px)",background:"rgba(102, 126, 234, 0.1)",position:"relative"},children:[n.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:h.map(e=>{const i=t.find(s=>s.id===e.from),r=t.find(s=>s.id===e.to);return!i||!r?null:n.jsx("line",{x1:`${i.position_6d.x/window.innerWidth*100}%`,y1:`${i.position_6d.y/window.innerHeight*100}%`,x2:`${r.position_6d.x/window.innerWidth*100}%`,y2:`${r.position_6d.y/window.innerHeight*100}%`,stroke:e.type==="temporal"?"#667eea":e.type==="causal"?"#48bb78":"#ed8936",strokeWidth:"0.5",opacity:"0.5"},e.id)})}),t.map(e=>n.jsx("div",{style:{position:"absolute",left:`${e.position_6d.x/window.innerWidth*100}%`,top:`${e.position_6d.y/window.innerHeight*100}%`,width:4,height:4,background:e.category==="⏰ Temporel"?"#f093fb":e.category==="🐉 Créatures"?"#ff6464":e.category==="💎 Ressources"?"#ffd700":"#667eea",borderRadius:"50%",transform:"translate(-50%, -50%)"}},e.id))]})]}),n.jsx(ae,{mapWidth:2e3,mapHeight:2e3,entities:t.map(e=>({x:e.position_6d.x,y:e.position_6d.y,icon:e.emoji,size:e.size})),viewportX:K.x,viewportY:K.y,viewportWidth:K.width,viewportHeight:K.height,onViewportChange:(e,i)=>ne(r=>({...r,x:e,y:i})),style:{top:70}}),n.jsxs("div",{style:{position:"absolute",top:20,left:340,display:"flex",gap:10,zIndex:1e3},children:[n.jsx("button",{onClick:l,disabled:!p,title:"Undo (Cmd+Z)",style:{padding:"8px 16px",background:p?"linear-gradient(135deg, #667eea, #764ba2)":"rgba(0,0,0,0.3)",border:"none",borderRadius:8,color:"white",cursor:p?"pointer":"not-allowed",opacity:p?1:.5,fontSize:16},children:"↩️ Undo"}),n.jsx("button",{onClick:d,disabled:!k,title:"Redo (Cmd+Shift+Z)",style:{padding:"8px 16px",background:k?"linear-gradient(135deg, #667eea, #764ba2)":"rgba(0,0,0,0.3)",border:"none",borderRadius:8,color:"white",cursor:k?"pointer":"not-allowed",opacity:k?1:.5,fontSize:16},children:"↪️ Redo"})]})]}),a&&n.jsxs("div",{style:{width:300,background:"linear-gradient(180deg, #16213e, #1a1a2e)",padding:20,borderLeft:"3px solid #764ba2",overflowY:"auto"},children:[n.jsx("h3",{style:{color:"#667eea",marginBottom:20},children:"Propriétés 6D"}),n.jsxs("div",{style:{marginBottom:20,padding:10,background:"rgba(102, 126, 234, 0.1)",borderRadius:10},children:[n.jsx("div",{style:{fontSize:24,textAlign:"center",marginBottom:10},children:a.emoji}),n.jsx("div",{style:{textAlign:"center",color:"white",fontWeight:"bold"},children:a.name}),n.jsx("div",{style:{textAlign:"center",color:"#667eea",fontSize:12},children:a.category})]}),n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{color:"white",fontSize:12,fontWeight:"bold"},children:"Position 6D"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[n.jsxs("div",{children:[n.jsx("label",{style:{color:"#667eea",fontSize:10},children:"X (Spatial)"}),n.jsx("input",{type:"number",value:Math.round(a.position_6d.x),onChange:e=>{var s,b,y,m,T;const i=t.map(R=>R.id===a.id?{...R,position_6d:{...R.position_6d,x:Number(e.target.value)}}:R);o(i);const r=Number(e.target.value);try{(m=w.current)==null||m.upsertEntity({id:a.id,position:{x:r,y:a.position_6d.y},te:((s=a.temporal)==null?void 0:s.te)??f.te,energy_complex:{A:(b=a.energy_complex)==null?void 0:b.A,phi:(y=a.energy_complex)==null?void 0:y.phi}})}catch{}(T=u.onUpdate)==null||T.call(u,a.id,{position_6d:{x:r}})},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #667eea",borderRadius:5,color:"white"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{color:"#667eea",fontSize:10},children:"Y (Spatial)"}),n.jsx("input",{type:"number",value:Math.round(a.position_6d.y),onChange:e=>{var s,b,y,m,T;const i=t.map(R=>R.id===a.id?{...R,position_6d:{...R.position_6d,y:Number(e.target.value)}}:R);o(i);const r=Number(e.target.value);try{(m=w.current)==null||m.upsertEntity({id:a.id,position:{x:a.position_6d.x,y:r},te:((s=a.temporal)==null?void 0:s.te)??f.te,energy_complex:{A:(b=a.energy_complex)==null?void 0:b.A,phi:(y=a.energy_complex)==null?void 0:y.phi}})}catch{}(T=u.onUpdate)==null||T.call(u,a.id,{position_6d:{y:r}})},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #667eea",borderRadius:5,color:"white"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{color:"#48bb78",fontSize:10},children:"Z (Altitude)"}),n.jsx("input",{type:"number",value:a.position_6d.z,step:"0.1",onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,position_6d:{...r.position_6d,z:Number(e.target.value)}}:r);o(i)},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #48bb78",borderRadius:5,color:"white"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{color:"#f093fb",fontSize:10},children:"T (Temps)"}),n.jsx("input",{type:"number",value:a.position_6d.t.toFixed(1),step:"0.1",onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,position_6d:{...r.position_6d,t:Number(e.target.value)}}:r);o(i)},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #f093fb",borderRadius:5,color:"white"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{color:"#ed8936",fontSize:10},children:"C (Causalité)"}),n.jsx("input",{type:"number",value:a.position_6d.c,step:"0.1",onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,position_6d:{...r.position_6d,c:Number(e.target.value)}}:r);o(i)},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #ed8936",borderRadius:5,color:"white"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{color:"#ffd700",fontSize:10},children:"Ψ (Quantum)"}),n.jsx("input",{type:"number",value:a.position_6d.psi.toFixed(2),step:"0.01",min:"0",max:"1",onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,position_6d:{...r.position_6d,psi:Number(e.target.value)}}:r);o(i)},style:{width:"100%",padding:5,background:"rgba(15, 52, 96, 0.8)",border:"1px solid #ffd700",borderRadius:5,color:"white"}})]})]})]}),a.energy_complex&&n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{color:"white",fontSize:12,fontWeight:"bold"},children:"Énergie Complexe (E = A + iΦ)"}),n.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(240, 147, 251, 0.1)",borderRadius:8},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:5},children:[n.jsx("span",{style:{color:"#f093fb",fontSize:11},children:"Amplitude (A)"}),n.jsx("span",{style:{color:"white"},children:a.energy_complex.A.toFixed(1)})]}),n.jsx("input",{type:"range",min:"0",max:"100",value:a.energy_complex.A,onChange:e=>{var r,s,b,y;const i=t.map(m=>m.id===a.id?{...m,energy_complex:{...m.energy_complex,A:Number(e.target.value)}}:m);o(i);try{(b=w.current)==null||b.upsertEntity({id:a.id,position:{x:a.position_6d.x,y:a.position_6d.y},te:((r=a.temporal)==null?void 0:r.te)??f.te,energy_complex:{A:Number(e.target.value),phi:(s=a.energy_complex)==null?void 0:s.phi}})}catch{}(y=u.onUpdate)==null||y.call(u,a.id,{energy_complex:{A:Number(e.target.value)}})},style:{width:"100%"}}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:5,marginTop:10},children:[n.jsx("span",{style:{color:"#f093fb",fontSize:11},children:"Phase (Φ)"}),n.jsxs("span",{style:{color:"white"},children:[(a.energy_complex.phi*180/Math.PI).toFixed(0),"°"]})]}),n.jsx("input",{type:"range",min:"0",max:Math.PI*2,step:"0.01",value:a.energy_complex.phi,onChange:e=>{var r,s,b,y;const i=t.map(m=>m.id===a.id?{...m,energy_complex:{...m.energy_complex,phi:Number(e.target.value)}}:m);o(i);try{(b=w.current)==null||b.upsertEntity({id:a.id,position:{x:a.position_6d.x,y:a.position_6d.y},te:((r=a.temporal)==null?void 0:r.te)??f.te,energy_complex:{A:(s=a.energy_complex)==null?void 0:s.A,phi:Number(e.target.value)}})}catch{}(y=u.onUpdate)==null||y.call(u,a.id,{energy_complex:{phi:Number(e.target.value)}})},style:{width:"100%"}}),n.jsx("div",{style:{marginTop:10,textAlign:"center",fontSize:14,color:"#f093fb",fontFamily:"monospace"},children:(Z=w.current)==null?void 0:Z.calculateComplexEnergy(a.energy_complex.A,a.energy_complex.phi).toString()})]})]}),n.jsxs("div",{style:{marginBottom:15},children:[n.jsxs("label",{style:{color:"white",fontSize:12},children:["Taille: ",a.size,"px"]}),n.jsx("input",{type:"range",min:"20",max:"200",value:a.size,onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,size:Number(e.target.value)}:r);o(i)},style:{width:"100%",marginTop:5}})]}),n.jsxs("div",{style:{marginBottom:15},children:[n.jsxs("label",{style:{color:"white",fontSize:12},children:["Rotation: ",a.rotation,"°"]}),n.jsx("input",{type:"range",min:"0",max:"360",value:a.rotation,onChange:e=>{const i=t.map(r=>r.id===a.id?{...r,rotation:Number(e.target.value)}:r);o(i)},style:{width:"100%",marginTop:5}})]}),n.jsx("button",{onClick:()=>{var e;o(t.filter(i=>i.id!==a.id)),I(h.filter(i=>i.from!==a.id&&i.to!==a.id)),P(null),(e=u.onDelete)==null||e.call(u,a.id)},style:{width:"100%",padding:10,background:"#ff4444",border:"none",borderRadius:5,color:"white",cursor:"pointer",marginTop:20},children:"🗑️ Supprimer"})]}),n.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.1); opacity: 0.8; }
        }
      `})]})}export{ue as MapIconPlacerV2};
//# sourceMappingURL=MapIconPlacerV2-kN9m4EEZ.js.map
