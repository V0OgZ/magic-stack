{"version":3,"file":"MapIconPlacerV2-kN9m4EEZ.js","sources":["../../../../shared/v2-adapter.js","../../src/shared/components/MiniMap.tsx","../../src/shared/hooks/useUndoRedo.ts","../../src/modes/editor/MapIconPlacerV2.tsx"],"sourcesContent":["/**\n * 🔮 V2 Adapter - Module d'intégration universel\n * Utilisable dans tous les HTML et le futur React unifié\n */\n\nclass V2Adapter {\n    constructor(config = {}) {\n        this.endpoints = {\n            rust: config.rustUrl || 'http://localhost:3001',\n            java: config.javaUrl || 'http://localhost:8080',\n            python: config.pythonUrl || 'http://localhost:7500'\n        };\n        \n        this.cache = new Map();\n        this.listeners = new Map();\n        this.ws = null;\n    }\n    \n    // ========== CORE V2 METHODS ==========\n    \n    /**\n     * Tick V2 universel - appelable depuis n'importe quel mode\n     */\n    async tick(state) {\n        try {\n            const response = await fetch(`${this.endpoints.rust}/api/v2/tick`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    current_tw: state.temporal?.tw || 0,\n                    current_te: state.temporal?.te || 0,\n                    entities: this.extractEntities(state),\n                    resources: state.resources,\n                    regulators: state.regulators\n                })\n            });\n            \n            if (!response.ok) throw new Error(`V2 tick failed: ${response.status}`);\n            \n            const result = await response.json();\n            this.emit('tick', result);\n            return result;\n        } catch (error) {\n            console.error('V2 Tick Error:', error);\n            return this.fallbackTick(state);\n        }\n    }\n    \n    /**\n     * Calcul du drift temporel\n     */\n    calculateDrift(tw, te) {\n        return tw - te;\n    }\n    \n    /**\n     * Calcul de l'énergie complexe E = A + iΦ\n     */\n    calculateComplexEnergy(amplitude, phase) {\n        return {\n            real: amplitude * Math.cos(phase),\n            imaginary: amplitude * Math.sin(phase),\n            magnitude: amplitude,\n            phase: phase,\n            toString() {\n                return `${this.real.toFixed(1)} + ${this.imaginary.toFixed(1)}i`;\n            }\n        };\n    }\n    \n    /**\n     * Calcul de l'interférence quantique\n     */\n    calculateInterference(entity1, entity2) {\n        if (!entity1.energy_complex || !entity2.energy_complex) return 0;\n        const p1 = (entity1.energy_complex.phi ?? entity1.energy_complex.phase ?? 0);\n        const p2 = (entity2.energy_complex.phi ?? entity2.energy_complex.phase ?? 0);\n        const phaseDiff = p1 - p2;\n        const distance = this.getDistance(entity1.position, entity2.position);\n        if (distance > 10) return 0;\n        return Math.cos(phaseDiff) * (1 - distance / 10);\n    }\n    \n    /**\n     * Détection de paradoxes\n     */\n    detectParadoxes(state) {\n        const paradoxes = [];\n        \n        // Paradoxe de drift excessif\n        if (Math.abs(state.temporal.tw - state.temporal.te) > 10) {\n            paradoxes.push({\n                type: 'excessive_drift',\n                severity: 'major',\n                entities: ['global']\n            });\n        }\n        \n        // Paradoxe de dette temporelle\n        if (state.temporal.debt > 50) {\n            paradoxes.push({\n                type: 'temporal_debt',\n                severity: 'critical',\n                debt: state.temporal.debt\n            });\n        }\n        \n        // Paradoxe d'overload\n        if (state.regulators?.overload?.stack >= 10) {\n            paradoxes.push({\n                type: 'overload_explosion',\n                severity: 'critical'\n            });\n        }\n        \n        return paradoxes;\n    }\n    \n    /**\n     * Upsert d'une entité V2 (pour éditeur jouable)\n     */\n    async upsertEntity(entity) {\n        const res = await fetch(`${this.endpoints.rust}/api/v2/entity`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(entity)\n        });\n        return res.json();\n    }\n\n    // ========== REGULATORS ==========\n    \n    async activateVince(position, intensity = 1) {\n        return fetch(`${this.endpoints.rust}/api/v2/regulators/vince`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ position, intensity })\n        }).then(r => r.json());\n    }\n    \n    async activateAnna(decayRate = 5, zone = null) {\n        return fetch(`${this.endpoints.rust}/api/v2/regulators/anna`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ decay_rate: decayRate, zone })\n        }).then(r => r.json());\n    }\n    \n    async triggerOverload() {\n        return fetch(`${this.endpoints.rust}/api/v2/regulators/overload`, {\n            method: 'POST'\n        }).then(r => r.json());\n    }\n    \n    // ========== UI HELPERS ==========\n    \n    /**\n     * Génère l'HTML pour l'affichage temporel\n     */\n    renderTemporalDisplay(tw, te, debt = 0) {\n        const drift = Math.abs(tw - te);\n        const driftClass = drift > 5 ? 'danger' : drift > 2 ? 'warning' : '';\n        const debtClass = debt > 50 ? 'critical' : debt > 20 ? 'warning' : '';\n        \n        return `\n            <div class=\"v2-temporal-display\">\n                <div class=\"time-values\">\n                    <span class=\"tw\">TW: ${tw.toFixed(1)}</span>\n                    <span class=\"te\">TE: ${te.toFixed(1)}</span>\n                    <span class=\"drift ${driftClass}\">Δt: ${drift.toFixed(1)}</span>\n                </div>\n                ${debt > 0 ? `\n                    <div class=\"debt ${debtClass}\">\n                        💸 Dette: ${debt.toFixed(1)}\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }\n    \n    /**\n     * Génère l'HTML pour l'énergie complexe\n     */\n    renderEnergyComplex(energy) {\n        if (!energy) return '';\n        \n        const complex = this.calculateComplexEnergy(\n            energy.amplitude || energy.A || 0,\n            energy.phase || energy.phi || 0\n        );\n        \n        return `\n            <div class=\"v2-energy-complex\">\n                <div class=\"energy-value\">${complex.toString()}</div>\n                <div class=\"energy-bar\">\n                    <div class=\"real-part\" style=\"width: ${complex.real}%\"></div>\n                    <div class=\"imaginary-part\" style=\"width: ${complex.imaginary}%\"></div>\n                </div>\n            </div>\n        `;\n    }\n    \n    /**\n     * Génère l'HTML pour les régulateurs\n     */\n    renderRegulators(regulators) {\n        if (!regulators) return '';\n        \n        return `\n            <div class=\"v2-regulators\">\n                ${regulators.vince ? `\n                    <div class=\"regulator vince ${regulators.vince.active ? 'active' : ''}\">\n                        <span class=\"name\">Vince</span>\n                        <span class=\"status\">${regulators.vince.active ? '⚡' : '💤'}</span>\n                    </div>\n                ` : ''}\n                ${regulators.anna ? `\n                    <div class=\"regulator anna ${regulators.anna.active ? 'active' : ''}\">\n                        <span class=\"name\">Anna</span>\n                        <span class=\"decay\">-${regulators.anna.decayRate || 5}%</span>\n                    </div>\n                ` : ''}\n                ${regulators.overload ? `\n                    <div class=\"regulator overload\">\n                        <span class=\"name\">Overload</span>\n                        <span class=\"stack\">${regulators.overload.stack || 0}/10</span>\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }\n    \n    // ========== WEBSOCKET ==========\n    \n    connectWebSocket(port = 8001) {\n        if (this.ws) return;\n        \n        this.ws = new WebSocket(`ws://localhost:${port}`);\n        \n        this.ws.onopen = () => {\n            console.log('✅ V2 WebSocket connected');\n            this.emit('ws:connected');\n        };\n        \n        this.ws.onmessage = (event) => {\n            const data = JSON.parse(event.data);\n            this.emit('ws:message', data);\n            \n            // Auto-update basé sur le type de message\n            if (data.type === 'tick') {\n                this.emit('tick', data.payload);\n            } else if (data.type === 'paradox') {\n                this.emit('paradox', data.payload);\n            }\n        };\n        \n        this.ws.onerror = (error) => {\n            console.error('WebSocket error:', error);\n            this.emit('ws:error', error);\n        };\n        \n        this.ws.onclose = () => {\n            console.log('WebSocket disconnected');\n            this.ws = null;\n            this.emit('ws:disconnected');\n        };\n    }\n    \n    // ========== EVENT SYSTEM ==========\n    \n    on(event, callback) {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        this.listeners.get(event).push(callback);\n    }\n    \n    off(event, callback) {\n        const callbacks = this.listeners.get(event);\n        if (callbacks) {\n            const index = callbacks.indexOf(callback);\n            if (index > -1) callbacks.splice(index, 1);\n        }\n    }\n    \n    emit(event, data) {\n        const callbacks = this.listeners.get(event);\n        if (callbacks) {\n            callbacks.forEach(cb => cb(data));\n        }\n    }\n    \n    // ========== UTILITIES ==========\n    \n    extractEntities(state) {\n        const entities = [];\n        \n        // Extraction depuis différents formats possibles\n        if (state.temporal?.entities) {\n            // Format Map\n            if (state.temporal.entities instanceof Map) {\n                state.temporal.entities.forEach((data, id) => {\n                    entities.push({ id, ...data });\n                });\n            }\n            // Format Array\n            else if (Array.isArray(state.temporal.entities)) {\n                entities.push(...state.temporal.entities);\n            }\n        }\n        \n        // Format legacy (hero direct dans state)\n        if (state.heroPosition && !entities.find(e => e.id === 'hero')) {\n            entities.push({\n                id: 'hero',\n                position: state.heroPosition,\n                te: state.temporal?.te || 0,\n                energy_complex: state.energy || { A: 50, phi: 0 }\n            });\n        }\n        \n        return entities;\n    }\n    \n    getDistance(pos1, pos2) {\n        if (!pos1 || !pos2) return Infinity;\n        const dx = pos1.x - pos2.x;\n        const dy = pos1.y - pos2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n    \n    fallbackTick(state) {\n        // Simulation locale si backend non disponible\n        console.warn('Using fallback tick (backend unavailable)');\n        \n        const newState = JSON.parse(JSON.stringify(state));\n        \n        // Simulation basique\n        if (newState.temporal) {\n            newState.temporal.tw += 1;\n            newState.temporal.te += 0.95;\n            \n            // Accumulation de dette\n            const drift = Math.abs(newState.temporal.tw - newState.temporal.te);\n            if (drift > 5) {\n                newState.temporal.debt = (newState.temporal.debt || 0) + 0.1;\n            }\n        }\n        \n        return {\n            new_tw: newState.temporal?.tw || 0,\n            new_te: newState.temporal?.te || 0,\n            debt: newState.temporal?.debt || 0,\n            paradoxes: this.detectParadoxes(newState)\n        };\n    }\n    \n    // ========== CSS INJECTION ==========\n    \n    injectStyles() {\n        if (document.getElementById('v2-adapter-styles')) return;\n        \n        const style = document.createElement('style');\n        style.id = 'v2-adapter-styles';\n        style.textContent = `\n            .v2-temporal-display {\n                background: linear-gradient(135deg, #1a1d3a, #2a2d4a);\n                border: 1px solid #4a4d6a;\n                border-radius: 8px;\n                padding: 10px;\n                margin: 10px 0;\n                font-family: monospace;\n            }\n            \n            .v2-temporal-display .time-values {\n                display: flex;\n                justify-content: space-around;\n                gap: 15px;\n            }\n            \n            .v2-temporal-display .tw { color: #667eea; }\n            .v2-temporal-display .te { color: #48bb78; }\n            .v2-temporal-display .drift { color: #ed8936; }\n            .v2-temporal-display .drift.warning { color: #f6ad55; }\n            .v2-temporal-display .drift.danger { color: #fc8181; }\n            \n            .v2-temporal-display .debt {\n                margin-top: 8px;\n                text-align: center;\n                padding: 4px;\n                border-radius: 4px;\n                background: rgba(255,100,100,0.1);\n            }\n            \n            .v2-temporal-display .debt.warning { background: rgba(255,200,100,0.2); }\n            .v2-temporal-display .debt.critical { \n                background: rgba(255,50,50,0.3);\n                animation: pulse 1s infinite;\n            }\n            \n            .v2-energy-complex {\n                background: #1a1d3a;\n                border: 1px solid #4a4d6a;\n                border-radius: 6px;\n                padding: 8px;\n                margin: 8px 0;\n            }\n            \n            .v2-energy-complex .energy-bar {\n                display: flex;\n                height: 20px;\n                border-radius: 4px;\n                overflow: hidden;\n                margin-top: 5px;\n            }\n            \n            .v2-energy-complex .real-part {\n                background: linear-gradient(90deg, #667eea, #764ba2);\n            }\n            \n            .v2-energy-complex .imaginary-part {\n                background: linear-gradient(90deg, #f093fb, #f5576c);\n            }\n            \n            .v2-regulators {\n                display: flex;\n                gap: 10px;\n                margin: 10px 0;\n            }\n            \n            .v2-regulators .regulator {\n                background: #2a2d4a;\n                border: 1px solid #4a4d6a;\n                border-radius: 6px;\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            \n            .v2-regulators .regulator.active {\n                border-color: #667eea;\n                box-shadow: 0 0 10px rgba(102,126,234,0.5);\n            }\n            \n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n        `;\n        document.head.appendChild(style);\n    }\n}\n\n// Export pour HTML classique\nif (typeof window !== 'undefined') {\n    window.V2Adapter = V2Adapter;\n}\n\n// Export pour modules ES6 / CommonJS\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = V2Adapter;\n}\n\n// Export pour TypeScript / ES6\nexport default V2Adapter;\n","/**\n * 🗺️ Mini-Map Component\n * Composant exportable pour vue d'ensemble\n */\n\nimport React, { useRef, useEffect, useCallback } from 'react';\n\ninterface MiniMapProps {\n  // Dimensions\n  mapWidth: number;\n  mapHeight: number;\n  miniMapWidth?: number;\n  miniMapHeight?: number;\n  \n  // Données\n  entities?: Array<{\n    x: number;\n    y: number;\n    color?: string;\n    icon?: string;\n    size?: number;\n  }>;\n  \n  // Viewport\n  viewportX: number;\n  viewportY: number;\n  viewportWidth: number;\n  viewportHeight: number;\n  \n  // Callbacks\n  onViewportChange?: (x: number, y: number) => void;\n  \n  // Style\n  style?: React.CSSProperties;\n  backgroundColor?: string;\n  borderColor?: string;\n  viewportColor?: string;\n  entityColor?: string;\n}\n\nexport function MiniMap({\n  mapWidth,\n  mapHeight,\n  miniMapWidth = 200,\n  miniMapHeight = 150,\n  entities = [],\n  viewportX,\n  viewportY,\n  viewportWidth,\n  viewportHeight,\n  onViewportChange,\n  style,\n  backgroundColor = '#1a1a2e',\n  borderColor = '#667eea',\n  viewportColor = 'rgba(102, 126, 234, 0.3)',\n  entityColor = '#ffffff',\n}: MiniMapProps): React.ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const isDragging = useRef(false);\n  \n  // Ratio de conversion\n  const scaleX = miniMapWidth / mapWidth;\n  const scaleY = miniMapHeight / mapHeight;\n  \n  // Dessiner la mini-map\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    \n    // Clear\n    ctx.fillStyle = backgroundColor;\n    ctx.fillRect(0, 0, miniMapWidth, miniMapHeight);\n    \n    // Dessiner les entités\n    entities.forEach(entity => {\n      const x = entity.x * scaleX;\n      const y = entity.y * scaleY;\n      const size = (entity.size || 2) * Math.min(scaleX, scaleY);\n      \n      if (entity.icon) {\n        // Si emoji/icône\n        ctx.font = `${size * 2}px Arial`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(entity.icon, x, y);\n      } else {\n        // Point simple\n        ctx.fillStyle = entity.color || entityColor;\n        ctx.beginPath();\n        ctx.arc(x, y, size, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    });\n    \n    // Dessiner le viewport\n    ctx.strokeStyle = borderColor;\n    ctx.lineWidth = 2;\n    ctx.strokeRect(\n      viewportX * scaleX,\n      viewportY * scaleY,\n      viewportWidth * scaleX,\n      viewportHeight * scaleY\n    );\n    \n    // Remplir le viewport (semi-transparent)\n    ctx.fillStyle = viewportColor;\n    ctx.fillRect(\n      viewportX * scaleX,\n      viewportY * scaleY,\n      viewportWidth * scaleX,\n      viewportHeight * scaleY\n    );\n    \n    // Bordure de la mini-map\n    ctx.strokeStyle = borderColor;\n    ctx.lineWidth = 1;\n    ctx.strokeRect(0, 0, miniMapWidth, miniMapHeight);\n  }, [\n    entities,\n    viewportX,\n    viewportY,\n    viewportWidth,\n    viewportHeight,\n    scaleX,\n    scaleY,\n    miniMapWidth,\n    miniMapHeight,\n    backgroundColor,\n    borderColor,\n    viewportColor,\n    entityColor,\n  ]);\n  \n  // Redessiner quand les props changent\n  useEffect(() => {\n    draw();\n  }, [draw]);\n  \n  // Gestion du clic pour déplacer le viewport\n  const handleMouseDown = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!onViewportChange) return;\n    \n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    // Convertir en coordonnées de map\n    const mapX = (x / scaleX) - (viewportWidth / 2);\n    const mapY = (y / scaleY) - (viewportHeight / 2);\n    \n    // Clamp aux limites\n    const clampedX = Math.max(0, Math.min(mapWidth - viewportWidth, mapX));\n    const clampedY = Math.max(0, Math.min(mapHeight - viewportHeight, mapY));\n    \n    onViewportChange(clampedX, clampedY);\n    isDragging.current = true;\n  }, [onViewportChange, scaleX, scaleY, viewportWidth, viewportHeight, mapWidth, mapHeight]);\n  \n  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isDragging.current || !onViewportChange) return;\n    \n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    const mapX = (x / scaleX) - (viewportWidth / 2);\n    const mapY = (y / scaleY) - (viewportHeight / 2);\n    \n    const clampedX = Math.max(0, Math.min(mapWidth - viewportWidth, mapX));\n    const clampedY = Math.max(0, Math.min(mapHeight - viewportHeight, mapY));\n    \n    onViewportChange(clampedX, clampedY);\n  }, [onViewportChange, scaleX, scaleY, viewportWidth, viewportHeight, mapWidth, mapHeight]);\n  \n  const handleMouseUp = useCallback(() => {\n    isDragging.current = false;\n  }, []);\n  \n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: 20,\n        right: 20,\n        border: `2px solid ${borderColor}`,\n        borderRadius: 8,\n        overflow: 'hidden',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.5)',\n        cursor: onViewportChange ? 'grab' : 'default',\n        ...style,\n      }}\n    >\n      <canvas\n        ref={canvasRef}\n        width={miniMapWidth}\n        height={miniMapHeight}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        style={{\n          display: 'block',\n          cursor: isDragging.current ? 'grabbing' : 'grab',\n        }}\n      />\n      \n      {/* Label optionnel */}\n      <div style={{\n        position: 'absolute',\n        bottom: 5,\n        left: 5,\n        fontSize: 10,\n        color: 'rgba(255,255,255,0.5)',\n        pointerEvents: 'none',\n      }}>\n        {Math.round(viewportX)},{Math.round(viewportY)}\n      </div>\n    </div>\n  );\n}\n","/**\n * 🔄 Hook pour Undo/Redo\n * Exportable et réutilisable dans tous les modes\n */\n\nimport { useState, useCallback, useRef } from 'react';\n\nexport function useUndoRedo<T>(initialState: T, maxHistory: number = 50) {\n  const [state, setState] = useState<T>(initialState);\n  const history = useRef<T[]>([initialState]);\n  const currentIndex = useRef(0);\n\n  const pushState = useCallback((newState: T | ((prev: T) => T)) => {\n    setState(prev => {\n      const nextState = typeof newState === 'function' \n        ? (newState as (prev: T) => T)(prev) \n        : newState;\n      \n      // Couper l'historique si on est au milieu\n      if (currentIndex.current < history.current.length - 1) {\n        history.current = history.current.slice(0, currentIndex.current + 1);\n      }\n      \n      // Ajouter le nouvel état\n      history.current.push(nextState);\n      \n      // Limiter la taille de l'historique\n      if (history.current.length > maxHistory) {\n        history.current.shift();\n      } else {\n        currentIndex.current++;\n      }\n      \n      return nextState;\n    });\n  }, [maxHistory]);\n\n  const undo = useCallback(() => {\n    if (currentIndex.current > 0) {\n      currentIndex.current--;\n      setState(history.current[currentIndex.current]);\n      return true;\n    }\n    return false;\n  }, []);\n\n  const redo = useCallback(() => {\n    if (currentIndex.current < history.current.length - 1) {\n      currentIndex.current++;\n      setState(history.current[currentIndex.current]);\n      return true;\n    }\n    return false;\n  }, []);\n\n  const canUndo = currentIndex.current > 0;\n  const canRedo = currentIndex.current < history.current.length - 1;\n\n  const reset = useCallback(() => {\n    history.current = [initialState];\n    currentIndex.current = 0;\n    setState(initialState);\n  }, [initialState]);\n\n  const getHistory = useCallback(() => {\n    return {\n      states: [...history.current],\n      currentIndex: currentIndex.current,\n    };\n  }, []);\n\n  // Raccourcis clavier\n  const handleKeyPress = useCallback((e: KeyboardEvent) => {\n    if ((e.metaKey || e.ctrlKey) && !e.shiftKey && e.key === 'z') {\n      e.preventDefault();\n      undo();\n    } else if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'z') {\n      e.preventDefault();\n      redo();\n    } else if ((e.metaKey || e.ctrlKey) && e.key === 'y') {\n      e.preventDefault();\n      redo();\n    }\n  }, [undo, redo]);\n\n  return {\n    state,\n    setState: pushState,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    reset,\n    getHistory,\n    handleKeyPress,\n  };\n}\n","/**\n * 🗺️ MAP_ICON_PLACER V2 - Migration depuis HTML magnifique\n * Intégration complète avec v2-adapter.js + WebSocket + Orchestrateur\n */\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\n// @ts-ignore\nimport V2Adapter from '../../../../../shared/v2-adapter.js';\nimport './MapIconPlacerV2.css';\n\n// NOUVEAUX IMPORTS - Composants exportables!\nimport { MiniMap } from '../../shared/components/MiniMap';\nimport { useUndoRedo } from '../../shared/hooks/useUndoRedo';\nimport { useMapLayers } from '../../shared/hooks/useMapLayers';\nimport * as MapUtils from '../../shared/utils/mapUtils';\n\n// CATALOGUE D'ICÔNES - Exactement comme dans HTML\nconst ICON_CATALOG = {\n  \"🏞️ Terrains\": {\n    mountain: \"⛰️\",\n    volcano: \"🌋\", \n    forest: \"🌲\",\n    desert: \"🏜️\",\n    ocean: \"🌊\",\n    island: \"🏝️\",\n    cave: \"🕳️\",\n    snow: \"❄️\",\n    swamp: \"🌿\",\n    plains: \"🌾\",\n    castle: \"🏰\",\n    city: \"🏙️\"\n  },\n  \"⚔️ Combats\": {\n    sword: \"⚔️\",\n    shield: \"🛡️\",\n    bow: \"🏹\",\n    axe: \"🪓\",\n    spear: \"🔱\",\n    dagger: \"🗡️\",\n    bomb: \"💣\",\n    explosion: \"💥\",\n    fire: \"🔥\",\n    ice: \"🧊\",\n    lightning: \"⚡\",\n    skull: \"💀\"\n  },\n  \"🏗️ Bâtiments\": {\n    castle: \"🏰\",\n    tower: \"🗼\",\n    house: \"🏠\",\n    hut: \"🛖\",\n    temple: \"⛩️\",\n    church: \"⛪\",\n    mosque: \"🕌\",\n    synagogue: \"🕍\",\n    ruins: \"🏚️\",\n    pyramid: \"🔺\",\n    tent: \"⛺\",\n    fortress: \"🏯\"\n  },\n  \"💎 Ressources\": {\n    gold: \"🪙\",\n    gem: \"💎\",\n    crystal: \"🔮\",\n    chest: \"📦\",\n    key: \"🗝️\",\n    potion: \"🧪\",\n    scroll: \"📜\",\n    book: \"📖\",\n    herb: \"🌿\",\n    mushroom: \"🍄\",\n    apple: \"🍎\",\n    bread: \"🍞\"\n  },\n  \"🐉 Créatures\": {\n    dragon: \"🐉\",\n    unicorn: \"🦄\",\n    phoenix: \"🦅\",\n    wolf: \"🐺\",\n    bear: \"🐻\",\n    spider: \"🕷️\",\n    snake: \"🐍\",\n    bat: \"🦇\",\n    goblin: \"👺\",\n    troll: \"👹\",\n    ghost: \"👻\",\n    skeleton: \"🦴\"\n  },\n  \"📍 Marqueurs\": {\n    flag: \"🚩\",\n    pin: \"📍\",\n    compass: \"🧭\",\n    telescope: \"🔭\",\n    torch: \"🔦\",\n    campfire: \"🔥\",\n    signpost: \"🪧\",\n    question: \"❓\",\n    exclamation: \"❗\",\n    checkpoint: \"✅\",\n    waypoint: \"🎯\",\n    spawn: \"🏁\"\n  },\n  \"⏰ Temporel\": {\n    clock: \"⏰\",\n    hourglass: \"⌛\",\n    pendulum: \"🕰️\",\n    calendar: \"📅\",\n    moon: \"🌙\",\n    sun: \"☀️\",\n    timestar: \"⭐\",\n    paradox: \"🌀\"\n  }\n};\n\ninterface PlacedIcon {\n  id: string;\n  emoji: string;\n  name: string;\n  category: string;\n  position_6d: {\n    x: number;\n    y: number;\n    z: number;\n    t: number;    // Temps\n    c: number;    // Causalité\n    psi: number;  // Quantum\n  };\n  size: number;\n  rotation: number;\n  opacity: number;\n  tags?: string;\n  notes?: string;\n  // Nouvelles propriétés V2\n  energy_complex?: {\n    A: number;    // Amplitude\n    phi: number;  // Phase\n  };\n  temporal?: {\n    tw: number;   // Temps monde\n    te: number;   // Temps entité\n    cycle?: number; // Cycle temporel\n  };\n}\n\ninterface Connection {\n  id: string;\n  from: string;\n  to: string;\n  type: 'temporal' | 'causal' | 'spatial';\n  strength: number;\n  interference?: number; // Interférence quantique\n}\n\ntype MapIconPlacerCallbacks = {\n  onPlace?: (resource: {\n    id: string;\n    emoji: string;\n    name: string;\n    category: string;\n    position_6d: { x: number; y: number; z: number; t: number; c: number; psi: number };\n    size: number;\n    rotation: number;\n    opacity: number;\n  }) => void;\n  onUpdate?: (id: string, updates: Partial<{\n    position_6d: { x?: number; y?: number; z?: number; t?: number; c?: number; psi?: number };\n    energy_complex: { A?: number; phi?: number };\n    size?: number; rotation?: number; opacity?: number; name?: string;\n  }>) => void;\n  onDelete?: (id: string) => void;\n  onConnect?: (from: string, to: string, type: 'temporal' | 'causal' | 'spatial') => void;\n}\n\nexport function MapIconPlacerV2(props: MapIconPlacerCallbacks = {}): React.ReactElement {\n  // État principal avec UNDO/REDO!\n  const {\n    state: placedIcons,\n    setState: setPlacedIcons,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    handleKeyPress,\n  } = useUndoRedo<PlacedIcon[]>([]);\n  const [selectedIcon, setSelectedIcon] = useState<{emoji: string, name: string, category: string} | null>(null);\n  const [selectedPlaced, setSelectedPlaced] = useState<PlacedIcon | null>(null);\n  const [currentTool, setCurrentTool] = useState<'place' | 'connect' | 'delete'>('place');\n  const [connections, setConnections] = useState<Connection[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [expandedCategories, setExpandedCategories] = useState(new Set(Object.keys(ICON_CATALOG)));\n  const [connectionStart, setConnectionStart] = useState<string | null>(null);\n  \n  // État V2\n  const [wsConnected, setWsConnected] = useState(false);\n  const [orchestratorStatus, setOrchestratorStatus] = useState<'offline' | 'online'>('offline');\n  const [temporalState, setTemporalState] = useState({\n    tw: 0,\n    te: 0,\n    drift: 0,\n    debt: 0\n  });\n  const [paradoxes, setParadoxes] = useState<any[]>([]);\n  const [regulators, setRegulators] = useState({\n    vince: { active: false, intensity: 0 },\n    anna: { active: false, decayRate: 5 },\n    overload: { stack: 0 }\n  });\n  \n  const canvasRef = useRef<HTMLDivElement>(null);\n  const nextId = useRef(1);\n  const v2AdapterRef = useRef<any>(null);\n  const tickIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  \n  // Viewport pour la mini-map\n  const [viewport, setViewport] = useState({ x: 0, y: 0, width: 800, height: 600 });\n  \n  // Raccourcis clavier pour undo/redo\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyPress);\n    return () => document.removeEventListener('keydown', handleKeyPress);\n  }, [handleKeyPress]);\n  \n  // Initialisation V2 Adapter avec WebSocket\n  useEffect(() => {\n    console.log('🚀 Initialisation V2 Adapter...');\n    v2AdapterRef.current = new V2Adapter({\n      rustUrl: 'http://localhost:3001',\n      javaUrl: 'http://localhost:8082',\n      pythonUrl: 'http://localhost:7500'\n    });\n    \n    const adapter = v2AdapterRef.current;\n    \n    // Injection des styles V2\n    adapter.injectStyles();\n    \n    // Connexion WebSocket\n    adapter.connectWebSocket(8001);\n    \n    // Listeners WebSocket\n    adapter.on('ws:connected', () => {\n      console.log('✅ WebSocket connecté');\n      setWsConnected(true);\n    });\n    \n    adapter.on('ws:disconnected', () => {\n      console.log('❌ WebSocket déconnecté');\n      setWsConnected(false);\n    });\n    \n    adapter.on('tick', (data: any) => {\n      setTemporalState({\n        tw: data.new_tw || 0,\n        te: data.new_te || 0,\n        drift: Math.abs((data.new_tw || 0) - (data.new_te || 0)),\n        debt: data.debt || 0\n      });\n    });\n    \n    adapter.on('paradox', (newParadoxes: any[]) => {\n      setParadoxes(newParadoxes);\n      if (newParadoxes.length > 0) {\n        console.warn('⚠️ Paradoxes détectés:', newParadoxes);\n      }\n    });\n    \n    // Test de connexion orchestrateur\n    fetch(`${adapter.endpoints.rust}/health`)\n      .then(res => res.ok && setOrchestratorStatus('online'))\n      .catch(() => setOrchestratorStatus('offline'));\n    \n    return () => {\n      if (adapter.ws) {\n        adapter.ws.close();\n      }\n      if (tickIntervalRef.current) {\n        clearInterval(tickIntervalRef.current);\n      }\n    };\n  }, []);\n  \n  // Tick V2 automatique toutes les 100ms\n  useEffect(() => {\n    if (!v2AdapterRef.current || !wsConnected) return;\n    \n    tickIntervalRef.current = setInterval(async () => {\n      const state = {\n        temporal: {\n          tw: temporalState.tw + 0.1,\n          te: temporalState.te + 0.095, // Légère dérive\n          entities: placedIcons.map(icon => ({\n            id: icon.id,\n            position: icon.position_6d,\n            energy_complex: icon.energy_complex || { A: 50, phi: 0 },\n            te: icon.temporal?.te || temporalState.te\n          }))\n        },\n        resources: {},\n        regulators\n      };\n      \n      try {\n        const result = await v2AdapterRef.current.tick(state);\n        \n        // Détection de paradoxes\n        const detectedParadoxes = v2AdapterRef.current.detectParadoxes({\n          temporal: {\n            tw: result.new_tw,\n            te: result.new_te,\n            debt: result.debt\n          },\n          regulators\n        });\n        \n        if (detectedParadoxes.length > 0) {\n          setParadoxes(detectedParadoxes);\n        }\n      } catch (err) {\n        // Fallback local si backend non disponible\n        const fallback = v2AdapterRef.current.fallbackTick(state);\n        setTemporalState({\n          tw: fallback.new_tw,\n          te: fallback.new_te,\n          drift: Math.abs(fallback.new_tw - fallback.new_te),\n          debt: fallback.debt\n        });\n      }\n    }, 100);\n    \n    return () => {\n      if (tickIntervalRef.current) {\n        clearInterval(tickIntervalRef.current);\n      }\n    };\n  }, [wsConnected, placedIcons, temporalState, regulators]);\n  \n  // Placer une icône avec position 6D complète\n  const placeIcon = useCallback((x: number, y: number) => {\n    if (!selectedIcon || currentTool !== 'place') return;\n    \n    const newIcon: PlacedIcon = {\n      id: `icon_${Date.now()}_${nextId.current++}`,\n      emoji: selectedIcon.emoji,\n      name: selectedIcon.name,\n      category: selectedIcon.category,\n      position_6d: {\n        x: x,\n        y: y,\n        z: 0,\n        t: temporalState.tw,      // Temps monde actuel\n        c: 1,                      // Causalité normale\n        psi: Math.random()         // Quantum aléatoire\n      },\n      size: 60,\n      rotation: 0,\n      opacity: 1,\n      energy_complex: {\n        A: 50 + Math.random() * 50,  // Amplitude 50-100\n        phi: Math.random() * Math.PI * 2  // Phase aléatoire\n      },\n      temporal: {\n        tw: temporalState.tw,\n        te: temporalState.te,\n        cycle: selectedIcon.category === \"⏰ Temporel\" ? 7 : undefined\n      }\n    };\n    \n    setPlacedIcons([...placedIcons, newIcon]);\n    props.onPlace?.({\n      id: newIcon.id,\n      emoji: newIcon.emoji,\n      name: newIcon.name,\n      category: newIcon.category,\n      position_6d: newIcon.position_6d,\n      size: newIcon.size,\n      rotation: newIcon.rotation,\n      opacity: newIcon.opacity,\n    });\n    // Upsert côté serveur (éditeur jouable)\n    try {\n      v2AdapterRef.current?.upsertEntity({\n        id: newIcon.id,\n        position: { x: newIcon.position_6d.x, y: newIcon.position_6d.y },\n        te: newIcon.temporal?.te ?? temporalState.te,\n        energy_complex: { A: newIcon.energy_complex?.A, phi: newIcon.energy_complex?.phi }\n      });\n    } catch (e) {\n      console.warn('Upsert entity failed (placeIcon):', e);\n    }\n    \n    // Notification via WebSocket si connecté\n    if (v2AdapterRef.current && wsConnected) {\n      v2AdapterRef.current.ws.send(JSON.stringify({\n        type: 'entity_placed',\n        payload: newIcon\n      }));\n    }\n  }, [selectedIcon, currentTool, placedIcons, temporalState, wsConnected, props]);\n  \n  // Créer une connexion entre icônes\n  const createConnection = useCallback((fromId: string, toId: string) => {\n    const fromIcon = placedIcons.find(i => i.id === fromId);\n    const toIcon = placedIcons.find(i => i.id === toId);\n    \n    if (!fromIcon || !toIcon) return;\n    \n    const distance = v2AdapterRef.current?.getDistance(\n      fromIcon.position_6d,\n      toIcon.position_6d\n    ) || 0;\n    \n    // Calcul de l'interférence quantique\n    const interference = v2AdapterRef.current?.calculateInterference(\n      { position: fromIcon.position_6d, energy_complex: fromIcon.energy_complex },\n      { position: toIcon.position_6d, energy_complex: toIcon.energy_complex }\n    ) || 0;\n    \n    const newConnection: Connection = {\n      id: `conn_${Date.now()}`,\n      from: fromId,\n      to: toId,\n      type: distance < 100 ? 'spatial' : \n            Math.abs(fromIcon.position_6d.t - toIcon.position_6d.t) > 1 ? 'temporal' : \n            'causal',\n      strength: Math.max(0.3, 1 - distance / 500),\n      interference\n    };\n    \n    setConnections([...connections, newConnection]);\n    props.onConnect?.(fromId, toId, newConnection.type);\n  }, [placedIcons, connections, props]);\n  \n  // Gérer le clic sur le canvas\n  const handleCanvasClick = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    if (currentTool === 'connect' && connectionStart) {\n      // Trouver l'icône cliquée\n      const clickedIcon = placedIcons.find(icon => {\n        const dx = Math.abs(icon.position_6d.x - x);\n        const dy = Math.abs(icon.position_6d.y - y);\n        return dx < icon.size/2 && dy < icon.size/2;\n      });\n      \n      if (clickedIcon && clickedIcon.id !== connectionStart) {\n        createConnection(connectionStart, clickedIcon.id);\n        setConnectionStart(null);\n        setCurrentTool('place');\n      }\n    } else if (currentTool === 'place') {\n      placeIcon(x, y);\n    }\n  }, [currentTool, connectionStart, placedIcons, placeIcon, createConnection]);\n  \n  // Sauvegarder avec Interstice Upload V2\n  const saveMapV2 = async () => {\n    const mapData = {\n      entity_type: 'MAP_6D',\n      name: `Map_${Date.now()}`,\n      position_6d: { x: 0, y: 0, z: 0, t: temporalState.tw, c: 1, psi: 0.5 },\n      icons: placedIcons,\n      connections: connections,\n      temporal_state: temporalState,\n      regulators: regulators\n    };\n    \n    try {\n      const javaBase = v2AdapterRef.current?.endpoints?.java || 'http://localhost:8082';\n      const response = await fetch(`${javaBase}/api/interstice/upload`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(mapData)\n      });\n      const result = await response.json();\n      alert(`✅ Map sauvegardée! ID: ${result.interstice_id}`);\n    } catch (err) {\n      console.error('❌ Erreur sauvegarde:', err);\n      alert('Erreur de sauvegarde - Vérifiez que l\\'orchestrateur est lancé');\n    }\n  };\n  \n  // Activer les régulateurs\n  const activateRegulator = async (type: 'vince' | 'anna' | 'overload') => {\n    if (!v2AdapterRef.current) return;\n    \n    try {\n      if (type === 'vince') {\n        await v2AdapterRef.current.activateVince(\n          selectedPlaced?.position_6d || { x: 0, y: 0, z: 0 },\n          1\n        );\n        setRegulators({ ...regulators, vince: { active: true, intensity: 1 }});\n      } else if (type === 'anna') {\n        await v2AdapterRef.current.activateAnna(10);\n        setRegulators({ ...regulators, anna: { active: true, decayRate: 10 }});\n      } else if (type === 'overload') {\n        await v2AdapterRef.current.triggerOverload();\n        setRegulators({ ...regulators, overload: { stack: regulators.overload.stack + 1 }});\n      }\n    } catch (err) {\n      console.error(`Erreur activation ${type}:`, err);\n    }\n  };\n  \n  // Exporter JSON local\n  const exportMap = () => {\n    const data = {\n      version: 'v2_6d',\n      timestamp: new Date().toISOString(),\n      icons: placedIcons,\n      connections: connections,\n      temporal: temporalState,\n      regulators: regulators\n    };\n    \n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `map_v2_6d_${Date.now()}.json`;\n    a.click();\n  };\n  \n  return (\n    <div style={{ display: 'flex', height: '100vh', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>\n      \n      {/* PANNEAU GAUCHE - Palette d'icônes */}\n      <div style={{\n        width: 320,\n        background: 'linear-gradient(180deg, #1a1a2e, #16213e)',\n        padding: 20,\n        overflowY: 'auto',\n        borderRight: '3px solid #764ba2',\n        boxShadow: '5px 0 20px rgba(0,0,0,0.5)',\n      }}>\n        {/* Header avec statut V2 */}\n        <div style={{\n          marginBottom: 20,\n          textAlign: 'center',\n          position: 'sticky',\n          top: -20,\n          background: 'linear-gradient(180deg, #1a1a2e, #16213e)',\n          padding: '10px 0',\n          zIndex: 100,\n        }}>\n          <h2 style={{\n            fontSize: '1.8em',\n            marginBottom: 10,\n            textShadow: '2px 2px 4px rgba(0,0,0,0.5)',\n            background: 'linear-gradient(45deg, #667eea, #764ba2)',\n            WebkitBackgroundClip: 'text',\n            WebkitTextFillColor: 'transparent',\n          }}>\n            🎨 Palette d'Icônes V2\n          </h2>\n          \n          {/* Statuts des services */}\n          <div style={{ display: 'flex', gap: 10, justifyContent: 'center', marginBottom: 10 }}>\n            <span style={{ \n              fontSize: 12, \n              padding: '4px 8px',\n              borderRadius: 15,\n              background: wsConnected ? 'rgba(72, 187, 120, 0.3)' : 'rgba(255, 100, 100, 0.3)',\n              border: `1px solid ${wsConnected ? '#48bb78' : '#ff6464'}`,\n              color: wsConnected ? '#48bb78' : '#ff6464'\n            }}>\n              {wsConnected ? '🟢' : '🔴'} WebSocket\n            </span>\n            <span style={{ \n              fontSize: 12, \n              padding: '4px 8px',\n              borderRadius: 15,\n              background: orchestratorStatus === 'online' ? 'rgba(72, 187, 120, 0.3)' : 'rgba(255, 100, 100, 0.3)',\n              border: `1px solid ${orchestratorStatus === 'online' ? '#48bb78' : '#ff6464'}`,\n              color: orchestratorStatus === 'online' ? '#48bb78' : '#ff6464'\n            }}>\n              {orchestratorStatus === 'online' ? '🟢' : '🔴'} Orchestrateur\n            </span>\n          </div>\n          \n          {/* Affichage temporel V2 */}\n          <div style={{\n            background: 'rgba(102, 126, 234, 0.1)',\n            border: '1px solid #667eea',\n            borderRadius: 10,\n            padding: 8,\n            marginBottom: 10,\n            fontSize: 11,\n            fontFamily: 'monospace'\n          }}>\n            <div style={{ display: 'flex', justifyContent: 'space-around', marginBottom: 5 }}>\n              <span style={{ color: '#667eea' }}>TW: {temporalState.tw.toFixed(1)}</span>\n              <span style={{ color: '#48bb78' }}>TE: {temporalState.te.toFixed(1)}</span>\n              <span style={{ color: temporalState.drift > 5 ? '#ff6464' : '#ed8936' }}>\n                Δt: {temporalState.drift.toFixed(1)}\n              </span>\n            </div>\n            {temporalState.debt > 0 && (\n              <div style={{ \n                color: temporalState.debt > 50 ? '#ff6464' : '#f6ad55',\n                textAlign: 'center'\n              }}>\n                💸 Dette: {temporalState.debt.toFixed(1)}\n              </div>\n            )}\n            {paradoxes.length > 0 && (\n              <div style={{ color: '#ff6464', textAlign: 'center', marginTop: 5 }}>\n                ⚠️ {paradoxes.length} paradoxe(s)\n              </div>\n            )}\n          </div>\n          \n          <input\n            type=\"text\"\n            placeholder=\"🔍 Rechercher...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            style={{\n              width: '100%',\n              padding: 10,\n              border: '2px solid #764ba2',\n              background: 'rgba(15, 52, 96, 0.8)',\n              color: 'white',\n              borderRadius: 10,\n              fontSize: 16,\n            }}\n          />\n        </div>\n        \n        {/* Catégories d'icônes */}\n        {Object.entries(ICON_CATALOG).map(([category, icons]) => {\n          const filteredIcons = Object.entries(icons).filter(([name]) => \n            searchTerm === '' || name.toLowerCase().includes(searchTerm.toLowerCase())\n          );\n          \n          if (filteredIcons.length === 0 && searchTerm !== '') return null;\n          \n          return (\n            <div key={category} style={{\n              marginBottom: 25,\n              background: 'rgba(15, 52, 96, 0.3)',\n              borderRadius: 10,\n              padding: 10,\n              border: '1px solid rgba(118, 75, 162, 0.3)',\n            }}>\n              <div\n                onClick={() => {\n                  const newExpanded = new Set(expandedCategories);\n                  if (newExpanded.has(category)) {\n                    newExpanded.delete(category);\n                  } else {\n                    newExpanded.add(category);\n                  }\n                  setExpandedCategories(newExpanded);\n                }}\n                style={{\n                  background: 'linear-gradient(90deg, #0f3460, #1e5f8e)',\n                  padding: 10,\n                  borderRadius: 8,\n                  marginBottom: 10,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                  fontWeight: 'bold',\n                }}\n              >\n                <span>{category}</span>\n                <span>{expandedCategories.has(category) ? '▼' : '▶'}</span>\n              </div>\n              \n              {expandedCategories.has(category) && (\n                <div style={{\n                  display: 'grid',\n                  gridTemplateColumns: 'repeat(4, 1fr)',\n                  gap: 8,\n                  padding: 5,\n                }}>\n                  {filteredIcons.map(([name, emoji]) => (\n                    <div\n                      key={name}\n                      onClick={() => setSelectedIcon({ emoji, name, category })}\n                      style={{\n                        width: 60,\n                        height: 60,\n                        background: selectedIcon?.name === name ? 'rgba(102, 126, 234, 0.5)' : 'rgba(15, 52, 96, 0.5)',\n                        border: selectedIcon?.name === name ? '2px solid #667eea' : '1px solid rgba(255,255,255,0.1)',\n                        borderRadius: 10,\n                        display: 'flex',\n                        flexDirection: 'column',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                        cursor: 'pointer',\n                        transition: 'all 0.2s',\n                      }}\n                      onMouseEnter={(e) => {\n                        e.currentTarget.style.transform = 'scale(1.1)';\n                        e.currentTarget.style.background = 'rgba(102, 126, 234, 0.3)';\n                      }}\n                      onMouseLeave={(e) => {\n                        e.currentTarget.style.transform = 'scale(1)';\n                        e.currentTarget.style.background = selectedIcon?.name === name ? 'rgba(102, 126, 234, 0.5)' : 'rgba(15, 52, 96, 0.5)';\n                      }}\n                      title={name}\n                    >\n                      <span style={{ fontSize: 30 }}>{emoji}</span>\n                      <span style={{ fontSize: 9, color: 'rgba(255,255,255,0.7)', marginTop: 2 }}>\n                        {name.slice(0, 8)}\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n      \n      {/* ZONE CENTRALE - Canvas de placement */}\n      <div style={{ flex: 1, position: 'relative', overflow: 'hidden' }}>\n        {/* Barre d'outils */}\n        <div style={{\n          position: 'absolute',\n          top: 20,\n          left: '50%',\n          transform: 'translateX(-50%)',\n          background: 'rgba(0,0,0,0.7)',\n          borderRadius: 25,\n          padding: '10px 20px',\n          display: 'flex',\n          gap: 15,\n          zIndex: 100,\n        }}>\n          <button\n            onClick={() => setCurrentTool('place')}\n            style={{\n              padding: '8px 20px',\n              background: currentTool === 'place' ? '#667eea' : 'transparent',\n              border: '2px solid #667eea',\n              borderRadius: 20,\n              color: 'white',\n              cursor: 'pointer',\n            }}\n          >\n            ✏️ Placer\n          </button>\n          <button\n            onClick={() => setCurrentTool('connect')}\n            style={{\n              padding: '8px 20px',\n              background: currentTool === 'connect' ? '#667eea' : 'transparent',\n              border: '2px solid #667eea',\n              borderRadius: 20,\n              color: 'white',\n              cursor: 'pointer',\n            }}\n          >\n            🔗 Connecter\n          </button>\n          <button\n            onClick={() => setCurrentTool('delete')}\n            style={{\n              padding: '8px 20px',\n              background: currentTool === 'delete' ? '#ff4444' : 'transparent',\n              border: '2px solid #ff4444',\n              borderRadius: 20,\n              color: 'white',\n              cursor: 'pointer',\n            }}\n          >\n            🗑️ Supprimer\n          </button>\n          <button\n            onClick={saveMapV2}\n            style={{\n              padding: '8px 20px',\n              background: 'linear-gradient(135deg, #48bb78, #38a169)',\n              border: 'none',\n              borderRadius: 20,\n              color: 'white',\n              cursor: 'pointer',\n              fontWeight: 'bold',\n            }}\n          >\n            💾 Sauvegarder V2\n          </button>\n          <button\n            onClick={exportMap}\n            style={{\n              padding: '8px 20px',\n              background: 'linear-gradient(135deg, #ed8936, #dd6b20)',\n              border: 'none',\n              borderRadius: 20,\n              color: 'white',\n              cursor: 'pointer',\n              fontWeight: 'bold',\n            }}\n          >\n            📥 Exporter\n          </button>\n        </div>\n        \n        {/* Régulateurs V2 */}\n        <div style={{\n          position: 'absolute',\n          top: 80,\n          left: '50%',\n          transform: 'translateX(-50%)',\n          background: 'rgba(0,0,0,0.6)',\n          borderRadius: 15,\n          padding: '8px 15px',\n          display: 'flex',\n          gap: 10,\n          zIndex: 99,\n        }}>\n          <button\n            onClick={() => activateRegulator('vince')}\n            style={{\n              padding: '5px 15px',\n              background: regulators.vince.active ? '#667eea' : 'transparent',\n              border: '1px solid #667eea',\n              borderRadius: 10,\n              color: 'white',\n              cursor: 'pointer',\n              fontSize: 12,\n            }}\n          >\n            ⚡ Vince {regulators.vince.active && `(${regulators.vince.intensity})`}\n          </button>\n          <button\n            onClick={() => activateRegulator('anna')}\n            style={{\n              padding: '5px 15px',\n              background: regulators.anna.active ? '#48bb78' : 'transparent',\n              border: '1px solid #48bb78',\n              borderRadius: 10,\n              color: 'white',\n              cursor: 'pointer',\n              fontSize: 12,\n            }}\n          >\n            🌀 Anna {regulators.anna.active && `(-${regulators.anna.decayRate}%)`}\n          </button>\n          <button\n            onClick={() => activateRegulator('overload')}\n            style={{\n              padding: '5px 15px',\n              background: regulators.overload.stack > 0 ? '#ff6464' : 'transparent',\n              border: '1px solid #ff6464',\n              borderRadius: 10,\n              color: 'white',\n              cursor: 'pointer',\n              fontSize: 12,\n            }}\n          >\n            💥 Overload ({regulators.overload.stack}/10)\n          </button>\n        </div>\n        \n        {/* Canvas de la carte */}\n        <div\n          ref={canvasRef}\n          onClick={handleCanvasClick}\n          style={{\n            width: '100%',\n            height: '100%',\n            background: 'radial-gradient(circle at center, rgba(102, 126, 234, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%)',\n            cursor: currentTool === 'place' && selectedIcon ? 'crosshair' : \n                   currentTool === 'connect' ? 'cell' :\n                   currentTool === 'delete' ? 'not-allowed' : 'default',\n            position: 'relative',\n          }}\n        >\n          {/* Icônes placées */}\n          {placedIcons.map(icon => (\n            <div\n              key={icon.id}\n              onClick={(e) => {\n                e.stopPropagation();\n                if (currentTool === 'delete') {\n                  setPlacedIcons(placedIcons.filter(i => i.id !== icon.id));\n                  setConnections(connections.filter(c => c.from !== icon.id && c.to !== icon.id));\n                } else if (currentTool === 'connect') {\n                  if (!connectionStart) {\n                    setConnectionStart(icon.id);\n                  } else if (connectionStart !== icon.id) {\n                    createConnection(connectionStart, icon.id);\n                    setConnectionStart(null);\n                  }\n                } else {\n                  setSelectedPlaced(icon);\n                }\n              }}\n              style={{\n                position: 'absolute',\n                left: icon.position_6d.x - icon.size / 2,\n                top: icon.position_6d.y - icon.size / 2,\n                width: icon.size,\n                height: icon.size,\n                fontSize: icon.size * 0.7,\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                transform: `rotate(${icon.rotation}deg) scale(${1 + icon.position_6d.z * 0.1})`,\n                opacity: icon.opacity * (1 - icon.position_6d.psi * 0.3), // Effet quantum\n                cursor: 'pointer',\n                background: selectedPlaced?.id === icon.id ? 'rgba(102, 126, 234, 0.3)' : \n                           connectionStart === icon.id ? 'rgba(72, 187, 120, 0.3)' : 'transparent',\n                border: selectedPlaced?.id === icon.id ? '2px solid #667eea' : \n                       connectionStart === icon.id ? '2px solid #48bb78' : 'none',\n                borderRadius: 10,\n                transition: 'all 0.2s',\n                animation: icon.temporal?.cycle ? `pulse ${icon.temporal.cycle}s infinite` : undefined,\n              }}\n            >\n              {icon.emoji}\n              {/* Indicateur temporel pour les icônes temporelles */}\n              {icon.category === \"⏰ Temporel\" && (\n                <div style={{\n                  position: 'absolute',\n                  bottom: -5,\n                  right: -5,\n                  fontSize: 10,\n                  background: 'rgba(102, 126, 234, 0.8)',\n                  borderRadius: '50%',\n                  width: 20,\n                  height: 20,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: 'white',\n                  fontWeight: 'bold'\n                }}>\n                  {Math.floor(icon.position_6d.t)}\n                </div>\n              )}\n            </div>\n          ))}\n          \n          {/* Lignes de connexion avec effets V2 */}\n          <svg style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none' }}>\n            <defs>\n              <linearGradient id=\"temporal-gradient\">\n                <stop offset=\"0%\" stopColor=\"#667eea\" stopOpacity=\"0.8\"/>\n                <stop offset=\"50%\" stopColor=\"#764ba2\" stopOpacity=\"0.5\"/>\n                <stop offset=\"100%\" stopColor=\"#667eea\" stopOpacity=\"0.8\"/>\n              </linearGradient>\n              <linearGradient id=\"causal-gradient\">\n                <stop offset=\"0%\" stopColor=\"#48bb78\" stopOpacity=\"0.8\"/>\n                <stop offset=\"100%\" stopColor=\"#38a169\" stopOpacity=\"0.3\"/>\n              </linearGradient>\n            </defs>\n            \n            {connections.map((conn) => {\n              const fromIcon = placedIcons.find(i => i.id === conn.from);\n              const toIcon = placedIcons.find(i => i.id === conn.to);\n              if (!fromIcon || !toIcon) return null;\n              \n              return (\n                <g key={conn.id}>\n                  <line\n                    x1={fromIcon.position_6d.x}\n                    y1={fromIcon.position_6d.y}\n                    x2={toIcon.position_6d.x}\n                    y2={toIcon.position_6d.y}\n                    stroke={conn.type === 'temporal' ? 'url(#temporal-gradient)' :\n                           conn.type === 'causal' ? 'url(#causal-gradient)' : \n                           'rgba(237, 137, 54, 0.5)'}\n                    strokeWidth={2 + (conn.interference || 0) * 3}\n                    strokeDasharray={conn.type === 'temporal' ? '10,5' : \n                                    conn.type === 'causal' ? '5,3' : '0'}\n                    opacity={conn.strength}\n                  />\n                  {/* Effet d'interférence quantique */}\n                  {conn.interference && conn.interference > 0.5 && (\n                    <circle\n                      cx={(fromIcon.position_6d.x + toIcon.position_6d.x) / 2}\n                      cy={(fromIcon.position_6d.y + toIcon.position_6d.y) / 2}\n                      r={5 + conn.interference * 10}\n                      fill=\"none\"\n                      stroke=\"#f093fb\"\n                      strokeWidth=\"1\"\n                      opacity={conn.interference}\n                    >\n                      <animate attributeName=\"r\" \n                               from={5 + conn.interference * 10} \n                               to={10 + conn.interference * 15}\n                               dur=\"2s\" \n                               repeatCount=\"indefinite\"/>\n                      <animate attributeName=\"opacity\" \n                               from={conn.interference} \n                               to=\"0\"\n                               dur=\"2s\" \n                               repeatCount=\"indefinite\"/>\n                    </circle>\n                  )}\n                </g>\n              );\n            })}\n          </svg>\n        </div>\n        \n        {/* Minimap améliorée */}\n        <div style={{\n          position: 'absolute',\n          bottom: 20,\n          right: 20,\n          width: 200,\n          height: 150,\n          background: 'rgba(0,0,0,0.8)',\n          border: '2px solid #667eea',\n          borderRadius: 10,\n          padding: 5,\n        }}>\n          <div style={{ color: 'white', fontSize: 11, marginBottom: 5, display: 'flex', justifyContent: 'space-between' }}>\n            <span>Minimap</span>\n            <span style={{ fontSize: 9, color: '#667eea' }}>\n              {placedIcons.length} icônes | {connections.length} liens\n            </span>\n          </div>\n          <div style={{\n            width: '100%',\n            height: 'calc(100% - 20px)',\n            background: 'rgba(102, 126, 234, 0.1)',\n            position: 'relative',\n          }}>\n            {/* Connexions sur minimap */}\n            <svg style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }}>\n              {connections.map((conn) => {\n                const fromIcon = placedIcons.find(i => i.id === conn.from);\n                const toIcon = placedIcons.find(i => i.id === conn.to);\n                if (!fromIcon || !toIcon) return null;\n                \n                return (\n                  <line\n                    key={conn.id}\n                    x1={`${(fromIcon.position_6d.x / window.innerWidth) * 100}%`}\n                    y1={`${(fromIcon.position_6d.y / window.innerHeight) * 100}%`}\n                    x2={`${(toIcon.position_6d.x / window.innerWidth) * 100}%`}\n                    y2={`${(toIcon.position_6d.y / window.innerHeight) * 100}%`}\n                    stroke={conn.type === 'temporal' ? '#667eea' :\n                           conn.type === 'causal' ? '#48bb78' : '#ed8936'}\n                    strokeWidth=\"0.5\"\n                    opacity=\"0.5\"\n                  />\n                );\n              })}\n            </svg>\n            \n            {/* Icônes sur minimap */}\n            {placedIcons.map(icon => (\n              <div\n                key={icon.id}\n                style={{\n                  position: 'absolute',\n                  left: `${(icon.position_6d.x / window.innerWidth) * 100}%`,\n                  top: `${(icon.position_6d.y / window.innerHeight) * 100}%`,\n                  width: 4,\n                  height: 4,\n                  background: icon.category === \"⏰ Temporel\" ? '#f093fb' :\n                             icon.category === \"🐉 Créatures\" ? '#ff6464' :\n                             icon.category === \"💎 Ressources\" ? '#ffd700' : '#667eea',\n                  borderRadius: '50%',\n                  transform: 'translate(-50%, -50%)',\n                }}\n              />\n            ))}\n          </div>\n        </div>\n        \n        {/* MINI-MAP */}\n        <MiniMap\n          mapWidth={2000}\n          mapHeight={2000}\n          entities={placedIcons.map(icon => ({\n            x: icon.position_6d.x,\n            y: icon.position_6d.y,\n            icon: icon.emoji,\n            size: icon.size,\n          }))}\n          viewportX={viewport.x}\n          viewportY={viewport.y}\n          viewportWidth={viewport.width}\n          viewportHeight={viewport.height}\n          onViewportChange={(x, y) => setViewport(prev => ({ ...prev, x, y }))}\n          style={{ top: 70 }}\n        />\n        \n        {/* UNDO/REDO Controls */}\n        <div style={{\n          position: 'absolute',\n          top: 20,\n          left: 340,\n          display: 'flex',\n          gap: 10,\n          zIndex: 1000,\n        }}>\n          <button\n            onClick={undo}\n            disabled={!canUndo}\n            title=\"Undo (Cmd+Z)\"\n            style={{\n              padding: '8px 16px',\n              background: canUndo ? 'linear-gradient(135deg, #667eea, #764ba2)' : 'rgba(0,0,0,0.3)',\n              border: 'none',\n              borderRadius: 8,\n              color: 'white',\n              cursor: canUndo ? 'pointer' : 'not-allowed',\n              opacity: canUndo ? 1 : 0.5,\n              fontSize: 16,\n            }}\n          >\n            ↩️ Undo\n          </button>\n          <button\n            onClick={redo}\n            disabled={!canRedo}\n            title=\"Redo (Cmd+Shift+Z)\"\n            style={{\n              padding: '8px 16px',\n              background: canRedo ? 'linear-gradient(135deg, #667eea, #764ba2)' : 'rgba(0,0,0,0.3)',\n              border: 'none',\n              borderRadius: 8,\n              color: 'white',\n              cursor: canRedo ? 'pointer' : 'not-allowed',\n              opacity: canRedo ? 1 : 0.5,\n              fontSize: 16,\n            }}\n          >\n            ↪️ Redo\n          </button>\n        </div>\n      </div>\n      \n      {/* PANNEAU DROIT - Propriétés V2 améliorées */}\n      {selectedPlaced && (\n        <div style={{\n          width: 300,\n          background: 'linear-gradient(180deg, #16213e, #1a1a2e)',\n          padding: 20,\n          borderLeft: '3px solid #764ba2',\n          overflowY: 'auto',\n        }}>\n          <h3 style={{ color: '#667eea', marginBottom: 20 }}>Propriétés 6D</h3>\n          \n          <div style={{ marginBottom: 20, padding: 10, background: 'rgba(102, 126, 234, 0.1)', borderRadius: 10 }}>\n            <div style={{ fontSize: 24, textAlign: 'center', marginBottom: 10 }}>\n              {selectedPlaced.emoji}\n            </div>\n            <div style={{ textAlign: 'center', color: 'white', fontWeight: 'bold' }}>\n              {selectedPlaced.name}\n            </div>\n            <div style={{ textAlign: 'center', color: '#667eea', fontSize: 12 }}>\n              {selectedPlaced.category}\n            </div>\n          </div>\n          \n          {/* Position 6D complète */}\n          <div style={{ marginBottom: 20 }}>\n            <label style={{ color: 'white', fontSize: 12, fontWeight: 'bold' }}>Position 6D</label>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10, marginTop: 10 }}>\n              <div>\n                <label style={{ color: '#667eea', fontSize: 10 }}>X (Spatial)</label>\n                <input\n                  type=\"number\"\n                  value={Math.round(selectedPlaced.position_6d.x)}\n                    onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, x: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                      // Sync serveur\n                      const nx = Number(e.target.value);\n                      try { v2AdapterRef.current?.upsertEntity({ id: selectedPlaced.id, position: { x: nx, y: selectedPlaced.position_6d.y }, te: selectedPlaced.temporal?.te ?? temporalState.te, energy_complex: { A: selectedPlaced.energy_complex?.A, phi: selectedPlaced.energy_complex?.phi } }); } catch {}\n                      props.onUpdate?.(selectedPlaced.id, { position_6d: { x: nx } });\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #667eea',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n              <div>\n                <label style={{ color: '#667eea', fontSize: 10 }}>Y (Spatial)</label>\n                <input\n                  type=\"number\"\n                  value={Math.round(selectedPlaced.position_6d.y)}\n                    onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, y: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                      // Sync serveur\n                      const ny = Number(e.target.value);\n                      try { v2AdapterRef.current?.upsertEntity({ id: selectedPlaced.id, position: { x: selectedPlaced.position_6d.x, y: ny }, te: selectedPlaced.temporal?.te ?? temporalState.te, energy_complex: { A: selectedPlaced.energy_complex?.A, phi: selectedPlaced.energy_complex?.phi } }); } catch {}\n                      props.onUpdate?.(selectedPlaced.id, { position_6d: { y: ny } });\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #667eea',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n              <div>\n                <label style={{ color: '#48bb78', fontSize: 10 }}>Z (Altitude)</label>\n                <input\n                  type=\"number\"\n                  value={selectedPlaced.position_6d.z}\n                  step=\"0.1\"\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, z: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #48bb78',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n              <div>\n                <label style={{ color: '#f093fb', fontSize: 10 }}>T (Temps)</label>\n                <input\n                  type=\"number\"\n                  value={selectedPlaced.position_6d.t.toFixed(1)}\n                  step=\"0.1\"\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, t: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #f093fb',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n              <div>\n                <label style={{ color: '#ed8936', fontSize: 10 }}>C (Causalité)</label>\n                <input\n                  type=\"number\"\n                  value={selectedPlaced.position_6d.c}\n                  step=\"0.1\"\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, c: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #ed8936',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n              <div>\n                <label style={{ color: '#ffd700', fontSize: 10 }}>Ψ (Quantum)</label>\n                <input\n                  type=\"number\"\n                  value={selectedPlaced.position_6d.psi.toFixed(2)}\n                  step=\"0.01\"\n                  min=\"0\"\n                  max=\"1\"\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, position_6d: { ...i.position_6d, psi: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: 5,\n                    background: 'rgba(15, 52, 96, 0.8)',\n                    border: '1px solid #ffd700',\n                    borderRadius: 5,\n                    color: 'white',\n                  }}\n                />\n              </div>\n            </div>\n          </div>\n          \n          {/* Énergie complexe */}\n          {selectedPlaced.energy_complex && (\n            <div style={{ marginBottom: 20 }}>\n              <label style={{ color: 'white', fontSize: 12, fontWeight: 'bold' }}>Énergie Complexe (E = A + iΦ)</label>\n              <div style={{ marginTop: 10, padding: 10, background: 'rgba(240, 147, 251, 0.1)', borderRadius: 8 }}>\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 5 }}>\n                  <span style={{ color: '#f093fb', fontSize: 11 }}>Amplitude (A)</span>\n                  <span style={{ color: 'white' }}>{selectedPlaced.energy_complex.A.toFixed(1)}</span>\n                </div>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={selectedPlaced.energy_complex.A}\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, energy_complex: { ...i.energy_complex!, A: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                    // Sync serveur\n                    try { v2AdapterRef.current?.upsertEntity({ id: selectedPlaced.id, position: { x: selectedPlaced.position_6d.x, y: selectedPlaced.position_6d.y }, te: selectedPlaced.temporal?.te ?? temporalState.te, energy_complex: { A: Number(e.target.value), phi: selectedPlaced.energy_complex?.phi } }); } catch {}\n                    props.onUpdate?.(selectedPlaced.id, { energy_complex: { A: Number(e.target.value) } });\n                  }}\n                  style={{ width: '100%' }}\n                />\n                \n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 5, marginTop: 10 }}>\n                  <span style={{ color: '#f093fb', fontSize: 11 }}>Phase (Φ)</span>\n                  <span style={{ color: 'white' }}>{(selectedPlaced.energy_complex.phi * 180 / Math.PI).toFixed(0)}°</span>\n                </div>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max={Math.PI * 2}\n                  step=\"0.01\"\n                  value={selectedPlaced.energy_complex.phi}\n                  onChange={(e) => {\n                    const updated = placedIcons.map(i => \n                      i.id === selectedPlaced.id \n                        ? { ...i, energy_complex: { ...i.energy_complex!, phi: Number(e.target.value) }}\n                        : i\n                    );\n                    setPlacedIcons(updated);\n                    // Sync serveur\n                    try { v2AdapterRef.current?.upsertEntity({ id: selectedPlaced.id, position: { x: selectedPlaced.position_6d.x, y: selectedPlaced.position_6d.y }, te: selectedPlaced.temporal?.te ?? temporalState.te, energy_complex: { A: selectedPlaced.energy_complex?.A, phi: Number(e.target.value) } }); } catch {}\n                    props.onUpdate?.(selectedPlaced.id, { energy_complex: { phi: Number(e.target.value) } });\n                  }}\n                  style={{ width: '100%' }}\n                />\n                \n                {/* Visualisation de l'énergie complexe */}\n                <div style={{ marginTop: 10, textAlign: 'center', fontSize: 14, color: '#f093fb', fontFamily: 'monospace' }}>\n                  {v2AdapterRef.current?.calculateComplexEnergy(\n                    selectedPlaced.energy_complex.A,\n                    selectedPlaced.energy_complex.phi\n                  ).toString()}\n                </div>\n              </div>\n            </div>\n          )}\n          \n          {/* Propriétés visuelles */}\n          <div style={{ marginBottom: 15 }}>\n            <label style={{ color: 'white', fontSize: 12 }}>Taille: {selectedPlaced.size}px</label>\n            <input\n              type=\"range\"\n              min=\"20\"\n              max=\"200\"\n              value={selectedPlaced.size}\n              onChange={(e) => {\n                const updated = placedIcons.map(i => \n                  i.id === selectedPlaced.id \n                    ? { ...i, size: Number(e.target.value) }\n                    : i\n                );\n                setPlacedIcons(updated);\n              }}\n              style={{ width: '100%', marginTop: 5 }}\n            />\n          </div>\n          \n          <div style={{ marginBottom: 15 }}>\n            <label style={{ color: 'white', fontSize: 12 }}>Rotation: {selectedPlaced.rotation}°</label>\n            <input\n              type=\"range\"\n              min=\"0\"\n              max=\"360\"\n              value={selectedPlaced.rotation}\n              onChange={(e) => {\n                const updated = placedIcons.map(i => \n                  i.id === selectedPlaced.id \n                    ? { ...i, rotation: Number(e.target.value) }\n                    : i\n                );\n                setPlacedIcons(updated);\n              }}\n              style={{ width: '100%', marginTop: 5 }}\n            />\n          </div>\n          \n          <button\n            onClick={() => {\n              setPlacedIcons(placedIcons.filter(i => i.id !== selectedPlaced.id));\n              setConnections(connections.filter(c => c.from !== selectedPlaced.id && c.to !== selectedPlaced.id));\n              setSelectedPlaced(null);\n              props.onDelete?.(selectedPlaced.id);\n            }}\n            style={{\n              width: '100%',\n              padding: 10,\n              background: '#ff4444',\n              border: 'none',\n              borderRadius: 5,\n              color: 'white',\n              cursor: 'pointer',\n              marginTop: 20,\n            }}\n          >\n            🗑️ Supprimer\n          </button>\n        </div>\n      )}\n      \n      {/* Style pour l'animation pulse */}\n      <style>{`\n        @keyframes pulse {\n          0%, 100% { transform: scale(1); opacity: 1; }\n          50% { transform: scale(1.1); opacity: 0.8; }\n        }\n      `}</style>\n    </div>\n  );\n}"],"names":["V2Adapter","config","state","response","_a","_b","result","error","tw","te","amplitude","phase","entity1","entity2","p1","p2","phaseDiff","distance","paradoxes","entity","position","intensity","r","decayRate","zone","debt","drift","driftClass","debtClass","energy","complex","regulators","port","event","data","callback","callbacks","index","cb","entities","id","e","pos1","pos2","dx","dy","newState","_c","style","MiniMap","mapWidth","mapHeight","miniMapWidth","miniMapHeight","viewportX","viewportY","viewportWidth","viewportHeight","onViewportChange","backgroundColor","borderColor","viewportColor","entityColor","canvasRef","useRef","isDragging","scaleX","scaleY","draw","useCallback","canvas","ctx","x","y","size","useEffect","handleMouseDown","rect","mapX","mapY","clampedX","clampedY","handleMouseMove","handleMouseUp","jsxs","jsx","useUndoRedo","initialState","maxHistory","setState","useState","history","currentIndex","pushState","prev","nextState","undo","redo","canUndo","canRedo","reset","getHistory","handleKeyPress","ICON_CATALOG","MapIconPlacerV2","props","placedIcons","setPlacedIcons","selectedIcon","setSelectedIcon","selectedPlaced","setSelectedPlaced","currentTool","setCurrentTool","connections","setConnections","searchTerm","setSearchTerm","expandedCategories","setExpandedCategories","connectionStart","setConnectionStart","wsConnected","setWsConnected","orchestratorStatus","setOrchestratorStatus","temporalState","setTemporalState","setParadoxes","setRegulators","nextId","v2AdapterRef","tickIntervalRef","viewport","setViewport","adapter","newParadoxes","res","icon","detectedParadoxes","fallback","placeIcon","newIcon","_e","_d","createConnection","fromId","toId","fromIcon","i","toIcon","interference","newConnection","handleCanvasClick","clickedIcon","saveMapV2","mapData","javaBase","err","activateRegulator","type","exportMap","blob","url","a","category","icons","filteredIcons","name","newExpanded","emoji","c","conn","updated","nx","ny"],"mappings":"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"}