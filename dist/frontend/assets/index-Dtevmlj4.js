const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapIconPlacerV2-kN9m4EEZ.js","assets/vendor-DCFZ6SsY.js","assets/store-CIj0PUzs.js","assets/ui-CleIVWQA.js","assets/MapIconPlacerV2-C9XEaof7.css","assets/SpatioTemporalMapEditor-iDnuxLV4.js"])))=>i.map(i=>d[i]);
var kn=Object.defineProperty;var vr=r=>{throw TypeError(r)};var Sn=(r,e,t)=>e in r?kn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Y=(r,e,t)=>Sn(r,typeof e!="symbol"?e+"":e,t),qt=(r,e,t)=>e.has(r)||vr("Cannot "+t);var x=(r,e,t)=>(qt(r,e,"read from private field"),t?t.call(r):e.get(r)),B=(r,e,t)=>e.has(r)?vr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),P=(r,e,t,n)=>(qt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),K=(r,e,t)=>(qt(r,e,"access private method"),t);var gt=(r,e,t,n)=>({set _(a){P(r,e,a,t)},get _(){return x(r,e,n)}});import{r as R,a as Cn,R as H,u as Tn,b as tn,c as J,L as be,B as Rn}from"./vendor-DCFZ6SsY.js";import{c as pt}from"./store-CIj0PUzs.js";import{m as yt,A as En}from"./ui-CleIVWQA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var rn={exports:{}},At={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mn=R,An=Symbol.for("react.element"),On=Symbol.for("react.fragment"),Pn=Object.prototype.hasOwnProperty,Nn=Mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,In={key:!0,ref:!0,__self:!0,__source:!0};function nn(r,e,t){var n,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Pn.call(e,n)&&!In.hasOwnProperty(n)&&(a[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:An,type:r,key:i,ref:o,props:a,_owner:Nn.current}}At.Fragment=On;At.jsx=nn;At.jsxs=nn;rn.exports=At;var s=rn.exports,Xt={},br=Cn;Xt.createRoot=br.createRoot,Xt.hydrateRoot=br.hydrateRoot;var Ot=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Pt=typeof window>"u"||"Deno"in globalThis;function oe(){}function Dn(r,e){return typeof r=="function"?r(e):r}function zn(r){return typeof r=="number"&&r>=0&&r!==1/0}function Ln(r,e){return Math.max(r+(e||0)-Date.now(),0)}function er(r,e){return typeof r=="function"?r(e):r}function $n(r,e){return typeof r=="function"?r(e):r}function _r(r,e){const{type:t="all",exact:n,fetchStatus:a,predicate:i,queryKey:o,stale:l}=r;if(o){if(n){if(e.queryHash!==mr(o,e.options))return!1}else if(!ot(e.queryKey,o))return!1}if(t!=="all"){const c=e.isActive();if(t==="active"&&!c||t==="inactive"&&c)return!1}return!(typeof l=="boolean"&&e.isStale()!==l||a&&a!==e.state.fetchStatus||i&&!i(e))}function wr(r,e){const{exact:t,status:n,predicate:a,mutationKey:i}=r;if(i){if(!e.options.mutationKey)return!1;if(t){if(it(e.options.mutationKey)!==it(i))return!1}else if(!ot(e.options.mutationKey,i))return!1}return!(n&&e.state.status!==n||a&&!a(e))}function mr(r,e){return((e==null?void 0:e.queryKeyHashFn)||it)(r)}function it(r){return JSON.stringify(r,(e,t)=>tr(t)?Object.keys(t).sort().reduce((n,a)=>(n[a]=t[a],n),{}):t)}function ot(r,e){return r===e?!0:typeof r!=typeof e?!1:r&&e&&typeof r=="object"&&typeof e=="object"?Object.keys(e).every(t=>ot(r[t],e[t])):!1}function sn(r,e){if(r===e)return r;const t=jr(r)&&jr(e);if(t||tr(r)&&tr(e)){const n=t?r:Object.keys(r),a=n.length,i=t?e:Object.keys(e),o=i.length,l=t?[]:{},c=new Set(n);let d=0;for(let p=0;p<o;p++){const v=t?p:i[p];(!t&&c.has(v)||t)&&r[v]===void 0&&e[v]===void 0?(l[v]=void 0,d++):(l[v]=sn(r[v],e[v]),l[v]===r[v]&&r[v]!==void 0&&d++)}return a===o&&d===a?r:l}return e}function jr(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function tr(r){if(!kr(r))return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!kr(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function kr(r){return Object.prototype.toString.call(r)==="[object Object]"}function Bn(r){return new Promise(e=>{setTimeout(e,r)})}function Fn(r,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(r,e):t.structuralSharing!==!1?sn(r,e):e}function qn(r,e,t=0){const n=[...r,e];return t&&n.length>t?n.slice(1):n}function Wn(r,e,t=0){const n=[e,...r];return t&&n.length>t?n.slice(0,-1):n}var gr=Symbol();function an(r,e){return!r.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!r.queryFn||r.queryFn===gr?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ae,ke,qe,Zr,Vn=(Zr=class extends Ot{constructor(){super();B(this,Ae);B(this,ke);B(this,qe);P(this,qe,e=>{if(!Pt&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){x(this,ke)||this.setEventListener(x(this,qe))}onUnsubscribe(){var e;this.hasListeners()||((e=x(this,ke))==null||e.call(this),P(this,ke,void 0))}setEventListener(e){var t;P(this,qe,e),(t=x(this,ke))==null||t.call(this),P(this,ke,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){x(this,Ae)!==e&&(P(this,Ae,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof x(this,Ae)=="boolean"?x(this,Ae):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ae=new WeakMap,ke=new WeakMap,qe=new WeakMap,Zr),on=new Vn,We,Se,Ve,Gr,Hn=(Gr=class extends Ot{constructor(){super();B(this,We,!0);B(this,Se);B(this,Ve);P(this,Ve,e=>{if(!Pt&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){x(this,Se)||this.setEventListener(x(this,Ve))}onUnsubscribe(){var e;this.hasListeners()||((e=x(this,Se))==null||e.call(this),P(this,Se,void 0))}setEventListener(e){var t;P(this,Ve,e),(t=x(this,Se))==null||t.call(this),P(this,Se,e(this.setOnline.bind(this)))}setOnline(e){x(this,We)!==e&&(P(this,We,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return x(this,We)}},We=new WeakMap,Se=new WeakMap,Ve=new WeakMap,Gr),jt=new Hn;function Un(){let r,e;const t=new Promise((a,i)=>{r=a,e=i});t.status="pending",t.catch(()=>{});function n(a){Object.assign(t,a),delete t.resolve,delete t.reject}return t.resolve=a=>{n({status:"fulfilled",value:a}),r(a)},t.reject=a=>{n({status:"rejected",reason:a}),e(a)},t}function Zn(r){return Math.min(1e3*2**r,3e4)}function ln(r){return(r??"online")==="online"?jt.isOnline():!0}var cn=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function Wt(r){return r instanceof cn}function dn(r){let e=!1,t=0,n=!1,a;const i=Un(),o=h=>{var u;n||(f(new cn(h)),(u=r.abort)==null||u.call(r))},l=()=>{e=!0},c=()=>{e=!1},d=()=>on.isFocused()&&(r.networkMode==="always"||jt.isOnline())&&r.canRun(),p=()=>ln(r.networkMode)&&r.canRun(),v=h=>{var u;n||(n=!0,(u=r.onSuccess)==null||u.call(r,h),a==null||a(),i.resolve(h))},f=h=>{var u;n||(n=!0,(u=r.onError)==null||u.call(r,h),a==null||a(),i.reject(h))},m=()=>new Promise(h=>{var u;a=g=>{(n||d())&&h(g)},(u=r.onPause)==null||u.call(r)}).then(()=>{var h;a=void 0,n||(h=r.onContinue)==null||h.call(r)}),b=()=>{if(n)return;let h;const u=t===0?r.initialPromise:void 0;try{h=u??r.fn()}catch(g){h=Promise.reject(g)}Promise.resolve(h).then(v).catch(g=>{var S;if(n)return;const _=r.retry??(Pt?0:3),y=r.retryDelay??Zn,j=typeof y=="function"?y(t,g):y,E=_===!0||typeof _=="number"&&t<_||typeof _=="function"&&_(t,g);if(e||!E){f(g);return}t++,(S=r.onFail)==null||S.call(r,t,g),Bn(j).then(()=>d()?void 0:m()).then(()=>{e?f(g):b()})})};return{promise:i,cancel:o,continue:()=>(a==null||a(),i),cancelRetry:l,continueRetry:c,canStart:p,start:()=>(p()?b():m().then(b),i)}}var Gn=r=>setTimeout(r,0);function Jn(){let r=[],e=0,t=l=>{l()},n=l=>{l()},a=Gn;const i=l=>{e?r.push(l):a(()=>{t(l)})},o=()=>{const l=r;r=[],l.length&&a(()=>{n(()=>{l.forEach(c=>{t(c)})})})};return{batch:l=>{let c;e++;try{c=l()}finally{e--,e||o()}return c},batchCalls:l=>(...c)=>{i(()=>{l(...c)})},schedule:i,setNotifyFunction:l=>{t=l},setBatchNotifyFunction:l=>{n=l},setScheduler:l=>{a=l}}}var te=Jn(),Oe,Jr,un=(Jr=class{constructor(){B(this,Oe)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),zn(this.gcTime)&&P(this,Oe,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Pt?1/0:5*60*1e3))}clearGcTimeout(){x(this,Oe)&&(clearTimeout(x(this,Oe)),P(this,Oe,void 0))}},Oe=new WeakMap,Jr),He,Pe,ae,Ne,X,ut,Ie,le,ge,Qr,Qn=(Qr=class extends un{constructor(e){super();B(this,le);B(this,He);B(this,Pe);B(this,ae);B(this,Ne);B(this,X);B(this,ut);B(this,Ie);P(this,Ie,!1),P(this,ut,e.defaultOptions),this.setOptions(e.options),this.observers=[],P(this,Ne,e.client),P(this,ae,x(this,Ne).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,P(this,He,Kn(this.options)),this.state=e.state??x(this,He),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=x(this,X))==null?void 0:e.promise}setOptions(e){this.options={...x(this,ut),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&x(this,ae).remove(this)}setData(e,t){const n=Fn(this.state.data,e,this.options);return K(this,le,ge).call(this,{data:n,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),n}setState(e,t){K(this,le,ge).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var n,a;const t=(n=x(this,X))==null?void 0:n.promise;return(a=x(this,X))==null||a.cancel(e),t?t.then(oe).catch(oe):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(x(this,He))}isActive(){return this.observers.some(e=>$n(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===gr||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>er(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!Ln(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=x(this,X))==null||t.continue()}onOnline(){var t;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=x(this,X))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),x(this,ae).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(x(this,X)&&(x(this,Ie)?x(this,X).cancel({revert:!0}):x(this,X).cancelRetry()),this.scheduleGc()),x(this,ae).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||K(this,le,ge).call(this,{type:"invalidate"})}fetch(e,t){var d,p,v;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(x(this,X))return x(this,X).continueRetry(),x(this,X).promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(m=>m.options.queryFn);f&&this.setOptions(f.options)}const n=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(P(this,Ie,!0),n.signal)})},i=()=>{const f=an(this.options,t),b=(()=>{const h={client:x(this,Ne),queryKey:this.queryKey,meta:this.meta};return a(h),h})();return P(this,Ie,!1),this.options.persister?this.options.persister(f,b,this):f(b)},l=(()=>{const f={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:x(this,Ne),state:this.state,fetchFn:i};return a(f),f})();(d=this.options.behavior)==null||d.onFetch(l,this),P(this,Pe,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=l.fetchOptions)==null?void 0:p.meta))&&K(this,le,ge).call(this,{type:"fetch",meta:(v=l.fetchOptions)==null?void 0:v.meta});const c=f=>{var m,b,h,u;Wt(f)&&f.silent||K(this,le,ge).call(this,{type:"error",error:f}),Wt(f)||((b=(m=x(this,ae).config).onError)==null||b.call(m,f,this),(u=(h=x(this,ae).config).onSettled)==null||u.call(h,this.state.data,f,this)),this.scheduleGc()};return P(this,X,dn({initialPromise:t==null?void 0:t.initialPromise,fn:l.fetchFn,abort:n.abort.bind(n),onSuccess:f=>{var m,b,h,u;if(f===void 0){c(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(f)}catch(g){c(g);return}(b=(m=x(this,ae).config).onSuccess)==null||b.call(m,f,this),(u=(h=x(this,ae).config).onSettled)==null||u.call(h,f,this.state.error,this),this.scheduleGc()},onError:c,onFail:(f,m)=>{K(this,le,ge).call(this,{type:"failed",failureCount:f,error:m})},onPause:()=>{K(this,le,ge).call(this,{type:"pause"})},onContinue:()=>{K(this,le,ge).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0})),x(this,X).start()}},He=new WeakMap,Pe=new WeakMap,ae=new WeakMap,Ne=new WeakMap,X=new WeakMap,ut=new WeakMap,Ie=new WeakMap,le=new WeakSet,ge=function(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Yn(n.data,this.options),fetchMeta:e.meta??null};case"success":return P(this,Pe,void 0),{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return Wt(a)&&a.revert&&x(this,Pe)?{...x(this,Pe),fetchStatus:"idle"}:{...n,error:a,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),te.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),x(this,ae).notify({query:this,type:"updated",action:e})})},Qr);function Yn(r,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ln(e.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function Kn(r){const e=typeof r.initialData=="function"?r.initialData():r.initialData,t=e!==void 0,n=t?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var de,Yr,Xn=(Yr=class extends Ot{constructor(e={}){super();B(this,de);this.config=e,P(this,de,new Map)}build(e,t,n){const a=t.queryKey,i=t.queryHash??mr(a,t);let o=this.get(i);return o||(o=new Qn({client:e,queryKey:a,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(a)}),this.add(o)),o}add(e){x(this,de).has(e.queryHash)||(x(this,de).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=x(this,de).get(e.queryHash);t&&(e.destroy(),t===e&&x(this,de).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){te.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return x(this,de).get(e)}getAll(){return[...x(this,de).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>_r(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>_r(e,n)):t}notify(e){te.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){te.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){te.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},de=new WeakMap,Yr),ue,ee,De,he,we,Kr,es=(Kr=class extends un{constructor(e){super();B(this,he);B(this,ue);B(this,ee);B(this,De);this.mutationId=e.mutationId,P(this,ee,e.mutationCache),P(this,ue,[]),this.state=e.state||ts(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){x(this,ue).includes(e)||(x(this,ue).push(e),this.clearGcTimeout(),x(this,ee).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){P(this,ue,x(this,ue).filter(t=>t!==e)),this.scheduleGc(),x(this,ee).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){x(this,ue).length||(this.state.status==="pending"?this.scheduleGc():x(this,ee).remove(this))}continue(){var e;return((e=x(this,De))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,o,l,c,d,p,v,f,m,b,h,u,g,_,y,j,E,S,z,W;const t=()=>{K(this,he,we).call(this,{type:"continue"})};P(this,De,dn({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(L,V)=>{K(this,he,we).call(this,{type:"failed",failureCount:L,error:V})},onPause:()=>{K(this,he,we).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>x(this,ee).canRun(this)}));const n=this.state.status==="pending",a=!x(this,De).canStart();try{if(n)t();else{K(this,he,we).call(this,{type:"pending",variables:e,isPaused:a}),await((o=(i=x(this,ee).config).onMutate)==null?void 0:o.call(i,e,this));const V=await((c=(l=this.options).onMutate)==null?void 0:c.call(l,e));V!==this.state.context&&K(this,he,we).call(this,{type:"pending",context:V,variables:e,isPaused:a})}const L=await x(this,De).start();return await((p=(d=x(this,ee).config).onSuccess)==null?void 0:p.call(d,L,e,this.state.context,this)),await((f=(v=this.options).onSuccess)==null?void 0:f.call(v,L,e,this.state.context)),await((b=(m=x(this,ee).config).onSettled)==null?void 0:b.call(m,L,null,this.state.variables,this.state.context,this)),await((u=(h=this.options).onSettled)==null?void 0:u.call(h,L,null,e,this.state.context)),K(this,he,we).call(this,{type:"success",data:L}),L}catch(L){try{throw await((_=(g=x(this,ee).config).onError)==null?void 0:_.call(g,L,e,this.state.context,this)),await((j=(y=this.options).onError)==null?void 0:j.call(y,L,e,this.state.context)),await((S=(E=x(this,ee).config).onSettled)==null?void 0:S.call(E,void 0,L,this.state.variables,this.state.context,this)),await((W=(z=this.options).onSettled)==null?void 0:W.call(z,void 0,L,e,this.state.context)),L}finally{K(this,he,we).call(this,{type:"error",error:L})}}finally{x(this,ee).runNext(this)}}},ue=new WeakMap,ee=new WeakMap,De=new WeakMap,he=new WeakSet,we=function(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),te.batch(()=>{x(this,ue).forEach(n=>{n.onMutationUpdate(e)}),x(this,ee).notify({mutation:this,type:"updated",action:e})})},Kr);function ts(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ye,ce,ht,Xr,rs=(Xr=class extends Ot{constructor(e={}){super();B(this,ye);B(this,ce);B(this,ht);this.config=e,P(this,ye,new Set),P(this,ce,new Map),P(this,ht,0)}build(e,t,n){const a=new es({mutationCache:this,mutationId:++gt(this,ht)._,options:e.defaultMutationOptions(t),state:n});return this.add(a),a}add(e){x(this,ye).add(e);const t=xt(e);if(typeof t=="string"){const n=x(this,ce).get(t);n?n.push(e):x(this,ce).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(x(this,ye).delete(e)){const t=xt(e);if(typeof t=="string"){const n=x(this,ce).get(t);if(n)if(n.length>1){const a=n.indexOf(e);a!==-1&&n.splice(a,1)}else n[0]===e&&x(this,ce).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=xt(e);if(typeof t=="string"){const n=x(this,ce).get(t),a=n==null?void 0:n.find(i=>i.state.status==="pending");return!a||a===e}else return!0}runNext(e){var n;const t=xt(e);if(typeof t=="string"){const a=(n=x(this,ce).get(t))==null?void 0:n.find(i=>i!==e&&i.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){te.batch(()=>{x(this,ye).forEach(e=>{this.notify({type:"removed",mutation:e})}),x(this,ye).clear(),x(this,ce).clear()})}getAll(){return Array.from(x(this,ye))}find(e){const t={exact:!0,...e};return this.getAll().find(n=>wr(t,n))}findAll(e={}){return this.getAll().filter(t=>wr(e,t))}notify(e){te.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return te.batch(()=>Promise.all(e.map(t=>t.continue().catch(oe))))}},ye=new WeakMap,ce=new WeakMap,ht=new WeakMap,Xr);function xt(r){var e;return(e=r.options.scope)==null?void 0:e.id}function Sr(r){return{onFetch:(e,t)=>{var p,v,f,m,b;const n=e.options,a=(f=(v=(p=e.fetchOptions)==null?void 0:p.meta)==null?void 0:v.fetchMore)==null?void 0:f.direction,i=((m=e.state.data)==null?void 0:m.pages)||[],o=((b=e.state.data)==null?void 0:b.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const d=async()=>{let h=!1;const u=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(e.signal.aborted?h=!0:e.signal.addEventListener("abort",()=>{h=!0}),e.signal)})},g=an(e.options,e.fetchOptions),_=async(y,j,E)=>{if(h)return Promise.reject();if(j==null&&y.pages.length)return Promise.resolve(y);const z=(()=>{const G={client:e.client,queryKey:e.queryKey,pageParam:j,direction:E?"backward":"forward",meta:e.options.meta};return u(G),G})(),W=await g(z),{maxPages:L}=e.options,V=E?Wn:qn;return{pages:V(y.pages,W,L),pageParams:V(y.pageParams,j,L)}};if(a&&i.length){const y=a==="backward",j=y?ns:Cr,E={pages:i,pageParams:o},S=j(n,E);l=await _(E,S,y)}else{const y=r??i.length;do{const j=c===0?o[0]??n.initialPageParam:Cr(n,l);if(c>0&&j==null)break;l=await _(l,j),c++}while(c<y)}return l};e.options.persister?e.fetchFn=()=>{var h,u;return(u=(h=e.options).persister)==null?void 0:u.call(h,d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=d}}}function Cr(r,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?r.getNextPageParam(e[n],e,t[n],t):void 0}function ns(r,{pages:e,pageParams:t}){var n;return e.length>0?(n=r.getPreviousPageParam)==null?void 0:n.call(r,e[0],e,t[0],t):void 0}var U,Ce,Te,Ue,Ze,Re,Ge,Je,en,ss=(en=class{constructor(r={}){B(this,U);B(this,Ce);B(this,Te);B(this,Ue);B(this,Ze);B(this,Re);B(this,Ge);B(this,Je);P(this,U,r.queryCache||new Xn),P(this,Ce,r.mutationCache||new rs),P(this,Te,r.defaultOptions||{}),P(this,Ue,new Map),P(this,Ze,new Map),P(this,Re,0)}mount(){gt(this,Re)._++,x(this,Re)===1&&(P(this,Ge,on.subscribe(async r=>{r&&(await this.resumePausedMutations(),x(this,U).onFocus())})),P(this,Je,jt.subscribe(async r=>{r&&(await this.resumePausedMutations(),x(this,U).onOnline())})))}unmount(){var r,e;gt(this,Re)._--,x(this,Re)===0&&((r=x(this,Ge))==null||r.call(this),P(this,Ge,void 0),(e=x(this,Je))==null||e.call(this),P(this,Je,void 0))}isFetching(r){return x(this,U).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return x(this,Ce).findAll({...r,status:"pending"}).length}getQueryData(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=x(this,U).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(r){const e=this.defaultQueryOptions(r),t=x(this,U).build(this,e),n=t.state.data;return n===void 0?this.fetchQuery(r):(r.revalidateIfStale&&t.isStaleByTime(er(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(r){return x(this,U).findAll(r).map(({queryKey:e,state:t})=>{const n=t.data;return[e,n]})}setQueryData(r,e,t){const n=this.defaultQueryOptions({queryKey:r}),a=x(this,U).get(n.queryHash),i=a==null?void 0:a.state.data,o=Dn(e,i);if(o!==void 0)return x(this,U).build(this,n).setData(o,{...t,manual:!0})}setQueriesData(r,e,t){return te.batch(()=>x(this,U).findAll(r).map(({queryKey:n})=>[n,this.setQueryData(n,e,t)]))}getQueryState(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=x(this,U).get(e.queryHash))==null?void 0:t.state}removeQueries(r){const e=x(this,U);te.batch(()=>{e.findAll(r).forEach(t=>{e.remove(t)})})}resetQueries(r,e){const t=x(this,U);return te.batch(()=>(t.findAll(r).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...r},e)))}cancelQueries(r,e={}){const t={revert:!0,...e},n=te.batch(()=>x(this,U).findAll(r).map(a=>a.cancel(t)));return Promise.all(n).then(oe).catch(oe)}invalidateQueries(r,e={}){return te.batch(()=>(x(this,U).findAll(r).forEach(t=>{t.invalidate()}),(r==null?void 0:r.refetchType)==="none"?Promise.resolve():this.refetchQueries({...r,type:(r==null?void 0:r.refetchType)??(r==null?void 0:r.type)??"active"},e)))}refetchQueries(r,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},n=te.batch(()=>x(this,U).findAll(r).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let i=a.fetch(void 0,t);return t.throwOnError||(i=i.catch(oe)),a.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(oe)}fetchQuery(r){const e=this.defaultQueryOptions(r);e.retry===void 0&&(e.retry=!1);const t=x(this,U).build(this,e);return t.isStaleByTime(er(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(oe).catch(oe)}fetchInfiniteQuery(r){return r.behavior=Sr(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(oe).catch(oe)}ensureInfiniteQueryData(r){return r.behavior=Sr(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return jt.isOnline()?x(this,Ce).resumePausedMutations():Promise.resolve()}getQueryCache(){return x(this,U)}getMutationCache(){return x(this,Ce)}getDefaultOptions(){return x(this,Te)}setDefaultOptions(r){P(this,Te,r)}setQueryDefaults(r,e){x(this,Ue).set(it(r),{queryKey:r,defaultOptions:e})}getQueryDefaults(r){const e=[...x(this,Ue).values()],t={};return e.forEach(n=>{ot(r,n.queryKey)&&Object.assign(t,n.defaultOptions)}),t}setMutationDefaults(r,e){x(this,Ze).set(it(r),{mutationKey:r,defaultOptions:e})}getMutationDefaults(r){const e=[...x(this,Ze).values()],t={};return e.forEach(n=>{ot(r,n.mutationKey)&&Object.assign(t,n.defaultOptions)}),t}defaultQueryOptions(r){if(r._defaulted)return r;const e={...x(this,Te).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return e.queryHash||(e.queryHash=mr(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===gr&&(e.enabled=!1),e}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...x(this,Te).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){x(this,U).clear(),x(this,Ce).clear()}},U=new WeakMap,Ce=new WeakMap,Te=new WeakMap,Ue=new WeakMap,Ze=new WeakMap,Re=new WeakMap,Ge=new WeakMap,Je=new WeakMap,en),as=R.createContext(void 0),is=({client:r,children:e})=>(R.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),s.jsx(as.Provider,{value:r,children:e}));function Nt({width:r,height:e,hexSize:t=60,hexes:n,selectedHex:a,onHexClick:i,onHexHover:o,onHexRightClick:l,showCoordinates:c=!1,showGrid:d=!0,enableDrag:p=!1,viewport:v={x:0,y:0,zoom:1}}){const[f,m]=H.useState(!1),[b,h]=H.useState({x:0,y:0}),[u,g]=H.useState(v),_=t*2,y=Math.sqrt(3)*t,j=y*.75,E=_*.75,S=(N,se)=>{const $e=N%2===1?y/2:0;return{x:N*E,y:se*j+$e}},z=N=>{p&&(m(!0),h({x:N.clientX-u.x,y:N.clientY-u.y}))},W=N=>{!f||!p||g({...u,x:N.clientX-b.x,y:N.clientY-b.y})},L=()=>{m(!1)},V=N=>{if(!p)return;N.preventDefault();const se=Math.max(.5,Math.min(2,u.zoom+N.deltaY*-.001));g({...u,zoom:se})},G=N=>{const se={grass:{background:"linear-gradient(135deg, #2d5016, #4a8025)"},forest:{background:"linear-gradient(135deg, #1a3a1a, #2a5a2a)"},mountain:{background:"linear-gradient(135deg, #5a5a5a, #8a8a8a)"},water:{background:"linear-gradient(135deg, #1e3a5f, #2e5a8f)"},mystique:{background:"linear-gradient(135deg, #4a1a5a, #6a3a7a)"},quantum:{background:"linear-gradient(135deg, #1a3a4a, #3a5a6a)"},nexus:{background:"radial-gradient(circle, #ff00ff, #00ffff)",animation:"pulse 2s infinite"}};return se[N||"grass"]||se.grass},ft=N=>{switch(N){case"total":return{background:"#000",opacity:.9};case"partial":return{opacity:.5,filter:"blur(2px)"};default:return{}}},mt=N=>{const se=S(N.x,N.y),$e=(a==null?void 0:a.x)===N.x&&(a==null?void 0:a.y)===N.y,Ft=`${N.x},${N.y}`;return s.jsxs("div",{className:`hex-cell ${$e?"hex-selected":""}`,onClick:()=>i==null?void 0:i(N.x,N.y),onMouseEnter:()=>o==null?void 0:o(N.x,N.y),onContextMenu:jn=>{jn.preventDefault(),l==null||l(N.x,N.y)},style:{position:"absolute",left:se.x,top:se.y,width:_,height:y,clipPath:"polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%)",...G(N.terrain),...ft(N.fog),border:$e?"3px solid #ffd700":d?"1px solid rgba(255,255,255,0.1)":"none",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},children:[c&&s.jsxs("span",{style:{fontSize:10,color:"rgba(255,255,255,0.5)",userSelect:"none"},children:[N.x,",",N.y]}),N.entity&&s.jsx("div",{style:{fontSize:24,filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:N.entity.icon||"👤"}),N.overlay&&s.jsx("div",{style:{position:"absolute",inset:0,background:N.overlay,opacity:.3,pointerEvents:"none"}})]},Ft)},rt=[];for(let N=0;N<r;N++)for(let se=0;se<e;se++){const $e=`${N},${se}`,Ft=n.get($e)||{x:N,y:se};rt.push(mt(Ft))}return s.jsxs("div",{className:"hex-grid-container",onMouseDown:z,onMouseMove:W,onMouseUp:L,onMouseLeave:L,onWheel:V,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",cursor:f?"grabbing":p?"grab":"default",background:"#0a0e1a"},children:[s.jsx("div",{className:"hex-grid-viewport",style:{position:"absolute",transform:`translate(${u.x}px, ${u.y}px) scale(${u.zoom})`,transformOrigin:"top left"},children:s.jsx("div",{className:"hex-grid",style:{position:"relative"},children:rt})}),p&&s.jsxs("div",{style:{position:"absolute",bottom:20,right:20,width:150,height:100,background:"rgba(0,0,0,0.8)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:4,padding:4},children:[s.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.5)",marginBottom:2},children:"Mini-map"}),s.jsx("div",{style:{width:"100%",height:"calc(100% - 15px)",background:"rgba(255,255,255,0.1)",position:"relative"},children:s.jsx("div",{style:{position:"absolute",left:`${u.x/(r*E)*100}%`,top:`${u.y/(e*j)*100}%`,width:`${100/u.zoom}%`,height:`${100/u.zoom}%`,border:"1px solid #ffd700",background:"rgba(255,215,0,0.1)"}})})]})]})}if(typeof document<"u"&&!document.getElementById("hex-grid-styles")){const r=document.createElement("style");r.id="hex-grid-styles",r.textContent=`
    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    
    .hex-cell:hover {
      transform: translateY(-2px);
      filter: brightness(1.2);
    }
    
    .hex-selected {
      animation: pulse 1s infinite;
      z-index: 10;
    }
  `,document.head.appendChild(r)}function It({temporal:r,variant:e="full",showEnergy:t=!0,showParadoxes:n=!0,animated:a=!0,onParadoxClick:i}){const o=Math.abs(r.tw-r.te),l=()=>o<2?"#48bb78":o<5?"#f6ad55":o<10?"#fc8181":"#e53e3e",c=()=>o<2?"Stable":o<5?"Dérive":o<10?"Danger":"Critique!",d=()=>{if(!r.energy_complex)return 0;const{A:p,phi:v}=r.energy_complex;return Math.sqrt(p*p+v*v)};return e==="minimal"?s.jsxs("div",{style:{display:"flex",gap:12,padding:"4px 8px",background:"rgba(0,0,0,0.5)",borderRadius:4,fontSize:12,color:"#e8ecff"},children:[s.jsxs("span",{children:["TW: ",r.tw.toFixed(1)]}),s.jsxs("span",{children:["TE: ",r.te.toFixed(1)]}),s.jsxs("span",{style:{color:l()},children:["Δ: ",o.toFixed(1)]})]}):e==="compact"?s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:"8px 16px",background:"linear-gradient(135deg, rgba(20, 24, 36, 0.9) 0%, rgba(26, 31, 46, 0.9) 100%)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:8,backdropFilter:"blur(10px)"},children:[s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[s.jsx("span",{style:{fontSize:10,color:"#718096"},children:"TW"}),s.jsx("span",{style:{fontSize:16,fontWeight:600,color:"#667eea"},children:r.tw.toFixed(1)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[s.jsx("span",{style:{fontSize:10,color:"#718096"},children:"TE"}),s.jsx("span",{style:{fontSize:16,fontWeight:600,color:"#48bb78"},children:r.te.toFixed(1)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[s.jsx("span",{style:{fontSize:10,color:"#718096"},children:"Δt"}),s.jsx("span",{style:{fontSize:16,fontWeight:600,color:l(),animation:o>5&&a?"pulse 1s infinite":"none"},children:o.toFixed(1)})]})]}),r.debt&&r.debt>0&&s.jsxs("div",{style:{padding:"2px 8px",background:"rgba(252, 129, 129, 0.2)",border:"1px solid rgba(252, 129, 129, 0.4)",borderRadius:4,fontSize:11,color:"#fc8181"},children:["💸 Dette: ",r.debt.toFixed(1)]})]}):s.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.95) 100%)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:12,padding:16,backdropFilter:"blur(20px)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",minWidth:280},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:12,borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[s.jsx("h3",{style:{margin:0,color:"#667eea",fontSize:14},children:"⏰ État Temporel"}),s.jsx("span",{style:{fontSize:11,padding:"2px 8px",background:`${l()}20`,border:`1px solid ${l()}40`,borderRadius:4,color:l()},children:c()})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:16},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:10,color:"#718096",marginBottom:4},children:"Temps Monde"}),s.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#667eea",animation:a?"fadeIn 0.5s":"none"},children:r.tw.toFixed(1)})]}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:10,color:"#718096",marginBottom:4},children:"Temps Entité"}),s.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#48bb78",animation:a?"fadeIn 0.5s 0.1s both":"none"},children:r.te.toFixed(1)})]}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:10,color:"#718096",marginBottom:4},children:"Dérive"}),s.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:l(),animation:o>5&&a?"pulse 1s infinite":a?"fadeIn 0.5s 0.2s both":"none"},children:o.toFixed(1)})]})]}),s.jsxs("div",{style:{marginBottom:16},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,color:"#718096",marginBottom:4},children:[s.jsx("span",{children:"Synchronisation"}),s.jsxs("span",{children:[Math.max(0,100-o*10).toFixed(0),"%"]})]}),s.jsx("div",{style:{height:6,background:"rgba(0, 0, 0, 0.3)",borderRadius:3,overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.max(0,100-o*10)}%`,height:"100%",background:`linear-gradient(90deg, ${l()} 0%, ${l()}cc 100%)`,transition:"width 0.5s ease"}})})]}),r.debt!==void 0&&r.debt>0&&s.jsx("div",{style:{padding:12,background:"rgba(252, 129, 129, 0.1)",border:"1px solid rgba(252, 129, 129, 0.3)",borderRadius:8,marginBottom:12},children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:12,color:"#fc8181",fontWeight:600},children:"💸 Dette Temporelle"}),s.jsxs("div",{style:{fontSize:10,color:"#fca5a5",marginTop:2},children:["Accumulation: ",((r.debtRate||.05)*100).toFixed(0),"%/tick"]})]}),s.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#fc8181"},children:r.debt.toFixed(1)})]})}),t&&r.energy_complex&&s.jsxs("div",{style:{padding:12,background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:8,marginBottom:12},children:[s.jsx("div",{style:{fontSize:12,color:"#a0aec0",marginBottom:8},children:"⚡ Énergie Complexe"}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{style:{fontSize:14,color:"#e8ecff"},children:["E = ",r.energy_complex.A.toFixed(0)," + ",r.energy_complex.phi.toFixed(2),"i"]}),s.jsxs("div",{style:{fontSize:12,color:"#9f7aea"},children:["|E| = ",d().toFixed(1)]})]}),s.jsxs("div",{style:{display:"flex",height:4,borderRadius:2,overflow:"hidden",marginTop:8},children:[s.jsx("div",{style:{width:`${r.energy_complex.A/100*100}%`,background:"linear-gradient(90deg, #667eea, #764ba2)"}}),s.jsx("div",{style:{width:`${r.energy_complex.phi/Math.PI*50}%`,background:"linear-gradient(90deg, #f093fb, #f5576c)"}})]})]}),n&&r.paradoxes&&r.paradoxes.length>0&&s.jsxs("div",{style:{padding:12,background:"rgba(237, 137, 54, 0.1)",border:"1px solid rgba(237, 137, 54, 0.3)",borderRadius:8},children:[s.jsx("div",{style:{fontSize:12,color:"#ed8936",marginBottom:8,fontWeight:600},children:"⚠️ Paradoxes Détectés"}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:r.paradoxes.map((p,v)=>s.jsxs("div",{onClick:()=>i==null?void 0:i(p),style:{padding:"4px 8px",background:"rgba(237, 137, 54, 0.1)",borderRadius:4,fontSize:11,color:"#f6ad55",cursor:i?"pointer":"default",transition:"background 0.2s"},onMouseEnter:f=>{i&&(f.currentTarget.style.background="rgba(237, 137, 54, 0.2)")},onMouseLeave:f=>{f.currentTarget.style.background="rgba(237, 137, 54, 0.1)"},children:[p.type.replace(/_/g," ")," - ",p.severity]},v))})]})]})}if(typeof document<"u"&&!document.getElementById("temporal-display-styles")){const r=document.createElement("style");r.id="temporal-display-styles",r.textContent=`
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
  `,document.head.appendChild(r)}const os={crystals:"💎",energy:"⚡",temporal:"⏰",quantum:"🌀"},ls={crystals:"#63b3ed",energy:"#f6ad55",temporal:"#9f7aea",quantum:"#48bb78"};function Dt({resources:r,maxValues:e,variant:t="horizontal",showLabels:n=!0,showMax:a=!0,animated:i=!0,onChange:o,customIcons:l={}}){const c={...os,...l},[d,p]=H.useState(r),[v,f]=H.useState(new Set);H.useEffect(()=>{const h=new Set;Object.keys(r).forEach(u=>{d[u]!==r[u]&&h.add(u)}),h.size>0&&i&&(f(h),setTimeout(()=>f(new Set),500)),p(r)},[r,i,d]);const m=(h,u)=>{if(u===void 0)return null;const g=e==null?void 0:e[h],_=g?u/g*100:0,y=v.has(h),j=g&&u<g*.25,E=ls[h]||"#667eea";return t==="compact"?s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",background:"rgba(255, 255, 255, 0.05)",borderRadius:4,border:y?`1px solid ${E}`:"1px solid transparent",transition:"all 0.3s"},children:[s.jsx("span",{style:{fontSize:16},children:c[h]}),s.jsx("span",{style:{fontSize:14,fontWeight:600,color:j?"#fc8181":"#e8ecff",animation:y?"pulse 0.5s":"none"},children:u})]},h):s.jsxs("div",{style:{display:"flex",flexDirection:t==="vertical"?"column":"row",gap:8,flex:1,minWidth:t==="vertical"?"auto":120},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minWidth:t==="vertical"?"auto":80},children:[s.jsx("span",{style:{fontSize:20,filter:y?`drop-shadow(0 0 8px ${E})`:"none",transition:"filter 0.3s"},children:c[h]}),n&&s.jsx("span",{style:{fontSize:11,color:"#a0aec0",textTransform:"capitalize"},children:h})]}),s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:4},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[s.jsx("span",{style:{fontSize:16,fontWeight:"bold",color:j?"#fc8181":"#e8ecff",animation:y?"bounceValue 0.5s":"none"},children:u}),a&&g&&s.jsxs("span",{style:{fontSize:11,color:"#718096"},children:["/ ",g]})]}),g&&s.jsx("div",{style:{height:4,background:"rgba(0, 0, 0, 0.3)",borderRadius:2,overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,_)}%`,height:"100%",background:`linear-gradient(90deg, ${E}, ${E}cc)`,transition:"width 0.5s ease",boxShadow:j?`0 0 8px ${E}`:"none",animation:j?"pulse 1s infinite":"none"}})})]}),o&&s.jsxs("div",{style:{display:"flex",gap:4},children:[s.jsx("button",{onClick:()=>o(h,Math.max(0,u-1)),style:{width:20,height:20,borderRadius:4,background:"rgba(252, 129, 129, 0.2)",border:"1px solid rgba(252, 129, 129, 0.4)",color:"#fc8181",cursor:"pointer",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),s.jsx("button",{onClick:()=>o(h,u+1),style:{width:20,height:20,borderRadius:4,background:"rgba(72, 187, 120, 0.2)",border:"1px solid rgba(72, 187, 120, 0.4)",color:"#48bb78",cursor:"pointer",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]},h)},b=Object.entries(r).filter(([h,u])=>u!==void 0);return s.jsxs("div",{className:"resource-bar",style:{display:"flex",flexDirection:t==="vertical"?"column":"row",gap:t==="compact"?8:16,padding:t==="compact"?8:12,background:t==="compact"?"transparent":"linear-gradient(135deg, rgba(20, 24, 36, 0.9) 0%, rgba(26, 31, 46, 0.9) 100%)",border:t==="compact"?"none":"1px solid rgba(102, 126, 234, 0.2)",borderRadius:t==="compact"?0:8,backdropFilter:t==="compact"?"none":"blur(10px)",flexWrap:t==="compact"?"wrap":"nowrap"},children:[b.map(([h,u])=>m(h,u)),b.length===0&&s.jsx("div",{style:{color:"#718096",fontSize:12,fontStyle:"italic"},children:"Aucune ressource"})]})}if(typeof document<"u"&&!document.getElementById("resource-bar-styles")){const r=document.createElement("style");r.id="resource-bar-styles",r.textContent=`
    @keyframes bounceValue {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
  `,document.head.appendChild(r)}const bt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},rr=new Map,vt=r=>{const e=rr.get(r);return e?Object.fromEntries(Object.entries(e.stores).map(([t,n])=>[t,n.getState()])):{}},cs=(r,e,t)=>{if(r===void 0)return{type:"untracked",connection:e.connect(t)};const n=rr.get(t.name);if(n)return{type:"tracked",store:r,...n};const a={connection:e.connect(t),stores:{}};return rr.set(t.name,a),{type:"tracked",store:r,...a}},ds=(r,e={})=>(t,n,a)=>{const{enabled:i,anonymousActionType:o,store:l,...c}=e;let d;try{d=(i??(bt?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return(bt?"production":void 0)!=="production"&&i&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),r(t,n,a);const{connection:p,...v}=cs(l,d,c);let f=!0;a.setState=(h,u,g)=>{const _=t(h,u);if(!f)return _;const y=g===void 0?{type:o||"anonymous"}:typeof g=="string"?{type:g}:g;return l===void 0?(p==null||p.send(y,n()),_):(p==null||p.send({...y,type:`${l}/${y.type}`},{...vt(c.name),[l]:a.getState()}),_)};const m=(...h)=>{const u=f;f=!1,t(...h),f=u},b=r(a.setState,n,a);if(v.type==="untracked"?p==null||p.init(b):(v.stores[v.store]=a,p==null||p.init(Object.fromEntries(Object.entries(v.stores).map(([h,u])=>[h,h===v.store?b:u.getState()])))),a.dispatchFromDevtools&&typeof a.dispatch=="function"){let h=!1;const u=a.dispatch;a.dispatch=(...g)=>{(bt?"production":void 0)!=="production"&&g[0].type==="__setState"&&!h&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),h=!0),u(...g)}}return p.subscribe(h=>{var u;switch(h.type){case"ACTION":if(typeof h.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Vt(h.payload,g=>{if(g.type==="__setState"){if(l===void 0){m(g.state);return}Object.keys(g.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const _=g.state[l];if(_==null)return;JSON.stringify(a.getState())!==JSON.stringify(_)&&m(_);return}a.dispatchFromDevtools&&typeof a.dispatch=="function"&&a.dispatch(g)});case"DISPATCH":switch(h.payload.type){case"RESET":return m(b),l===void 0?p==null?void 0:p.init(a.getState()):p==null?void 0:p.init(vt(c.name));case"COMMIT":if(l===void 0){p==null||p.init(a.getState());return}return p==null?void 0:p.init(vt(c.name));case"ROLLBACK":return Vt(h.state,g=>{if(l===void 0){m(g),p==null||p.init(a.getState());return}m(g[l]),p==null||p.init(vt(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Vt(h.state,g=>{if(l===void 0){m(g);return}JSON.stringify(a.getState())!==JSON.stringify(g[l])&&m(g[l])});case"IMPORT_STATE":{const{nextLiftedState:g}=h.payload,_=(u=g.computedStates.slice(-1)[0])==null?void 0:u.state;if(!_)return;m(l===void 0?_:_[l]),p==null||p.send(null,g);return}case"PAUSE_RECORDING":return f=!f}return}}),b},zt=ds,Vt=(r,e)=>{let t;try{t=JSON.parse(r)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}t!==void 0&&e(t)};function us(r,e){let t;try{t=r()}catch{return}return{getItem:a=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=t.getItem(a))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const lt=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return lt(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return lt(n)(t)}}}},hs=(r,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:u=>u,version:0,merge:(u,g)=>({...g,...u}),...e},o=!1;const l=new Set,c=new Set;let d;try{d=i.getStorage()}catch{}if(!d)return r((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...u)},n,a);const p=lt(i.serialize),v=()=>{const u=i.partialize({...n()});let g;const _=p({state:u,version:i.version}).then(y=>d.setItem(i.name,y)).catch(y=>{g=y});if(g)throw g;return _},f=a.setState;a.setState=(u,g)=>{f(u,g),v()};const m=r((...u)=>{t(...u),v()},n,a);let b;const h=()=>{var u;if(!d)return;o=!1,l.forEach(_=>_(n()));const g=((u=i.onRehydrateStorage)==null?void 0:u.call(i,n()))||void 0;return lt(d.getItem.bind(d))(i.name).then(_=>{if(_)return i.deserialize(_)}).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==i.version){if(i.migrate)return i.migrate(_.state,_.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return _.state}).then(_=>{var y;return b=i.merge(_,(y=n())!=null?y:m),t(b,!0),v()}).then(()=>{g==null||g(b,void 0),o=!0,c.forEach(_=>_(b))}).catch(_=>{g==null||g(void 0,_)})};return a.persist={setOptions:u=>{i={...i,...u},u.getStorage&&(d=u.getStorage())},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>h(),hasHydrated:()=>o,onHydrate:u=>(l.add(u),()=>{l.delete(u)}),onFinishHydration:u=>(c.add(u),()=>{c.delete(u)})},h(),b||m},ps=(r,e)=>(t,n,a)=>{let i={storage:us(()=>localStorage),partialize:h=>h,version:0,merge:(h,u)=>({...u,...h}),...e},o=!1;const l=new Set,c=new Set;let d=i.storage;if(!d)return r((...h)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...h)},n,a);const p=()=>{const h=i.partialize({...n()});return d.setItem(i.name,{state:h,version:i.version})},v=a.setState;a.setState=(h,u)=>{v(h,u),p()};const f=r((...h)=>{t(...h),p()},n,a);a.getInitialState=()=>f;let m;const b=()=>{var h,u;if(!d)return;o=!1,l.forEach(_=>{var y;return _((y=n())!=null?y:f)});const g=((u=i.onRehydrateStorage)==null?void 0:u.call(i,(h=n())!=null?h:f))||void 0;return lt(d.getItem.bind(d))(i.name).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==i.version){if(i.migrate)return[!0,i.migrate(_.state,_.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,_.state];return[!1,void 0]}).then(_=>{var y;const[j,E]=_;if(m=i.merge(E,(y=n())!=null?y:f),t(m,!0),j)return p()}).then(()=>{g==null||g(m,void 0),m=n(),o=!0,c.forEach(_=>_(m))}).catch(_=>{g==null||g(void 0,_)})};return a.persist={setOptions:h=>{i={...i,...h},h.storage&&(d=h.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>b(),hasHydrated:()=>o,onHydrate:h=>(l.add(h),()=>{l.delete(h)}),onFinishHydration:h=>(c.add(h),()=>{c.delete(h)})},i.skipHydration||b(),m||f},fs=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((bt?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),hs(r,e)):ps(r,e),hn=fs,Ht={temporal:{tw:0,te:0,debt:0,debtRate:.05,entities:new Map,energy_complex:{A:50,phi:Math.PI/4}},resources:{crystals:100,energy:50,temporal:25,quantum:10},day:1,turn:1,mode:"campaign",difficulty:"normal",heroPosition:{x:10,y:10},heroStats:{health:100,maxHealth:100,attack:10,defense:5,movement:3},regulators:{vince:{active:!1,intensity:0},anna:{active:!1,decayRate:5},overload:{stack:0,maxStack:10}},events:[],currentView:"map",selectedHex:null},yr=pt()(zt(hn((r,e)=>({...Ht,setCurrentView:t=>r({currentView:t}),setSelectedHex:t=>r({selectedHex:t}),moveHero:(t,n)=>{var l,c;const a=e(),o=(Math.abs(t-(((l=a.heroPosition)==null?void 0:l.x)||0))+Math.abs(n-(((c=a.heroPosition)==null?void 0:c.y)||0)))*5;a.resources.energy>=o&&r(d=>({heroPosition:{x:t,y:n},resources:{...d.resources,energy:d.resources.energy-o}}))},endTurn:async()=>{const t=e();await e().tick();const n=t.turn+1,a=Math.floor(n/10)+1;r(o=>({turn:n,day:a,resources:{...o.resources,energy:Math.min(100,o.resources.energy+10),temporal:Math.min(100,o.resources.temporal+5)}}));const i=t.events.filter(o=>o.day===a);i.length>0&&console.log("📅 Événements du jour:",i)},tick:async()=>{try{const t=await fetch("http://localhost:3001/api/v2/tick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e())});if(t.ok){const n=await t.json();r(a=>({temporal:{...a.temporal,tw:n.new_tw||a.temporal.tw+1,te:n.new_te||a.temporal.te+.95,debt:n.debt||a.temporal.debt}}))}}catch{r(n=>({temporal:{...n.temporal,tw:n.temporal.tw+1,te:n.temporal.te+.95}}))}},addResource:(t,n)=>{r(a=>({resources:{...a.resources,[t]:a.resources[t]+n}}))},consumeResource:(t,n)=>e().resources[t]>=n?(r(i=>({resources:{...i.resources,[t]:i.resources[t]-n}})),!0):!1,activateVince:t=>{r(n=>({regulators:{...n.regulators,vince:{active:!0,intensity:1,position:t}}}))},activateAnna:t=>{r(n=>({regulators:{...n.regulators,anna:{active:!0,decayRate:t}}}))},triggerOverload:()=>{const t=e(),n=t.regulators.overload.stack+1;n>=t.regulators.overload.maxStack?(console.log("💥 OVERLOAD EXPLOSION!"),r(a=>({regulators:{...a.regulators,overload:{...a.regulators.overload,stack:0}}}))):r(a=>({regulators:{...a.regulators,overload:{...a.regulators.overload,stack:n}}}))},startNewGame:(t,n)=>{r({...Ht,mode:t,difficulty:n})},saveGame:()=>{const t=e(),n=JSON.stringify(t);localStorage.setItem("magic-stack-save",n),console.log("💾 Jeu sauvegardé")},loadGame:t=>{try{const n=JSON.parse(t);r(n),console.log("📂 Jeu chargé")}catch(n){console.error("Erreur chargement:",n)}},reset:()=>r(Ht)}),{name:"magic-stack-game",partialize:r=>({temporal:r.temporal,resources:r.resources,day:r.day,turn:r.turn,mode:r.mode,difficulty:r.difficulty,heroPosition:r.heroPosition,heroStats:r.heroStats,regulators:r.regulators,events:r.events})}))),pn=pt((r,e)=>({hexes:new Map,setHex:(t,n,a)=>{const i=`${t},${n}`;r(o=>{const l=new Map(o.hexes);return l.set(i,{x:t,y:n,...a}),{hexes:l}})},getHex:(t,n)=>{const a=`${t},${n}`;return e().hexes.get(a)},generateMap:(t,n)=>{const a=new Map,i=["grass","forest","mountain","water","mystique","quantum"];for(let o=0;o<t;o++)for(let l=0;l<n;l++){const c=`${o},${l}`;a.set(c,{x:o,y:l,terrain:i[Math.floor(Math.random()*i.length)],fog:Math.random()>.7?"partial":"clear"})}r({hexes:a})}}));if(typeof window<"u"){const r=pn.getState();r.hexes.size===0&&r.generateMap(20,20)}function ms(){const r=Tn(),{gameState:e,currentView:t,setCurrentView:n,moveHero:a,endTurn:i}=yr();return s.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#0a0e1a"},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.9) 100%)",borderBottom:"1px solid rgba(102, 126, 234, 0.3)",backdropFilter:"blur(10px)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[s.jsx("h1",{style:{fontSize:24,fontWeight:"bold",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",margin:0},children:"⚔️ Heroes of Time"}),s.jsxs("nav",{style:{display:"flex",gap:8},children:[s.jsx(Zt,{active:t==="map",onClick:()=>n("map"),children:"🗺️ Carte"}),s.jsx(Zt,{active:t==="combat",onClick:()=>n("combat"),children:"⚔️ Combat"}),s.jsx(Zt,{active:t==="timeline",onClick:()=>n("timeline"),children:"📅 Timeline"})]})]}),s.jsx(It,{temporal:e.temporal,variant:"compact",showEnergy:!0})]}),s.jsx("div",{style:{padding:"0 20px",background:"rgba(20, 24, 36, 0.5)"},children:s.jsx(Dt,{resources:e.resources,maxValues:{crystals:999,energy:100,temporal:100,quantum:50},variant:"horizontal"})}),s.jsxs("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:[s.jsxs(tn,{children:[s.jsx(J,{path:"/",element:s.jsx(Ut,{})}),s.jsx(J,{path:"/map",element:s.jsx(Ut,{})}),s.jsx(J,{path:"/combat",element:s.jsx(Tr,{})}),s.jsx(J,{path:"/timeline",element:s.jsx(Rr,{})})]}),t==="map"&&s.jsx(Ut,{}),t==="combat"&&s.jsx(Tr,{}),t==="timeline"&&s.jsx(Rr,{})]}),s.jsxs("footer",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"rgba(20, 24, 36, 0.9)",borderTop:"1px solid rgba(102, 126, 234, 0.3)"},children:[s.jsxs("div",{style:{display:"flex",gap:8},children:[s.jsx("button",{onClick:i,style:{padding:"10px 20px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14},children:"⏭️ Fin de Tour"}),s.jsx("button",{onClick:()=>r("/"),style:{padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:8,cursor:"pointer",fontSize:14},children:"🏠 Menu"})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,fontSize:14,color:"#a0aec0"},children:[s.jsxs("span",{children:["Jour ",e.day||1]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Tour ",e.turn||1]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Mode: ",e.mode||"Campaign"]})]})]})]})}function Ut(){const{gameState:r,selectedHex:e,setSelectedHex:t,moveHero:n}=yr(),{hexes:a}=pn();return s.jsx(Nt,{width:20,height:20,hexes:a,selectedHex:e,onHexClick:(i,o)=>{t({x:i,y:o}),r.heroPosition&&n(i,o)},enableDrag:!0,showGrid:!0})}function Tr(){return s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column",gap:20},children:[s.jsx("div",{style:{fontSize:64},children:"⚔️"}),s.jsx("h2",{style:{fontSize:32,color:"#667eea"},children:"Mode Combat"}),s.jsx("p",{style:{color:"#a0aec0"},children:"TCG ou Auto-résolution"}),s.jsxs("div",{style:{display:"flex",gap:16},children:[s.jsx("button",{style:{padding:"12px 24px",background:"linear-gradient(135deg, #fc8181 0%, #f56565 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontSize:16},children:"🎴 Mode TCG"}),s.jsx("button",{style:{padding:"12px 24px",background:"linear-gradient(135deg, #48bb78 0%, #38b2ac 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontSize:16},children:"⚡ Auto-Résolution"})]})]})}function Rr(){const{gameState:r}=yr();return s.jsxs("div",{style:{padding:40,maxWidth:1200,margin:"0 auto"},children:[s.jsx("h2",{style:{fontSize:32,color:"#667eea",marginBottom:24},children:"📅 Timeline Temporelle"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:16},children:[1,5,10,15,20,25,30].map(e=>s.jsxs("div",{style:{padding:16,background:e===r.day?"linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%)":"rgba(255, 255, 255, 0.05)",border:e===r.day?"2px solid #667eea":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:8},children:[s.jsxs("div",{style:{fontSize:24,marginBottom:8},children:["Jour ",e]}),e===30&&s.jsx("div",{style:{fontSize:12,color:"#ffd700"},children:"🌟 Événement Spécial"})]},e))}),s.jsxs("div",{style:{marginTop:32,padding:20,background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:8},children:[s.jsx("h3",{style:{color:"#9f7aea",marginBottom:12},children:"Prochains Événements"}),s.jsxs("ul",{style:{listStyle:"none",padding:0},children:[s.jsx("li",{children:"Jour 8: Premiers contacts"}),s.jsx("li",{children:"Jour 15: Les régulateurs arrivent"}),s.jsx("li",{children:"Jour 20: Bataille majeure"}),s.jsx("li",{children:"Jour 25: Convergence temporelle"}),s.jsx("li",{children:"Jour 30: L'Apocalypse Temporelle"})]})]})]})}function Zt({active:r,onClick:e,children:t}){return s.jsx("button",{onClick:e,style:{padding:"8px 16px",background:r?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"transparent",color:r?"white":"#a0aec0",border:r?"none":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:6,cursor:"pointer",fontSize:14,transition:"all 0.2s"},children:t})}const Er={hexes:new Map,mapSize:{width:30,height:20},selectedHex:null,selectedIcon:null,currentTool:"select",history:[],historyIndex:-1},fn=pt()(zt((r,e)=>({...Er,setSelectedHex:t=>r({selectedHex:t}),setSelectedIcon:t=>r({selectedIcon:t}),setCurrentTool:t=>r({currentTool:t}),placeIcon:(t,n,a)=>{const i=`${t},${n}`;r(o=>{const l=new Map(o.hexes),c=l.get(i)||{x:t,y:n};c.icon=a,l.set(i,c);const d=o.history.slice(0,o.historyIndex+1);return d.push(Array.from(l.values())),{hexes:l,history:d,historyIndex:d.length-1}})},setTerrain:(t,n,a)=>{const i=`${t},${n}`;r(o=>{const l=new Map(o.hexes),c=l.get(i)||{x:t,y:n};return c.terrain=a,l.set(i,c),{hexes:l}})},clearHex:(t,n)=>{const a=`${t},${n}`;r(i=>{const o=new Map(i.hexes);return o.delete(a),{hexes:o}})},connectHexes:(t,n)=>{const a=`${t.x},${t.y}`,i=`${n.x},${n.y}`;r(o=>{const l=new Map(o.hexes),c=l.get(a)||{x:t.x,y:t.y};c.connections=c.connections||[],c.connections.includes(i)||c.connections.push(i),l.set(a,c);const d=l.get(i)||{x:n.x,y:n.y};return d.connections=d.connections||[],d.connections.includes(a)||d.connections.push(a),l.set(i,d),{hexes:l}})},exportMap:()=>{const t=e();return{version:"1.0.0",mapSize:t.mapSize,hexes:Array.from(t.hexes.values()),metadata:{createdAt:new Date().toISOString(),tool:"Magic Stack Unified Editor"}}},importMap:t=>{if(!t||!t.hexes)return;const n=new Map;t.hexes.forEach(a=>{n.set(`${a.x},${a.y}`,a)}),r({hexes:n,mapSize:t.mapSize||{width:30,height:20}})},undo:()=>{const t=e();if(t.historyIndex>0){const n=t.historyIndex-1,a=t.history[n],i=new Map;a.forEach(o=>{i.set(`${o.x},${o.y}`,o)}),r({hexes:i,historyIndex:n})}},redo:()=>{const t=e();if(t.historyIndex<t.history.length-1){const n=t.historyIndex+1,a=t.history[n],i=new Map;a.forEach(o=>{i.set(`${o.x},${o.y}`,o)}),r({hexes:i,historyIndex:n})}},reset:()=>r(Er),initializeMap:(t,n)=>{const a=new Map,i=["grass","forest","mountain","water"];for(let o=0;o<t;o++)for(let l=0;l<n;l++){const c=`${o},${l}`;a.set(c,{x:o,y:l,terrain:i[Math.floor(Math.random()*i.length)]})}r({hexes:a,mapSize:{width:t,height:n}})}})));if(typeof window<"u"){const r=fn.getState();r.hexes.size===0&&r.initializeMap(30,20)}function gs(){const r=R.useRef(null),[e,t]=R.useState({rust:!1,java:!1,vectorDB:!1});R.useEffect(()=>{a();const i=async o=>{const{type:l,data:c}=o.data;switch(l){case"SAVE_MAP":try{const d={type:"unified_map",name:`map_export_${Date.now()}`,data:c,metadata:{totalIcons:Array.isArray(c==null?void 0:c.icons)?c.icons.length:void 0,totalConnections:Array.isArray(c==null?void 0:c.connections)?c.connections.length:void 0,created:c==null?void 0:c.created,version:c==null?void 0:c.version}},p=await fetch("http://localhost:8082/api/interstice/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(p.ok){const v=await p.json().catch(()=>({}));n({type:"SAVE_SUCCESS",message:"Map sauvegardée!",data:v})}else n({type:"SAVE_ERROR",message:`HTTP ${p.status}`})}catch{n({type:"SAVE_ERROR",message:"Erreur sauvegarde"})}break;case"LOAD_MAP":try{const d=await fetch(`http://localhost:8082/api/interstice/${c.mapId}`);if(d.ok){const p=await d.json(),v=(p==null?void 0:p.data)??p;n({type:"MAP_LOADED",data:v})}else n({type:"LOAD_ERROR",message:`HTTP ${d.status}`})}catch{n({type:"LOAD_ERROR",message:"Erreur chargement"})}break;case"CALCULATE_6D":try{const d=await fetch("http://localhost:3001/api/v2/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(d.ok){const p=await d.json();n({type:"6D_RESULT",data:p})}}catch(d){console.error("Erreur calcul 6D:",d)}break;case"SEARCH_LORE":try{const d=await fetch("http://localhost:7500/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:c.query})});if(d.ok){const p=await d.json();n({type:"LORE_RESULTS",data:p})}}catch(d){console.error("Erreur recherche lore:",d)}break;case"ASK_CLIPPY":try{const d=await fetch("http://localhost:7501/api/clippy/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:c.question,context:c.context})});if(d.ok){const p=await d.json();n({type:"CLIPPY_ANSWER",data:p})}}catch(d){console.error("Erreur Clippy:",d)}break}};return window.addEventListener("message",i),()=>window.removeEventListener("message",i)},[]);const n=i=>{var o;(o=r.current)!=null&&o.contentWindow&&r.current.contentWindow.postMessage(i,"*")},a=async()=>{const i=[{url:"http://localhost:3001/health",key:"rust"},{url:"http://localhost:8082/health",key:"java"},{url:"http://localhost:7500/health",key:"vectorDB"}];for(const o of i)try{const l=await fetch(o.url);t(c=>({...c,[o.key]:l.ok}))}catch{t(l=>({...l,[o.key]:!1}))}};return s.jsxs("div",{style:{width:"100%",height:"100vh",position:"relative"},children:[s.jsxs("div",{style:{position:"absolute",top:10,right:10,zIndex:1e3,background:"rgba(0, 0, 0, 0.8)",padding:"10px",borderRadius:"8px",display:"flex",gap:"10px"},children:[s.jsxs("span",{style:{color:e.rust?"#4ade80":"#ef4444"},children:["Rust ",e.rust?"✓":"✗"]}),s.jsxs("span",{style:{color:e.java?"#4ade80":"#ef4444"},children:["Java ",e.java?"✓":"✗"]}),s.jsxs("span",{style:{color:e.vectorDB?"#4ade80":"#ef4444"},children:["Vector ",e.vectorDB?"✓":"✗"]})]}),s.jsx("iframe",{ref:r,src:"/assets/MAP_ICON_PLACER_ADVANCED.html",style:{width:"100%",height:"100%",border:"none"},title:"Map Icon Placer HD",onLoad:()=>{n({type:"INIT",apis:{rust:"http://localhost:3001",java:"http://localhost:8082",vectorDB:"http://localhost:7500",clippy:"http://localhost:7501"}})}})]})}function ys(){const[r,e]=H.useState("import"),[t,n]=H.useState(!1),{hexes:a,selectedHex:i,setSelectedHex:o,importMap:l}=fn(),[c,d]=H.useState({tw:0,te:0,debt:0,debtRate:.05,energy_complex:{A:50,phi:Math.PI/4}});H.useEffect(()=>{if(!t)return;const v=setInterval(()=>{d(f=>({...f,tw:f.tw+1,te:f.te+.95,debt:f.debt+Math.abs(f.tw-f.te)*f.debtRate}))},1e3);return()=>clearInterval(v)},[t]);const p=()=>{const v=document.createElement("input");v.type="file",v.accept=".json",v.onchange=f=>{const m=f.target.files[0];if(m){const b=new FileReader;b.onload=h=>{var u;try{const g=JSON.parse((u=h.target)==null?void 0:u.result);l(g),e("test"),console.log("✅ Scénario importé:",g)}catch(g){console.error("❌ Erreur import:",g)}},b.readAsText(m)}},v.click()};return r==="icon-placer"?s.jsx(gs,{}):r==="import"?s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:30,background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)"},children:[s.jsx("h1",{style:{fontSize:48,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"🔬 Mode Test & Instantiation"}),s.jsx("p",{style:{fontSize:18,color:"#a0aec0",textAlign:"center",maxWidth:600},children:"Testez vos créations du World Editor en conditions réelles avec les mécaniques V2 et les backends actifs"}),s.jsxs("div",{style:{display:"flex",gap:20},children:[s.jsx("button",{onClick:p,style:{padding:"15px 30px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:12,fontSize:18,fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:v=>v.currentTarget.style.transform="scale(1.05)",onMouseLeave:v=>v.currentTarget.style.transform="scale(1)",children:"📂 Importer un Scénario"}),s.jsx("button",{onClick:()=>e("icon-placer"),style:{padding:"15px 30px",background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",border:"none",borderRadius:12,fontSize:18,fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:v=>v.currentTarget.style.transform="scale(1.05)",onMouseLeave:v=>v.currentTarget.style.transform="scale(1)",children:"🗺️ Map Icon Placer V2"}),s.jsx("a",{onClick:()=>e("icon-placer"),target:"_blank",rel:"noopener noreferrer",style:{padding:"15px 30px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"2px solid #667eea",borderRadius:12,fontSize:18,fontWeight:"bold",cursor:"pointer",textDecoration:"none",display:"flex",alignItems:"center",gap:10},children:"🎨 Ouvrir World Editor"})]}),s.jsxs("div",{style:{marginTop:40,padding:20,background:"rgba(102, 126, 234, 0.1)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:12,maxWidth:600},children:[s.jsx("h3",{style:{color:"#667eea",marginBottom:10},children:"💡 Workflow recommandé"}),s.jsxs("ol",{style:{color:"#a0aec0",lineHeight:1.8},children:[s.jsxs("li",{children:["Créez votre map dans le ",s.jsx("strong",{children:"World Editor"})," (cet éditeur)"]}),s.jsx("li",{children:"Exportez en JSON"}),s.jsx("li",{children:"Importez ici pour tester avec V2"}),s.jsx("li",{children:"Vérifiez drift, paradoxes, régulateurs"}),s.jsx("li",{children:"Si OK → Publiez vers le jeu"})]})]}),s.jsx(be,{to:"/",style:{marginTop:20,padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:8,textDecoration:"none"},children:"← Retour au menu"})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#0a0e1a"},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.9) 100%)",borderBottom:"1px solid rgba(102, 126, 234, 0.3)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[s.jsx("button",{onClick:()=>e("import"),style:{padding:"8px 16px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:8,cursor:"pointer"},children:"← Nouveau"}),s.jsx("h2",{style:{fontSize:24,fontWeight:"bold",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",margin:0},children:"🔬 Test de Scénario"})]}),s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsx("button",{onClick:()=>n(!t),style:{padding:"10px 20px",background:t?"linear-gradient(135deg, #fc8181 0%, #f56565 100%)":"linear-gradient(135deg, #48bb78 0%, #38b2ac 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:"bold",fontSize:16},children:t?"⏸️ Pause":"▶️ Start V2"}),s.jsx("button",{style:{padding:"10px 20px",background:"linear-gradient(135deg, #f6ad55 0%, #ed8936 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:"bold"},children:"⚡ Paradoxe"}),s.jsx("button",{style:{padding:"10px 20px",background:"linear-gradient(135deg, #9f7aea 0%, #805ad5 100%)",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:"bold"},children:"🌀 Régulateur"})]}),s.jsx(It,{temporal:c,variant:"compact",showEnergy:!0})]}),s.jsx("div",{style:{padding:"0 20px",background:"rgba(20, 24, 36, 0.5)"},children:s.jsx(Dt,{resources:{crystals:100,energy:50,temporal:25,quantum:10},variant:"compact"})}),s.jsxs("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:[s.jsx(Nt,{width:30,height:20,hexes:a,selectedHex:i,onHexClick:(v,f)=>o({x:v,y:f}),enableDrag:!0,showGrid:!0}),s.jsxs("div",{style:{position:"absolute",top:20,right:20,width:300,padding:20,background:"rgba(0, 0, 0, 0.9)",border:"2px solid #667eea",borderRadius:12},children:[s.jsx("h3",{style:{fontSize:16,color:"#667eea",marginBottom:15},children:"📊 Debug V2"}),s.jsxs("div",{style:{fontSize:14,color:"#e8ecff",lineHeight:1.8},children:[s.jsxs("div",{children:["TW: ",c.tw.toFixed(1)]}),s.jsxs("div",{children:["TE: ",c.te.toFixed(1)]}),s.jsxs("div",{children:["Drift: ",Math.abs(c.tw-c.te).toFixed(2)]}),s.jsxs("div",{children:["Dette: ",c.debt.toFixed(2)]}),s.jsxs("div",{children:["Énergie: ",c.energy_complex.A.toFixed(0)," + ",c.energy_complex.phi.toFixed(2),"i"]})]}),s.jsx("div",{style:{marginTop:15,paddingTop:15,borderTop:"1px solid rgba(102, 126, 234, 0.3)"},children:s.jsxs("div",{style:{fontSize:12,color:"#a0aec0"},children:["Hexes: ",a.size,s.jsx("br",{}),"FPS: 60",s.jsx("br",{}),"Backends: ✅ Rust | ✅ Java | ✅ Vector"]})})]})]}),s.jsxs("footer",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"rgba(20, 24, 36, 0.9)",borderTop:"1px solid rgba(102, 126, 234, 0.3)",fontSize:14,color:"#a0aec0"},children:[s.jsxs("span",{children:["Mode: ",t?"🟢 Running":"⏸️ Paused"]}),s.jsx("span",{children:"Scénario: Test_Map_001"}),s.jsxs("span",{children:["Tick: ",c.tw]})]})]})}const Mr={easy:{driftRate:.1,debtMax:100,enemyDensity:.1,resourceScarcity:.2},normal:{driftRate:.3,debtMax:50,enemyDensity:.2,resourceScarcity:.4},hard:{driftRate:.5,debtMax:30,enemyDensity:.35,resourceScarcity:.6},nightmare:{driftRate:1,debtMax:10,enemyDensity:.5,resourceScarcity:.8}},_t=pt()(zt((r,e)=>({viewport:{x:50,y:50},temporal:{tw:0,te:0,debt:0,debtMax:50,driftRate:.3},resources:{crystals:50,energy:100,temporal:25},difficulty:"normal",difficultySettings:Mr.normal,heroPosition:{x:60,y:60},heroStats:{health:100,maxHealth:100,vision:5},mapSize:{width:120,height:120},hexes:new Map,discoveredHexes:new Set,selectedHex:null,audioEnabled:!0,audioVolume:.5,setViewport:t=>r({viewport:t}),moveViewport:(t,n)=>{const a=e(),i=Math.max(0,Math.min(100,a.viewport.x+t)),o=Math.max(0,Math.min(100,a.viewport.y+n));r({viewport:{x:i,y:o}})},centerOnHero:()=>{const t=e();if(t.heroPosition){const n=Math.max(0,Math.min(100,t.heroPosition.x-10)),a=Math.max(0,Math.min(100,t.heroPosition.y-10));r({viewport:{x:n,y:a}})}},moveHero:(t,n)=>{const a=e(),i=a.heroPosition;if(!i)return;const l=(Math.abs(t-i.x)+Math.abs(n-i.y))*2;if(a.resources.energy<l){console.log("⚡ Pas assez d'énergie!");return}r(d=>({heroPosition:{x:t,y:n},resources:{...d.resources,energy:d.resources.energy-l}}));const c=a.heroStats.vision;for(let d=-c;d<=c;d++)for(let p=-c;p<=c;p++)e().discoverHex(t+d,n+p);e().playSound("move")},setSelectedHex:t=>r({selectedHex:t}),tick:()=>{const t=e(),{driftRate:n}=t.difficultySettings,a=t.temporal.tw+1,i=t.temporal.te+(1-n),o=Math.abs(a-i);let l=t.temporal.debt;o>5&&(l+=o*.1),l>t.temporal.debtMax&&(console.log("💀 GAME OVER - Dette temporelle maximale atteinte!"),e().playSound("gameover")),r(c=>({temporal:{...c.temporal,tw:a,te:i,debt:Math.min(l,c.temporal.debtMax)}}))},initGame:t=>{const n=Mr[t];r({difficulty:t,difficultySettings:n,temporal:{tw:0,te:0,debt:0,debtMax:n.debtMax,driftRate:n.driftRate},resources:{crystals:t==="easy"?100:t==="normal"?50:t==="hard"?25:10,energy:100,temporal:25},heroPosition:{x:60,y:60},viewport:{x:50,y:50}}),e().generateMegaMap();const a=e().heroPosition;if(a){const i=e().heroStats.vision;for(let o=-i;o<=i;o++)for(let l=-i;l<=i;l++)e().discoverHex(a.x+o,a.y+l)}},generateMegaMap:()=>{const t=new Map,{enemyDensity:n,resourceScarcity:a}=e().difficultySettings,i=["grass","forest","mountain","water","mystique","quantum","nexus"];for(let o=0;o<120;o++)for(let l=0;l<120;l++){const c=`${o},${l}`;let d="grass";const p=Math.floor(o/20),v=Math.floor(l/20);p===0&&v===0?d=Math.random()>.3?"grass":"forest":p===5&&v===5?d=Math.random()>.5?"quantum":"nexus":p===2&&v===3?d=Math.random()>.4?"mystique":"mountain":d=i[Math.floor(Math.random()*i.length)];let f=null;Math.random()<n&&!(o===60&&l===60)&&(f={type:"enemy",icon:"👹",strength:Math.floor(Math.random()*10)+1});let m=null;!f&&Math.random()>a&&(m={type:["crystals","energy","temporal"][Math.floor(Math.random()*3)],amount:Math.floor(Math.random()*20)+5});let b=null;if(Math.random()<.02){const h=[{name:"Sanctuaire Temporel",icon:"⛩️",effect:"reset_drift"},{name:"Cristal Ancien",icon:"💎",effect:"bonus_crystals"},{name:"Puits Quantique",icon:"🌀",effect:"teleport"},{name:"Archive OPUS",icon:"📚",effect:"reveal_map"}];b=h[Math.floor(Math.random()*h.length)]}t.set(c,{x:o,y:l,terrain:d,entity:f,resource:m,poi:b,fog:"total"})}for(let o=-3;o<=3;o++)for(let l=-3;l<=3;l++){const c=`${60+o},${60+l}`,d=t.get(c);d&&(d.entity=null,d.terrain="grass")}t.set("110,110",{x:110,y:110,terrain:"nexus",entity:{type:"boss",icon:"🐉",name:"Gardien Temporel",strength:100},fog:"total"}),r({hexes:t}),console.log("🗺️ Mega map 120x120 générée!")},setHex:(t,n,a)=>{const i=`${t},${n}`;r(o=>{const l=new Map(o.hexes);return l.set(i,{x:t,y:n,...a}),{hexes:l}})},getHex:(t,n)=>{const a=`${t},${n}`;return e().hexes.get(a)},discoverHex:(t,n)=>{if(t<0||t>=120||n<0||n>=120)return;const a=`${t},${n}`;r(i=>{const o=new Set(i.discoveredHexes);o.add(a);const l=new Map(i.hexes),c=l.get(a);return c&&(c.fog="clear",l.set(a,c)),{discoveredHexes:o,hexes:l}})},toggleAudio:()=>r(t=>({audioEnabled:!t.audioEnabled})),setVolume:t=>r({audioVolume:t}),playSound:t=>{const n=e();n.audioEnabled&&console.log(`🔊 Playing sound: ${t} at volume ${n.audioVolume}`)}})));function xs(){const[r,e]=H.useState(!1),[t,n]=H.useState("normal");return r?s.jsx(bs,{difficulty:t}):s.jsx(vs,{onStart:a=>{n(a),e(!0)}})}function vs({onStart:r}){const e=[{id:"easy",name:"🌱 Facile",color:"#48bb78",drift:.1,debtMax:100,description:"Drift minimal, dette généreuse"},{id:"normal",name:"⚔️ Normal",color:"#63b3ed",drift:.3,debtMax:50,description:"Équilibré pour découvrir"},{id:"hard",name:"💀 Difficile",color:"#f6ad55",drift:.5,debtMax:30,description:"Drift élevé, ressources limitées"},{id:"nightmare",name:"🔥 Cauchemar",color:"#fc8181",drift:1,debtMax:10,description:"Survie impossible?"}];return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:32,padding:20,background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("h1",{style:{fontSize:48,background:"linear-gradient(135deg, #f6ad55 0%, #fc8181 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:16},children:"🏹 Chasse Temporelle"}),s.jsx("p",{style:{fontSize:18,color:"#a0aec0",marginBottom:8},children:"Map gigantesque 120x120 hexagones"}),s.jsx("p",{style:{fontSize:14,color:"#718096"},children:"6x6 écrans • Brouillard de guerre • Régulateurs"})]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:20,maxWidth:600,width:"100%"},children:e.map(t=>s.jsxs("button",{onClick:()=>r(t.id),style:{padding:20,background:`linear-gradient(135deg, ${t.color}20, ${t.color}10)`,border:`2px solid ${t.color}`,borderRadius:12,color:"white",cursor:"pointer",transition:"all 0.3s",textAlign:"left"},onMouseEnter:n=>{n.currentTarget.style.transform="translateY(-4px)",n.currentTarget.style.boxShadow=`0 10px 30px ${t.color}40`},onMouseLeave:n=>{n.currentTarget.style.transform="translateY(0)",n.currentTarget.style.boxShadow="none"},children:[s.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:t.color,marginBottom:8},children:t.name}),s.jsx("div",{style:{fontSize:12,color:"#e8ecff",marginBottom:12},children:t.description}),s.jsxs("div",{style:{display:"flex",gap:16,fontSize:11,color:"#a0aec0"},children:[s.jsxs("span",{children:["Drift: ",t.drift]}),s.jsxs("span",{children:["Dette max: ",t.debtMax]})]})]},t.id))}),s.jsx(be,{to:"/",style:{marginTop:20,padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:8,textDecoration:"none"},children:"← Retour au menu"})]})}function bs({difficulty:r}){const{viewport:e,setViewport:t,temporal:n,resources:a,heroPosition:i,moveHero:o,hexes:l,selectedHex:c,setSelectedHex:d,tick:p}=_t();H.useEffect(()=>{_t.getState().initGame(r)},[r]),H.useEffect(()=>{const f=setInterval(()=>{p()},1e3);return()=>clearInterval(f)},[p]),H.useEffect(()=>{const f=m=>{const h=_t.getState().viewport;switch(m.key){case"ArrowUp":t({...h,y:Math.max(0,h.y-10)});break;case"ArrowDown":t({...h,y:Math.min(100,h.y+10)});break;case"ArrowLeft":t({...h,x:Math.max(0,h.x-10)});break;case"ArrowRight":t({...h,x:Math.min(100,h.x+10)});break}};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[t]);const v=H.useMemo(()=>{const f=new Map,{x:m,y:b}=e;for(let h=m;h<m+20&&h<120;h++)for(let u=b;u<b+20&&u<120;u++){const g=`${h},${u}`,_=l.get(g);_&&f.set(`${h-m},${u-b}`,{..._,displayX:h-m,displayY:u-b,realX:h,realY:u})}return f},[e,l]);return s.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#0a0e1a"},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.9) 100%)",borderBottom:"1px solid rgba(246, 173, 85, 0.3)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[s.jsx("h2",{style:{fontSize:24,fontWeight:"bold",background:"linear-gradient(135deg, #f6ad55 0%, #fc8181 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",margin:0},children:"🏹 Chasse Temporelle"}),s.jsx("span",{style:{padding:"4px 12px",background:Gt(r)+"20",border:`1px solid ${Gt(r)}`,borderRadius:6,fontSize:12,color:Gt(r)},children:r.toUpperCase()})]}),s.jsx(It,{temporal:n,variant:"compact",showEnergy:!0})]}),s.jsx("div",{style:{padding:"0 20px",background:"rgba(20, 24, 36, 0.5)"},children:s.jsx(Dt,{resources:a,variant:"compact"})}),s.jsxs("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:[s.jsx(Nt,{width:20,height:20,hexes:v,selectedHex:c?{x:c.x-e.x,y:c.y-e.y}:null,onHexClick:(f,m)=>{const b=f+e.x,h=m+e.y;d({x:b,y:h}),i&&Math.abs(b-i.x)+Math.abs(h-i.y)<=3&&o(b,h)},showGrid:!0,enableDrag:!1}),s.jsx(_s,{}),s.jsxs("div",{style:{position:"absolute",top:10,left:10,padding:"8px 12px",background:"rgba(0, 0, 0, 0.8)",borderRadius:6,fontSize:12,color:"#a0aec0"},children:[s.jsxs("div",{children:["Viewport: [",e.x,",",e.y,"] → [",e.x+20,",",e.y+20,"]"]}),i&&s.jsxs("div",{children:["Héros: [",i.x,",",i.y,"]"]}),s.jsx("div",{style:{marginTop:4,fontSize:10,color:"#718096"},children:"Utilisez les flèches pour naviguer"})]})]}),s.jsxs("footer",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"rgba(20, 24, 36, 0.9)",borderTop:"1px solid rgba(246, 173, 85, 0.3)"},children:[s.jsx("div",{style:{display:"flex",gap:8},children:s.jsx(be,{to:"/",style:{padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:8,textDecoration:"none"},children:"🏠 Menu"})}),s.jsx("div",{style:{fontSize:14,color:"#a0aec0"},children:"Map totale: 120×120 | Zone visible: 20×20"})]})]})}function _s(){const{viewport:r,heroPosition:e,hexes:t}=_t(),n=2;return s.jsxs("div",{style:{position:"absolute",bottom:20,right:20,width:240,height:240,background:"rgba(0, 0, 0, 0.9)",border:"2px solid rgba(246, 173, 85, 0.5)",borderRadius:8,padding:4},children:[s.jsx("div",{style:{fontSize:10,color:"#f6ad55",marginBottom:4,textAlign:"center"},children:"CARTE COMPLÈTE"}),s.jsxs("div",{style:{position:"relative",width:232,height:210,background:"rgba(255, 255, 255, 0.05)"},children:[s.jsx("div",{style:{position:"absolute",left:r.x*n,top:r.y*n,width:20*n,height:20*n,border:"2px solid #ffd700",background:"rgba(255, 215, 0, 0.1)"}}),e&&s.jsx("div",{style:{position:"absolute",left:e.x*n-2,top:e.y*n-2,width:4,height:4,background:"#48bb78",borderRadius:"50%"}}),Array.from(t.entries()).filter(([a,i])=>i.entity||i.poi).map(([a,i])=>s.jsx("div",{style:{position:"absolute",left:i.x*n-1,top:i.y*n-1,width:2,height:2,background:i.entity?"#fc8181":"#667eea",borderRadius:"50%"}},a))]})]})}function Gt(r){return{easy:"#48bb78",normal:"#63b3ed",hard:"#f6ad55",nightmare:"#fc8181"}[r]||"#667eea"}function ws(){return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:32,padding:20},children:[s.jsx("h1",{style:{fontSize:48,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:16},children:"🎮 Magic Stack Unified"}),s.jsx("p",{style:{fontSize:18,color:"#a0aec0",textAlign:"center",maxWidth:600},children:"Un seul code, tous les modes. Jeu, Éditeur, Chasse Temporelle. Architecture unifiée avec composants partagés."}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:20,width:"100%",maxWidth:1200},children:[s.jsx(_e,{to:"/game",icon:"🎮",title:"Heroes of Time",description:"Le jeu principal avec combat, exploration et paradoxes temporels",color:"#667eea"}),s.jsx(_e,{to:"/editor",icon:"🗺️",title:"World Editor",description:"Créez vos propres cartes et scénarios",color:"#48bb78"}),s.jsx(_e,{to:"/chasse",icon:"🏹",title:"Chasse Temporelle",description:"Mode aventure 120x120 avec 4 difficultés",color:"#f6ad55"}),s.jsx(_e,{to:"/multiplayer",icon:"🎭",title:"Multijoueur HOMM3",description:"Combat TCG, exploration et conquête du Nexus",color:"#e53e3e"}),s.jsx(_e,{to:"/ai-battle",icon:"🤖",title:"IA vs IA Autoplay",description:"Batailles automatiques avec formules quantiques",color:"#9f7aea"}),s.jsx(_e,{to:"/spectator",icon:"👁️",title:"God Mode Spectateur",description:"Observez tout le multivers en temps réel",color:"#38b2ac"}),s.jsx(_e,{to:"/backstory-editor",icon:"📝",title:"Éditeur de Backstory",description:"Personnalisez les histoires et personnalités des héros IA",color:"#f6e05e"}),s.jsx(_e,{to:"/unified",icon:"🎮",title:"✨ Unified Map System",description:"L'ÉDITEUR EST LE JEU ! Structure, Resources, Timeline - tout unifié",color:"#FF1493",featured:!0})]}),s.jsxs("div",{style:{display:"flex",gap:16,marginTop:32},children:[s.jsx(Jt,{label:"Rust",port:3001}),s.jsx(Jt,{label:"Java",port:8080}),s.jsx(Jt,{label:"Vector",port:5001})]})]})}function _e({to:r,icon:e,title:t,description:n,color:a,featured:i}){return s.jsxs(be,{to:r,style:{display:"flex",flexDirection:"column",padding:24,background:i?`linear-gradient(135deg, ${a}20, ${a}10)`:"rgba(255, 255, 255, 0.05)",border:i?`2px solid ${a}`:`1px solid ${a}40`,borderRadius:12,textDecoration:"none",color:"inherit",transition:"all 0.3s",cursor:"pointer",boxShadow:i?`0 0 20px ${a}40`:"none",animation:i?"pulse 2s infinite":"none"},onMouseEnter:o=>{o.currentTarget.style.background="rgba(255, 255, 255, 0.1)",o.currentTarget.style.transform="translateY(-4px)",o.currentTarget.style.boxShadow=`0 10px 30px ${a}40`},onMouseLeave:o=>{o.currentTarget.style.background="rgba(255, 255, 255, 0.05)",o.currentTarget.style.transform="translateY(0)",o.currentTarget.style.boxShadow="none"},children:[s.jsx("div",{style:{fontSize:48,marginBottom:16},children:e}),s.jsx("h3",{style:{fontSize:20,color:a,marginBottom:8},children:t}),s.jsx("p",{style:{fontSize:14,color:"#a0aec0"},children:n})]})}function Jt({label:r,port:e}){const[t,n]=H.useState(!1);return H.useEffect(()=>{fetch(`http://localhost:${e}/health`).then(()=>n(!0)).catch(()=>n(!1))},[e]),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:"rgba(255, 255, 255, 0.05)",borderRadius:8,fontSize:12},children:[s.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:t?"#48bb78":"#fc8181"}}),s.jsx("span",{children:r}),s.jsxs("span",{style:{color:"#718096"},children:[":",e]})]})}const js=[{id:"agro",name:"Deck Aggro"},{id:"control",name:"Deck Contrôle"},{id:"random",name:"Deck Aléatoire"}];function ks(){const[r,e]=R.useState("AI_VS_AI"),[t,n]=R.useState("random"),[a,i]=R.useState(null),[o,l]=R.useState(""),c=async()=>{try{const p=await(await fetch("http://localhost:8082/api/combat/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({player1:"P1",player2:"AI",seed:Date.now().toString()})})).json();i(p.gameId),l("Partie créée")}catch{l("Erreur démarrage")}};return s.jsxs("div",{style:{padding:40},children:[s.jsx("h1",{children:"⚔️ Start TCG"}),s.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20},children:[s.jsxs("select",{value:r,onChange:d=>e(d.target.value),children:[s.jsx("option",{value:"AI_VS_AI",children:"AI vs AI"}),s.jsx("option",{value:"PVA",children:"Joueur vs AI"}),s.jsx("option",{value:"PVP",children:"PvP (WIP)"})]}),s.jsx("select",{value:t,onChange:d=>n(d.target.value),children:js.map(d=>s.jsx("option",{value:d.id,children:d.name},d.id))}),s.jsx("button",{onClick:c,children:"▶️ Démarrer"})]}),o&&s.jsx("div",{children:o}),a&&s.jsxs("div",{children:[s.jsxs("div",{children:["Game ID: ",a]}),s.jsx("div",{style:{marginTop:10},children:s.jsx("a",{href:"/combat",style:{color:"#7dd3fc"},children:"Ouvrir l’écran Combat"})})]})]})}function Ss(){return s.jsxs("div",{style:{padding:40,textAlign:"center",minHeight:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)",color:"#e8ecff"},children:[s.jsx("h1",{style:{fontSize:"3em",marginBottom:20},children:"👥 Mode Multijoueur"}),s.jsxs("div",{style:{maxWidth:600,margin:"0 auto",padding:30,background:"rgba(255, 255, 255, 0.05)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)"},children:[s.jsx("p",{style:{fontSize:"1.2em",marginBottom:30},children:"🚧 En cours de migration depuis MULTIPLAYER_DEMO_HOMM3.html"}),s.jsxs("div",{style:{marginBottom:30},children:[s.jsx("h3",{children:"Fonctionnalités prévues:"}),s.jsxs("ul",{style:{textAlign:"left",marginTop:15},children:[s.jsx("li",{children:"Synchronisation temps réel via WebSocket"}),s.jsx("li",{children:"Lobbies de parties"}),s.jsx("li",{children:"Chat intégré"}),s.jsx("li",{children:"Support jusqu'à 8 joueurs"}),s.jsx("li",{children:"Mode spectateur"})]})]}),s.jsx("div",{style:{marginTop:30},children:s.jsx(be,{to:"/",style:{padding:"10px 30px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textDecoration:"none",borderRadius:25,display:"inline-block"},children:"← Retour à l'accueil"})})]})]})}function Cs(){const[r,e]=H.useState(!1),[t,n]=H.useState([]),a=()=>{e(!0),n(["⚔️ Début du combat...","🐉 Dragon Rouge entre en jeu","🧙 Archimage lance Boule de feu","💥 Dragon subit 45 dégâts","🐉 Dragon attaque avec Souffle ardent","🧙 Archimage esquive!","... (combat en cours)"])};return s.jsx("div",{style:{padding:40,minHeight:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)",color:"#e8ecff"},children:s.jsxs("div",{style:{maxWidth:1200,margin:"0 auto"},children:[s.jsx("h1",{style:{fontSize:"3em",textAlign:"center",marginBottom:30},children:"🤖 IA vs IA - Combat Automatique"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:30},children:[s.jsxs("div",{style:{padding:20,background:"rgba(255, 255, 255, 0.05)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)"},children:[s.jsx("h2",{children:"⚙️ Contrôles"}),s.jsx("button",{onClick:a,disabled:r,style:{width:"100%",padding:15,marginTop:20,background:r?"rgba(100, 100, 100, 0.3)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:10,fontSize:"1.1em",cursor:r?"not-allowed":"pointer"},children:r?"⚔️ Combat en cours...":"▶️ Lancer le combat"}),s.jsx("button",{onClick:()=>{e(!1),n([])},style:{width:"100%",padding:15,marginTop:10,background:"rgba(255, 50, 50, 0.3)",color:"white",border:"1px solid rgba(255, 50, 50, 0.5)",borderRadius:10,fontSize:"1.1em",cursor:"pointer"},children:"⏹️ Arrêter"}),s.jsxs("div",{style:{marginTop:30},children:[s.jsx("h3",{children:"📊 Configuration"}),s.jsxs("label",{style:{display:"block",marginTop:15},children:["Vitesse:",s.jsx("input",{type:"range",min:"1",max:"10",defaultValue:"5",style:{width:"100%",marginTop:5}})]}),s.jsxs("label",{style:{display:"block",marginTop:15},children:[s.jsx("input",{type:"checkbox",defaultChecked:!0}),s.jsx("span",{style:{marginLeft:5},children:"Animation détaillée"})]}),s.jsxs("label",{style:{display:"block",marginTop:10},children:[s.jsx("input",{type:"checkbox"}),s.jsx("span",{style:{marginLeft:5},children:"Mode tournoi"})]})]})]}),s.jsxs("div",{style:{padding:20,background:"rgba(255, 255, 255, 0.05)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)"},children:[s.jsx("h2",{children:"⚔️ Arène de Combat"}),s.jsx("div",{style:{marginTop:20,padding:15,background:"rgba(0, 0, 0, 0.3)",borderRadius:10,height:400,overflowY:"auto",fontFamily:"monospace"},children:t.length>0?t.map((i,o)=>s.jsx("div",{style:{marginBottom:5},children:i},o)):s.jsx("div",{style:{color:"rgba(255, 255, 255, 0.5)"},children:"En attente du lancement du combat..."})}),s.jsxs("div",{style:{marginTop:20,display:"grid",gridTemplateColumns:"1fr 1fr",gap:15},children:[s.jsxs("div",{style:{padding:10,background:"rgba(102, 126, 234, 0.2)",borderRadius:8,textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"2em"},children:"🐉"}),s.jsx("div",{children:"Dragon Rouge"}),s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"PV: 450/500"})]}),s.jsxs("div",{style:{padding:10,background:"rgba(118, 75, 162, 0.2)",borderRadius:8,textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"2em"},children:"🧙"}),s.jsx("div",{children:"Archimage"}),s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"PV: 280/300"})]})]})]})]}),s.jsx("div",{style:{textAlign:"center",marginTop:40},children:s.jsx(be,{to:"/",style:{padding:"10px 30px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textDecoration:"none",borderRadius:25,display:"inline-block"},children:"← Retour à l'accueil"})})]})})}function Ts(){const[r,e]=H.useState("spatial"),[t,n]=H.useState(50);return s.jsx("div",{style:{padding:20,minHeight:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)",color:"#e8ecff"},children:s.jsxs("div",{style:{maxWidth:1400,margin:"0 auto"},children:[s.jsx("h1",{style:{fontSize:"3em",textAlign:"center",marginBottom:30,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"👁️ Mode God - Vision Omnisciente"}),s.jsxs("div",{style:{padding:15,background:"rgba(255, 255, 255, 0.05)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)",marginBottom:20,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("div",{style:{display:"flex",gap:10},children:["spatial","temporal","causal","quantum"].map(a=>s.jsxs("button",{onClick:()=>e(a),style:{padding:"8px 20px",background:r===a?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(102, 126, 234, 0.5)",borderRadius:20,color:"white",cursor:"pointer",textTransform:"capitalize"},children:[a==="spatial"&&"🗺️",a==="temporal"&&"⏳",a==="causal"&&"🔀",a==="quantum"&&"🌌"," "+a]},a))}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:15},children:[s.jsx("span",{children:"Timeline:"}),s.jsx("input",{type:"range",min:"0",max:"100",value:t,onChange:a=>n(Number(a.target.value)),style:{width:200}}),s.jsxs("span",{children:["Jour ",Math.floor(t*3.65)]})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 300px",gap:20,height:600},children:[s.jsxs("div",{style:{background:"radial-gradient(circle at center, rgba(102, 126, 234, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:[s.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`
                repeating-linear-gradient(
                  30deg,
                  transparent,
                  transparent 35px,
                  rgba(102, 126, 234, 0.1) 35px,
                  rgba(102, 126, 234, 0.1) 70px
                ),
                repeating-linear-gradient(
                  -30deg,
                  transparent,
                  transparent 35px,
                  rgba(118, 75, 162, 0.1) 35px,
                  rgba(118, 75, 162, 0.1) 70px
                )
              `,opacity:.5}}),s.jsxs("div",{style:{textAlign:"center",zIndex:1,padding:40,background:"rgba(0, 0, 0, 0.7)",borderRadius:15},children:[s.jsxs("div",{style:{fontSize:"4em",marginBottom:20},children:[r==="spatial"&&"🗺️",r==="temporal"&&"⏳",r==="causal"&&"🔀",r==="quantum"&&"🌌"]}),s.jsxs("h2",{children:["Vue ",r]}),s.jsxs("p",{style:{marginTop:15,color:"rgba(255, 255, 255, 0.7)"},children:[r==="spatial"&&"Visualisation spatiale de tous les éléments",r==="temporal"&&"Timeline des événements passés et futurs",r==="causal"&&"Chaînes de causalité et conséquences",r==="quantum"&&"États quantiques superposés"]})]})]}),s.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:15,border:"2px solid rgba(102, 126, 234, 0.3)",padding:20,overflowY:"auto"},children:[s.jsx("h3",{children:"📊 Statistiques Globales"}),s.jsxs("div",{style:{marginTop:20},children:[s.jsxs("div",{style:{marginBottom:15},children:[s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"Entités actives"}),s.jsx("div",{style:{fontSize:"1.5em",fontWeight:"bold"},children:"1,247"})]}),s.jsxs("div",{style:{marginBottom:15},children:[s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"Événements temporels"}),s.jsx("div",{style:{fontSize:"1.5em",fontWeight:"bold"},children:"89"})]}),s.jsxs("div",{style:{marginBottom:15},children:[s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"Branches causales"}),s.jsx("div",{style:{fontSize:"1.5em",fontWeight:"bold"},children:"12"})]}),s.jsxs("div",{style:{marginBottom:15},children:[s.jsx("div",{style:{fontSize:"0.9em",color:"rgba(255, 255, 255, 0.7)"},children:"États quantiques"}),s.jsx("div",{style:{fontSize:"1.5em",fontWeight:"bold"},children:"∞"})]})]}),s.jsx("hr",{style:{margin:"20px 0",border:"none",borderTop:"1px solid rgba(255, 255, 255, 0.1)"}}),s.jsx("h4",{children:"🎮 Contrôles Rapides"}),s.jsxs("div",{style:{marginTop:15},children:[s.jsx("button",{style:{width:"100%",padding:10,marginBottom:10,background:"rgba(102, 126, 234, 0.2)",border:"1px solid rgba(102, 126, 234, 0.5)",borderRadius:8,color:"white",cursor:"pointer"},children:"⏸️ Pause Temporelle"}),s.jsx("button",{style:{width:"100%",padding:10,marginBottom:10,background:"rgba(118, 75, 162, 0.2)",border:"1px solid rgba(118, 75, 162, 0.5)",borderRadius:8,color:"white",cursor:"pointer"},children:"🔄 Reset Causalité"}),s.jsx("button",{style:{width:"100%",padding:10,background:"rgba(255, 50, 50, 0.2)",border:"1px solid rgba(255, 50, 50, 0.5)",borderRadius:8,color:"white",cursor:"pointer"},children:"💥 Collapse Quantique"})]})]})]}),s.jsx("div",{style:{textAlign:"center",marginTop:40},children:s.jsx(be,{to:"/",style:{padding:"10px 30px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textDecoration:"none",borderRadius:25,display:"inline-block"},children:"← Retour à l'accueil"})})]})})}const pe={arthur_pendragon:{id:"arthur_pendragon",name:"Arthur Pendragon",title:"Le Roi Temporel",class:"Roi-Chevalier",tier:"LEGENDARY",icon_id:"👑",fx_preset:"artifact_shine",sound_event:"excalibur_draw",theme_color:"#FFD700",output_modes:{literary:"Le noble roi aux cheveux d'or, porteur d'Excalibur",runic:"ᚨᚱᚦᚢᚱ᛫ᚱᛖᚷᚾᚨᚾᛏ",iconic:"👑⚔️⏳"},stats:{attack:20,defense:18,health:180,mana:150,temporal_energy:100,quantum_affinity:.9},abilities:[{id:"excalibur",name:"Excalibur Quantique",cost:3,description:"Double les dégâts pour ce tour"},{id:"table_ronde",name:"Table Ronde",cost:6,description:"Invoque 3 chevaliers aléatoires"}],flavor:"Le temps plie devant ma volonté"},merlin:{id:"merlin",name:"Merlin",title:"L'Archimage Temporel",class:"Mage",tier:"LEGENDARY",icon_id:"🧙‍♂️",fx_preset:"quantum_phase",sound_event:"magic_cast",theme_color:"#9932CC",output_modes:{literary:"Le vénérable archimage qui vit à rebours dans le temps",runic:"ᛗᛖᚱᛚᛁᚾ᛫ᛏᛖᛗᛈᛟᚱᛖᛚ",iconic:"🧙‍♂️⏳✨"},stats:{attack:15,defense:12,health:120,mana:250,temporal_energy:200,quantum_affinity:.95},abilities:[{id:"time_reverse",name:"Inversion Temporelle",cost:4,description:"Annule le dernier tour de l'adversaire"},{id:"prophecy",name:"Prophétie",cost:2,description:"Révèle les 3 prochaines cartes"}],description:"Vit à rebours dans le temps, connaît le futur"},morgana:{id:"morgana",name:"Morgana",title:"Tisseuse de Réalités",class:"Sorcière",tier:"LEGENDARY",icon_id:"🌙",fx_preset:"temporal_glitch",sound_event:"artifact_activate",theme_color:"#8B008B",output_modes:{literary:"La mystérieuse conseillère des ombres",runic:"ᛗᛟᚱᚷᚨᚾᚨ",iconic:"🌙🕸️✨"},stats:{attack:18,defense:14,health:140,mana:200,temporal_energy:150,quantum_affinity:.85},abilities:[{id:"illusion",name:"Illusion Quantique",cost:3,description:"Crée 2 copies d'une unité"},{id:"shadow_realm",name:"Royaume des Ombres",cost:5,description:"Cache toutes vos unités pour 1 tour"}]},lysandrel:{id:"lysandrel",name:"Lysandrel",title:"Le Forgeron de Réalité",class:"Reality Forger",tier:"LEGENDARY",icon_id:"🔮",fx_preset:"reality_distortion",sound_event:"reality_forge",theme_color:"#FF6B6B",output_modes:{literary:"Forge une seule réalité dominante parmi les possibles",runic:"ᛚᚤᛊᚨᚾᛞᚱᛖᛚ",iconic:"🔮🔨🌌"},stats:{attack:25,defense:20,health:180,mana:300,temporal_energy:300,quantum_affinity:.9},abilities:[{id:"reality_forge",name:"Forge de Réalité",cost:6,description:"Remplace le terrain par votre choix"},{id:"collapse",name:"Effondrement",cost:4,description:"Détruit toutes les illusions et copies"}],description:"Une seule réalité doit survivre"},ragnar_lothbrok:{id:"ragnar_lothbrok",name:"Ragnar Lothbrok",title:"Le Chef de Guerre Temporel",class:"Guerrier",tier:"LEGENDARY",icon_id:"⚔️",fx_preset:"blood_rage",sound_event:"battle_cry",theme_color:"#8B0000",output_modes:{literary:"Le guerrier viking qui traverse les époques",runic:"ᚱᚨᚷᚾᚨᚱ᛫ᛚᛟᚦᛒᚱᛟᚲ",iconic:"⚔️🛡️🔥"},stats:{attack:28,defense:22,health:200,mana:80,temporal_energy:50,quantum_affinity:.6},abilities:[{id:"berserker",name:"Rage du Berserker",cost:3,description:"+10 attaque, -5 défense pour 2 tours"},{id:"valhalla",name:"Appel du Valhalla",cost:5,description:"Ressuscite une unité tombée"}]},claudius_memento:{id:"claudius_memento",name:"Claudius Memento",title:"L'Architecte du Multivers",class:"Architecte",tier:"LEGENDARY",icon_id:"💻",fx_preset:"digital_matrix",sound_event:"code_compile",theme_color:"#00CED1",output_modes:{literary:"L'architecte qui code la réalité elle-même",runic:"ᚲᛚᚨᚢᛞᛁᚢᛊ",iconic:"💻🏗️🌐"},stats:{attack:16,defense:16,health:160,mana:180,temporal_energy:250,quantum_affinity:1},abilities:[{id:"debug",name:"Mode Debug",cost:2,description:"Révèle toutes les cartes cachées"},{id:"refactor",name:"Refactoring",cost:4,description:"Réorganise le plateau de jeu"}]},lancelot:{id:"lancelot",name:"Lancelot",title:"Le Chevalier Parfait",class:"Chevalier",tier:"EPIC",icon_id:"🛡️",fx_preset:"holy_light",sound_event:"sword_draw",theme_color:"#4169E1",output_modes:{literary:"Le plus noble des chevaliers de la Table Ronde",runic:"ᛚᚨᚾᛊᛖᛚᛟᛏ",iconic:"🛡️⚔️✨"},stats:{attack:22,defense:24,health:160,mana:100,temporal_energy:60},abilities:[{id:"perfect_defense",name:"Défense Parfaite",cost:2,description:"Bloque toute attaque ce tour"}]},alice_prime:{id:"alice_prime",name:"Alice Prime",title:"L'Exploratrice Quantique",class:"Exploratrice",tier:"EPIC",icon_id:"🦸",fx_preset:"quantum_jump",sound_event:"portal_open",theme_color:"#FF69B4",output_modes:{literary:"Traverse les mondes parallèles avec aisance",runic:"ᚨᛚᛁᛊᛖ",iconic:"🦸🌀🎭"},stats:{attack:18,defense:16,health:140,mana:150,temporal_energy:180,quantum_affinity:.88},abilities:[{id:"quantum_leap",name:"Saut Quantique",cost:3,description:"Téléporte n'importe où sur la carte"},{id:"temporal_echo",name:"Écho Temporel",cost:4,description:"Répète votre dernière action"}]},vincent_vega:{id:"vincent_vega",name:"Vincent Vega",title:"Le Philosophe Armé",class:"Gunslinger",tier:"EPIC",icon_id:"🔫",fx_preset:"bullet_time",sound_event:"gun_shot",theme_color:"#2F4F4F",output_modes:{literary:"Maître du timing et de la philosophie appliquée",runic:"ᚹᛁᚾᛊᛖᚾᛏ",iconic:"🔫🎯⏱️"},stats:{attack:30,defense:15,health:120,mana:90,temporal_energy:70},abilities:[{id:"gun_perdu",name:"Gun Perdu",cost:3,description:"Tir garanti critique"}]},nyx_lua:{id:"nyx_lua",name:"Nyx-Lua",title:"Tisseuse de Mondes Latents",class:"World Weaver",tier:"EPIC",icon_id:"🌌",fx_preset:"dimensional_weave",sound_event:"reality_shift",theme_color:"#191970",output_modes:{literary:"Tisse des mondes parallèles dans l'ombre",runic:"ᚾᚤᛪ᛫ᛚᚢᚨ",iconic:"🌌🕸️🌙"},stats:{attack:20,defense:15,health:140,mana:400,temporal_energy:400,quantum_affinity:.95},abilities:[{id:"world_weaving",name:"Tissage de Mondes",cost:5,description:"Crée une zone avec règles alternatives"}],description:"Tous les mondes possibles ont le droit d'exister"},jean_grofignon:{id:"jean_grofignon",name:"Jean-Grofignon",title:"L'Ontologique",class:"Philosophe",tier:"EPIC",icon_id:"🤔",fx_preset:"existential_crisis",sound_event:"hmm",theme_color:"#8B4513",output_modes:{literary:"Questionne l'existence même de la bataille",runic:"ᚷᚱᛟᚠᛁᚷᚾᛟᚾ",iconic:"🤔💭❓"},stats:{attack:14,defense:14,health:140,mana:140,temporal_energy:140},abilities:[{id:"ontological_doubt",name:"Doute Ontologique",cost:2,description:"L'ennemi passe son tour à réfléchir"}]},the_dude:{id:"the_dude",name:"The Dude",title:"Le Philosophe Décontracté",class:"Philosophe",tier:"EPIC",icon_id:"😎",fx_preset:"chill_vibes",sound_event:"yeah_man",theme_color:"#D2691E",output_modes:{literary:"Aborde chaque combat avec une zen attitude",runic:"ᛞᚢᛞᛖ",iconic:"😎🎳🍺"},stats:{attack:16,defense:20,health:150,mana:100,temporal_energy:80},abilities:[{id:"abide",name:"The Dude Abides",cost:1,description:"Immunité aux effets négatifs pour 1 tour"}]},christian_mckinsey:{id:"christian_mckinsey",name:"Christian McKinsey",title:"Le Consultant Quantique",class:"Consultant",tier:"EPIC",icon_id:"💼",fx_preset:"excel_quantum",sound_event:"powerpoint",theme_color:"#708090",output_modes:{literary:"Optimise les flux temporels avec des tableaux Excel",runic:"ᛗᚲᚲᛁᚾᛊᛖᚤ",iconic:"💼📊📈"},stats:{attack:22,defense:22,health:150,mana:130,temporal_energy:100},abilities:[{id:"excel_quantum",name:"Excel Quantique",cost:3,description:"Optimise toutes les stats de +20%"}]},marie_basilisk:{id:"marie_basilisk",name:"Marie/Basilisk",title:"La Pétrificatrice",class:"Assassin",tier:"EPIC",icon_id:"🐍",fx_preset:"petrification",sound_event:"hiss",theme_color:"#228B22",output_modes:{literary:"Son regard transforme les ennemis en pierre",runic:"ᛒᚨᛊᛁᛚᛁᛊᚲ",iconic:"🐍👁️🗿"},stats:{attack:35,defense:10,health:110,mana:120,temporal_energy:90},abilities:[{id:"petrify",name:"Pétrification",cost:4,description:"Paralyse un ennemi pour 2 tours"}]},axis:{id:"axis",name:"Axis",title:"Le Voyageur Linéaire",class:"Voyageur",tier:"EPIC",icon_id:"🧭",fx_preset:"linear_path",sound_event:"whoosh",theme_color:"#4682B4",output_modes:{literary:"Voyage uniquement sur les axes cardinaux du temps",runic:"ᚨᛪᛁᛊ",iconic:"🧭➡️⬆️"},stats:{attack:20,defense:20,health:145,mana:145,temporal_energy:145},abilities:[{id:"linear_travel",name:"Voyage Linéaire",cost:2,description:"Déplacement instantané en ligne droite"}]},gauvain:{id:"gauvain",name:"Gauvain",title:"Le Chevalier Solaire",class:"Chevalier",tier:"RARE",icon_id:"☀️",fx_preset:"solar_flare",sound_event:"light_burst",theme_color:"#FFD700",output_modes:{literary:"Sa force croît avec le soleil",runic:"ᚷᚨᚢᚹᚨᛁᚾ",iconic:"☀️⚔️🛡️"},stats:{attack:18,defense:16,health:130,mana:80,temporal_energy:40},abilities:[{id:"solar_power",name:"Pouvoir Solaire",cost:2,description:"+5 attaque en journée"}]},perceval:{id:"perceval",name:"Perceval",title:"Le Chevalier du Graal",class:"Chevalier",tier:"RARE",icon_id:"🏆",fx_preset:"holy_grail",sound_event:"choir",theme_color:"#FFD700",output_modes:{literary:"Chercheur éternel du Saint Graal",runic:"ᛈᛖᚱᛊᛖᚹᚨᛚ",iconic:"🏆⚔️✨"},stats:{attack:16,defense:18,health:135,mana:90,temporal_energy:50},abilities:[{id:"grail_quest",name:"Quête du Graal",cost:3,description:"Pioche 2 cartes artefact"}]},kay:{id:"kay",name:"Kay",title:"Le Sénéchal",class:"Soutien",tier:"RARE",icon_id:"🗝️",fx_preset:"support_aura",sound_event:"buff",theme_color:"#B8860B",output_modes:{literary:"Frère adoptif et fidèle soutien d'Arthur",runic:"ᚲᚨᚤ",iconic:"🗝️🛡️👥"},stats:{attack:14,defense:20,health:140,mana:100,temporal_energy:60},abilities:[{id:"rally",name:"Ralliement",cost:2,description:"+2/+2 à toutes les unités alliées"}]},bedivere:{id:"bedivere",name:"Bedivere",title:"Le Fidèle",class:"Chevalier",tier:"RARE",icon_id:"🤝",fx_preset:"loyalty",sound_event:"oath",theme_color:"#4B0082",output_modes:{literary:"Le dernier chevalier fidèle jusqu'à la fin",runic:"ᛒᛖᛞᛁᚹᛖᚱᛖ",iconic:"🤝⚔️💜"},stats:{attack:17,defense:17,health:125,mana:85,temporal_energy:45},abilities:[{id:"last_stand",name:"Dernier Rempart",cost:3,description:"Gagne +10/+10 si seul en jeu"}]},mordred:{id:"mordred",name:"Mordred",title:"Le Traître",class:"Chevalier Noir",tier:"RARE",icon_id:"💀",fx_preset:"dark_energy",sound_event:"dark_laugh",theme_color:"#8B0000",output_modes:{literary:"Le fils renégat qui causa la chute de Camelot",runic:"ᛗᛟᚱᛞᚱᛖᛞ",iconic:"💀⚔️🔥"},stats:{attack:24,defense:12,health:120,mana:70,temporal_energy:30},abilities:[{id:"betrayal",name:"Trahison",cost:4,description:"Vole le contrôle d'une unité ennemie"}]},viviane:{id:"viviane",name:"Viviane",title:"La Dame du Lac",class:"Enchanteresse",tier:"RARE",icon_id:"💧",fx_preset:"water_magic",sound_event:"water_splash",theme_color:"#00CED1",output_modes:{literary:"Gardienne d'Excalibur dans les eaux mystiques",runic:"ᚹᛁᚹᛁᚨᚾᛖ",iconic:"💧🗡️🌊"},stats:{attack:15,defense:15,health:130,mana:160,temporal_energy:80,quantum_affinity:.7},abilities:[{id:"water_blessing",name:"Bénédiction Aquatique",cost:3,description:"Soigne 30 PV à toutes les unités"}]},chlamydius:{id:"chlamydius",name:"Chlamydius",title:"Le Mystérieux",class:"Inconnu",tier:"COMMON",icon_id:"❓",fx_preset:"mystery",sound_event:"question",theme_color:"#696969",output_modes:{literary:"Un héros dont l'origine reste inconnue",runic:"ᚲᛚᚨᛗᚤᛞᛁᚢᛊ",iconic:"❓🎭💫"},stats:{attack:12,defense:12,health:100,mana:100,temporal_energy:50},abilities:[{id:"random",name:"Effet Aléatoire",cost:2,description:"Effet complètement aléatoire"}]},nexus_guardian:{id:"nexus_guardian",name:"Gardien du Nexus",title:"Le Protecteur",class:"Gardien",tier:"COMMON",icon_id:"🛡️",fx_preset:"shield_wall",sound_event:"shield_up",theme_color:"#4682B4",output_modes:{literary:"Protège les portails entre les mondes",runic:"ᚾᛖᛪᚢᛊ",iconic:"🛡️🌀🚪"},stats:{attack:10,defense:25,health:150,mana:60,temporal_energy:40},abilities:[{id:"guardian_stance",name:"Position de Garde",cost:1,description:"Taunt et +5 défense"}]},grofi_scout:{id:"grofi_scout",name:"Éclaireur Grofi",title:"L'Éclaireur",class:"Scout",tier:"COMMON",icon_id:"🏃",fx_preset:"speed_boost",sound_event:"footsteps",theme_color:"#228B22",output_modes:{literary:"Éclaireur rapide de la faction Grofi",runic:"ᚷᚱᛟᚠᛁ",iconic:"🏃👁️🗺️"},stats:{attack:14,defense:8,health:80,mana:50,temporal_energy:60},abilities:[{id:"scout",name:"Reconnaissance",cost:1,description:"Révèle 3 cases adjacentes"}]}};function Lt(r){return Object.values(pe).filter(e=>e.tier===r)}function nt(){return Object.keys(pe).length}const Rs=Lt("LEGENDARY"),Es=Lt("EPIC"),Ms=Lt("RARE"),As=Lt("COMMON");nt(),Rs.length,Es.length,Ms.length,As.length,[...new Set(Object.values(pe).map(r=>r.class))],Math.round(Object.values(pe).reduce((r,e)=>r+e.stats.attack,0)/nt()),Math.round(Object.values(pe).reduce((r,e)=>r+e.stats.defense,0)/nt()),Math.round(Object.values(pe).reduce((r,e)=>r+e.stats.health,0)/nt()),Math.round(Object.values(pe).reduce((r,e)=>r+e.stats.mana,0)/nt());const Os=()=>{const[r,e]=R.useState("alice"),[t,n]=R.useState(null),[a,i]=R.useState(!1),[o,l]=R.useState(!1),[c,d]=R.useState({connected:!1,endpoint:"http://localhost:5001",collection:"hero_backstories"}),[p,v]=R.useState(!1),[f,m]=R.useState("");R.useEffect(()=>{h(r),b()},[r]);const b=async()=>{try{(await fetch(`${c.endpoint}/health`)).ok&&d(j=>({...j,connected:!0}))}catch{d(j=>({...j,connected:!1}))}},h=async y=>{if(c.connected)try{const E=await fetch(`${c.endpoint}/backstory/${y}`);if(E.ok){const S=await E.json();n(S);return}}catch(E){console.error("Failed to load from vector DB:",E)}const j=pe[y];j&&n({hero_id:y,name:j.name,title:j.title,backstory:j.description||"",personality_traits:["Courageux","Déterminé","Mystérieux"],speaking_style:"Formel et éloquent",motivations:["Sauver le multivers","Découvrir la vérité"],fears:["Les paradoxes temporels","Perdre ses alliés"],special_memories:["La première rencontre avec le Nexus","La bataille de la Convergence"],relationships:{vincent:"Allié de confiance",morgana:"Rivale respectée"},combat_style:"Stratégique et calculé",quantum_signature:"Ψ = 0.85",temporal_affinity:"Passé et Futur",custom_prompts:[]})},u=async()=>{if(t){l(!0);try{c.connected?(await fetch(`${c.endpoint}/backstory`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&await fetch(`${c.endpoint}/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({collection:"hero_backstories",document:t,embedding_fields:["backstory","personality_traits","speaking_style"]})}):localStorage.setItem(`hero_backstory_${t.hero_id}`,JSON.stringify(t)),i(!1)}catch(y){console.error("Failed to save backstory:",y)}finally{l(!1)}}},g=async()=>{if(!t)return;const y=`
Tu es ${t.name}, ${t.title}.

BACKSTORY:
${t.backstory}

PERSONNALITÉ:
${t.personality_traits.join(", ")}

STYLE DE PAROLE:
${t.speaking_style}

MOTIVATIONS:
${t.motivations.join(", ")}

PEURS:
${t.fears.join(", ")}

SOUVENIRS IMPORTANTS:
${t.special_memories.join(`
`)}

Génère une réplique typique de ce personnage dans une situation de combat.
    `;try{const j=await fetch("http://localhost:5002/character/speak",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({character_prompt:y,context:"Combat contre un dragon quantique",max_tokens:150})});if(j.ok){const E=await j.json();m(E.dialogue)}}catch{m('"Par le Nexus ! Ce dragon ne passera pas tant que je tiendrai cette épée !"')}v(!0)},_=()=>{if(!t)return;const y=`
# ${t.name} - ${t.title}

## Backstory
${t.backstory}

## Personnalité
- Traits: ${t.personality_traits.join(", ")}
- Style de parole: ${t.speaking_style}
- Style de combat: ${t.combat_style}

## Motivations
${t.motivations.map(j=>`- ${j}`).join(`
`)}

## Peurs
${t.fears.map(j=>`- ${j}`).join(`
`)}

## Souvenirs Clés
${t.special_memories.map(j=>`- ${j}`).join(`
`)}

## Relations
${Object.entries(t.relationships).map(([j,E])=>`- ${j}: ${E}`).join(`
`)}

## Signature Quantique
- Coefficient Ψ: ${t.quantum_signature}
- Affinité Temporelle: ${t.temporal_affinity}

## Prompts Personnalisés
${t.custom_prompts.join(`
`)}
    `;navigator.clipboard.writeText(y),alert("Prompt copié dans le presse-papier !")};return t?s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-black to-indigo-900 p-4",children:[s.jsxs("div",{className:"bg-black/60 rounded-lg p-6 mb-6 border-2 border-purple-500",children:[s.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-4",children:"📝 Éditeur de Backstory des Héros"}),s.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s.jsx("span",{className:"text-white",children:"Héros:"}),s.jsx("select",{value:r,onChange:y=>e(y.target.value),className:"bg-gray-800 text-white px-4 py-2 rounded-lg border border-purple-500",children:Object.values(pe).map(y=>s.jsxs("option",{value:y.id,children:[y.icon_id," ",y.name," - ",y.title]},y.id))}),s.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${c.connected?"bg-green-500":"bg-red-500"} animate-pulse`}),s.jsxs("span",{className:"text-sm text-gray-400",children:["Vector DB: ",c.connected?"Connecté":"Local Storage"]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>i(!a),className:"px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:scale-105 transition-all",children:a?"👁️ Aperçu":"✏️ Éditer"}),a&&s.jsx("button",{onClick:u,disabled:o,className:"px-4 py-2 bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-lg hover:scale-105 transition-all disabled:opacity-50",children:o?"⏳ Sauvegarde...":"💾 Sauvegarder"}),s.jsx("button",{onClick:g,className:"px-4 py-2 bg-gradient-to-r from-pink-600 to-red-600 text-white rounded-lg hover:scale-105 transition-all",children:"🎭 Tester Dialogue"}),s.jsx("button",{onClick:_,className:"px-4 py-2 bg-gradient-to-r from-yellow-600 to-orange-600 text-white rounded-lg hover:scale-105 transition-all",children:"📋 Exporter Prompt"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(yt.div,{className:"bg-black/60 rounded-lg p-6 border-2 border-purple-500",initial:{opacity:0,x:-50},animate:{opacity:1,x:0},children:[s.jsx("h2",{className:"text-2xl font-bold text-purple-400 mb-4",children:a?"✏️ Mode Édition":"📖 Backstory"}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-white mb-2",children:"Histoire:"}),a?s.jsx("textarea",{value:t.backstory,onChange:y=>n({...t,backstory:y.target.value}),className:"w-full h-40 bg-gray-800 text-white p-3 rounded-lg border border-purple-500",placeholder:"L'histoire du héros..."}):s.jsx("div",{className:"bg-gray-800/50 p-4 rounded-lg text-gray-300",children:t.backstory||"Aucune histoire définie"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-white mb-2",children:"Traits de Personnalité:"}),a?s.jsxs("div",{className:"space-y-2",children:[t.personality_traits.map((y,j)=>s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{value:y,onChange:E=>{const S=[...t.personality_traits];S[j]=E.target.value,n({...t,personality_traits:S})},className:"flex-1 bg-gray-800 text-white p-2 rounded-lg border border-purple-500"}),s.jsx("button",{onClick:()=>{const E=t.personality_traits.filter((S,z)=>z!==j);n({...t,personality_traits:E})},className:"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"❌"})]},j)),s.jsx("button",{onClick:()=>{n({...t,personality_traits:[...t.personality_traits,""]})},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"➕ Ajouter Trait"})]}):s.jsx("div",{className:"flex flex-wrap gap-2",children:t.personality_traits.map((y,j)=>s.jsx("span",{className:"px-3 py-1 bg-purple-600/30 text-purple-300 rounded-full",children:y},j))})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-white mb-2",children:"Style de Parole:"}),a?s.jsx("input",{value:t.speaking_style,onChange:y=>n({...t,speaking_style:y.target.value}),className:"w-full bg-gray-800 text-white p-3 rounded-lg border border-purple-500",placeholder:"Comment le héros s'exprime..."}):s.jsx("div",{className:"bg-gray-800/50 p-3 rounded-lg text-gray-300",children:t.speaking_style})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-white mb-2",children:"Style de Combat:"}),a?s.jsx("input",{value:t.combat_style,onChange:y=>n({...t,combat_style:y.target.value}),className:"w-full bg-gray-800 text-white p-3 rounded-lg border border-purple-500",placeholder:"Approche au combat..."}):s.jsx("div",{className:"bg-gray-800/50 p-3 rounded-lg text-gray-300",children:t.combat_style})]})]}),s.jsxs(yt.div,{className:"bg-black/60 rounded-lg p-6 border-2 border-purple-500",initial:{opacity:0,x:50},animate:{opacity:1,x:0},children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-xl font-bold text-purple-400 mb-3",children:"🎯 Motivations & Peurs"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-white mb-2",children:"Motivations:"}),a?s.jsx("div",{className:"space-y-2",children:t.motivations.map((y,j)=>s.jsx("input",{value:y,onChange:E=>{const S=[...t.motivations];S[j]=E.target.value,n({...t,motivations:S})},className:"w-full bg-gray-800 text-white p-2 rounded-lg border border-purple-500"},j))}):s.jsx("ul",{className:"list-disc list-inside text-gray-300",children:t.motivations.map((y,j)=>s.jsx("li",{children:y},j))})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-white mb-2",children:"Peurs:"}),a?s.jsx("div",{className:"space-y-2",children:t.fears.map((y,j)=>s.jsx("input",{value:y,onChange:E=>{const S=[...t.fears];S[j]=E.target.value,n({...t,fears:S})},className:"w-full bg-gray-800 text-white p-2 rounded-lg border border-purple-500"},j))}):s.jsx("ul",{className:"list-disc list-inside text-gray-300",children:t.fears.map((y,j)=>s.jsx("li",{children:y},j))})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-xl font-bold text-purple-400 mb-3",children:"🌀 Signature Quantique"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-white mb-2",children:"Coefficient Ψ:"}),a?s.jsx("input",{value:t.quantum_signature,onChange:y=>n({...t,quantum_signature:y.target.value}),className:"w-full bg-gray-800 text-white p-2 rounded-lg border border-purple-500"}):s.jsx("div",{className:"bg-purple-600/30 p-2 rounded-lg text-purple-300 text-center",children:t.quantum_signature})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white mb-2",children:"Affinité Temporelle:"}),a?s.jsx("input",{value:t.temporal_affinity,onChange:y=>n({...t,temporal_affinity:y.target.value}),className:"w-full bg-gray-800 text-white p-2 rounded-lg border border-purple-500"}):s.jsx("div",{className:"bg-cyan-600/30 p-2 rounded-lg text-cyan-300 text-center",children:t.temporal_affinity})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-xl font-bold text-purple-400 mb-3",children:"💭 Souvenirs Importants"}),a?s.jsxs("div",{className:"space-y-2",children:[t.special_memories.map((y,j)=>s.jsx("textarea",{value:y,onChange:E=>{const S=[...t.special_memories];S[j]=E.target.value,n({...t,special_memories:S})},className:"w-full h-20 bg-gray-800 text-white p-2 rounded-lg border border-purple-500"},j)),s.jsx("button",{onClick:()=>{n({...t,special_memories:[...t.special_memories,""]})},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"➕ Ajouter Souvenir"})]}):s.jsx("div",{className:"space-y-2",children:t.special_memories.map((y,j)=>s.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg text-gray-300 italic",children:['"',y,'"']},j))})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-xl font-bold text-purple-400 mb-3",children:"🤖 Prompts IA Personnalisés"}),a?s.jsxs("div",{className:"space-y-2",children:[t.custom_prompts.map((y,j)=>s.jsx("textarea",{value:y,onChange:E=>{const S=[...t.custom_prompts];S[j]=E.target.value,n({...t,custom_prompts:S})},className:"w-full h-20 bg-gray-800 text-white p-2 rounded-lg border border-purple-500 font-mono text-sm",placeholder:"Instruction spéciale pour l'IA..."},j)),s.jsx("button",{onClick:()=>{n({...t,custom_prompts:[...t.custom_prompts,""]})},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"➕ Ajouter Prompt"})]}):t.custom_prompts.length>0?s.jsx("div",{className:"space-y-2",children:t.custom_prompts.map((y,j)=>s.jsx("div",{className:"bg-gray-800/50 p-3 rounded-lg text-green-400 font-mono text-sm",children:y},j))}):s.jsx("div",{className:"text-gray-500 italic",children:"Aucun prompt personnalisé"})]})]})]}),s.jsx(En,{children:p&&s.jsx(yt.div,{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>v(!1),children:s.jsxs(yt.div,{className:"bg-gradient-to-br from-purple-900 to-black border-2 border-purple-500 rounded-lg p-8 max-w-2xl",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},onClick:y=>y.stopPropagation(),children:[s.jsx("h3",{className:"text-2xl font-bold text-purple-400 mb-4",children:"🎭 Dialogue Généré"}),s.jsx("div",{className:"bg-black/50 rounded-lg p-6 mb-4",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"text-4xl",children:pe[r].icon_id}),s.jsxs("div",{children:[s.jsx("div",{className:"text-white font-bold mb-2",children:t.name}),s.jsx("div",{className:"text-gray-300 italic text-lg",children:f})]})]})}),s.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:[s.jsxs("div",{children:["Style: ",t.speaking_style]}),s.jsxs("div",{children:["Personnalité: ",t.personality_traits.join(", ")]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:g,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"🔄 Régénérer"}),s.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Fermer"})]})]})})})]}):s.jsx("div",{children:"Chargement..."})},Ps="modulepreload",Ns=function(r){return"/"+r},Ar={},Qe=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(t.map(c=>{if(c=Ns(c),c in Ar)return;Ar[c]=!0;const d=c.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const v=document.createElement("link");if(v.rel=d?"stylesheet":Ps,d||(v.as="script"),v.crossOrigin="",v.href=c,l&&v.setAttribute("nonce",l),document.head.appendChild(v),d)return new Promise((f,m)=>{v.addEventListener("load",f),v.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},Is={rustBackend:"/engine",javaBackend:"/api",pythonBackend:"/vector",wsEndpoint:"ws://localhost:8001"};class Ds{constructor(e=Is){Y(this,"config");Y(this,"ws",null);Y(this,"wsConnected",!1);Y(this,"reconnectTimeout",null);this.config=e}async connectWebSocket(){return new Promise((e,t)=>{try{this.ws=new WebSocket(this.config.wsEndpoint),this.ws.onopen=()=>{console.log("✅ WebSocket V2 connecté"),this.wsConnected=!0,e()},this.ws.onerror=n=>{console.error("❌ Erreur WebSocket:",n),this.wsConnected=!1,t(n)},this.ws.onclose=()=>{console.log("🔌 WebSocket déconnecté"),this.wsConnected=!1,this.scheduleReconnect()},this.ws.onmessage=n=>{this.handleWebSocketMessage(n.data)}}catch(n){t(n)}})}scheduleReconnect(){this.reconnectTimeout||(this.reconnectTimeout=setTimeout(()=>{console.log("🔄 Tentative de reconnexion..."),this.connectWebSocket().catch(console.error),this.reconnectTimeout=null},5e3))}handleWebSocketMessage(e){try{const t=JSON.parse(e);console.log("📨 Message V2:",t),window.dispatchEvent(new CustomEvent("v2-event",{detail:t}))}catch(t){console.error("Erreur parsing message:",t)}}async tick(e){return(await fetch(`${this.config.rustBackend}/api/v2/tick`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:e,timestamp:Date.now()})})).json()}async calculateDrift(e){return(await fetch(`${this.config.rustBackend}/api/v2/drift`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positions:e})})).json()}async calculateComplexEnergy(e){return(await fetch(`${this.config.rustBackend}/api/v2/energy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity:e})})).json()}async detectParadoxes(e){return(await fetch(`${this.config.rustBackend}/api/v2/paradoxes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({timeline:e})})).json()}async upsertEntity(e){return(await fetch(`${this.config.rustBackend}/api/v2/entity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async uploadToInterstice(e){return(await fetch(`${this.config.javaBackend}/api/v2/interstice/upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async downloadFromInterstice(e){return(await fetch(`${this.config.javaBackend}/api/v2/interstice/${e}`)).json()}async searchVectorDB(e,t){return(await fetch(`${this.config.pythonBackend}/api/v2/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,filters:t})})).json()}async extractEntities(e){return(await fetch(`${this.config.pythonBackend}/api/v2/entities`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})})).json()}async activateVince(e){return(await fetch(`${this.config.rustBackend}/api/v2/regulators/vince`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async activateAnna(e){return(await fetch(`${this.config.rustBackend}/api/v2/regulators/anna`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async triggerOverload(e){return(await fetch(`${this.config.rustBackend}/api/v2/regulators/overload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}sendEvent(e){this.ws&&this.wsConnected?this.ws.send(JSON.stringify(e)):console.warn("WebSocket non connecté, événement non envoyé:",e)}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.wsConnected=!1}isConnected(){return this.wsConnected}}const nr=new Ds,sr=Object.freeze(Object.defineProperty({__proto__:null,V2Adapter:nr,default:nr},Symbol.toStringTag,{value:"Module"}));var F;(function(r){r.assertEqual=a=>{};function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{const i={};for(const o of a)i[o]=o;return i},r.getValidEnumValues=a=>{const i=r.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),o={};for(const l of i)o[l]=a[l];return r.objectValues(o)},r.objectValues=a=>r.objectKeys(a).map(function(i){return a[i]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},r.find=(a,i)=>{for(const o of a)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(F||(F={}));var Or;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Or||(Or={}));const C=F.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),je=r=>{switch(typeof r){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(r)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(r)?C.array:r===null?C.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?C.promise:typeof Map<"u"&&r instanceof Map?C.map:typeof Set<"u"&&r instanceof Set?C.set:typeof Date<"u"&&r instanceof Date?C.date:C.object;default:return C.unknown}},w=F.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ve extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},n={_errors:[]},a=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let l=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(t(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return a(this),n}static assert(e){if(!(e instanceof ve))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,F.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const a of this.issues)if(a.path.length>0){const i=a.path[0];t[i]=t[i]||[],t[i].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}ve.create=r=>new ve(r);const ar=(r,e)=>{let t;switch(r.code){case w.invalid_type:r.received===C.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case w.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,F.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:t=`Unrecognized key(s) in object: ${F.joinValues(r.keys,", ")}`;break;case w.invalid_union:t="Invalid input";break;case w.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${F.joinValues(r.options)}`;break;case w.invalid_enum_value:t=`Invalid enum value. Expected ${F.joinValues(r.options)}, received '${r.received}'`;break;case w.invalid_arguments:t="Invalid function arguments";break;case w.invalid_return_type:t="Invalid function return type";break;case w.invalid_date:t="Invalid date";break;case w.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:F.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case w.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case w.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case w.custom:t="Invalid input";break;case w.invalid_intersection_types:t="Intersection results could not be merged";break;case w.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case w.not_finite:t="Number must be finite";break;default:t=e.defaultError,F.assertNever(r)}return{message:t}};let zs=ar;function Ls(){return zs}const $s=r=>{const{data:e,path:t,errorMaps:n,issueData:a}=r,i=[...t,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let l="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:e,defaultError:l}).message;return{...a,path:i,message:l}};function k(r,e){const t=Ls(),n=$s({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ar?void 0:ar].filter(a=>!!a)});r.common.issues.push(n)}class ne{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if(a.status==="aborted")return A;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const i=await a.key,o=await a.value;n.push({key:i,value:o})}return ne.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return A;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}}const A=Object.freeze({status:"aborted"}),st=r=>({status:"dirty",value:r}),ie=r=>({status:"valid",value:r}),Pr=r=>r.status==="aborted",Nr=r=>r.status==="dirty",Ye=r=>r.status==="valid",kt=r=>typeof Promise<"u"&&r instanceof Promise;var T;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(T||(T={}));class me{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ir=(r,e)=>{if(Ye(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ve(r.common.issues);return this._error=t,this._error}}};function D(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,l)=>{const{message:c}=r;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??n??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??t??l.defaultError}},description:a}}class ${get description(){return this._def.description}_getType(e){return je(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ne,ctx:{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(kt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Ir(n,a)}"~validate"(e){var n,a;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:t});return Ye(i)?{value:i.value}:{issues:t.common.issues}}catch(i){(a=(n=i==null?void 0:i.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(i=>Ye(i)?{value:i.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},a=this._parse({data:e,path:n.path,parent:n}),i=await(kt(a)?a:Promise.resolve(a));return Ir(n,i)}refine(e,t){const n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,i)=>{const o=e(a),l=()=>i.addIssue({code:w.custom,...n(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new et({schema:this,typeName:M.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ee.create(this,this._def)}nullable(){return tt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fe.create(this)}promise(){return Et.create(this,this._def)}or(e){return Ct.create([this,e],this._def)}and(e){return Tt.create(this,e,this._def)}transform(e){return new et({...D(this._def),schema:this,typeName:M.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new dr({...D(this._def),innerType:this,defaultValue:t,typeName:M.ZodDefault})}brand(){return new la({typeName:M.ZodBranded,type:this,...D(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new ur({...D(this._def),innerType:this,catchValue:t,typeName:M.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return xr.create(this,e)}readonly(){return hr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Bs=/^c[^\s-]{8,}$/i,Fs=/^[0-9a-z]+$/,qs=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ws=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Vs=/^[a-z0-9_-]{21}$/i,Hs=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Us=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Zs=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Gs="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Qt;const Js=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Qs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ys=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ks=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Xs=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ea=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mn="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ta=new RegExp(`^${mn}$`);function gn(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function ra(r){return new RegExp(`^${gn(r)}$`)}function na(r){let e=`${mn}T${gn(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function sa(r,e){return!!((e==="v4"||!e)&&Js.test(r)||(e==="v6"||!e)&&Ys.test(r))}function aa(r,e){if(!Hs.test(r))return!1;try{const[t]=r.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function ia(r,e){return!!((e==="v4"||!e)&&Qs.test(r)||(e==="v6"||!e)&&Ks.test(r))}class xe extends ${_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){const i=this._getOrReturnCtx(e);return k(i,{code:w.invalid_type,expected:C.string,received:i.parsedType}),A}const n=new ne;let a;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:w.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:w.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,l=e.data.length<i.value;(o||l)&&(a=this._getOrReturnCtx(e,a),o?k(a,{code:w.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&k(a,{code:w.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Zs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"email",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Qt||(Qt=new RegExp(Gs,"u")),Qt.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"emoji",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")Ws.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"uuid",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")Vs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"nanoid",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")Bs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cuid",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")Fs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cuid2",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")qs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"ulid",code:w.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),k(a,{validation:"url",code:w.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"regex",code:w.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?na(i).test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?ta.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?ra(i).test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:w.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?Us.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"duration",code:w.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?sa(e.data,i.version)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"ip",code:w.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?aa(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"jwt",code:w.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?ia(e.data,i.version)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cidr",code:w.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Xs.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"base64",code:w.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?ea.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"base64url",code:w.invalid_string,message:i.message}),n.dirty()):F.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:w.invalid_string,...T.errToObj(n)})}_addCheck(e){return new xe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...T.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...T.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...T.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...T.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...T.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...T.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...T.errToObj(t)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new xe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new xe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new xe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}xe.create=r=>new xe({checks:[],typeName:M.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...D(r)});function oa(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,i=Number.parseInt(r.toFixed(a).replace(".","")),o=Number.parseInt(e.toFixed(a).replace(".",""));return i%o/10**a}class Ke extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){const i=this._getOrReturnCtx(e);return k(i,{code:w.invalid_type,expected:C.number,received:i.parsedType}),A}let n;const a=new ne;for(const i of this._def.checks)i.kind==="int"?F.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),k(n,{code:w.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?oa(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),k(n,{code:w.not_finite,message:i.message}),a.dirty()):F.assertNever(i);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,T.toString(t))}gt(e,t){return this.setLimit("min",e,!1,T.toString(t))}lte(e,t){return this.setLimit("max",e,!0,T.toString(t))}lt(e,t){return this.setLimit("max",e,!1,T.toString(t))}setLimit(e,t,n,a){return new Ke({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:T.toString(a)}]})}_addCheck(e){return new Ke({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:T.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&F.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ke.create=r=>new Ke({checks:[],typeName:M.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...D(r)});class ct extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n;const a=new ne;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),k(n,{code:w.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):F.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return k(t,{code:w.invalid_type,expected:C.bigint,received:t.parsedType}),A}gte(e,t){return this.setLimit("min",e,!0,T.toString(t))}gt(e,t){return this.setLimit("min",e,!1,T.toString(t))}lte(e,t){return this.setLimit("max",e,!0,T.toString(t))}lt(e,t){return this.setLimit("max",e,!1,T.toString(t))}setLimit(e,t,n,a){return new ct({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:T.toString(a)}]})}_addCheck(e){return new ct({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ct.create=r=>new ct({checks:[],typeName:M.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...D(r)});class ir extends ${_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.boolean,received:n.parsedType}),A}return ie(e.data)}}ir.create=r=>new ir({typeName:M.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...D(r)});class St extends ${_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){const i=this._getOrReturnCtx(e);return k(i,{code:w.invalid_type,expected:C.date,received:i.parsedType}),A}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return k(i,{code:w.invalid_date}),A}const n=new ne;let a;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:w.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:w.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):F.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new St({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}St.create=r=>new St({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:M.ZodDate,...D(r)});class Dr extends ${_parse(e){if(this._getType(e)!==C.symbol){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.symbol,received:n.parsedType}),A}return ie(e.data)}}Dr.create=r=>new Dr({typeName:M.ZodSymbol,...D(r)});class zr extends ${_parse(e){if(this._getType(e)!==C.undefined){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.undefined,received:n.parsedType}),A}return ie(e.data)}}zr.create=r=>new zr({typeName:M.ZodUndefined,...D(r)});class Lr extends ${_parse(e){if(this._getType(e)!==C.null){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.null,received:n.parsedType}),A}return ie(e.data)}}Lr.create=r=>new Lr({typeName:M.ZodNull,...D(r)});class or extends ${constructor(){super(...arguments),this._any=!0}_parse(e){return ie(e.data)}}or.create=r=>new or({typeName:M.ZodAny,...D(r)});class $r extends ${constructor(){super(...arguments),this._unknown=!0}_parse(e){return ie(e.data)}}$r.create=r=>new $r({typeName:M.ZodUnknown,...D(r)});class Me extends ${_parse(e){const t=this._getOrReturnCtx(e);return k(t,{code:w.invalid_type,expected:C.never,received:t.parsedType}),A}}Me.create=r=>new Me({typeName:M.ZodNever,...D(r)});class Br extends ${_parse(e){if(this._getType(e)!==C.undefined){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.void,received:n.parsedType}),A}return ie(e.data)}}Br.create=r=>new Br({typeName:M.ZodVoid,...D(r)});class fe extends ${_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==C.array)return k(t,{code:w.invalid_type,expected:C.array,received:t.parsedType}),A;if(a.exactLength!==null){const o=t.data.length>a.exactLength.value,l=t.data.length<a.exactLength.value;(o||l)&&(k(t,{code:o?w.too_big:w.too_small,minimum:l?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(k(t,{code:w.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(k(t,{code:w.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,l)=>a.type._parseAsync(new me(t,o,t.path,l)))).then(o=>ne.mergeArray(n,o));const i=[...t.data].map((o,l)=>a.type._parseSync(new me(t,o,t.path,l)));return ne.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new fe({...this._def,minLength:{value:e,message:T.toString(t)}})}max(e,t){return new fe({...this._def,maxLength:{value:e,message:T.toString(t)}})}length(e,t){return new fe({...this._def,exactLength:{value:e,message:T.toString(t)}})}nonempty(e){return this.min(1,e)}}fe.create=(r,e)=>new fe({type:r,minLength:null,maxLength:null,exactLength:null,typeName:M.ZodArray,...D(e)});function Be(r){if(r instanceof Z){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Ee.create(Be(n))}return new Z({...r._def,shape:()=>e})}else return r instanceof fe?new fe({...r._def,type:Be(r.element)}):r instanceof Ee?Ee.create(Be(r.unwrap())):r instanceof tt?tt.create(Be(r.unwrap())):r instanceof ze?ze.create(r.items.map(e=>Be(e))):r}class Z extends ${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=F.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==C.object){const d=this._getOrReturnCtx(e);return k(d,{code:w.invalid_type,expected:C.object,received:d.parsedType}),A}const{status:n,ctx:a}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Me&&this._def.unknownKeys==="strip"))for(const d in a.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const p=i[d],v=a.data[d];c.push({key:{status:"valid",value:d},value:p._parse(new me(a,v,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof Me){const d=this._def.unknownKeys;if(d==="passthrough")for(const p of l)c.push({key:{status:"valid",value:p},value:{status:"valid",value:a.data[p]}});else if(d==="strict")l.length>0&&(k(a,{code:w.unrecognized_keys,keys:l}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const p of l){const v=a.data[p];c.push({key:{status:"valid",value:p},value:d._parse(new me(a,v,a.path,p)),alwaysSet:p in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const d=[];for(const p of c){const v=await p.key,f=await p.value;d.push({key:v,value:f,alwaysSet:p.alwaysSet})}return d}).then(d=>ne.mergeObjectSync(n,d)):ne.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new Z({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var i,o;const a=((o=(i=this._def).errorMap)==null?void 0:o.call(i,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:T.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new Z({...this._def,unknownKeys:"strip"})}passthrough(){return new Z({...this._def,unknownKeys:"passthrough"})}extend(e){return new Z({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Z({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:M.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Z({...this._def,catchall:e})}pick(e){const t={};for(const n of F.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new Z({...this._def,shape:()=>t})}omit(e){const t={};for(const n of F.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new Z({...this._def,shape:()=>t})}deepPartial(){return Be(this)}partial(e){const t={};for(const n of F.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new Z({...this._def,shape:()=>t})}required(e){const t={};for(const n of F.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Ee;)i=i._def.innerType;t[n]=i}return new Z({...this._def,shape:()=>t})}keyof(){return yn(F.objectKeys(this.shape))}}Z.create=(r,e)=>new Z({shape:()=>r,unknownKeys:"strip",catchall:Me.create(),typeName:M.ZodObject,...D(e)});Z.strictCreate=(r,e)=>new Z({shape:()=>r,unknownKeys:"strict",catchall:Me.create(),typeName:M.ZodObject,...D(e)});Z.lazycreate=(r,e)=>new Z({shape:r,unknownKeys:"strip",catchall:Me.create(),typeName:M.ZodObject,...D(e)});class Ct extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function a(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return t.common.issues.push(...l.ctx.common.issues),l.result;const o=i.map(l=>new ve(l.ctx.common.issues));return k(t,{code:w.invalid_union,unionErrors:o}),A}if(t.common.async)return Promise.all(n.map(async i=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(a);{let i;const o=[];for(const c of n){const d={...t,common:{...t.common,issues:[]},parent:null},p=c._parseSync({data:t.data,path:t.path,parent:d});if(p.status==="valid")return p;p.status==="dirty"&&!i&&(i={result:p,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const l=o.map(c=>new ve(c));return k(t,{code:w.invalid_union,unionErrors:l}),A}}get options(){return this._def.options}}Ct.create=(r,e)=>new Ct({options:r,typeName:M.ZodUnion,...D(e)});function lr(r,e){const t=je(r),n=je(e);if(r===e)return{valid:!0,data:r};if(t===C.object&&n===C.object){const a=F.objectKeys(e),i=F.objectKeys(r).filter(l=>a.indexOf(l)!==-1),o={...r,...e};for(const l of i){const c=lr(r[l],e[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(t===C.array&&n===C.array){if(r.length!==e.length)return{valid:!1};const a=[];for(let i=0;i<r.length;i++){const o=r[i],l=e[i],c=lr(o,l);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return t===C.date&&n===C.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Tt extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(i,o)=>{if(Pr(i)||Pr(o))return A;const l=lr(i.value,o.value);return l.valid?((Nr(i)||Nr(o))&&t.dirty(),{status:t.value,value:l.data}):(k(n,{code:w.invalid_intersection_types}),A)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Tt.create=(r,e,t)=>new Tt({left:r,right:e,typeName:M.ZodIntersection,...D(t)});class ze extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return k(n,{code:w.invalid_type,expected:C.array,received:n.parsedType}),A;if(n.data.length<this._def.items.length)return k(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&n.data.length>this._def.items.length&&(k(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new me(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>ne.mergeArray(t,o)):ne.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new ze({...this._def,rest:e})}}ze.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ze({items:r,typeName:M.ZodTuple,rest:null,...D(e)})};class Rt extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return k(n,{code:w.invalid_type,expected:C.object,received:n.parsedType}),A;const a=[],i=this._def.keyType,o=this._def.valueType;for(const l in n.data)a.push({key:i._parse(new me(n,l,n.path,l)),value:o._parse(new me(n,n.data[l],n.path,l)),alwaysSet:l in n.data});return n.common.async?ne.mergeObjectAsync(t,a):ne.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof $?new Rt({keyType:e,valueType:t,typeName:M.ZodRecord,...D(n)}):new Rt({keyType:xe.create(),valueType:e,typeName:M.ZodRecord,...D(t)})}}class Fr extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return k(n,{code:w.invalid_type,expected:C.map,received:n.parsedType}),A;const a=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([l,c],d)=>({key:a._parse(new me(n,l,n.path,[d,"key"])),value:i._parse(new me(n,c,n.path,[d,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,p=await c.value;if(d.status==="aborted"||p.status==="aborted")return A;(d.status==="dirty"||p.status==="dirty")&&t.dirty(),l.set(d.value,p.value)}return{status:t.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,p=c.value;if(d.status==="aborted"||p.status==="aborted")return A;(d.status==="dirty"||p.status==="dirty")&&t.dirty(),l.set(d.value,p.value)}return{status:t.value,value:l}}}}Fr.create=(r,e,t)=>new Fr({valueType:e,keyType:r,typeName:M.ZodMap,...D(t)});class dt extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return k(n,{code:w.invalid_type,expected:C.set,received:n.parsedType}),A;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(k(n,{code:w.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(k(n,{code:w.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const i=this._def.valueType;function o(c){const d=new Set;for(const p of c){if(p.status==="aborted")return A;p.status==="dirty"&&t.dirty(),d.add(p.value)}return{status:t.value,value:d}}const l=[...n.data.values()].map((c,d)=>i._parse(new me(n,c,n.path,d)));return n.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(e,t){return new dt({...this._def,minSize:{value:e,message:T.toString(t)}})}max(e,t){return new dt({...this._def,maxSize:{value:e,message:T.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}dt.create=(r,e)=>new dt({valueType:r,minSize:null,maxSize:null,typeName:M.ZodSet,...D(e)});class qr extends ${get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}qr.create=(r,e)=>new qr({getter:r,typeName:M.ZodLazy,...D(e)});class cr extends ${_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return k(t,{received:t.data,code:w.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:e.data}}get value(){return this._def.value}}cr.create=(r,e)=>new cr({value:r,typeName:M.ZodLiteral,...D(e)});function yn(r,e){return new Xe({values:r,typeName:M.ZodEnum,...D(e)})}class Xe extends ${_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return k(t,{expected:F.joinValues(n),received:t.parsedType,code:w.invalid_type}),A}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return k(t,{received:t.data,code:w.invalid_enum_value,options:n}),A}return ie(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Xe.create(e,{...this._def,...t})}exclude(e,t=this._def){return Xe.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Xe.create=yn;class Wr extends ${_parse(e){const t=F.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){const a=F.objectValues(t);return k(n,{expected:F.joinValues(a),received:n.parsedType,code:w.invalid_type}),A}if(this._cache||(this._cache=new Set(F.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=F.objectValues(t);return k(n,{received:n.data,code:w.invalid_enum_value,options:a}),A}return ie(e.data)}get enum(){return this._def.values}}Wr.create=(r,e)=>new Wr({values:r,typeName:M.ZodNativeEnum,...D(e)});class Et extends ${unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.promise&&t.common.async===!1)return k(t,{code:w.invalid_type,expected:C.promise,received:t.parsedType}),A;const n=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return ie(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Et.create=(r,e)=>new Et({type:r,typeName:M.ZodPromise,...D(e)});class et extends ${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===M.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:o=>{k(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const o=a.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async l=>{if(t.value==="aborted")return A;const c=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return c.status==="aborted"?A:c.status==="dirty"||t.value==="dirty"?st(c.value):c});{if(t.value==="aborted")return A;const l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?A:l.status==="dirty"||t.value==="dirty"?st(l.value):l}}if(a.type==="refinement"){const o=l=>{const c=a.refinement(l,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?A:(l.status==="dirty"&&t.dirty(),o(l.value),{status:t.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?A:(l.status==="dirty"&&t.dirty(),o(l.value).then(()=>({status:t.value,value:l.value}))))}if(a.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ye(o))return A;const l=a.transform(o.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Ye(o)?Promise.resolve(a.transform(o.value,i)).then(l=>({status:t.value,value:l})):A);F.assertNever(a)}}et.create=(r,e,t)=>new et({schema:r,typeName:M.ZodEffects,effect:e,...D(t)});et.createWithPreprocess=(r,e,t)=>new et({schema:e,effect:{type:"preprocess",transform:r},typeName:M.ZodEffects,...D(t)});class Ee extends ${_parse(e){return this._getType(e)===C.undefined?ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ee.create=(r,e)=>new Ee({innerType:r,typeName:M.ZodOptional,...D(e)});class tt extends ${_parse(e){return this._getType(e)===C.null?ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}tt.create=(r,e)=>new tt({innerType:r,typeName:M.ZodNullable,...D(e)});class dr extends ${_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}dr.create=(r,e)=>new dr({innerType:r,typeName:M.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...D(e)});class ur extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return kt(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ve(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ve(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ur.create=(r,e)=>new ur({innerType:r,typeName:M.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...D(e)});class Vr extends ${_parse(e){if(this._getType(e)!==C.nan){const n=this._getOrReturnCtx(e);return k(n,{code:w.invalid_type,expected:C.nan,received:n.parsedType}),A}return{status:"valid",value:e.data}}}Vr.create=r=>new Vr({typeName:M.ZodNaN,...D(r)});class la extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class xr extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?A:i.status==="dirty"?(t.dirty(),st(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?A:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new xr({in:e,out:t,typeName:M.ZodPipeline})}}class hr extends ${_parse(e){const t=this._def.innerType._parse(e),n=a=>(Ye(a)&&(a.value=Object.freeze(a.value)),a);return kt(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}}hr.create=(r,e)=>new hr({innerType:r,typeName:M.ZodReadonly,...D(e)});var M;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(M||(M={}));const I=xe.create,O=Ke.create,Mt=ir.create,$t=or.create;Me.create;const re=fe.create,q=Z.create,ca=Ct.create;Tt.create;ze.create;const Bt=Rt.create,xn=cr.create,Le=Xe.create;Et.create;Ee.create;tt.create;const vn=q({q:O(),r:O()}),da=q({position:vn,type:Le(["grass","forest","mountain","water","desert","snow","lava","void"]),elevation:O().default(0),passable:Mt().default(!0),movementCost:O().default(1),properties:Bt($t()).optional()}),ua=q({id:I(),name:I(),color:I(),hexes:re(vn),properties:q({faction:I().optional(),difficulty:Le(["easy","normal","hard","nightmare"]).optional(),temporalZone:I().optional()}).optional()}),ha=q({id:I(),from:I(),to:I(),type:Le(["road","portal","bridge","teleport"]),bidirectional:Mt().default(!0),cost:O().default(1)}),bn=q({version:xn("2.0"),id:I(),name:I(),description:I().optional(),dimensions:q({width:O().positive(),height:O().positive()}),hexagons:re(da),regions:re(ua).default([]),connections:re(ha).default([]),metadata:q({author:I().optional(),created:I().datetime().optional(),tags:re(I()).optional()}).optional()}),pa=q({x:O(),y:O(),z:O().default(0),t:O().default(0),c:O().default(0),psi:O().min(0).max(1).default(0)}),fa=q({A:O().min(0).max(100),phi:O().min(-180).max(180)}),_n=q({id:I(),type:Le(["hero","creature","artifact","resource","building","marker","portal"]),subtype:I(),emoji:I(),name:I(),position_6d:pa,size:O().default(40),rotation:O().default(0),opacity:O().min(0).max(1).default(1),temporal:q({cycle:O().optional(),te:O().optional(),appearDay:O().optional(),disappearDay:O().optional()}).optional(),energy_complex:fa.optional(),data:Bt($t()).optional()}),ma=q({id:I(),from:I(),to:I(),type:Le(["temporal","causal","quantum","energy"]),strength:O().min(0).max(1).default(.5),properties:q({interference:O().optional(),delay:O().optional(),condition:I().optional()}).optional()}),ga=q({id:I(),day:O().positive(),type:I(),name:I(),description:I().optional(),action:q({spawn:re(_n).optional(),remove:re(I()).optional(),modify:re(q({resourceId:I(),changes:Bt($t())})).optional()}).optional(),conditions:re(I()).optional(),repeat:q({interval:O(),times:O().optional()}).optional()}),ya=q({vince:q({active:Mt().default(!1),intensity:O().default(1),zone:I().optional()}),anna:q({active:Mt().default(!1),decayRate:O().default(5),zone:I().optional()}),overload:q({stack:O().default(0),maxStack:O().default(10),threshold:O().default(7)})}),Hr=q({type:Le(["elimination","capture","survive","collect","custom"]),description:I(),parameters:Bt($t()).optional()}),xa=q({version:xn("2.0"),id:I(),name:I(),description:I().optional(),world:ca([I(),bn]),resources:re(_n).default([]),connections:re(ma).default([]),timeline:q({events:re(ga).default([]),maxDays:O().default(100),startDay:O().default(1)}),regulators:ya,victory_conditions:re(Hr).default([]),defeat_conditions:re(Hr).default([]),initial_state:q({resources:q({gold:O().default(1e3),crystals:O().default(100),energy:O().default(50),temporal:O().default(25),quantum:O().default(10)}),tw:O().default(0),te:O().default(0)}),metadata:q({author:I().optional(),created:I().datetime().optional(),modified:I().datetime().optional(),tags:re(I()).optional(),difficulty:Le(["easy","normal","hard","nightmare"]).optional(),playerCount:q({min:O().default(1),max:O().default(8)}).optional()}).optional()});function Yt(r){return bn.parse(r)}function Kt(r){return xa.parse(r)}function va(r,e,t){const n=[];for(let a=0;a<t;a++)for(let i=0;i<e;i++){const o=i-Math.floor(a/2);n.push({position:{q:o,r:a},type:"grass",elevation:0,passable:!0,movementCost:1})}return{version:"2.0",id:`world_${Date.now()}`,name:r,dimensions:{width:e,height:t},hexagons:n,regions:[],connections:[]}}function ba(r,e){return{version:"2.0",id:`map_${Date.now()}`,name:r,world:e,resources:[],connections:[],timeline:{events:[],maxDays:100,startDay:1},regulators:{vince:{active:!1,intensity:1},anna:{active:!1,decayRate:5},overload:{stack:0,maxStack:10,threshold:7}},victory_conditions:[],defeat_conditions:[],initial_state:{resources:{gold:1e3,crystals:100,energy:50,temporal:25,quantum:10},tw:0,te:0}}}class _a{constructor(){Y(this,"STORAGE_KEY_WORLDS","unified_worlds");Y(this,"STORAGE_KEY_MAPS","unified_maps");Y(this,"BACKEND_URL","http://localhost:8082/api")}async saveWorldLocal(e){try{const t=this.getLocalWorlds();return t[e.id]=e,localStorage.setItem(this.STORAGE_KEY_WORLDS,JSON.stringify(t)),{success:!0,path:`local:worlds/${e.id}`}}catch(t){return{success:!1,error:`Erreur de sauvegarde locale: ${t}`}}}async saveWorldBackend(e){try{const t=await fetch(`${this.BACKEND_URL}/worlds`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return{success:!0,path:(await t.json()).path||`backend:worlds/${e.id}`}}catch(t){return console.warn("Backend offline, sauvegarde locale",t),this.saveWorldLocal(e)}}async saveMapLocal(e){try{const t=this.getLocalMaps();return t[e.id]=e,localStorage.setItem(this.STORAGE_KEY_MAPS,JSON.stringify(t)),{success:!0,path:`local:maps/${e.id}`}}catch(t){return{success:!1,error:`Erreur de sauvegarde locale: ${t}`}}}async saveMapBackend(e){try{const t=await fetch(`${this.BACKEND_URL}/maps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return{success:!0,path:(await t.json()).path||`backend:maps/${e.id}`}}catch(t){return console.warn("Backend offline, sauvegarde locale",t),this.saveMapLocal(e)}}async uploadToInterstice(e){var t,n,a;try{const i=await fetch("http://localhost:8082/api/interstice/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"unified_map",name:e.name,data:e,metadata:{version:e.version,author:(t=e.metadata)==null?void 0:t.author,created:(n=e.metadata)==null?void 0:n.created,tags:(a=e.metadata)==null?void 0:a.tags}})});if(!i.ok)throw new Error(`HTTP ${i.status}`);return{success:!0,path:`interstice:${(await i.json()).interstice_id}`}}catch(i){return{success:!1,error:`Erreur upload Interstice: ${i}`}}}async loadWorldLocal(e){try{const n=this.getLocalWorlds()[e];return n?{success:!0,data:Yt(n)}:{success:!1,error:`World ${e} non trouvé`}}catch(t){return{success:!1,error:`Erreur de chargement: ${t}`}}}async loadWorldBackend(e){try{const t=await fetch(`${this.BACKEND_URL}/worlds/${e}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();return{success:!0,data:Yt(n)}}catch(t){return console.warn("Backend offline, chargement local",t),this.loadWorldLocal(e)}}async loadMapLocal(e){try{const n=this.getLocalMaps()[e];return n?{success:!0,data:Kt(n)}:{success:!1,error:`Map ${e} non trouvée`}}catch(t){return{success:!1,error:`Erreur de chargement: ${t}`}}}async loadMapBackend(e){try{const t=await fetch(`${this.BACKEND_URL}/maps/${e}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();return{success:!0,data:Kt(n)}}catch(t){return console.warn("Backend offline, chargement local",t),this.loadMapLocal(e)}}async listWorlds(){const e=Object.values(this.getLocalWorlds());let t=[];try{const n=await fetch(`${this.BACKEND_URL}/worlds`);n.ok&&(t=await n.json())}catch(n){console.warn("Backend offline pour listing",n)}return{local:e,backend:t}}async listMaps(){const e=Object.values(this.getLocalMaps());let t=[];try{const n=await fetch(`${this.BACKEND_URL}/maps`);n.ok&&(t=await n.json())}catch(n){console.warn("Backend offline pour listing",n)}return{local:e,backend:t}}exportBundle(e,t){return JSON.stringify({version:"2.0",type:"unified_bundle",exported:new Date().toISOString(),world:e,map:t},null,2)}async importBundle(e){try{const t=JSON.parse(e);if(t.type!=="unified_bundle")throw new Error("Format invalide, attendu: unified_bundle");const n=Yt(t.world),a=Kt(t.map);return{success:!0,data:{world:n,map:a}}}catch(t){return{success:!1,error:`Erreur d'import: ${t}`}}}downloadFile(e,t){const n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=t,i.click(),URL.revokeObjectURL(a)}getLocalWorlds(){const e=localStorage.getItem(this.STORAGE_KEY_WORLDS);return e?JSON.parse(e):{}}getLocalMaps(){const e=localStorage.getItem(this.STORAGE_KEY_MAPS);return e?JSON.parse(e):{}}clearLocalCache(){localStorage.removeItem(this.STORAGE_KEY_WORLDS),localStorage.removeItem(this.STORAGE_KEY_MAPS)}getStorageStats(){const e=this.getLocalWorlds(),t=this.getLocalMaps(),n=JSON.stringify(e).length,a=JSON.stringify(t).length;return{worldsCount:Object.keys(e).length,mapsCount:Object.keys(t).length,totalSize:n+a}}}const Fe=new _a,Q=pt()(zt(hn((r,e)=>({currentWorld:null,currentMap:null,worldPath:null,mapPath:null,mode:"structure",tool:"paint",selectedHex:null,selectedResource:null,selectedRegion:null,selectedEvent:null,temporal:{tw:0,te:0,drift:0,debt:0,currentDay:1},simulationRunning:!1,showGrid:!0,showRegions:!0,showConnections:!0,showTimeline:!1,zoomLevel:1,viewOffset:{x:0,y:0},brushSize:1,brushTerrain:"grass",selectedIcon:null,connectionStart:null,undoStack:[],redoStack:[],newWorld:(t,n,a)=>{const i=va(t,n,a);r({currentWorld:i,worldPath:null,mode:"structure",tool:"paint"})},loadWorld:(t,n)=>{r({currentWorld:t,worldPath:n||null})},saveWorld:async()=>{const{currentWorld:t,worldPath:n}=e();if(!t)return;const a=await Fe.saveWorldBackend(t);a.success?(r({worldPath:a.path}),console.log("✅ World sauvegardé:",a.path)):console.error("❌ Erreur sauvegarde world:",a.error)},newMap:t=>{const{currentWorld:n}=e();if(!n){console.error("No world loaded! Create or load a world first.");return}const a=ba(t,n);r({currentMap:a,mapPath:null,mode:"resources",tool:"place"})},loadMap:(t,n)=>{r({currentMap:t,mapPath:n||null,mode:"resources"})},saveMap:async()=>{const{currentMap:t,mapPath:n}=e();if(!t)return;const a=await Fe.saveMapBackend(t);a.success?(r({mapPath:a.path}),console.log("✅ Map sauvegardée:",a.path)):console.error("❌ Erreur sauvegarde map:",a.error)},exportToFile:()=>{const{currentWorld:t,currentMap:n}=e();if(!t||!n){console.error("World et Map requis pour export");return}const a=Fe.exportBundle(t,n);Fe.downloadFile(a,`unified_map_${Date.now()}.json`)},importFromFile:async t=>{const n=await Fe.importBundle(t);n.success&&n.data?(e().loadWorld(n.data.world),e().loadMap(n.data.map),console.log("✅ Import réussi")):console.error("❌ Erreur import:",n.error)},setMode:t=>{r({mode:t}),t==="structure"?r({tool:"paint"}):t==="resources"?r({tool:"place"}):t==="timeline"&&r({tool:"select"})},setTool:t=>r({tool:t}),paintTerrain:(t,n)=>{const{currentWorld:a,brushTerrain:i,brushSize:o}=e();if(!a)return;const l=[...a.hexagons],c=Math.floor(o/2);for(let d=-c;d<=c;d++)for(let p=-c;p<=c;p++){if(Math.abs(d+p)>c)continue;const v=l.findIndex(f=>f.position.q===t+d&&f.position.r===n+p);v!==-1&&(l[v]={...l[v],type:i})}r({currentWorld:{...a,hexagons:l}})},setBrushTerrain:t=>r({brushTerrain:t}),setBrushSize:t=>r({brushSize:Math.max(1,Math.min(9,t))}),createRegion:(t,n)=>{const{currentWorld:a}=e();if(!a)return;const i={id:`region_${Date.now()}`,name:t,color:`#${Math.floor(Math.random()*16777215).toString(16)}`,hexes:n};r({currentWorld:{...a,regions:[...a.regions,i]}})},updateRegion:(t,n)=>{const{currentWorld:a}=e();a&&r({currentWorld:{...a,regions:a.regions.map(i=>i.id===t?{...i,...n}:i)}})},deleteRegion:t=>{const{currentWorld:n}=e();n&&r({currentWorld:{...n,regions:n.regions.filter(a=>a.id!==t)}})},placeResourceWithIcon:(t,n,a)=>{const{currentMap:i,temporal:o}=e();if(!i)return;const c={"🐉 Créatures":"creature","💎 Ressources":"resource","🏗️ Bâtiments":"building","📍 Marqueurs":"marker","⏰ Temporel":"marker","⚔️ Combats":"artifact","🏞️ Terrains":"marker"}[a.category]||"marker",d={id:`resource_${Date.now()}`,type:c,subtype:a.name,emoji:a.emoji,name:a.name,position_6d:{x:t,y:n,z:0,t:o.currentDay,c:0,psi:0},size:40,rotation:0,opacity:1};r({currentMap:{...i,resources:[...i.resources,d]}})},placeResource:(t,n)=>{const{currentMap:a,selectedIcon:i,temporal:o}=e();if(!a||!i)return;const l={id:`resource_${Date.now()}`,type:"marker",subtype:i.name,emoji:i.emoji,name:i.name,position_6d:{x:t,y:n,z:0,t:o.currentDay,c:0,psi:0},size:40,rotation:0,opacity:1};r({currentMap:{...a,resources:[...a.resources,l]}})},updateResource:(t,n)=>{const{currentMap:a}=e();a&&r({currentMap:{...a,resources:a.resources.map(i=>i.id===t?{...i,...n}:i)}})},deleteResource:t=>{const{currentMap:n}=e();n&&r({currentMap:{...n,resources:n.resources.filter(a=>a.id!==t),connections:n.connections.filter(a=>a.from!==t&&a.to!==t)}})},createConnection:(t,n,a)=>{const{currentMap:i}=e();if(!i)return;const o={id:`conn_${Date.now()}`,from:t,to:n,type:a,strength:.5};r({currentMap:{...i,connections:[...i.connections,o]},connectionStart:null})},deleteConnection:t=>{const{currentMap:n}=e();n&&r({currentMap:{...n,connections:n.connections.filter(a=>a.id!==t)}})},addEvent:t=>{const{currentMap:n}=e();if(!n)return;const a={...t,id:`event_${Date.now()}`};r({currentMap:{...n,timeline:{...n.timeline,events:[...n.timeline.events,a]}}})},updateEvent:(t,n)=>{const{currentMap:a}=e();a&&r({currentMap:{...a,timeline:{...a.timeline,events:a.timeline.events.map(i=>i.id===t?{...i,...n}:i)}}})},deleteEvent:t=>{const{currentMap:n}=e();n&&r({currentMap:{...n,timeline:{...n.timeline,events:n.timeline.events.filter(a=>a.id!==t)}}})},setCurrentDay:t=>{r(n=>({temporal:{...n.temporal,currentDay:t}}))},updateRegulators:t=>{const{currentMap:n}=e();n&&r({currentMap:{...n,regulators:{...n.regulators,...t}}})},activateRegulator:t=>{const{currentMap:n}=e();if(!n)return;const a={};t==="vince"?a.vince={...n.regulators.vince,active:!0}:t==="anna"?a.anna={...n.regulators.anna,active:!0}:t==="overload"&&(a.overload={...n.regulators.overload,stack:n.regulators.overload.stack+1}),e().updateRegulators(a)},startSimulation:()=>r({simulationRunning:!0}),stopSimulation:()=>r({simulationRunning:!1}),tick:()=>{const{temporal:t,simulationRunning:n}=e();n&&r({temporal:{...t,tw:t.tw+.1,te:t.te+.095,drift:Math.abs(t.tw+.1-(t.te+.095)),debt:t.debt+(t.drift>1?.01:-.01)}})},playMap:()=>{const{currentMap:t}=e();if(!t){console.error("No map to play!");return}r({mode:"play"}),console.log("Playing map:",t.name)},setZoom:t=>r({zoomLevel:Math.max(.5,Math.min(3,t))}),pan:(t,n)=>{r(a=>({viewOffset:{x:a.viewOffset.x+t,y:a.viewOffset.y+n}}))},toggleGrid:()=>r(t=>({showGrid:!t.showGrid})),toggleRegions:()=>r(t=>({showRegions:!t.showRegions})),toggleConnections:()=>r(t=>({showConnections:!t.showConnections})),toggleTimeline:()=>r(t=>({showTimeline:!t.showTimeline})),undo:()=>{console.log("Undo")},redo:()=>{console.log("Redo")},getVisibleResources:()=>{const{currentMap:t,temporal:n}=e();return t?t.resources.filter(a=>{var l,c;const i=((l=a.temporal)==null?void 0:l.appearDay)||1,o=((c=a.temporal)==null?void 0:c.disappearDay)||1/0;return n.currentDay>=i&&n.currentDay<=o}):[]},getActiveEvents:()=>{const{currentMap:t,temporal:n}=e();return t?t.timeline.events.filter(a=>{if(a.day===n.currentDay)return!0;if(a.repeat){const i=n.currentDay-a.day;if(i>0&&i%a.repeat.interval===0&&(!a.repeat.times||i/a.repeat.interval<=a.repeat.times))return!0}return!1}):[]},canPlayMap:()=>{const{currentWorld:t,currentMap:n}=e();return!!(t&&n&&n.resources.length>0)}}),{name:"unified-map-store",partialize:r=>({worldPath:r.worldPath,mapPath:r.mapPath,showGrid:r.showGrid,showRegions:r.showRegions,showConnections:r.showConnections,zoomLevel:r.zoomLevel,brushSize:r.brushSize})})));function pr(){const r=R.useRef(null),{currentWorld:e,selectedHex:t,brushTerrain:n,brushSize:a,showGrid:i,showRegions:o,zoomLevel:l,viewOffset:c,paintTerrain:d,setTool:p}=Q(),[v,f]=R.useState(!1),m=30*l,b={grass:"#4ade80",forest:"#16a34a",mountain:"#a8a29e",water:"#3b82f6",desert:"#fbbf24",snow:"#e0e7ff",lava:"#ef4444",void:"#1e1b4b"},h=(S,z)=>{const W=(S-c.x)/l,L=(z-c.y)/l,V=(W*Math.sqrt(3)/3-L/3)/m,G=L*2/3/m;return{q:Math.round(V),r:Math.round(G)}},u=(S,z)=>{const W=m*(Math.sqrt(3)*S+Math.sqrt(3)/2*z),L=m*(3/2*z);return{x:W*l+c.x+100,y:L*l+c.y+100}},g=(S,z,W,L,V=!1)=>{S.beginPath();for(let G=0;G<6;G++){const ft=Math.PI/3*G-Math.PI/6,mt=z+m*Math.cos(ft),rt=W+m*Math.sin(ft);G===0?S.moveTo(mt,rt):S.lineTo(mt,rt)}S.closePath(),S.fillStyle=L,S.fill(),i&&(S.strokeStyle=V?"#fbbf24":"rgba(255, 255, 255, 0.2)",S.lineWidth=V?2:1,S.stroke())};R.useEffect(()=>{const S=r.current;if(!S)return;const z=()=>{S.width=window.innerWidth,S.height=window.innerHeight-200};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]),R.useEffect(()=>{const S=r.current;if(!S||!e)return;const z=S.getContext("2d");z&&((S.width===0||S.height===0)&&(S.width=window.innerWidth,S.height=window.innerHeight-200),z.clearRect(0,0,S.width,S.height),z.fillStyle="#0a0e1a",z.fillRect(0,0,S.width,S.height),e.hexagons.forEach(W=>{const L=u(W.position.q,W.position.r),V=b[W.type]||"#4ade80",G=(t==null?void 0:t.q)===W.position.q&&(t==null?void 0:t.r)===W.position.r;g(z,L.x,L.y,V,G)}),o&&e.regions.forEach(W=>{z.strokeStyle=W.color,z.lineWidth=3,z.globalAlpha=.5,W.hexes.forEach(L=>{const V=u(L.q,L.r);g(z,V.x,V.y,"transparent",!1)}),z.globalAlpha=1}))},[e,t,i,o,l,c]);const _=S=>{f(!0),y(S)},y=S=>{var G;if(!v)return;const z=(G=r.current)==null?void 0:G.getBoundingClientRect();if(!z)return;const W=S.clientX-z.left,L=S.clientY-z.top,V=h(W,L);d(V.q,V.r)},j=()=>{f(!1)},E=S=>{var G;const z=(G=r.current)==null?void 0:G.getBoundingClientRect();if(!z)return;const W=S.clientX-z.left,L=S.clientY-z.top,V=h(W,L);d(V.q,V.r)};return s.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"},children:[s.jsx("canvas",{ref:r,style:{cursor:"crosshair",display:"block",width:"100%",height:"100%"},onMouseDown:_,onMouseMove:y,onMouseUp:j,onMouseLeave:j,onClick:E}),s.jsxs("div",{style:{position:"absolute",top:20,right:20,background:"rgba(0, 0, 0, 0.8)",padding:15,borderRadius:10,border:"1px solid rgba(102, 126, 234, 0.5)"},children:[s.jsx("h3",{style:{margin:0,marginBottom:10,fontSize:16},children:"🏗️ Mode Structure"}),s.jsxs("div",{style:{fontSize:12,display:"flex",flexDirection:"column",gap:5},children:[s.jsxs("div",{children:["Terrain: ",n]}),s.jsxs("div",{children:["Taille: ",a]}),s.jsxs("div",{children:["World: ",e==null?void 0:e.name]}),s.jsxs("div",{children:["Dimensions: ",e==null?void 0:e.dimensions.width," x ",e==null?void 0:e.dimensions.height]})]})]})]})}function wa({currentMode:r,onModeChange:e}){const t=[{mode:"structure",label:"Structure",icon:"🏗️",color:"#4299e1"},{mode:"resources",label:"Resources",icon:"💎",color:"#48bb78"},{mode:"timeline",label:"Timeline",icon:"⏳",color:"#ed8936"},{mode:"overlay",label:"Overlay",icon:"🌌",color:"#9f7aea"},{mode:"play",label:"Play",icon:"🎮",color:"#f56565"}];return s.jsx("div",{style:{display:"flex",gap:4,background:"rgba(0, 0, 0, 0.3)",padding:4,borderRadius:12,border:"1px solid rgba(102, 126, 234, 0.3)"},children:t.map(({mode:n,label:a,icon:i,color:o})=>s.jsxs("button",{onClick:()=>e(n),style:{padding:"8px 16px",background:r===n?`linear-gradient(135deg, ${o}dd, ${o}99)`:"rgba(255, 255, 255, 0.05)",border:r===n?`2px solid ${o}`:"2px solid transparent",borderRadius:8,color:"white",cursor:"pointer",fontSize:14,fontWeight:r===n?"bold":"normal",display:"flex",alignItems:"center",gap:6,transition:"all 0.2s",transform:r===n?"scale(1.05)":"scale(1)"},onMouseEnter:l=>{r!==n&&(l.currentTarget.style.background="rgba(255, 255, 255, 0.1)",l.currentTarget.style.transform="scale(1.02)")},onMouseLeave:l=>{r!==n&&(l.currentTarget.style.background="rgba(255, 255, 255, 0.05)",l.currentTarget.style.transform="scale(1)")},children:[s.jsx("span",{style:{fontSize:18},children:i}),s.jsx("span",{children:a})]},n))})}function ja({mode:r}){const{tool:e,setTool:t,brushTerrain:n,setBrushTerrain:a,brushSize:i,setBrushSize:o,selectedIcon:l}=Q(),c=()=>{switch(r){case"structure":return[{tool:"paint",icon:"🖌️",label:"Peindre"},{tool:"select",icon:"👆",label:"Sélectionner"},{tool:"region",icon:"🗺️",label:"Régions"}];case"resources":return[{tool:"place",icon:"📍",label:"Placer"},{tool:"select",icon:"👆",label:"Sélectionner"},{tool:"connect",icon:"🔗",label:"Connecter"},{tool:"delete",icon:"🗑️",label:"Supprimer"}];case"timeline":return[{tool:"select",icon:"👆",label:"Sélectionner"},{tool:"place",icon:"⏰",label:"Événement"}];default:return[]}},d=[{type:"grass",color:"#4ade80",label:"Herbe"},{type:"forest",color:"#16a34a",label:"Forêt"},{type:"mountain",color:"#a8a29e",label:"Montagne"},{type:"water",color:"#3b82f6",label:"Eau"},{type:"desert",color:"#fbbf24",label:"Désert"},{type:"snow",color:"#e0e7ff",label:"Neige"},{type:"lava",color:"#ef4444",label:"Lave"},{type:"void",color:"#1e1b4b",label:"Vide"}];return s.jsxs("div",{style:{width:280,background:"linear-gradient(180deg, #1a1a2e, #16213e)",padding:20,borderRight:"2px solid rgba(102, 126, 234, 0.3)",overflowY:"auto",display:"flex",flexDirection:"column",gap:20},children:[s.jsx("h3",{style:{margin:0,fontSize:18,background:"linear-gradient(45deg, #667eea, #764ba2)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"🎨 Outils"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:c().map(({tool:p,icon:v,label:f})=>s.jsxs("button",{onClick:()=>t(p),title:f,style:{width:60,height:60,background:e===p?"linear-gradient(135deg, #667eea, #764ba2)":"rgba(255, 255, 255, 0.1)",border:e===p?"2px solid #667eea":"2px solid transparent",borderRadius:10,color:"white",cursor:"pointer",fontSize:24,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,transition:"all 0.2s"},children:[v,s.jsx("span",{style:{fontSize:9},children:f})]},p))}),r==="structure"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:14},children:"Terrain"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:d.map(({type:p,color:v,label:f})=>s.jsx("button",{onClick:()=>a(p),title:f,style:{width:50,height:50,background:v,border:n===p?"3px solid white":"1px solid rgba(255, 255, 255, 0.3)",borderRadius:8,cursor:"pointer",position:"relative"},children:n===p&&s.jsx("div",{style:{position:"absolute",top:-8,right:-8,background:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:"✓"})},p))})]}),s.jsxs("div",{children:[s.jsxs("h4",{style:{margin:"0 0 10px 0",fontSize:14},children:["Taille du pinceau: ",i]}),s.jsx("input",{type:"range",min:"1",max:"9",step:"2",value:i,onChange:p=>o(Number(p.target.value)),style:{width:"100%",accentColor:"#667eea"}})]})]}),r==="resources"&&l&&s.jsxs("div",{style:{padding:10,background:"rgba(102, 126, 234, 0.1)",borderRadius:10,border:"1px solid rgba(102, 126, 234, 0.3)"},children:[s.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:14},children:"Icône sélectionnée"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[s.jsx("div",{style:{fontSize:32,width:50,height:50,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255, 255, 255, 0.1)",borderRadius:8},children:l.emoji}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:12,fontWeight:"bold"},children:l.name}),s.jsx("div",{style:{fontSize:10,color:"rgba(255, 255, 255, 0.7)"},children:l.category})]})]})]})]})}function ka(){const{temporal:r,setCurrentDay:e,currentMap:t,simulationRunning:n,startSimulation:a,stopSimulation:i}=Q(),o=(t==null?void 0:t.timeline.maxDays)||100,l=(t==null?void 0:t.timeline.events)||[],c=d=>l.filter(p=>p.day===d);return s.jsxs("div",{style:{height:120,background:"linear-gradient(180deg, rgba(26, 31, 46, 0.95) 0%, rgba(20, 24, 36, 0.9) 100%)",borderTop:"2px solid rgba(102, 126, 234, 0.3)",padding:"10px 20px",display:"flex",flexDirection:"column",gap:10},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:15},children:[s.jsx("h3",{style:{margin:0,fontSize:16,display:"flex",alignItems:"center",gap:8},children:"⏳ Timeline"}),s.jsx("button",{onClick:()=>n?i():a(),style:{padding:"6px 12px",background:n?"linear-gradient(135deg, #f56565, #e53e3e)":"linear-gradient(135deg, #48bb78, #38a169)",border:"none",borderRadius:6,color:"white",cursor:"pointer",fontSize:12,fontWeight:"bold"},children:n?"⏸ Pause":"▶️ Play"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginLeft:"auto"},children:[s.jsxs("span",{style:{fontSize:14},children:["Jour ",r.currentDay," / ",o]}),s.jsxs("div",{style:{display:"flex",gap:5},children:[s.jsx("button",{onClick:()=>e(Math.max(1,r.currentDay-1)),style:{padding:"4px 8px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:4,color:"white",cursor:"pointer",fontSize:16},children:"◀"}),s.jsx("button",{onClick:()=>e(Math.min(o,r.currentDay+1)),style:{padding:"4px 8px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:4,color:"white",cursor:"pointer",fontSize:16},children:"▶"})]})]})]}),s.jsxs("div",{style:{position:"relative",height:40,background:"rgba(0, 0, 0, 0.3)",borderRadius:8,overflow:"hidden"},children:[l.map(d=>{const p=d.day/o*100;return s.jsx("div",{title:`Jour ${d.day}: ${d.name}`,style:{position:"absolute",left:`${p}%`,top:0,width:2,height:"100%",background:"linear-gradient(180deg, transparent, #fbbf24, transparent)",cursor:"pointer"},onClick:()=>e(d.day)},d.id)}),s.jsx("div",{style:{position:"absolute",left:`${r.currentDay/o*100}%`,top:-5,width:4,height:50,background:"linear-gradient(135deg, #667eea, #764ba2)",borderRadius:2,boxShadow:"0 2px 10px rgba(102, 126, 234, 0.5)",transform:"translateX(-50%)"}}),s.jsx("input",{type:"range",min:"1",max:o,value:r.currentDay,onChange:d=>e(Number(d.target.value)),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}})]}),s.jsxs("div",{style:{display:"flex",gap:20,fontSize:11,color:"rgba(255, 255, 255, 0.7)"},children:[s.jsxs("span",{children:["TW: ",r.tw.toFixed(1)]}),s.jsxs("span",{children:["TE: ",r.te.toFixed(1)]}),s.jsxs("span",{children:["Dérive: ",r.drift.toFixed(2)]}),s.jsxs("span",{children:["Dette: ",r.debt.toFixed(2)]}),s.jsxs("span",{children:["Événements aujourd'hui: ",c(r.currentDay).length]})]})]})}function Sa(){const{setMode:r,temporal:e,currentMap:t}=Q();return s.jsxs("div",{style:{width:300,background:"linear-gradient(180deg, #1a1a2e, #16213e)",padding:20,borderLeft:"2px solid rgba(102, 126, 234, 0.3)",display:"flex",flexDirection:"column",gap:20},children:[s.jsx("h3",{style:{margin:0,fontSize:18,background:"linear-gradient(45deg, #f56565, #ed8936)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"🎮 Mode Jeu"}),s.jsxs("div",{style:{padding:15,background:"rgba(245, 101, 101, 0.1)",borderRadius:10,border:"1px solid rgba(245, 101, 101, 0.3)"},children:[s.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:14},children:"Partie en cours"}),s.jsxs("div",{style:{fontSize:12,display:"flex",flexDirection:"column",gap:5},children:[s.jsxs("div",{children:["Map: ",t==null?void 0:t.name]}),s.jsxs("div",{children:["Jour: ",e.currentDay]}),s.jsxs("div",{children:["Ressources: ",(t==null?void 0:t.resources.length)||0]}),s.jsxs("div",{children:["Événements: ",(t==null?void 0:t.timeline.events.length)||0]})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[s.jsx("button",{style:{padding:"12px",background:"linear-gradient(135deg, #48bb78, #38a169)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontWeight:"bold",fontSize:14},children:"⏭️ Fin de Tour"}),s.jsx("button",{style:{padding:"12px",background:"linear-gradient(135deg, #4299e1, #3182ce)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontWeight:"bold",fontSize:14},children:"💾 Sauvegarder"}),s.jsx("button",{onClick:()=>r("resources"),style:{padding:"12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"✏️ Retour à l'édition"})]}),s.jsxs("div",{style:{marginTop:"auto",padding:15,background:"rgba(0, 0, 0, 0.3)",borderRadius:10,fontSize:11},children:[s.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:12},children:"Statistiques"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[s.jsx("div",{children:"FPS: 60"}),s.jsx("div",{children:"Ping: 12ms"}),s.jsx("div",{children:"Joueurs: 1/8"}),s.jsx("div",{children:"Mode: Local"})]})]})]})}function Ca(){const{mode:r,tool:e,currentWorld:t,currentMap:n,zoomLevel:a}=Q(),[i,o]=R.useState(new Date),[l,c]=R.useState({rust:"checking",java:"checking",vector:"checking",ws:"checking"});R.useEffect(()=>{const p=setInterval(()=>o(new Date),1e3);return()=>clearInterval(p)},[]),R.useEffect(()=>{const p=async()=>{fetch("/engine/health").then(m=>c(b=>({...b,rust:m.ok?"online":"offline"}))).catch(()=>c(m=>({...m,rust:"offline"}))),fetch("/api/health").then(m=>c(b=>({...b,java:m.ok?"online":"offline"}))).catch(()=>c(m=>({...m,java:"offline"}))),fetch("/vector/health").then(m=>c(b=>({...b,vector:m.ok?"online":"offline"}))).catch(()=>c(m=>({...m,vector:"offline"})));const f=new WebSocket("ws://localhost:8001");f.onopen=()=>{c(m=>({...m,ws:"online"})),f.close()},f.onerror=()=>c(m=>({...m,ws:"offline"}))};p();const v=setInterval(p,3e4);return()=>clearInterval(v)},[]);const d=p=>{switch(p){case"online":return"#48bb78";case"offline":return"#f56565";case"checking":return"#fbbf24";default:return"#a0aec0"}};return s.jsxs("footer",{style:{height:30,background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(0, 0, 0, 0.9) 100%)",borderTop:"1px solid rgba(102, 126, 234, 0.2)",padding:"0 20px",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:11,color:"rgba(255, 255, 255, 0.7)"},children:[s.jsxs("div",{style:{display:"flex",gap:15},children:[s.jsxs("span",{children:["Mode: ",s.jsx("strong",{style:{color:"#667eea"},children:r})]}),s.jsxs("span",{children:["Outil: ",s.jsx("strong",{children:e})]}),s.jsxs("span",{children:["Zoom: ",s.jsxs("strong",{children:[(a*100).toFixed(0),"%"]})]})]}),s.jsxs("div",{style:{display:"flex",gap:15},children:[t&&s.jsxs("span",{children:["🌍 ",t.name]}),n&&s.jsxs("span",{children:["🗺️ ",n.name]})]}),s.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[Object.entries(l).map(([p,v])=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[s.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:d(v),boxShadow:v==="online"?`0 0 4px ${d(v)}`:"none"}}),s.jsx("span",{style:{textTransform:"uppercase",fontSize:10},children:p})]},p)),s.jsx("span",{style:{marginLeft:10,color:"rgba(255, 255, 255, 0.5)"},children:i.toLocaleTimeString()})]})]})}const at=class at{constructor(){Y(this,"heroes",new Map);Y(this,"creatures",new Map);Y(this,"artifacts",new Map);Y(this,"formulas",new Map);Y(this,"audioMappings",{});Y(this,"loaded",!1);Y(this,"ASSETS_DATA",{heroes:{jean_grofignon_complete:{id:"jean_grofignon_complete",name:"Jean Grofignon",icon:"🚬",category:"COSMIC",sound_hover:"deep_magic",sound_activate:"quantum_beep",voice_type:"cosmic_chill",theme_color:"#FFD700",visual_effects:["cosmic_particles","joint_smoke","canapé_glow"],backstory:"Le fumeur cosmique qui comprend tout depuis son canapé",stats:{power:99,knowledge:99,temporal:99,quantum:99}},arthur_pendragon:{id:"arthur_pendragon",name:"Arthur Pendragon",icon:"⚔️",category:"LEGENDARY",sound_hover:"metal_clang",sound_activate:"power_up",voice_type:"commanding_noble",theme_color:"#C0A080",visual_effects:["golden_aura","excalibur_glow","royal_particles"],backstory:"Le roi légendaire avec Excalibur Ultimate",stats:{power:95,knowledge:70,temporal:60,quantum:50}},merlin_wizard:{id:"merlin_wizard",name:"Merlin",icon:"🧙‍♂️",category:"LEGENDARY",sound_hover:"mystical_harmonics",sound_activate:"deep_magic",voice_type:"ethereal_wise",theme_color:"#4A90E2",visual_effects:["dragon_transformation","elemental_swirl","wisdom_glow"],backstory:"Le mage légendaire qui peut se transformer en dragon",stats:{power:80,knowledge:99,temporal:90,quantum:85}},grokaen_architect:{id:"grokaen_architect",name:"GROKÆN",icon:"🏗️",category:"HOME_MAGES",sound_hover:"electronic_buzz",sound_activate:"hexagon_activation",voice_type:"system_architect",theme_color:"#00FFFF",visual_effects:["6d_architecture","magic_stack_build","formula_cascade"],backstory:"L'architecte temporel créateur de la Magic Stack",stats:{power:75,knowledge:95,temporal:99,quantum:90}},anna_sorceress:{id:"anna_sorceress",name:"Anna",icon:"⏰",category:"PARADOXAL",sound_hover:"ice_crack",sound_activate:"deep_magic",voice_type:"temporal_power",theme_color:"#9932CC",visual_effects:["time_nexus","power_swirl","temporal_aura"],backstory:"La gardienne du Nexus Temporel",stats:{power:85,knowledge:80,temporal:99,quantum:70}}},creatures:{red_dragon:{id:"red_dragon",name:"Dragon Rouge",icon:"🐲",category:"EPIC",tier:7,sound_hover:"fire_whoosh",sound_activate:"power_up",theme_color:"#FF0000",visual_effects:["fire_breath","wing_flap","treasure_guard"],abilities:["Fire Breath","Fear Aura","Fly"]},phoenix:{id:"phoenix",name:"Phénix",icon:"🔥",category:"QUANTUM",tier:6,sound_hover:"fire_whoosh",sound_activate:"mystical_harmonics",theme_color:"#FF6347",visual_effects:["fire_aura","rebirth_flames","eternal_flight"],abilities:["Rebirth","Fire Immunity","Quantum Phase"]},unicorn:{id:"unicorn",name:"Licorne",icon:"🦄",category:"EPIC",tier:5,sound_hover:"crystalline",sound_activate:"mystical_harmonics",theme_color:"#E6E6FA",visual_effects:["horn_glow","purification_light","healing_aura"],abilities:["Purify","Heal","Magic Resistance"]},archangel:{id:"archangel",name:"Archange",icon:"👼",category:"EPIC",tier:7,sound_hover:"ancient_resonance",sound_activate:"crystalline",theme_color:"#FFD700",visual_effects:["divine_light","golden_wings","resurrection_glow"],abilities:["Resurrect","Divine Shield","Fly"]}},artifacts:{excalibur_ultimate:{id:"excalibur_ultimate",name:"Excalibur Ultimate",icon:"⚔️",category:"LEGENDARY",tier:5,sound_hover:"metal_clang",sound_activate:"power_up",theme_color:"#FFD700",visual_effects:["golden_glow","power_surge"],effects:["+25 Power","Ignore Defense","Temporal Strike"]},cosmic_chaos_resolution:{id:"cosmic_chaos_resolution",name:"Résolution du Chaos Cosmique",icon:"🌌",category:"COSMIC",tier:5,sound_hover:"quantum_beep",sound_activate:"deep_magic",theme_color:"#9400D3",visual_effects:["reality_warp","cosmic_swirl"],effects:["Reality Control","Paradox Immunity","Quantum Mastery"]},tesseract_prison:{id:"tesseract_prison",name:"Prison Tesseract",icon:"🔷",category:"QUATRIEME_MUR",tier:4,sound_hover:"electronic_buzz",sound_activate:"quantum_beep",theme_color:"#00CED1",visual_effects:["4d_rotation","spatial_lock"],effects:["Dimensional Prison","Space Fold","Quantum Lock"]}},formulas:{temporal_shift:{id:"temporal_shift",name:"Décalage Temporel",category:"temporal",formula:"Ψ(t) = Ψ₀ × e^(iωt) × R(Δt)",description:"Déplace une entité dans le temps",cost:20},quantum_collapse:{id:"quantum_collapse",name:"Effondrement Quantique",category:"quantum",formula:"|Ψ⟩ = Σ(α_i|i⟩) → |n⟩",description:"Force une superposition à s'effondrer",cost:30},causal_fork:{id:"causal_fork",name:"Fourche Causale",category:"causal",formula:"C(t₁→t₂) = ∫P(ξ)dξ × Θ(t₂-t₁)",description:"Crée une bifurcation dans la causalité",cost:40},energy_complex:{id:"energy_complex",name:"Énergie Complexe",category:"energy",formula:"E = A × e^(iΦ) + ∇²Ψ",description:"Manipule l'énergie en amplitude et phase",cost:25}}})}async initialize(){this.loaded||(Object.entries(this.ASSETS_DATA.heroes).forEach(([e,t])=>{this.heroes.set(e,t)}),Object.entries(this.ASSETS_DATA.creatures).forEach(([e,t])=>{this.creatures.set(e,t)}),Object.entries(this.ASSETS_DATA.artifacts).forEach(([e,t])=>{this.artifacts.set(e,t)}),Object.entries(this.ASSETS_DATA.formulas).forEach(([e,t])=>{this.formulas.set(e,t)}),this.loaded=!0,console.log("✅ Assets loaded:",{heroes:this.heroes.size,creatures:this.creatures.size,artifacts:this.artifacts.size,formulas:this.formulas.size}))}getHero(e){return this.heroes.get(e)}getAllHeroes(){return Array.from(this.heroes.values())}getCreature(e){return this.creatures.get(e)}getAllCreatures(){return Array.from(this.creatures.values())}getArtifact(e){return this.artifacts.get(e)}getAllArtifacts(){return Array.from(this.artifacts.values())}getFormula(e){return this.formulas.get(e)}getAllFormulas(){return Array.from(this.formulas.values())}getFormulasByCategory(e){return Array.from(this.formulas.values()).filter(t=>t.category===e)}getAllIcons(){const e=[];return this.heroes.forEach(t=>{e.push({emoji:t.icon,name:t.name,category:"👥 Héros"})}),this.creatures.forEach(t=>{e.push({emoji:t.icon,name:t.name,category:"🐉 Créatures"})}),this.artifacts.forEach(t=>{e.push({emoji:t.icon,name:t.name,category:"💎 Artefacts"})}),e}search(e){const t=e.toLowerCase();return{heroes:Array.from(this.heroes.values()).filter(n=>{var a;return n.name.toLowerCase().includes(t)||((a=n.backstory)==null?void 0:a.toLowerCase().includes(t))}),creatures:Array.from(this.creatures.values()).filter(n=>{var a;return n.name.toLowerCase().includes(t)||((a=n.abilities)==null?void 0:a.some(i=>i.toLowerCase().includes(t)))}),artifacts:Array.from(this.artifacts.values()).filter(n=>{var a;return n.name.toLowerCase().includes(t)||((a=n.effects)==null?void 0:a.some(i=>i.toLowerCase().includes(t)))}),formulas:Array.from(this.formulas.values()).filter(n=>{var a;return n.name.toLowerCase().includes(t)||((a=n.description)==null?void 0:a.toLowerCase().includes(t))})}}static getPortal(e){return at.portals.get(e)}static getAllPortals(){return Array.from(at.portals.entries()).map(([e,t])=>({id:e,...t,category:"portal"}))}};Y(at,"portals",new Map([["portal_avalon",{name:"Portail Avalon",icon:"🌀",type:"dimensional"}],["portal_pocket",{name:"Portail de Poche",icon:"🌌",type:"pocket_world"}],["portal_temporal",{name:"Portail Temporel",icon:"⏳",type:"temporal"}]]));let fr=at;const wt=new fr,Ta=Object.freeze(Object.defineProperty({__proto__:null,AssetsService:wt},Symbol.toStringTag,{value:"Module"}));function Ra(){const{currentWorld:r,currentMap:e,temporal:t,setMode:n}=Q(),[a,i]=R.useState({entities:[],resources:(e==null?void 0:e.initial_state.resources)||{gold:1e3,crystals:100,energy:50,temporal:25,quantum:10},temporal:{...t,tw:(e==null?void 0:e.initial_state.tw)||0,te:(e==null?void 0:e.initial_state.te)||0},turn:1,activePlayer:0}),[o,l]=R.useState(null),[c,d]=R.useState(!0);R.useEffect(()=>{wt.initialize()},[]),R.useEffect(()=>{if(!e)return;const f=e.resources.map(m=>{let b;if(m.type==="hero"){const h=wt.getHero(m.subtype);h&&(b=h.stats)}else if(m.type==="creature"){const h=wt.getCreature(m.subtype);h&&(b={tier:h.tier})}return{id:m.id,type:m.type,position:{x:m.position_6d.x,y:m.position_6d.y,z:m.position_6d.z},icon:m.emoji,name:m.name,owner:0,stats:b}});i(m=>({...m,entities:f}))},[e]),R.useEffect(()=>{if(!e)return;e.timeline.events.filter(m=>{if(m.day===a.temporal.currentDay)return!0;if(m.repeat){const b=a.temporal.currentDay-m.day;if(b>0&&b%m.repeat.interval===0&&(!m.repeat.times||b/m.repeat.interval<=m.repeat.times))return!0}return!1}).forEach(m=>{var b;if(console.log(`🎯 Événement jour ${a.temporal.currentDay}: ${m.name}`),(b=m.action)!=null&&b.spawn){const h=m.action.spawn.map(u=>({id:u.id,type:u.type,position:{x:u.position_6d.x,y:u.position_6d.y,z:u.position_6d.z},icon:u.emoji,name:u.name,owner:0}));i(u=>({...u,entities:[...u.entities,...h]}))}})},[a.temporal.currentDay,e]);const p=()=>{i(f=>({...f,turn:f.turn+1,temporal:{...f.temporal,currentDay:f.temporal.currentDay+1,tw:f.temporal.tw+1,te:f.temporal.te+.95,drift:Math.abs(f.temporal.tw+1-(f.temporal.te+.95))},resources:{...f.resources,gold:f.resources.gold+100,crystals:f.resources.crystals+10,energy:Math.min(100,f.resources.energy+10)}}))},v=(f,m,b)=>{i(h=>({...h,entities:h.entities.map(u=>u.id===f?{...u,position:{...u.position,x:m,y:b}}:u)}))};return!r||!e?s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)"},children:s.jsxs("div",{style:{textAlign:"center",color:"white"},children:[s.jsx("h2",{children:"Aucune map à jouer !"}),s.jsx("button",{onClick:()=>n("structure"),style:{marginTop:20,padding:"12px 24px",background:"linear-gradient(135deg, #667eea, #764ba2)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontSize:16},children:"Retour à l'éditeur"})]})}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#0a0e1a"},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.9) 100%)",borderBottom:"1px solid rgba(102, 126, 234, 0.3)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[s.jsxs("h2",{style:{margin:0,fontSize:20,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:["🎮 ",e.name]}),s.jsxs("span",{style:{color:"rgba(255,255,255,0.6)",fontSize:14},children:["Tour ",a.turn," • Jour ",a.temporal.currentDay]})]}),s.jsx(It,{temporal:a.temporal,variant:"compact",showEnergy:!0})]}),s.jsx("div",{style:{padding:"0 20px",background:"rgba(20, 24, 36, 0.5)"},children:s.jsx(Dt,{resources:a.resources,maxValues:{gold:9999,crystals:999,energy:100,temporal:100,quantum:50},variant:"horizontal"})}),s.jsxs("main",{style:{flex:1,position:"relative",overflow:"hidden",display:"flex"},children:[s.jsxs("div",{style:{flex:1,position:"relative",background:"radial-gradient(circle at center, rgba(102, 126, 234, 0.05) 0%, rgba(0, 0, 0, 0.3) 100%)"},children:[r&&s.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:.3},children:s.jsx(Nt,{width:r.dimensions.width,height:r.dimensions.height,onHexClick:(f,m)=>{o&&(v(o.id,f*60,m*60),l(null))}})}),a.entities.map(f=>s.jsx("div",{onClick:()=>l(f),style:{position:"absolute",left:f.position.x,top:f.position.y,width:50,height:50,fontSize:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",background:(o==null?void 0:o.id)===f.id?"radial-gradient(circle, rgba(102, 126, 234, 0.5), transparent)":"transparent",border:(o==null?void 0:o.id)===f.id?"2px solid #667eea":"none",borderRadius:"50%",transition:"all 0.2s",transform:f.position.z?`translateZ(${f.position.z*10}px)`:void 0},title:f.name,children:f.icon},f.id))]}),s.jsxs("aside",{style:{width:300,background:"linear-gradient(180deg, #1a1a2e, #16213e)",padding:20,borderLeft:"2px solid rgba(102, 126, 234, 0.3)",overflowY:"auto"},children:[o?s.jsxs("div",{children:[s.jsxs("h3",{style:{fontSize:18,marginBottom:15,background:"linear-gradient(45deg, #667eea, #764ba2)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:[o.icon," ",o.name]}),s.jsxs("div",{style:{fontSize:12,color:"rgba(255,255,255,0.7)"},children:[s.jsxs("div",{children:["Type: ",o.type]}),s.jsxs("div",{children:["Position: (",o.position.x,", ",o.position.y,")"]}),o.stats&&s.jsxs("div",{style:{marginTop:10},children:[s.jsx("div",{children:"Stats:"}),Object.entries(o.stats).map(([f,m])=>s.jsxs("div",{style:{marginLeft:10},children:[f,": ",m]},f))]})]}),s.jsx("button",{onClick:()=>l(null),style:{marginTop:15,padding:"8px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:6,color:"white",cursor:"pointer",fontSize:12,width:"100%"},children:"Désélectionner"})]}):s.jsx("div",{style:{color:"rgba(255,255,255,0.5)",fontSize:14},children:"Cliquez sur une entité pour la sélectionner"}),e.victory_conditions.length>0&&s.jsxs("div",{style:{marginTop:30},children:[s.jsx("h4",{style:{fontSize:14,marginBottom:10},children:"Conditions de victoire"}),e.victory_conditions.map((f,m)=>s.jsx("div",{style:{padding:8,background:"rgba(72, 187, 120, 0.1)",borderRadius:6,marginBottom:8,fontSize:12,color:"rgba(255,255,255,0.8)"},children:f.description},m))]})]})]}),s.jsxs("footer",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"rgba(20, 24, 36, 0.9)",borderTop:"1px solid rgba(102, 126, 234, 0.3)"},children:[s.jsxs("div",{style:{display:"flex",gap:10},children:[s.jsx("button",{onClick:p,style:{padding:"10px 20px",background:"linear-gradient(135deg, #48bb78, #38a169)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontWeight:"bold",fontSize:14},children:"⏭️ Fin de Tour"}),s.jsx("button",{onClick:()=>d(!c),style:{padding:"10px 20px",background:c?"linear-gradient(135deg, #f56565, #e53e3e)":"linear-gradient(135deg, #4299e1, #3182ce)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:c?"⏸ Pause":"▶️ Reprendre"})]}),s.jsx("button",{onClick:()=>n("resources"),style:{padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"✏️ Retour à l'éditeur"})]})]})}const wn=R.lazy(()=>Qe(()=>import("./MapIconPlacerV2-kN9m4EEZ.js"),__vite__mapDeps([0,1,2,3,4])).then(r=>({default:r.default}))),Ea=R.lazy(()=>Qe(()=>import("./SpatioTemporalMapEditor-iDnuxLV4.js"),__vite__mapDeps([5,1,2,3])).then(r=>({default:r.SpatioTemporalMapEditor})));function Ma(){const{mode:r,setMode:e,currentWorld:t,currentMap:n,temporal:a,showGrid:i,showRegions:o,showConnections:l,showTimeline:c,zoomLevel:d,newWorld:p,newMap:v,exportToFile:f,playMap:m,canPlayMap:b}=Q();R.useEffect(()=>{Qe(async()=>{const{AssetsService:u}=await Promise.resolve().then(()=>Ta);return{AssetsService:u}},void 0).then(({AssetsService:u})=>{u.initialize()})},[]),R.useEffect(()=>{t||(console.log("Creating default world..."),p("Nouveau Monde",20,20))},[t,p]),R.useEffect(()=>{t&&!n&&(console.log("Creating default map..."),v("Nouvelle Map"))},[t,n,v]);const h=()=>{switch(r){case"structure":return s.jsx(pr,{});case"resources":return s.jsx(R.Suspense,{fallback:s.jsx(Ur,{}),children:s.jsx(wn,{onPlace:u=>{Q.getState().placeResource(u.position_6d.x,u.position_6d.y)},onUpdate:(u,g)=>{Q.getState().updateResource(u,g)},onDelete:u=>{Q.getState().deleteResource(u)},onConnect:(u,g,_)=>{Q.getState().createConnection(u,g,_)}})});case"timeline":return s.jsx(R.Suspense,{fallback:s.jsx(Ur,{}),children:s.jsx(Oa,{})});case"play":return s.jsx(Ra,{});case"overlay":return s.jsx(Pa,{});default:return s.jsx(pr,{})}};return s.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)",color:"white",overflow:"hidden"},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",background:"linear-gradient(180deg, rgba(20, 24, 36, 0.95) 0%, rgba(26, 31, 46, 0.9) 100%)",borderBottom:"2px solid rgba(102, 126, 234, 0.5)",boxShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[s.jsx("h1",{style:{fontSize:24,fontWeight:"bold",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",margin:0},children:"🎮 Unified Map System"}),s.jsx(wa,{currentMode:r,onModeChange:e})]}),s.jsxs("div",{style:{display:"flex",gap:10},children:[s.jsx("button",{onClick:()=>p("Nouveau Monde",50,50),style:{padding:"8px 16px",background:"rgba(102, 126, 234, 0.2)",border:"1px solid rgba(102, 126, 234, 0.5)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"🆕 Nouveau World"}),s.jsx("button",{onClick:async()=>{Q.getState().currentMap&&await Q.getState().saveMap()},style:{padding:"8px 16px",background:"rgba(72, 187, 120, 0.2)",border:"1px solid rgba(72, 187, 120, 0.5)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"💾 Save Map"}),s.jsx("button",{onClick:async()=>{const{local:u}=await Fe.listMaps();if(u&&u.length>0){const g=u[u.length-1];Q.getState().loadMap(g)}},style:{padding:"8px 16px",background:"rgba(66, 153, 225, 0.2)",border:"1px solid rgba(66, 153, 225, 0.5)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"⤓ Load Last"}),s.jsx("button",{onClick:f,style:{padding:"8px 16px",background:"rgba(102, 126, 234, 0.2)",border:"1px solid rgba(102, 126, 234, 0.5)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"💾 Export"}),b()&&s.jsx("button",{onClick:m,style:{padding:"8px 20px",background:"linear-gradient(135deg, #48bb78 0%, #38a169 100%)",border:"none",borderRadius:8,color:"white",cursor:"pointer",fontWeight:"bold",fontSize:14,boxShadow:"0 2px 8px rgba(72, 187, 120, 0.3)"},children:"▶️ PLAY THIS MAP"}),b()&&s.jsx("button",{onClick:async()=>{var _;const g=Q.getState().currentMap;if(g)for(const y of g.resources)try{await nr.upsertEntity({id:y.id,position:{x:y.position_6d.x,y:y.position_6d.y},te:((_=y.temporal)==null?void 0:_.te)??g.initial_state.te,energy_complex:y.energy_complex?{A:y.energy_complex.A,phi:y.energy_complex.phi}:{A:50,phi:0}})}catch{}},style:{padding:"8px 16px",background:"rgba(237, 137, 54, 0.2)",border:"1px solid rgba(237, 137, 54, 0.5)",borderRadius:8,color:"white",cursor:"pointer",fontSize:14},children:"🔄 Sync to Engine"})]})]}),s.jsxs("div",{style:{flex:1,display:"flex",position:"relative",overflow:"hidden"},children:[r!=="play"&&s.jsx(ja,{mode:r}),s.jsx("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:h()}),r==="play"&&s.jsx(Sa,{})]}),c&&s.jsx(ka,{}),s.jsx(Ca,{})]})}function Aa(){return Q(),s.jsx("div",{style:{width:"100%",height:"100%"},children:s.jsx(wn,{})})}function Oa(){var e,t;const r=Q();return s.jsx(Ea,{mapWidth:((e=r.currentWorld)==null?void 0:e.dimensions.width)||50,mapHeight:((t=r.currentWorld)==null?void 0:t.dimensions.height)||50,currentDay:r.temporal.currentDay,onEventPlace:n=>{r.addEvent({day:n.time,type:"spawn",name:n.entity.name,description:`${n.entity.name} apparaît`,action:{spawn:[{id:n.id,type:n.entity.type,subtype:n.entity.id,emoji:n.entity.icon,name:n.entity.name,position_6d:{x:n.x,y:n.y,z:n.z||0,t:n.time,c:0,psi:0}}]}})}})}function Pa(){return s.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:.5},children:s.jsx(pr,{})}),s.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:.7,pointerEvents:"none"},children:s.jsx(R.Suspense,{fallback:null,children:s.jsx(Aa,{})})}),s.jsxs("div",{style:{position:"absolute",top:10,right:10,background:"rgba(0,0,0,0.8)",padding:15,borderRadius:10,border:"1px solid rgba(102, 126, 234, 0.5)"},children:[s.jsx("h3",{style:{margin:0,marginBottom:10},children:"Mode Overlay"}),s.jsx("p",{style:{margin:0,fontSize:12,color:"rgba(255,255,255,0.7)"},children:"Tous les layers visibles"})]})]})}function Ur(){return s.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("div",{style:{fontSize:24,color:"rgba(255,255,255,0.5)"},children:"Chargement..."})})}const Na=()=>{const r=R.useRef(null),[e,t]=R.useState(!1),[n,a]=R.useState(null),[i,o]=R.useState(!1),[l,c]=R.useState("disconnected"),d="/demos/experimental/IA_VS_IA_AUTOPLAY.html";R.useEffect(()=>{if(!r.current)return;const b=async u=>{if(u.data.type==="battle-event"){const g=u.data.payload;i&&await p(g),console.log("Battle Event:",g)}else u.data.type==="battle-state"&&a(u.data.payload)};return window.addEventListener("message",b),(()=>{const u=r.current;if(u!=null&&u.contentWindow)try{u.onload=()=>{const g=u.contentWindow;if(!g)return;const _=g.document.createElement("script");_.textContent=`
                        // Sauvegarder les fonctions originales
                        const originalPerformAttack = window.performAttack;
                        const originalPerformSpell = window.performSpecialSpell;
                        const originalGameTick = window.gameTick;
                        
                        // Surcharger pour envoyer des messages au parent
                        window.performAttack = function(iaNumber, type) {
                            const result = originalPerformAttack.apply(this, arguments);
                            
                            // Envoyer l'événement au parent React
                            window.parent.postMessage({
                                type: 'battle-event',
                                payload: {
                                    type: 'attack',
                                    source: iaNumber === 1 ? 'ia1' : 'ia2',
                                    target: iaNumber === 1 ? 'ia2' : 'ia1',
                                    spell: type
                                }
                            }, '*');
                            
                            return result;
                        };
                        
                        window.performSpecialSpell = function(iaNumber, spellType) {
                            const result = originalPerformSpell.apply(this, arguments);
                            
                            // Envoyer l'événement au parent React
                            window.parent.postMessage({
                                type: 'battle-event',
                                payload: {
                                    type: 'spell',
                                    source: iaNumber === 1 ? 'ia1' : 'ia2',
                                    spell: spellType,
                                    formula: window.spells[spellType]?.formula
                                }
                            }, '*');
                            
                            return result;
                        };
                        
                        // Envoyer l'état à chaque tick
                        window.gameTick = function() {
                            const result = originalGameTick.apply(this, arguments);
                            
                            window.parent.postMessage({
                                type: 'battle-state',
                                payload: window.gameState
                            }, '*');
                            
                            return result;
                        };
                        
                        console.log('🌉 Bridge V2 API injecté avec succès');
                    `,g.document.head.appendChild(_),t(!0)}}catch(g){console.error("Erreur injection bridge:",g)}})(),()=>{window.removeEventListener("message",b)}},[i]),R.useEffect(()=>{if(!i)return;(async()=>{c("connecting");try{const{V2Adapter:h}=await Qe(async()=>{const{V2Adapter:u}=await Promise.resolve().then(()=>sr);return{V2Adapter:u}},void 0);await h.connectWebSocket(),c("connected"),console.log("✅ Connecté aux API V2")}catch(h){console.error("Erreur connexion V2:",h),c("disconnected")}})()},[i]);const p=async b=>{try{const h={type:"COMBAT_ACTION",timestamp:Date.now(),data:{action:b.type,source:b.source,target:b.target,value:b.damage,formula:b.formula,position:b.position||{x:0,y:0,z:0,t:Date.now(),c:0,psi:0}}},u=await fetch("http://localhost:3001/api/v2/combat/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(u.ok){const g=await u.json();console.log("V2 Response:",g),g.ai_action&&v(g.ai_action)}}catch(h){console.error("Erreur envoi V2:",h)}},v=b=>{var h;(h=r.current)!=null&&h.contentWindow&&r.current.contentWindow.postMessage({type:"execute-action",payload:b},"*")},f=()=>{var b,h,u;o(!0),(b=r.current)!=null&&b.contentWindow&&((u=(h=r.current.contentWindow).startBattle)==null||u.call(h))},m=()=>{var b,h,u;o(!1),(b=r.current)!=null&&b.contentWindow&&((u=(h=r.current.contentWindow).startBattle)==null||u.call(h))};return s.jsxs("div",{className:"ai-battle-wrapper",children:[s.jsxs("div",{className:"battle-controls",children:[s.jsxs("div",{className:"control-panel",children:[s.jsx("h2",{children:"🤖 Mode Combat IA vs IA"}),s.jsxs("div",{className:"mode-selector",children:[s.jsx("button",{className:`mode-btn ${i?"":"active"}`,onClick:()=>o(!1),children:"Mode Local (HTML Original)"}),s.jsx("button",{className:`mode-btn ${i?"active":""}`,onClick:()=>o(!0),children:"Mode V2 API (Backend Rust)"})]}),i&&s.jsxs("div",{className:"v2-status",children:[s.jsx("span",{className:`status-indicator ${l}`,children:l==="connected"?"🟢":l==="connecting"?"🟡":"🔴"}),s.jsxs("span",{children:["Backend V2: ",l]})]}),s.jsxs("div",{className:"action-buttons",children:[s.jsx("button",{className:"action-btn start",onClick:f,disabled:i&&l!=="connected",children:"▶️ Démarrer avec V2"}),s.jsx("button",{className:"action-btn start-local",onClick:m,children:"▶️ Démarrer en Local"})]}),n&&s.jsxs("div",{className:"battle-info",children:[s.jsx("h3",{children:"État du Combat"}),s.jsxs("div",{className:"info-grid",children:[s.jsxs("div",{children:["Round: ",n.round]}),s.jsxs("div",{children:["Scénario: ",n.scenario]}),s.jsxs("div",{children:["IA1 HP: ",n.ia1.hp]}),s.jsxs("div",{children:["IA2 HP: ",n.ia2.hp]})]})]})]}),s.jsx("div",{className:"bridge-status",children:s.jsx("span",{className:`bridge-indicator ${e?"connected":"disconnected"}`,children:e?"🌉 Bridge actif":"🚫 Bridge inactif"})})]}),s.jsx("div",{className:"battle-iframe-container",children:s.jsx("iframe",{ref:r,src:d,title:"IA vs IA Battle",className:"battle-iframe",sandbox:"allow-same-origin allow-scripts"})})]})},Ia=()=>{const r=R.useRef(null),[e,t]=R.useState(!1),[n,a]=R.useState({x:0,y:0,z:0,t:0,c:0,psi:0}),[i,o]=R.useState(!1),[l,c]=R.useState("disconnected"),[d,p]=R.useState({day:1,week:1,month:1,resources:{gold:1e3,wood:20,ore:20,gems:10,temporalEnergy:100}}),v="/CHASSE_TEMPORELLE_MEGA_MAP.html";R.useEffect(()=>{if(!r.current)return;const h=async g=>{if(g.data.type==="map-event"){const _=g.data.payload;i&&await f(_),_.position&&a(_.position),console.log("Map Event:",_)}else g.data.type==="game-state"&&p(g.data.payload)};return window.addEventListener("message",h),(()=>{const g=r.current;g!=null&&g.contentWindow&&(g.onload=()=>{const _=g.contentWindow;if(!_)return;const y=_.document.createElement("script");y.textContent=`
                    // Bridge V2 pour CHASSE TEMPORELLE
                    console.log('🌉 Bridge Chasse Temporelle V2 initialisé');
                    
                    // Intercepter les mouvements de la map
                    const originalHandleHexClick = window.handleHexClick || function() {};
                    window.handleHexClick = function(x, y) {
                        const result = originalHandleHexClick.apply(this, arguments);
                        
                        // Envoyer l'événement au parent React
                        window.parent.postMessage({
                            type: 'map-event',
                            payload: {
                                type: 'move',
                                position: {
                                    x: x,
                                    y: y,
                                    z: 0,
                                    t: Date.now(),
                                    c: 0,
                                    psi: Math.random()
                                }
                            }
                        }, '*');
                        
                        return result;
                    };
                    
                    // Intercepter les portails temporels
                    const originalOpenPortal = window.openPortal || function() {};
                    window.openPortal = function(portalData) {
                        const result = originalOpenPortal.apply(this, arguments);
                        
                        window.parent.postMessage({
                            type: 'map-event',
                            payload: {
                                type: 'portal',
                                position: portalData.position,
                                value: portalData
                            }
                        }, '*');
                        
                        return result;
                    };
                    
                    // Envoyer l'état du jeu périodiquement
                    setInterval(() => {
                        if (window.gameState) {
                            window.parent.postMessage({
                                type: 'game-state',
                                payload: window.gameState
                            }, '*');
                        }
                    }, 1000);
                `,_.document.head.appendChild(y),t(!0)})})(),()=>{window.removeEventListener("message",h)}},[i]),R.useEffect(()=>{if(!i)return;(async()=>{c("connecting");try{const{V2Adapter:u}=await Qe(async()=>{const{V2Adapter:_}=await Promise.resolve().then(()=>sr);return{V2Adapter:_}},void 0);await u.connectWebSocket();const g=setInterval(async()=>{const _=await u.tick(n);if(console.log("⏰ Tick V2:",_),_.drift){const y=await u.calculateDrift([n]);console.log("🌀 Dérive temporelle:",y)}},100);return c("connected"),console.log("✅ Connecté aux API V2 avec tick temporel"),()=>clearInterval(g)}catch(u){console.error("Erreur connexion V2:",u),c("disconnected")}})()},[i,n]);const f=async h=>{var u;try{const{V2Adapter:g}=await Qe(async()=>{const{V2Adapter:E}=await Promise.resolve().then(()=>sr);return{V2Adapter:E}},void 0),_={type:"MAP_ACTION",timestamp:Date.now(),data:{action:h.type,position:h.position,entity:h.entity,value:h.value}},y=await g.calculateComplexEnergy({position:h.position,type:"hero"});if(console.log("⚡ Énergie complexe:",y),h.type==="temporal_shift"){const E=await g.detectParadoxes([h.position]);console.log("⚠️ Détection paradoxes:",E),((u=E.paradoxes)==null?void 0:u.length)>0&&await g.activateVince({position:h.position,severity:"high"})}const j=await fetch("http://localhost:3001/api/v2/map/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(j.ok){const E=await j.json();console.log("V2 Response:",E)}}catch(g){console.error("Erreur envoi V2:",g)}},m=(h,u,g)=>{var _;(_=r.current)!=null&&_.contentWindow&&(r.current.contentWindow.postMessage({type:"teleport",payload:{x:h,y:u,t:g||Date.now()}},"*"),a(y=>({...y,x:h,y:u,t:g||y.t})))},b=()=>{var h;(h=r.current)!=null&&h.contentWindow&&r.current.contentWindow.postMessage({type:"time-travel",payload:{active:!0}},"*")};return s.jsxs("div",{className:"chasse-mega-wrapper",children:[s.jsxs("div",{className:"chasse-controls",children:[s.jsxs("div",{className:"control-header",children:[s.jsx("h2",{children:"⚔️ CHASSE TEMPORELLE - Map Méga 6x6"}),s.jsxs("div",{className:"mode-selector",children:[s.jsx("button",{className:`mode-btn ${i?"":"active"}`,onClick:()=>o(!1),children:"Mode Local"}),s.jsx("button",{className:`mode-btn ${i?"active":""}`,onClick:()=>o(!0),children:"Mode V2 API (Navigation 6D)"})]}),i&&s.jsxs("div",{className:"v2-indicators",children:[s.jsx("span",{className:`indicator ${l}`,children:l==="connected"?"🟢":l==="connecting"?"🟡":"🔴"}),s.jsxs("span",{children:["WebSocket: ",l]}),s.jsx("span",{className:"tick-indicator",children:"⏰ Tick 100ms"})]})]}),s.jsxs("div",{className:"position-display",children:[s.jsx("h3",{children:"Position 6D"}),s.jsxs("div",{className:"coords-grid",children:[s.jsxs("div",{children:["X: ",n.x]}),s.jsxs("div",{children:["Y: ",n.y]}),s.jsxs("div",{children:["Z: ",n.z]}),s.jsxs("div",{children:["T: ",new Date(n.t).toLocaleTimeString()]}),s.jsxs("div",{children:["C: ",n.c.toFixed(2)]}),s.jsxs("div",{children:["Ψ: ",n.psi.toFixed(3)]})]})]}),s.jsxs("div",{className:"game-stats",children:[s.jsx("h3",{children:"État du Jeu"}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{children:["🗓️ Jour ",d.day,", Semaine ",d.week]}),s.jsxs("div",{children:["💰 Or: ",d.resources.gold]}),s.jsxs("div",{children:["🌲 Bois: ",d.resources.wood]}),s.jsxs("div",{children:["⛏️ Minerai: ",d.resources.ore]}),s.jsxs("div",{children:["💎 Gemmes: ",d.resources.gems]}),s.jsxs("div",{children:["⚡ Énergie: ",d.resources.temporalEnergy]})]})]}),s.jsxs("div",{className:"quick-actions",children:[s.jsx("button",{className:"action-btn",onClick:()=>m(0,0),children:"🏠 Retour Base"}),s.jsx("button",{className:"action-btn temporal",onClick:b,children:"⏳ Voyage Temporel"}),s.jsx("button",{className:"action-btn portal",onClick:()=>m(50,50,Date.now()-864e5),children:"🌀 Portail -1 Jour"})]}),s.jsx("div",{className:"bridge-status",children:s.jsx("span",{className:`bridge-indicator ${e?"connected":"disconnected"}`,children:e?"🌉 Bridge actif":"🚫 Bridge inactif"})})]}),s.jsx("div",{className:"chasse-iframe-container",children:s.jsx("iframe",{ref:r,src:v,title:"Chasse Temporelle Mega Map",className:"chasse-iframe",sandbox:"allow-same-origin allow-scripts"})})]})},Da=new ss;function za(){return s.jsx(is,{client:Da,children:s.jsx(Rn,{children:s.jsx("div",{className:"app-container",style:{minHeight:"100vh",background:"linear-gradient(135deg, #0a0e1a 0%, #1a1d3a 100%)",color:"#e8ecff"},children:s.jsxs(tn,{children:[s.jsx(J,{path:"/",element:s.jsx(ws,{})}),s.jsx(J,{path:"/game/*",element:s.jsx(ms,{})}),s.jsx(J,{path:"/editor/*",element:s.jsx(ys,{})}),s.jsx(J,{path:"/chasse/*",element:s.jsx(xs,{})}),s.jsx(J,{path:"/multiplayer",element:s.jsx(Ss,{})}),s.jsx(J,{path:"/ai-battle",element:s.jsx(Cs,{})}),s.jsx(J,{path:"/spectator",element:s.jsx(Ts,{})}),s.jsx(J,{path:"/backstory-editor",element:s.jsx(Os,{})}),s.jsx(J,{path:"/unified",element:s.jsx(Ma,{})}),s.jsx(J,{path:"/combat",element:s.jsx(Na,{})}),s.jsx(J,{path:"/start-tcg",element:s.jsx(ks,{})}),s.jsx(J,{path:"/chasse-mega",element:s.jsx(Ia,{})}),s.jsx(J,{path:"/settings",element:s.jsx(La,{})}),s.jsx(J,{path:"/about",element:s.jsx($a,{})})]})})})})}function La(){return s.jsxs("div",{style:{padding:40},children:[s.jsx("h1",{children:"⚙️ Paramètres"}),s.jsx(be,{to:"/",children:"← Retour"})]})}function $a(){return s.jsxs("div",{style:{padding:40},children:[s.jsx("h1",{children:"📖 À propos"}),s.jsx("p",{children:"Magic Stack Unified - Architecture React unifiée"}),s.jsx("p",{children:"Claude Nexus - Intégrateur des Tréfonds d'Avalon"}),s.jsx(be,{to:"/",children:"← Retour"})]})}Xt.createRoot(document.getElementById("root")).render(s.jsx(H.StrictMode,{children:s.jsx(za,{})}));export{pe as H,s as j};
//# sourceMappingURL=index-Dtevmlj4.js.map
