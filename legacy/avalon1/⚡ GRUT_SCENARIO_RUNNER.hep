#!/usr/bin/env bash

# HEP: Heroes Executable Package
# GRUT SCENARIO GOOD RUN

PACKAGE_NAME="GRUT_SCENARIO_RUNNER"
PACKAGE_VERSION="GOOD_RUN"
BACKEND_URL="http://localhost:8080"

# üëÅÔ∏è Couleurs GRUT
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

echo -e "${PURPLE}üëÅÔ∏è GRUT SCENARIO GOOD RUN ACTIVATED üëÅÔ∏è${NC}"

# Chargement du scenario GROFI Causal Demo
load_grut_scenario() {
    echo -e "${BLUE}üåä Chargement GROFI Causal Demo...${NC}"
    
    SCENARIO_FILE="/workspace/üìú OPUS/scenarios/visualizer/GROFI_CAUSAL_DEMO.json"
    
    if [[ -f "$SCENARIO_FILE" ]]; then
        echo -e "${CYAN}‚úÖ Scenario trouv√© : GROFI_CAUSAL_DEMO${NC}"
        
        # Extraction des donn√©es cl√©s
        HERO_NAME=$(jq -r '.heroes[0].name' "$SCENARIO_FILE")
        DEMO_STEPS=$(jq -r '.demo_sequence | length' "$SCENARIO_FILE")
        
        echo -e "${PURPLE}ü¶∏ H√©ros : $HERO_NAME${NC}"
        echo -e "${PURPLE}üìã √âtapes demo : $DEMO_STEPS${NC}"
        
        return 0
    else
        echo -e "${RED}‚ùå Scenario GRUT non trouv√©${NC}"
        return 1
    fi
}

# Ex√©cution des √©tapes GRUT
run_grut_steps() {
    echo -e "${BLUE}‚ö° EX√âCUTION S√âQUENCE GRUT${NC}"
    
    # √âtape 1 : Cr√©ation H√©ros GROFI
    echo -e "${CYAN}ü¶∏ √âtape 1 : Cr√©ation Jean-Grofignon${NC}"
    curl -s -X POST "$BACKEND_URL/api/heroes/create" \
         -H "Content-Type: application/json" \
         -d '{"name":"Jean-Grofignon","level":15,"immunities":["SRTI","ROLLBACK"]}'
    
    # √âtape 2 : √âtat Quantique
    echo -e "${CYAN}üåÄ √âtape 2 : √âtat Quantique Basique${NC}"
    curl -s -X POST "$BACKEND_URL/api/quantum/create-state" \
         -H "Content-Type: application/json" \
         -d '{"formula":"œà001: ‚äô(Œît+2 @10,10 ‚ü∂ MOV(Jean-Grofignon, @10,10))"}'
    
    # √âtape 3 : Vision GRUT
    echo -e "${CYAN}üëÅÔ∏è √âtape 3 : Activation Vision GRUT${NC}"
    curl -s -X POST "$BACKEND_URL/api/grut/vision-6d" \
         -H "Content-Type: application/json" \
         -d '{"target":"Jean-Grofignon","dimensions":6}'
    
    echo -e "${PURPLE}‚úÖ GRUT SCENARIO GOOD RUN COMPL√âT√â${NC}"
}

# Main execution
main() {
    echo -e "${PURPLE}üëÅÔ∏è GRUT VOIT TOUT - SCENARIO LANC√â${NC}"
    
    load_grut_scenario
    if [[ $? -eq 0 ]]; then
        run_grut_steps
    fi
    
    echo -e "${BLUE}üåä GRUT SCENARIO : SUCCESS${NC}"
}

# ACTIVATION
main "$@"