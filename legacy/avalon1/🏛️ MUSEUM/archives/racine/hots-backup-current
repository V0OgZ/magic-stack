#!/bin/bash

# Heroes of Time - Script de contrÃ´le principal
# Usage: ./hots [start|stop|status|restart|test|help]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SERVICES_SCRIPT="$SCRIPT_DIR/scripts/actifs/start-services-background.sh"
STOP_SCRIPT="$SCRIPT_DIR/scripts/actifs/stop-all-services.sh"

# Couleurs pour l'affichage
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

show_help() {
    echo -e "${CYAN}ğŸ® Heroes of Time - ContrÃ´le des services${NC}"
    echo -e "${CYAN}=========================================${NC}"
    echo ""
    echo -e "${GREEN}Usage:${NC} ./hots [commande] [options]"
    echo ""
    echo -e "${YELLOW}Commandes disponibles:${NC}"
    echo -e "  ${GREEN}start${NC}       DÃ©marre tous les services en arriÃ¨re-plan"
    echo -e "  ${GREEN}start essential${NC} ğŸ›ï¸ DÃ©marre services essentiels seulement (Backend + Frontend + Panopticon GRUT)"
    echo -e "  ${GREEN}stop${NC}        ArrÃªte tous les services"
    echo -e "  ${GREEN}restart${NC}     RedÃ©marre tous les services"
    echo -e "  ${GREEN}status${NC}      Affiche le statut des services"
    echo -e "  ${GREEN}test${NC}        Lance les tests (voir options ci-dessous)"
    echo -e "  ${GREEN}generate${NC}    ğŸ§  GÃ©nÃ¨re la documentation MD depuis JSON (Memento)"
    echo -e "  ${GREEN}translate${NC}   ğŸ“œ SystÃ¨me de traduction hybride (LLM â†’ Service â†’ Algo)"
    echo -e "  ${GREEN}map${NC}         ğŸ—ºï¸  Gestion des maps et terrains"
    echo -e "  ${GREEN}replay${NC}      ğŸ“¹ SystÃ¨me de replay des parties"
    echo -e "  ${GREEN}editor${NC}      ğŸ¨ Ã‰diteur visuel script spatio-temporel"
    echo -e "  ${GREEN}admin${NC}       ğŸ® Interface d'administration multijoueur"
    echo -e "  ${GREEN}test-uis${NC}    ğŸ§ª Test complet de toutes les UIs"
    echo -e "  ${GREEN}worldstate${NC}  ğŸŒ World State Graph - Visualisation Ã©tat mondial"
    echo -e "  ${GREEN}multi-realm${NC} ğŸŒŒ Multi Realm Manager - Gestion des realms"
    echo -e "  ${GREEN}benedikt${NC}    ğŸŒ€ Benedikt Conulbrurcus - Tests tÃ©lÃ©portation"
    echo -e "  ${GREEN}debug${NC}       ğŸ› Mode debug complet (compilation + logs)"
    echo -e "  ${GREEN}compile${NC}     ğŸ”§ Compilation backend avec debug info"
    echo -e "  ${GREEN}logs${NC}        ğŸ“‹ Affiche les logs en temps rÃ©el"
    echo -e "  ${GREEN}scenario${NC}    ğŸ¬ Lance un scÃ©nario HEP (Heroes Epic Play)"
    echo -e "  ${GREEN}demo${NC}        ğŸ® DÃ©monstration ZFC - Replay Ã©pique (./hots demo quick pour rapide, ./hots demo noob pour dÃ©butants)"
    echo -e "  ${GREEN}excalibur-vega${NC} ğŸ—¡ï¸âš¡ DÃ©mo Excalibur vs Vince Vega - Version lente visuelle pour Jean-Grofignon"
    echo -e "  ${GREEN}vince${NC}       ğŸ”« Vince Process Annihilator - Nettoie les process avec style!"
    echo -e "  ${GREEN}walter${NC}      ğŸ³ Walter Anti-Vince Protocol - Protection backend"
    echo -e "  ${GREEN}reality-debug${NC} ğŸŒ€ Debug Reality Broken Events - Diagnostics complets"
    echo -e "  ${GREEN}tattoo-force${NC} ğŸ¨ Force tatouages sync avec lampe Platon"
    echo -e "  ${GREEN}wake-memento${NC} ğŸ“š Interface rÃ©veil Memento transcendant"
    echo -e "  ${GREEN}help${NC}        Affiche cette aide"
    echo -e "  ${GREEN}web${NC}         ğŸŒ Interface Web GRUT (remplace la console)"
    echo ""
    echo -e "${YELLOW}Options de test:${NC}"
    echo -e "  ${GREEN}./hots test${NC}              Tests complets (dÃ©faut)"
    echo -e "  ${GREEN}./hots test quick${NC}        Tests rapides (1-2 min)"
    echo -e "  ${GREEN}./hots test ui${NC}           Tests interfaces utilisateur"
    echo -e "  ${GREEN}./hots test backend${NC}      Tests backend uniquement"
    echo -e "  ${GREEN}./hots test maven${NC}        Tests Maven compilation/build"
    echo -e "  ${GREEN}./hots test demo${NC}         DÃ©monstrations interactives"
    echo -e "  ${GREEN}./hots test bataille${NC}     Tests bataille temporelle"
    echo -e "  ${GREEN}./hots test quantum${NC}      Tests quantum/visualiseurs"
    echo -e "  ${GREEN}./hots test scenarios${NC}    Tests scÃ©narios HOTS complets"
    echo -e "  ${GREEN}./hots test json${NC}         ğŸš€ Tests nouveaux scripts JSON (HSP)"
    echo -e "  ${GREEN}./hots test jean-gros${NC}    ğŸ³ Tests Jean-Gros v2/v3 complets"
    echo -e "  ${GREEN}./hots test decay${NC}        ğŸŒ€ Tests systÃ¨me DK20 Temporal Decay (Anna)"
    echo -e "  ${GREEN}./hots test hybrid${NC}       ğŸ³ Tests systÃ¨me Hybrid Decay (The Dude)"
    echo -e "  ${GREEN}./hots test missing${NC}      ğŸ¯ Tests scÃ©narios manquants et crÃ©atures"
    echo -e "  ${GREEN}./hots test creatures${NC}    ğŸ‰ Tests spÃ©cifiques des crÃ©atures quantiques"
    echo -e "  ${GREEN}./hots test performance${NC}  Tests de performance"
    echo -e "  ${GREEN}./hots test integration${NC}  Tests d'intÃ©gration complÃ¨te"
    echo -e "  ${GREEN}./hots test report${NC}       Rapport complet des tests"
    echo -e "  ${GREEN}./hots test final${NC}        ğŸ† TOUS LES TESTS (complet)"
    echo -e "  ${GREEN}./hots test list${NC}         Liste tous les tests disponibles"
    echo -e "  ${GREEN}./hots test economie${NC}     ğŸ® Test simulation Ã©conomique complÃ¨te"
    echo -e "  ${GREEN}./hots test translation${NC}  ğŸ§  Test service traduction hybride (LLM â†’ Service â†’ Algo)"
    echo -e "  ${GREEN}./hots test md-generator${NC} ğŸ“ Test gÃ©nÃ©rateur MD automatique"
    echo ""
    echo -e "${YELLOW}Exemples:${NC}"
    echo -e "  ${CYAN}./hots start${NC}             # DÃ©marre tout"
    echo -e "  ${CYAN}./hots status${NC}            # VÃ©rifie l'Ã©tat"
    echo -e "  ${CYAN}./hots test quick${NC}        # Tests rapides"
    echo -e "  ${CYAN}./hots test maven${NC}        # Test compilation backend"
    echo -e "  ${CYAN}./hots test final${NC}        # ğŸ† TEST COMPLET FINAL"
    echo -e "  ${CYAN}./hots test report${NC}       # Rapport dÃ©taillÃ©"
    echo -e "  ${CYAN}./hots debug${NC}             # ğŸ› Mode debug complet"
    echo -e "  ${CYAN}./hots compile${NC}           # ğŸ”§ Compilation avec debug"
    echo -e "  ${CYAN}./hots logs${NC}              # ğŸ“‹ Logs en temps rÃ©el"
    echo -e "  ${CYAN}./hots generate${NC}          # ğŸ§  GÃ©nÃ¨re tous les MD depuis JSON"
    echo -e "  ${CYAN}./hots translate scenario.hots${NC} # ğŸ“œ Traduit HOTS en narration"
    echo -e "  ${CYAN}./hots translate health${NC}       # ğŸ¥ Test santÃ© services traduction"
    echo -e "  ${CYAN}./hots translate test${NC}         # ğŸ§ª Test complet systÃ¨me hybride"
    echo -e "  ${CYAN}./hots map list${NC}          # ğŸ—ºï¸  Liste les maps disponibles"
    echo -e "  ${CYAN}./hots replay center${NC}     # ğŸ¬ Centre de Replay complet"
    echo -e "  ${CYAN}./hots scenario list${NC}     # ğŸ¬ Liste les scÃ©narios HEP disponibles"
    echo -e "  ${CYAN}./hots scenario bataille${NC} # ğŸ¬ Lance bataille temporelle HOTS"
    echo -e "  ${CYAN}./hots scenario anthor${NC}   # ğŸ¬ Lance duel Anthor vs Grofi"
    echo -e "  ${CYAN}./hots editor${NC}            # ğŸ¨ Lance l'Ã©diteur visuel"
    echo -e "  ${CYAN}./hots vince${NC}             # ğŸ”« Nettoie les process lents (animation ROFL)"
    echo -e "  ${CYAN}./hots walter${NC}            # ğŸ³ Protection backend Anti-Vince"
    echo -e "  ${CYAN}./hots web${NC}               # ğŸŒ Interface Web GRUT moderne"
    echo ""
    echo -e "${PURPLE}ğŸ’¾ Commandes de Persistence:${NC}"
    echo -e "  ${GREEN}save${NC} <nom> [game_id] [player]  Sauvegarder la partie"
    echo -e "  ${GREEN}load${NC} <id> [player]            Charger une sauvegarde"
    echo -e "  ${GREEN}list-saves${NC} [player]           Lister les sauvegardes"
}

check_service() {
    local port=$1
    local name=$2
    local url=$3
    
    if lsof -i :$port > /dev/null 2>&1; then
        if [[ $port == "8001" ]]; then
            # Pour le Panopticon GRUT React, on vÃ©rifie juste le port
            echo -e "  ${GREEN}âœ… $name ($port) - ACTIF${NC}"
        elif curl -s "$url" > /dev/null 2>&1; then
            echo -e "  ${GREEN}âœ… $name ($port) - ACTIF${NC}"
        else
            echo -e "  ${YELLOW}âš ï¸  $name ($port) - PORT OUVERT MAIS SERVICE NON RÃ‰ACTIF${NC}"
        fi
    else
        echo -e "  ${RED}âŒ $name ($port) - INACTIF${NC}"
    fi
}

show_status() {
    echo -e "${CYAN}ğŸ” Statut des services Heroes of Time - VINCE MODE${NC}"
    echo -e "${CYAN}===============================================${NC}"
    
    check_service 3000 "React Frontend Moderne" "http://localhost:3000"
    check_service 9000 "HTML Pocket World" "http://localhost:9000"
    check_service 8080 "Backend API" "http://localhost:8080/api/health"
    
    echo ""
    echo -e "${YELLOW}ğŸ® VINCE MODE - URLs d'accÃ¨s:${NC}"
    echo -e "  âš›ï¸ React Frontend: ${CYAN}http://localhost:3000${NC} (ton futur)"
    echo -e "  ğŸ“± HTML Pocket: ${CYAN}http://localhost:9000/portail-vince-mode.html${NC} (legacy)"
    echo -e "  ğŸ“Š Dashboard Legacy: ${CYAN}http://localhost:9000/dashboard.html${NC}"
    echo -e "  ğŸ—ï¸ Backend API: ${CYAN}http://localhost:8080/api/health${NC}"
    echo ""
    echo -e "  ğŸ¯ Portail Principal: ${CYAN}http://localhost:9000/portail-vince-mode.html${NC}"
    
    # Compte les services actifs
    active_count=0
    for port in 3000 9000 8080; do
        if lsof -i :$port > /dev/null 2>&1; then
            ((active_count++))
        fi
    done
    
    echo ""
    if [ $active_count -eq 3 ]; then
        echo -e "${GREEN}ğŸ® VINCE MODE: TOUS LES SERVICES SONT ACTIFS ! ($active_count/3)${NC}"
        echo -e "${GREEN}âœ… Architecture simplifiÃ©e opÃ©rationnelle${NC}"
    else
        echo -e "${YELLOW}âš ï¸  VINCE MODE: $active_count/3 services actifs${NC}"
        echo -e "${YELLOW}ğŸ’¡ Utilisez './start-vince-mode.sh' pour dÃ©marrer${NC}"
    fi
}

start_services() {
    echo -e "${BLUE}ğŸ® DÃ©marrage VINCE MODE - Architecture SimplifiÃ©e${NC}"
    echo "================================================"
    
    # Utiliser le script Vince Mode
    if [ -f "./start-vince-mode.sh" ]; then
        bash "./start-vince-mode.sh"
        echo ""
        echo -e "${GREEN}âœ… VINCE MODE lancÃ© avec succÃ¨s${NC}"
        echo -e "${YELLOW}ğŸ’¡ Utilisez './hots status' pour vÃ©rifier l'Ã©tat${NC}"
    else
        echo -e "${RED}âŒ Script Vince Mode non trouvÃ©: ./start-vince-mode.sh${NC}"
        echo -e "${YELLOW}ğŸ’¡ CrÃ©ation du script...${NC}"
        # Fallback: crÃ©er le script s'il n'existe pas
        cat > start-vince-mode.sh << 'EOF'
#!/bin/bash
echo "ğŸ® VINCE MODE - 2 SERVEURS WEB SEULEMENT"
echo "========================================"
pkill -f "python3 -m http.server"
pkill -f "npm start"
sleep 2
echo "ğŸš€ DÃ©marrage VINCE MODE..."
echo "ğŸ“± Port 9000: HTML Pocket World"
cd frontend && python3 -m http.server 9000 > ../pocket-world.log 2>&1 &
cd ..
echo "âš›ï¸ Port 3000: React Frontend"
cd frontend && npm start > ../react-frontend.log 2>&1 &
cd ..
echo "âœ… VINCE MODE OPÃ‰RATIONNEL !"
EOF
        chmod +x start-vince-mode.sh
        bash "./start-vince-mode.sh"
        return 1
    fi
}

setup_panopticon() {
    echo -e "${CYAN}ğŸ”§ VÃ©rification setup Panopticon GRUT...${NC}"
    
    if [ ! -d "panopticon-grut-dashboard/node_modules" ]; then
        echo -e "${YELLOW}ğŸ“¦ Installation des dÃ©pendances npm...${NC}"
        cd panopticon-grut-dashboard
        if npm install; then
            echo -e "${GREEN}âœ… DÃ©pendances installÃ©es${NC}"
            cd ..
        else
            echo -e "${RED}âŒ Erreur installation dÃ©pendances${NC}"
            cd ..
            return 1
        fi
    else
        echo -e "${GREEN}âœ… DÃ©pendances dÃ©jÃ  installÃ©es${NC}"
    fi
}

start_essential_services() {
    echo -e "${BLUE}ğŸ›ï¸ DÃ©marrage des services essentiels Heroes of Time${NC}"
    echo "=================================================="
    echo -e "${YELLOW}Services essentiels : Backend + Frontend + Panopticon GRUT${NC}"
    echo ""
    
    # Setup Panopticon si nÃ©cessaire
    setup_panopticon
    if [ $? -ne 0 ]; then
        return 1
    fi
    
    # DÃ©marrer le backend
    echo -e "${CYAN}âš™ï¸  DÃ©marrage du Backend (port 8080)...${NC}"
    if [ -d "backend" ]; then
        cd backend
        if mvn spring-boot:run -q > backend.log 2>&1 &
        then
            echo -e "${GREEN}âœ… Backend dÃ©marrÃ©${NC}"
            cd ..
        else
            echo -e "${RED}âŒ Erreur dÃ©marrage backend${NC}"
            cd ..
            return 1
        fi
    else
        echo -e "${RED}âŒ Dossier backend non trouvÃ©${NC}"
        return 1
    fi
    
    # Attendre que le backend soit prÃªt
    echo -e "${YELLOW}â³ Attente du dÃ©marrage backend...${NC}"
    sleep 10
    
    # DÃ©marrer le frontend
    echo -e "${CYAN}ğŸ® DÃ©marrage du Frontend (port 8000)...${NC}"
    if [ -d "frontend" ]; then
        cd frontend
        if python3 -m http.server 8000 > frontend.log 2>&1 &
        then
            echo -e "${GREEN}âœ… Frontend dÃ©marrÃ©${NC}"
            cd ..
        else
            echo -e "${RED}âŒ Erreur dÃ©marrage frontend${NC}"
            cd ..
            return 1
        fi
    else
        echo -e "${RED}âŒ Dossier frontend non trouvÃ©${NC}"
        return 1
    fi
    
    # DÃ©marrer le Panopticon GRUT React
    echo -e "${CYAN}ğŸ›ï¸ DÃ©marrage du Panopticon GRUT React (port 8001)...${NC}"
    if [ -d "panopticon-grut-dashboard" ]; then
        cd panopticon-grut-dashboard
        if npm run dev > panopticon.log 2>&1 &
        then
            echo -e "${GREEN}âœ… Panopticon GRUT dÃ©marrÃ©${NC}"
            cd ..
        else
            echo -e "${RED}âŒ Erreur dÃ©marrage Panopticon GRUT${NC}"
            cd ..
            return 1
        fi
    else
        echo -e "${RED}âŒ Dossier panopticon-grut-dashboard non trouvÃ©${NC}"
        return 1
    fi
    
    echo ""
    echo -e "${GREEN}âœ… Services essentiels dÃ©marrÃ©s !${NC}"
    echo -e "${YELLOW}ğŸŒ URLs d'accÃ¨s :${NC}"
    echo -e "  ğŸ›ï¸ Panopticon GRUT : ${CYAN}http://localhost:8001${NC}"
    echo -e "  ğŸ® Frontend : ${CYAN}http://localhost:8000${NC}"
    echo -e "  âš™ï¸  Backend API : ${CYAN}http://localhost:8080/api/health${NC}"
    echo ""
    echo -e "${YELLOW}ğŸ’¡ Pour dÃ©marrer tous les services : ${CYAN}./hots start${NC}"
    echo -e "${YELLOW}ğŸ’¡ Pour vÃ©rifier l'Ã©tat : ${CYAN}./hots status${NC}"
}

stop_services() {
    echo -e "${BLUE}ğŸ›‘ ArrÃªt des services Heroes of Time${NC}"
    echo "====================================="
    
    if [ -f "$STOP_SCRIPT" ]; then
        bash "$STOP_SCRIPT"
        echo ""
        echo -e "${GREEN}âœ… Services arrÃªtÃ©s${NC}"
    else
        echo -e "${RED}âŒ Script d'arrÃªt non trouvÃ©: $STOP_SCRIPT${NC}"
        return 1
    fi
}

restart_services() {
    echo -e "${BLUE}ğŸ”„ RedÃ©marrage des services Heroes of Time${NC}"
    echo "=========================================="
    stop_services
    sleep 2
    start_services
}

# Nouvelles fonctions de test
list_available_tests() {
    echo -e "${CYAN}ğŸ“‹ Tests disponibles dans Heroes of Time${NC}"
    echo -e "${CYAN}=======================================${NC}"
    echo ""
    echo -e "${YELLOW}ğŸ”§ Tests de base:${NC}"
    echo -e "  ${GREEN}quick${NC}         - Tests rapides (1-2 min)"
    echo -e "  ${GREEN}ui${NC}            - Tests interfaces utilisateur"
    echo -e "  ${GREEN}backend${NC}       - Tests backend uniquement"
    echo -e "  ${GREEN}maven${NC}         - Tests Maven compilation/build"
    echo ""
    echo -e "${YELLOW}ğŸ® Tests spÃ©cialisÃ©s:${NC}"
    echo -e "  ${GREEN}demo${NC}          - DÃ©monstrations interactives"
    echo -e "  ${GREEN}bataille${NC}      - Tests bataille temporelle"
    echo -e "  ${GREEN}quantum${NC}       - Tests quantum/visualiseurs"
    echo -e "  ${GREEN}scenarios${NC}     - Tests scÃ©narios HOTS complets"
    echo -e "  ${GREEN}json${NC}          - Tests nouveaux scripts JSON (architecture HSP)"
    echo -e "  ${GREEN}jean-gros${NC}     - Tests Jean-Gros v2/v3 complets"
    echo -e "  ${GREEN}decay${NC}         - Tests systÃ¨me DK20 Temporal Decay (Anna the Martopicker)"
    echo -e "  ${GREEN}hybrid${NC}        - Tests systÃ¨me Hybrid Decay (The Dude's fusion)"
    echo -e "  ${GREEN}performance${NC}   - Tests de performance et optimisation"
    echo -e "  ${GREEN}integration${NC}   - Tests d'intÃ©gration complÃ¨te"
    echo ""
    echo -e "${YELLOW}ğŸ“Š Rapports et analyse:${NC}"
    echo -e "  ${GREEN}report${NC}        - Rapport complet des tests"
    echo -e "  ${GREEN}final${NC}         - Test final complet (tous les tests)"
    echo -e "  ${GREEN}list${NC}          - Cette liste"
    echo ""
    echo -e "${YELLOW}ğŸ“ Scripts de test disponibles:${NC}"
    
    # Lister les scripts de test disponibles
    if [ -d "scripts/test" ]; then
        find scripts/test -name "*.sh" | sort | while read script; do
            echo -e "  ğŸ“„ ${BLUE}$script${NC}"
        done
    fi
    
    if [ -d "scripts/demo" ]; then
        echo ""
        echo -e "${YELLOW}ğŸ¬ Scripts de dÃ©mo disponibles:${NC}"
        find scripts/demo -name "*.sh" | sort | while read script; do
            echo -e "  ğŸ­ ${PURPLE}$script${NC}"
        done
    fi
}

run_test_suite() {
    local test_type="${1:-complete}"
    
    echo -e "${CYAN}ğŸ§ª Lancement des tests Heroes of Time${NC}"
    echo -e "${CYAN}====================================${NC}"
    echo -e "${YELLOW}Type de test: ${test_type}${NC}"
    echo ""
    
    case "$test_type" in
        "quick")
            echo -e "${GREEN}ğŸš€ Tests rapides en cours...${NC}"
            if [ -f "scripts/test/test-ui-quick.sh" ]; then
                bash scripts/test/test-ui-quick.sh
            elif [ -f "scripts/actifs/test-ui-quick.sh" ]; then
                bash scripts/actifs/test-ui-quick.sh
            else
                echo -e "${RED}âŒ Script de test rapide non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "ui")
            echo -e "${GREEN}ğŸ–¥ï¸  Tests d'interface utilisateur...${NC}"
            if [ -f "scripts/test/test-scenarios-ui.sh" ]; then
                bash scripts/test/test-scenarios-ui.sh
            else
                echo -e "${RED}âŒ Script de test UI non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "backend")
            echo -e "${GREEN}âš™ï¸  Tests backend...${NC}"
            if [ -f "scripts/test/test-backend-conformity.sh" ]; then
                bash scripts/test/test-backend-conformity.sh
            else
                echo -e "${RED}âŒ Script de test backend non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "maven")
            echo -e "${GREEN}â˜• Tests Maven compilation...${NC}"
            echo -e "${YELLOW}ğŸ”§ Test compilation backend Maven...${NC}"
            if [ -d "backend" ]; then
                cd backend
                echo "ğŸ“‹ Tentative de compilation Maven..."
                if mvn clean compile -q; then
                    echo -e "${GREEN}âœ… Compilation Maven rÃ©ussie${NC}"
                else
                    echo -e "${RED}âŒ Erreur de compilation Maven${NC}"
                    echo -e "${YELLOW}ğŸ’¡ ProblÃ¨mes connus: executeFormula manquante, JPA entities${NC}"
                fi
                cd ..
            else
                echo -e "${RED}âŒ Dossier backend non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "demo")
            echo -e "${GREEN}ğŸ¬ DÃ©monstrations interactives...${NC}"
            if [ -f "scripts/demo/demo-quantum-final.sh" ]; then
                bash scripts/demo/demo-quantum-final.sh
            else
                echo -e "${RED}âŒ Script de dÃ©mo non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "bataille")
            echo -e "${GREEN}âš”ï¸  Tests bataille temporelle...${NC}"
            if [ -f "scripts/test/test-complete-bataille-temporelle.sh" ]; then
                bash scripts/test/test-complete-bataille-temporelle.sh
            else
                echo -e "${RED}âŒ Script de test bataille non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "quantum")
            echo -e "${GREEN}ğŸŒ€ Tests quantum et visualiseurs...${NC}"
            if [ -f "tester-quantum-ui.sh" ]; then
                bash tester-quantum-ui.sh
            else
                echo -e "${RED}âŒ Script de test quantum non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "scenarios")
            echo -e "${GREEN}ğŸ­ Tests scÃ©narios HOTS...${NC}"
            if [ -f "scripts/test/run-all-hots-scenarios.sh" ]; then
                bash scripts/test/run-all-hots-scenarios.sh
            else
                echo -e "${RED}âŒ Script de test scÃ©narios non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "json")
            echo -e "${GREEN}ğŸš€ Tests nouveaux scripts JSON (architecture HSP)...${NC}"
            echo -e "${YELLOW}ğŸ” Test script panopticon JSON...${NC}"
            if [ -f "scripts/test-panopticon-json-scenario.sh" ]; then
                bash scripts/test-panopticon-json-scenario.sh
            else
                echo -e "${RED}âŒ Script panopticon JSON non trouvÃ©${NC}"
            fi
            
            echo -e "${YELLOW}âš”ï¸ Test script duel collapse JSON...${NC}"
            if [ -f "scripts/test-duel-collapse-json.sh" ]; then
                bash scripts/test-duel-collapse-json.sh
            else
                echo -e "${RED}âŒ Script duel collapse JSON non trouvÃ©${NC}"
            fi
            
            echo -e "${YELLOW}ğŸ® Test runner gÃ©nÃ©rique JSON...${NC}"
            if [ -f "scripts/test-json-scenario-runner.sh" ]; then
                echo "Testing with GROFI_QUICK_TEST scenario..."
                bash scripts/test-json-scenario-runner.sh GROFI_QUICK_TEST
            else
                echo -e "${RED}âŒ Script runner JSON non trouvÃ©${NC}"
            fi
            ;;
        "jean-gros")
            echo -e "${GREEN}ğŸ³ Tests Jean-Gros complets...${NC}"
            echo -e "${YELLOW}ğŸ”§ Lancement Jean-Gros v2 FIXED...${NC}"
            if [ -f "scripts/test-jean-gros-v2-FIXED.sh" ]; then
                bash scripts/test-jean-gros-v2-FIXED.sh
            else
                echo -e "${RED}âŒ Script Jean-Gros v2 non trouvÃ©${NC}"
            fi
            
            echo -e "${YELLOW}ğŸš€ Lancement Jean-Gros v3 WITH JSON...${NC}"
            if [ -f "scripts/test-jean-gros-v3-with-json.sh" ]; then
                bash scripts/test-jean-gros-v3-with-json.sh
            else
                echo -e "${RED}âŒ Script Jean-Gros v3 non trouvÃ©${NC}"
            fi
            ;;
        "decay")
            echo -e "${GREEN}ğŸŒ€ Tests systÃ¨me DK20 Temporal Decay...${NC}"
            echo -e "${PURPLE}ğŸ’« Testing Anna the Martopicker's temporal mechanics${NC}"
            if [ -f "scripts/test-temporal-decay-dk20.sh" ]; then
                bash scripts/test-temporal-decay-dk20.sh
            else
                echo -e "${RED}âŒ Script DK20 Temporal Decay non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "hybrid")
            echo -e "${GREEN}ğŸ³ Tests systÃ¨me Hybrid Decay...${NC}"
            echo -e "${PURPLE}ğŸ’« Testing The Dude's unified temporal decay system${NC}"
            if [ -f "scripts/test-temporal-decay-hybrid-dude.sh" ]; then
                bash scripts/test-temporal-decay-hybrid-dude.sh
            else
                echo -e "${RED}âŒ Script Hybrid Decay non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "performance")
            echo -e "${GREEN}âš¡ Tests de performance...${NC}"
            if [ -f "scripts/test/test-optimizations-performance.sh" ]; then
                bash scripts/test/test-optimizations-performance.sh
            elif [ -f "scripts/test/benchmark-native-vs-script.sh" ]; then
                bash scripts/test/benchmark-native-vs-script.sh
            else
                echo -e "${RED}âŒ Script de test performance non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "integration")
            echo -e "${GREEN}ğŸ”— Tests d'intÃ©gration...${NC}"
            if [ -f "scripts/test/test-integration-complete.sh" ]; then
                bash scripts/test/test-integration-complete.sh
            else
                echo -e "${RED}âŒ Script de test intÃ©gration non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "missing")
            echo -e "${GREEN}ğŸ¯ Tests scÃ©narios manquants et crÃ©atures...${NC}"
            if [ -f "scripts/test-all-missing-scenarios.sh" ]; then
                chmod +x scripts/test-all-missing-scenarios.sh
                bash scripts/test-all-missing-scenarios.sh
            else
                echo -e "${RED}âŒ Script de test scÃ©narios manquants non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "creatures")
            echo -e "${GREEN}ğŸ‰ Tests spÃ©cifiques des crÃ©atures quantiques...${NC}"
            if [ -f "scripts/test-all-missing-scenarios.sh" ]; then
                chmod +x scripts/test-all-missing-scenarios.sh
                bash scripts/test-all-missing-scenarios.sh | grep -E "(CRÃ‰ATURE|ğŸ‰|creature|Luciole|Dragon|Liche|PhÃ©nix)"
            else
                echo -e "${RED}âŒ Script de test crÃ©atures non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "report")
            generate_test_report
            ;;
        "final")
            echo -e "${GREEN}ğŸ† TEST FINAL COMPLET - TOUS LES TESTS${NC}"
            echo -e "${CYAN}=====================================${NC}"
            
            # Lancer tous les tests dans l'ordre
            echo -e "${YELLOW}ğŸš€ Phase 1: Tests rapides${NC}"
            run_test_suite "quick"
            
            echo -e "${YELLOW}ğŸ–¥ï¸  Phase 2: Tests UI${NC}"
            run_test_suite "ui"
            
            echo -e "${YELLOW}âš™ï¸  Phase 3: Tests backend${NC}"
            run_test_suite "backend"
            
            echo -e "${YELLOW}â˜• Phase 4: Tests Maven${NC}"
            run_test_suite "maven"
            
            echo -e "${YELLOW}ğŸ¬ Phase 5: DÃ©monstrations${NC}"
            run_test_suite "demo"
            
            echo -e "${YELLOW}âš”ï¸  Phase 6: Tests bataille${NC}"
            run_test_suite "bataille"
            
            echo -e "${YELLOW}ğŸŒ€ Phase 7: Tests quantum${NC}"
            run_test_suite "quantum"
            
            echo -e "${YELLOW}ğŸ­ Phase 8: Tests scÃ©narios${NC}"
            run_test_suite "scenarios"
            
            echo -e "${YELLOW}ğŸš€ Phase 9: Tests JSON (architecture HSP)${NC}"
            run_test_suite "json"
            
            echo -e "${YELLOW}ğŸ³ Phase 10: Tests Jean-Gros complets${NC}"
            run_test_suite "jean-gros"
            
            echo -e "${YELLOW}ğŸŒ€ Phase 11: Tests DK20 Temporal Decay${NC}"
            run_test_suite "decay"
            
            echo -e "${YELLOW}âš¡ Phase 12: Tests performance${NC}"
            run_test_suite "performance"
            
            echo -e "${YELLOW}ğŸ”— Phase 13: Tests intÃ©gration${NC}"
            run_test_suite "integration"
            
            echo -e "${YELLOW}ğŸ¯ Phase 14: Tests scÃ©narios manquants${NC}"
            run_test_suite "missing"
            
            echo ""
            echo -e "${CYAN}ğŸ† TEST FINAL COMPLET TERMINÃ‰${NC}"
            echo -e "${GREEN}âœ… Toutes les phases de test exÃ©cutÃ©es${NC}"
            
            # Rapport final
            generate_test_report
            ;;
        "list")
            list_available_tests
            ;;
        "economie")
            echo -e "${GREEN}ğŸ® Test simulation Ã©conomique complÃ¨te...${NC}"
            if [ -f "scripts/test/test-economie-guerre.sh" ]; then
                bash scripts/test/test-economie-guerre.sh
            else
                echo -e "${RED}âŒ Script de test Ã©conomique non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "translation")
            echo -e "${GREEN}ğŸ§  Test service traduction hybride intelligent...${NC}"
            echo -e "${CYAN}ğŸŒŸ NOUVEAU: SystÃ¨me hybride avec fallback LLM â†’ Service â†’ Algo${NC}"
            if [ -f "MUSEUM/scripts-collection/test-smart-translation.py" ]; then
                echo -e "${BLUE}ğŸ” Test du service Python â†’ Backend Java...${NC}"
                python3 MUSEUM/scripts-collection/test-smart-translation.py
                echo ""
                echo -e "${BLUE}ğŸ” Test endpoints REST traduction...${NC}"
                curl -s -X GET "http://localhost:8080/api/translate/health" | python3 -m json.tool || echo "âŒ Backend non disponible"
            else
                echo -e "${RED}âŒ Script de test traduction non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "md-generator")
            echo -e "${GREEN}ğŸ“ Test gÃ©nÃ©rateur MD automatique...${NC}"
            if [ -f "scripts/test/generate-scenario-md.py" ]; then
                python3 scripts/test/generate-scenario-md.py
            else
                echo -e "${RED}âŒ Script gÃ©nÃ©rateur MD non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "complete"|*)
            echo -e "${GREEN}ğŸ”¬ Tests complets en cours...${NC}"
            if [ -f "scripts/test/test-complet-final.sh" ]; then
                bash scripts/test/test-complet-final.sh
            elif [ -f "test-complet-final.sh" ]; then
                bash test-complet-final.sh
            else
                echo -e "${RED}âŒ Script de test complet non trouvÃ©${NC}"
                return 1
            fi
            ;;
    esac
}

generate_test_report() {
    echo -e "${CYAN}ğŸ“Š Rapport complet des tests Heroes of Time${NC}"
    echo -e "${CYAN}===========================================${NC}"
    echo ""
    
    # VÃ©rifier l'Ã©tat des services
    echo -e "${YELLOW}ğŸ” Ã‰tat des services:${NC}"
    check_service 8001 "Panopticon GRUT Dashboard" "http://localhost:8001"
    check_service 8000 "Frontend" "http://localhost:8000"
    check_service 8080 "Backend API" "http://localhost:8080/api/health"
    check_service 5174 "Temporal" "http://localhost:5174"
    check_service 5175 "Visualizer" "http://localhost:5175"
    check_service 8888 "Test Runner" "http://localhost:8888"
    
    echo ""
    echo -e "${YELLOW}ğŸ§ª Test Runner Analysis:${NC}"
    if lsof -i :8888 >/dev/null 2>&1; then
        echo -e "  âœ… Test Runner actif sur port 8888"
        echo -e "  ğŸŒ Interface: ${CYAN}http://localhost:8888${NC}"
        
        # Analyser les tests disponibles dans le Test Runner
        if [ -f "test-runner-interface.html" ]; then
            echo -e "  ğŸ“‹ Interface HTML: ${GREEN}Disponible${NC}"
            
            # Extraire les tests configurÃ©s
            echo -e "  ğŸ¯ Tests configurÃ©s dans l'interface:"
            grep -o "script: '[^']*'" test-runner-interface.html 2>/dev/null | sed "s/script: '/    ğŸ“„ /" | sed "s/'$//"
        fi
        
        if [ -f "test-runner-server.py" ]; then
            echo -e "  ğŸ Serveur Python: ${GREEN}Disponible${NC}"
        fi
    else
        echo -e "  âŒ Test Runner non actif"
    fi
    echo ""
    
    # Analyser les scripts de test disponibles
    echo -e "${YELLOW}ğŸ“ Scripts de test disponibles:${NC}"
    local test_count=0
    
    if [ -d "scripts/test" ]; then
        while IFS= read -r script; do
            if [ -f "$script" ]; then
                local size=$(du -h "$script" 2>/dev/null | cut -f1)
                local name=$(basename "$script")
                echo -e "  ğŸ“„ ${GREEN}$name${NC} (${size})"
                ((test_count++))
            fi
        done < <(find scripts/test -name "*.sh" | sort)
    fi
    
    if [ -d "scripts/demo" ]; then
        echo ""
        echo -e "${YELLOW}ğŸ¬ Scripts de dÃ©mo disponibles:${NC}"
        while IFS= read -r script; do
            if [ -f "$script" ]; then
                local size=$(du -h "$script" 2>/dev/null | cut -f1)
                local name=$(basename "$script")
                echo -e "  ğŸ­ ${PURPLE}$name${NC} (${size})"
                ((test_count++))
            fi
        done < <(find scripts/demo -name "*.sh" | sort)
    fi
    
    echo ""
    echo -e "${YELLOW}ğŸ” Tests racine disponibles:${NC}"
    for script in test-*.sh tester-*.sh; do
        if [ -f "$script" ]; then
            local size=$(du -h "$script" 2>/dev/null | cut -f1)
            echo -e "  ğŸ§ª ${BLUE}$script${NC} (${size})"
            ((test_count++))
        fi
    done
    
    # Analyser le backend Maven
    echo ""
    echo -e "${YELLOW}â˜• Analyse Backend Maven:${NC}"
    if [ -f "backend/pom.xml" ]; then
        echo -e "  ğŸ“„ pom.xml: ${GREEN}Disponible${NC}"
        if [ -d "backend/src/main/java" ]; then
            local java_files=$(find backend/src/main/java -name "*.java" | wc -l)
            echo -e "  â˜• Fichiers Java: ${GREEN}$java_files fichiers${NC}"
        fi
        if [ -d "backend/target" ]; then
            echo -e "  ğŸ¯ Target Maven: ${GREEN}PrÃ©sent${NC}"
        else
            echo -e "  ğŸ¯ Target Maven: ${YELLOW}Absent (pas compilÃ©)${NC}"
        fi
        
        # Test de compilation rapide
        echo -e "  ğŸ”§ Test compilation rapide..."
        if (cd backend && mvn compile -q >/dev/null 2>&1); then
            echo -e "  âœ… Compilation: ${GREEN}RÃ©ussie${NC}"
        else
            echo -e "  âŒ Compilation: ${RED}Ã‰choue${NC}"
            echo -e "    ğŸ’¡ ProblÃ¨mes connus: executeFormula manquante, JPA entities${NC}"
        fi
    else
        echo -e "  âŒ Backend Maven non trouvÃ©"
    fi
    
    # Analyser les frontends
    echo ""
    echo -e "${YELLOW}ğŸ–¥ï¸  Analyse Frontends:${NC}"
    local frontend_count=0
    for frontend_dir in frontend frontend-temporal frontend-legendary-ui quantum-visualizer; do
        if [ -d "$frontend_dir" ] && [ -f "$frontend_dir/index.html" ]; then
            local size=$(du -sh "$frontend_dir" 2>/dev/null | cut -f1)
            echo -e "  ğŸ“ ${GREEN}$frontend_dir${NC} (${size})"
            ((frontend_count++))
        fi
    done
    echo -e "  ğŸ“Š Total frontends: ${GREEN}$frontend_count${NC}"
    
    # Analyser les scÃ©narios et assets
    echo ""
    echo -e "${YELLOW}ğŸ­ Analyse ScÃ©narios et Assets:${NC}"
    if [ -d "game_assets/scenarios" ]; then
        local hots_files=$(find game_assets/scenarios -name "*.hots" | wc -l)
        local json_files=$(find game_assets/scenarios -name "*.json" | wc -l)
        echo -e "  ğŸ“„ Fichiers HOTS: ${GREEN}$hots_files${NC}"
        echo -e "  ğŸ“„ Fichiers JSON: ${GREEN}$json_files${NC}"
    else
        echo -e "  âŒ Dossier game_assets/scenarios non trouvÃ©"
    fi
    
    echo ""
    echo -e "${YELLOW}ğŸ“Š RÃ©sumÃ© du rapport:${NC}"
    echo -e "  ğŸ® Services actifs: ${GREEN}$active_count/6${NC}"
    echo -e "  ğŸ§ª Scripts de test: ${GREEN}$test_count${NC}"
    echo -e "  ğŸ–¥ï¸  Frontends: ${GREEN}$frontend_count${NC}"
    echo -e "  ğŸŒ Test Runner: $(if lsof -i :8888 >/dev/null 2>&1; then echo -e "${GREEN}Actif${NC}"; else echo -e "${RED}Inactif${NC}"; fi)"
    echo -e "  â˜• Backend Maven: $(if [ -f "backend/pom.xml" ]; then echo -e "${GREEN}Disponible${NC}"; else echo -e "${RED}Manquant${NC}"; fi)"
    
    # Ã‰tat de santÃ© global
    echo ""
    echo -e "${YELLOW}ğŸ¥ Ã‰tat de santÃ© global:${NC}"
    local health_score=0
    
    if [ $active_count -ge 4 ]; then ((health_score += 25)); fi
    if [ $test_count -ge 20 ]; then ((health_score += 25)); fi
    if lsof -i :8888 >/dev/null 2>&1; then ((health_score += 25)); fi
    if [ -f "backend/pom.xml" ]; then ((health_score += 25)); fi
    
    if [ $health_score -ge 90 ]; then
        echo -e "  ğŸŸ¢ ${GREEN}Excellent${NC} ($health_score/100)"
    elif [ $health_score -ge 70 ]; then
        echo -e "  ğŸŸ¡ ${YELLOW}Bon${NC} ($health_score/100)"
    elif [ $health_score -ge 50 ]; then
        echo -e "  ğŸŸ  ${YELLOW}Moyen${NC} ($health_score/100)"
    else
        echo -e "  ğŸ”´ ${RED}NÃ©cessite attention${NC} ($health_score/100)"
    fi
    
    # Recommandations
    echo ""
    echo -e "${YELLOW}ğŸ’¡ Recommandations:${NC}"
    
    if [ $active_count -lt 6 ]; then
        echo -e "  âš ï¸  DÃ©marrer tous les services: ${CYAN}./hots start${NC}"
    fi
    
    if ! lsof -i :8888 >/dev/null 2>&1; then
        echo -e "  ğŸ§ª Lancer le Test Runner: ${CYAN}python3 test-runner-server.py 8888 &${NC}"
    fi
    
    if [ -f "backend/pom.xml" ] && ! (cd backend && mvn compile -q >/dev/null 2>&1); then
        echo -e "  ğŸ”§ RÃ©parer backend Maven: ${CYAN}./hots test maven${NC}"
    fi
    
    echo -e "  ğŸš€ Tests rapides: ${CYAN}./hots test quick${NC}"
    echo -e "  ğŸ¬ DÃ©monstration: ${CYAN}./hots test demo${NC}"
    echo -e "  ğŸ† Test final complet: ${CYAN}./hots test final${NC}"
    echo -e "  ğŸ“‹ Liste complÃ¨te: ${CYAN}./hots test list${NC}"
    
    echo ""
    echo -e "${CYAN}ğŸ“ˆ Pour un diagnostic complet, utilisez: ${GREEN}./hots test final${NC}"
}

# ğŸ§  Fonction de gÃ©nÃ©ration MD - Memento
generate_md_docs() {
    echo -e "${CYAN}ğŸ§  MEMENTO - GÃ©nÃ©rateur de Documentation MD${NC}"
    echo -e "${CYAN}============================================${NC}"
    echo ""
    
    if [ ! -f "scripts/generate-md-from-json.py" ]; then
        echo -e "${RED}âŒ GÃ©nÃ©rateur MD non trouvÃ©: scripts/generate-md-from-json.py${NC}"
        return 1
    fi
    
    echo -e "${YELLOW}ğŸ”„ GÃ©nÃ©ration automatique des fichiers Markdown...${NC}"
    python3 scripts/generate-md-from-json.py
    
    if [ $? -eq 0 ]; then
        echo ""
        echo -e "${GREEN}âœ… GÃ©nÃ©ration terminÃ©e avec succÃ¨s !${NC}"
        echo -e "${YELLOW}ğŸ“ Fichiers gÃ©nÃ©rÃ©s dans :${NC}"
        echo -e "  - ${CYAN}docs/artifacts/generated/${NC}"
        echo -e "  - ${CYAN}docs/heroes/generated/${NC}"
        echo -e "  - ${CYAN}docs/creatures/generated/${NC}"
    else
        echo -e "${RED}âŒ Erreur lors de la gÃ©nÃ©ration${NC}"
        return 1
    fi
}

# ğŸ“œ Fonction de traduction HOTS â†’ LittÃ©raire - OPUS
translate_scenario() {
    local scenario_file="$1"
    
    echo -e "${PURPLE}ğŸ“œ OPUS - Traduction LittÃ©raire Heroes of Time${NC}"
    echo -e "${PURPLE}===============================================${NC}"
    echo ""
    
    # VÃ©rifier que le script existe
    if [ ! -f "scripts/generate-scenario-translation.py" ]; then
        echo -e "${RED}âŒ Script de traduction non trouvÃ©: scripts/generate-scenario-translation.py${NC}"
        return 1
    fi
    
    # Si aucun fichier spÃ©cifiÃ©, afficher l'aide
    if [ -z "$scenario_file" ]; then
        echo -e "${YELLOW}Usage: ./hots translate <fichier.hots>${NC}"
        echo ""
        echo -e "${CYAN}Exemples:${NC}"
        echo -e "  ${GREEN}./hots translate scenarios/bataille_temporelle.hots${NC}"
        echo -e "  ${GREEN}./hots translate scenarios/reconciliation_vince_opus.hots${NC}"
        echo ""
        echo -e "${CYAN}ğŸ“‹ ScÃ©narios disponibles:${NC}"
        if [ -d "scenarios" ]; then
            ls -1 scenarios/*.hots 2>/dev/null | head -10
        fi
        if [ -d "frontend/public/game_assets/scenarios/hots" ]; then
            echo -e "${CYAN}ğŸ“‹ Autres scÃ©narios:${NC}"
            ls -1 frontend/public/game_assets/scenarios/hots/*.hots 2>/dev/null | head -10
        fi
        return 0
    fi
    
    # VÃ©rifier que le fichier existe
    if [ ! -f "$scenario_file" ]; then
        echo -e "${RED}âŒ Fichier non trouvÃ©: $scenario_file${NC}"
        return 1
    fi
    
    # Lancer la traduction
    echo -e "${CYAN}ğŸ”® Traduction en cours de: $scenario_file${NC}"
    python3 scripts/generate-scenario-translation.py "$scenario_file"
    
    # Afficher le rÃ©sultat
    if [ $? -eq 0 ]; then
        local output_name="${scenario_file##*/}"
        output_name="${output_name%.hots}_LITERARY.md"
        echo -e "${GREEN}âœ… Traduction gÃ©nÃ©rÃ©e: docs/scenarios/generated/$output_name${NC}"
        echo -e "${YELLOW}ğŸ’¡ Ouvrez le fichier pour lire la narration Ã©pique !${NC}"
    else
        echo -e "${RED}âŒ Erreur lors de la traduction${NC}"
        return 1
    fi
}

# ğŸ—ºï¸ Fonctions MAP
manage_maps() {
    local action="$1"
    
    case "$action" in
        "list"|"")
            echo -e "${CYAN}ğŸ—ºï¸  SYSTÃˆME MAP - Heroes of Time${NC}"
            echo -e "${CYAN}================================${NC}"
            echo ""
            echo -e "${YELLOW}ğŸ“ Maps disponibles :${NC}"
            
            if [ -d "game_assets/scenarios/maps/templates" ]; then
                find game_assets/scenarios/maps/templates -name "*.hsp" -o -name "*.json" | while read map; do
                    local name=$(basename "$map")
                    local size=$(du -sh "$map" 2>/dev/null | cut -f1)
                    echo -e "  ğŸ“„ ${GREEN}$name${NC} (${size})"
                done
            else
                echo -e "  âŒ Dossier templates non trouvÃ©"
            fi
            
            echo ""
            echo -e "${YELLOW}ğŸ® Commandes disponibles :${NC}"
            echo -e "  ${GREEN}./hots map list${NC}          # Liste les maps"
            echo -e "  ${GREEN}./hots map create <name>${NC}  # CrÃ©er une nouvelle map"
            echo -e "  ${GREEN}./hots map info <name>${NC}    # Infos sur une map"
            ;;
        "create")
            local map_name="$2"
            if [ -z "$map_name" ]; then
                echo -e "${RED}âŒ Usage: ./hots map create <nom_de_la_map>${NC}"
                return 1
            fi
            
            echo -e "${YELLOW}ğŸ”§ CrÃ©ation de la map: $map_name${NC}"
            echo -e "${GREEN}âœ… Map crÃ©Ã©e (fonctionnalitÃ© Ã  implÃ©menter)${NC}"
            ;;
        "info")
            local map_name="$2"
            echo -e "${YELLOW}ğŸ“Š Informations sur la map: $map_name${NC}"
            echo -e "${GREEN}âœ… Infos map (fonctionnalitÃ© Ã  implÃ©menter)${NC}"
            ;;
        *)
            echo -e "${RED}âŒ Action inconnue: $action${NC}"
            echo -e "${YELLOW}Actions disponibles: list, create, info${NC}"
            return 1
            ;;
    esac
}

# ğŸ“¹ Fonctions REPLAY
manage_replays() {
    local action="$1"
    
    case "$action" in
        "list"|"")
            echo -e "${CYAN}ğŸ“¹ SYSTÃˆME REPLAY - Heroes of Time${NC}"
            echo -e "${CYAN}==================================${NC}"
            echo ""
            echo -e "${YELLOW}ğŸ¬ Replays disponibles :${NC}"
            
            if [ -d "game_assets/scenarios/maps/replays" ]; then
                find game_assets/scenarios/maps/replays -name "*.hsp" -o -name "*.json" | while read replay; do
                    local name=$(basename "$replay" | sed 's/\.[^.]*$//')
                    local size=$(du -sh "$replay" 2>/dev/null | cut -f1)
                    local date=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M" "$replay" 2>/dev/null)
                    echo -e "  ğŸ¬ ${GREEN}$name${NC} (${size}) - $date"
                done
            else
                echo -e "  âŒ Aucun replay trouvÃ©"
            fi
            
            echo ""
            echo -e "${YELLOW}ğŸ® Commandes disponibles :${NC}"
                echo -e "  ${GREEN}./hots replay list${NC}           # Liste les replays"
    echo -e "  ${GREEN}./hots replay center${NC}         # ğŸ¬ Ouvre le Centre de Replay (dashboard)"
    echo -e "  ${GREEN}./hots replay view <name>${NC}     # Voir un replay spÃ©cifique"
    echo -e "  ${GREEN}./hots replay analyze <name>${NC}  # Analyser un replay (infos dÃ©taillÃ©es)"
    echo -e "  ${GREEN}./hots replay save <name>${NC}     # Sauvegarder partie actuelle"
            ;;
        "view")
            local replay_name="$2"
            if [ -z "$replay_name" ]; then
                echo -e "${RED}âŒ Usage: ./hots replay view <nom_du_replay>${NC}"
                return 1
            fi
            
            echo -e "${YELLOW}ğŸ¬ Visualisation du replay: $replay_name${NC}"
            echo -e "${GREEN}âœ… Ouverture du Centre de Replay...${NC}"
            
            # VÃ©rifier que le dashboard est actif
            if ! curl -s http://localhost:8000/dashboard.html > /dev/null; then
                echo -e "${RED}âŒ Dashboard non accessible sur le port 8000${NC}"
                echo -e "${YELLOW}ğŸ’¡ Lancez d'abord: ./hots start${NC}"
                return 1
            fi
            
            echo -e "${CYAN}ğŸ¬ Ouverture du Centre de Replay dans le navigateur...${NC}"
            if command -v open > /dev/null; then
                # macOS
                open "http://localhost:8000/dashboard.html"
            elif command -v xdg-open > /dev/null; then
                # Linux
                xdg-open "http://localhost:8000/dashboard.html"
            else
                echo -e "${YELLOW}ğŸ“‹ AccÃ©dez manuellement Ã : http://localhost:8000/dashboard.html${NC}"
                echo -e "${YELLOW}   Puis cliquez sur 'ğŸ¬ Centre de Replay'${NC}"
            fi
            ;;
        "center"|"centre")
            echo -e "${CYAN}ğŸ¬ Ouverture du Centre de Replay Heroes of Time${NC}"
            
            # VÃ©rifier que le dashboard est actif
            if ! curl -s http://localhost:8000/dashboard.html > /dev/null; then
                echo -e "${RED}âŒ Dashboard non accessible sur le port 8000${NC}"
                echo -e "${YELLOW}ğŸ’¡ Lancez d'abord: ./hots start${NC}"
                return 1
            fi
            
            echo -e "${GREEN}âœ… Dashboard actif - Ouverture du navigateur...${NC}"
            if command -v open > /dev/null; then
                # macOS
                open "http://localhost:8000/dashboard.html"
            elif command -v xdg-open > /dev/null; then
                # Linux  
                xdg-open "http://localhost:8000/dashboard.html"
            else
                echo -e "${YELLOW}ğŸ“‹ AccÃ©dez manuellement Ã : http://localhost:8000/dashboard.html${NC}"
                echo -e "${YELLOW}   Puis cliquez sur 'ğŸ¬ Centre de Replay'${NC}"
            fi
            ;;
        "analyze")
            local replay_name="$2"
            echo -e "${YELLOW}ğŸ“Š Analyse du replay: $replay_name${NC}"
            
            # Chercher le fichier de replay
            local replay_file=""
            if [ -f "game_assets/scenarios/maps/replays/20250721_session_jean/$replay_name.hsp" ]; then
                replay_file="game_assets/scenarios/maps/replays/20250721_session_jean/$replay_name.hsp"
            elif [ -f "game_assets/scenarios/visualizer/$replay_name.hsp" ]; then
                replay_file="game_assets/scenarios/visualizer/$replay_name.hsp"
            fi
            
            if [ -n "$replay_file" ]; then
                echo -e "${GREEN}ğŸ“„ Fichier trouvÃ©: $replay_file${NC}"
                echo -e "${CYAN}ğŸ“Š Informations du replay:${NC}"
                
                # Extraire les infos JSON
                if command -v jq > /dev/null; then
                    echo -e "${YELLOW}ğŸ® Nom du jeu:${NC} $(jq -r '.replayInfo.gameName // "N/A"' "$replay_file" 2>/dev/null)"
                    echo -e "${YELLOW}ğŸ“… Date:${NC} $(jq -r '.replayInfo.date // "N/A"' "$replay_file" 2>/dev/null)"
                    echo -e "${YELLOW}â±ï¸ DurÃ©e:${NC} $(jq -r '.replayInfo.duration // "N/A"' "$replay_file" 2>/dev/null)"
                    echo -e "${YELLOW}ğŸ† Gagnant:${NC} $(jq -r '.replayInfo.winner // "N/A"' "$replay_file" 2>/dev/null)"
                    echo -e "${YELLOW}ğŸ‘¥ Joueurs:${NC} $(jq -r '.replayInfo.players | join(", ") // "N/A"' "$replay_file" 2>/dev/null)"
                    echo -e "${YELLOW}ğŸ”„ Tours:${NC} $(jq -r '.replayInfo.totalTurns // "N/A"' "$replay_file" 2>/dev/null)"
                else
                    head -20 "$replay_file"
                fi
            else
                echo -e "${RED}âŒ Replay '$replay_name' non trouvÃ©${NC}"
                echo -e "${YELLOW}ğŸ’¡ Utilisez: ./hots replay list${NC}"
            fi
            ;;
        "save")
            local replay_name="$2"
            echo -e "${YELLOW}ğŸ’¾ Sauvegarde de la partie actuelle: $replay_name${NC}"
            echo -e "${GREEN}âœ… FonctionnalitÃ© de sauvegarde (Ã  connecter au backend)${NC}"
            ;;
        *)
            echo -e "${RED}âŒ Action inconnue: $action${NC}"
            echo -e "${YELLOW}Actions disponibles: list, view, analyze, save${NC}"
            return 1
            ;;
    esac
}

# ğŸ¨ Fonction Ã‰DITEUR VISUEL
launch_visual_editor() {
    echo -e "${CYAN}ğŸ¨ Ã‰DITEUR VISUEL SCRIPT SPATIO-TEMPOREL - Heroes of Time${NC}"
    echo -e "${CYAN}========================================================${NC}"
    echo ""
    
    # VÃ©rifier que le frontend est actif
    if ! curl -s http://localhost:8000 > /dev/null; then
        echo -e "${RED}âŒ Frontend non accessible sur le port 8000${NC}"
        echo -e "${YELLOW}ğŸ’¡ Lancez d'abord: ./hots start essential${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… Frontend actif - Ouverture de l'Ã©diteur visuel...${NC}"
    if command -v open > /dev/null; then
        # macOS
        open "http://localhost:8000/visual-script-editor.html"
    elif command -v xdg-open > /dev/null; then
        # Linux  
        xdg-open "http://localhost:8000/visual-script-editor.html"
    else
        echo -e "${YELLOW}ğŸ“‹ AccÃ©dez manuellement Ã : http://localhost:8000/visual-script-editor.html${NC}"
    fi
    
    echo -e "${CYAN}ğŸ¨ FonctionnalitÃ©s de l'Ã©diteur:${NC}"
    echo -e "  ğŸš¶ Actions de base (MOV, USE, CREATE, HERO, BATTLE)"
    echo -e "  Ïˆ Actions temporelles (PSI, TRIGGER, COLLAPSE)"
    echo -e "  â° Timeline Editor avec branches multiples"
    echo -e "  ğŸ® Game Board interactif"
    echo -e "  ğŸ”§ SystÃ¨me de macros personnalisÃ©es"
    echo -e "  ğŸ“œ GÃ©nÃ©ration automatique de scripts"
    echo -e "  ğŸ’¾ Sauvegarde/chargement de configurations"
    echo ""
    echo -e "${YELLOW}ğŸ’¡ RÃ©volution du game design:${NC}"
    echo -e "  â€¢ Premier IDE visuel de scripting quantico-temporel au monde"
    echo -e "  â€¢ Point-and-click â†’ Scripts complexes automatiques"
    echo -e "  â€¢ Visualisation des superpositions et causalitÃ©s"
    echo -e "  â€¢ Macros personnalisÃ©es pour actions rapides"
}

# ğŸ® Fonction INTERFACE ADMIN MULTIJOUEUR
launch_admin_interface() {
    echo -e "${CYAN}ğŸ® INTERFACE D'ADMINISTRATION MULTIJOUEUR - Heroes of Time${NC}"
    echo -e "${CYAN}========================================================${NC}"
    echo ""
    
    # VÃ©rifier que les services sont actifs
    if ! curl -s http://localhost:8080 > /dev/null; then
        echo -e "${RED}âŒ Backend non accessible sur le port 8080${NC}"
        echo -e "${YELLOW}ğŸ’¡ Lancez d'abord: ./hots start essential${NC}"
        return 1
    fi
    
    if ! curl -s http://localhost:8000 > /dev/null; then
        echo -e "${RED}âŒ Frontend non accessible sur le port 8000${NC}"
        echo -e "${YELLOW}ğŸ’¡ Lancez d'abord: ./hots start essential${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… Services vÃ©rifiÃ©s${NC}"
    echo ""
    echo -e "${YELLOW}ğŸ® Lancement de l'interface d'administration multijoueur...${NC}"
    echo ""
    
    # Ouvrir l'interface dans le navigateur
    if command -v open > /dev/null; then
        open "http://localhost:8000/admin-multiplayer.html"
    elif command -v xdg-open > /dev/null; then
        xdg-open "http://localhost:8000/admin-multiplayer.html"
    else
        echo -e "${YELLOW}ğŸŒ Ouvrez manuellement: http://localhost:8000/admin-multiplayer.html${NC}"
    fi
    
    echo -e "${GREEN}ğŸ® Interface d'administration lancÃ©e !${NC}"
    echo ""
    echo -e "${CYAN}ğŸ“‹ FonctionnalitÃ©s disponibles:${NC}"
    echo -e "  ğŸ—ï¸  Gestion des jeux (crÃ©er, lister, supprimer)"
    echo -e "  ğŸ‘¥ Gestion des joueurs (ajouter, expulser)"
    echo -e "  ğŸ¦¸ Gestion des hÃ©ros (apparaÃ®tre, tÃ©lÃ©porter, supprimer)"
    echo -e "  ğŸ¯ ContrÃ´le du jeu (pause, tour suivant, reset, fin)"
    echo -e "  ğŸš€ DÃ©marrage rapide multijoueur"
    echo -e "  ğŸ§ª Tests complets du systÃ¨me"
    echo -e "  ğŸ¬ DÃ©mo multijoueur"
    echo ""
    echo -e "${YELLOW}ğŸ’¡ Mode Administrateur - Jean sur le canapÃ©${NC}"
    echo -e "${YELLOW}ğŸ’¡ Protocole Memento - Fusion Claudius activÃ©e${NC}"
}

# Fonction pour gÃ©rer les scÃ©narios HEP
manage_scenarios() {
    local command="$1"
    local scenario_name="$2"
    
    echo -e "${PURPLE}ğŸ¬ Gestionnaire de ScÃ©narios HEP (Heroes Epic Play)${NC}"
    echo -e "${PURPLE}==============================================${NC}"
    
    case "$command" in
        "list"|"")
            echo -e "${YELLOW}ğŸ“‹ ScÃ©narios HEP disponibles:${NC}"
            echo ""
            
            if [ -d "game_assets/scenarios/hots" ]; then
                echo -e "${CYAN}ğŸ¬ ScÃ©narios HOTS (.hots):${NC}"
                find game_assets/scenarios/hots -name "*.hots" -type f | while read file; do
                    local filename=$(basename "$file" .hots)
                    local size=$(du -h "$file" 2>/dev/null | cut -f1)
                    echo -e "  ğŸ“„ ${GREEN}$filename${NC} (${size})"
                done
            fi
            
            if [ -d "game_assets/scenarios" ]; then
                echo ""
                echo -e "${CYAN}ğŸ® ScÃ©narios JSON classiques:${NC}"
                find game_assets/scenarios -name "*.json" -type f | while read file; do
                    local filename=$(basename "$file" .json)
                    local size=$(du -h "$file" 2>/dev/null | cut -f1)
                    echo -e "  ğŸ“„ ${BLUE}$filename${NC} (${size})"
                done
            fi
            
            echo ""
            echo -e "${YELLOW}ğŸ’¡ Usage: ./hots scenario [nom_scenario]${NC}"
            echo -e "${YELLOW}ğŸ’¡ Exemple: ./hots scenario bataille${NC}"
            ;;
            
        "bataille"|"bataille_temporelle")
            echo -e "${YELLOW}âš”ï¸  Lancement de la Bataille Temporelle ComplÃ¨te...${NC}"
            local scenario_file="game_assets/scenarios/hots/bataille_temporelle_complete.hots"
            if [ -f "$scenario_file" ]; then
                echo -e "${GREEN}âœ… ScÃ©nario trouvÃ©: $scenario_file${NC}"
                echo -e "${CYAN}ğŸ“Š Analyse du scÃ©nario:${NC}"
                wc -l "$scenario_file"
                echo ""
                if [ -x "scripts/test-anthor-ford-scenario.sh" ]; then
                    echo -e "${BLUE}ğŸ¯ Lancement avec moteur de test intÃ©grÃ©...${NC}"
                    ./scripts/test-anthor-ford-scenario.sh "$scenario_file"
                else
                    echo -e "${YELLOW}âš ï¸  Moteur de test non trouvÃ©, lancement simulÃ©...${NC}"
                    echo -e "${CYAN}ğŸ¬ Contenu du scÃ©nario:${NC}"
                    head -20 "$scenario_file"
                    echo -e "${YELLOW}... (contenu tronquÃ©)${NC}"
                fi
            else
                echo -e "${RED}âŒ ScÃ©nario non trouvÃ©: $scenario_file${NC}"
            fi
            ;;
            
        "anthor"|"anthor_vs_grofi")
            echo -e "${YELLOW}ğŸ­ Lancement du Duel Anthor vs Jean-Grofignon...${NC}"
            local scenario_file="game_assets/scenarios/hots/anthor_vs_grofi_temporal_duel.hots"
            if [ -f "$scenario_file" ]; then
                echo -e "${GREEN}âœ… ScÃ©nario trouvÃ©: $scenario_file${NC}"
                echo -e "${CYAN}ğŸ“Š Analyse du scÃ©nario:${NC}"
                wc -l "$scenario_file"
                echo ""
                if [ -x "scripts/test-anthor-ford-scenario.sh" ]; then
                    echo -e "${BLUE}ğŸ¯ Lancement du test Anthor spÃ©cialisÃ©...${NC}"
                    ./scripts/test-anthor-ford-scenario.sh
                else
                    echo -e "${YELLOW}âš ï¸  Moteur de test Anthor non trouvÃ©, affichage du scÃ©nario...${NC}"
                    echo -e "${CYAN}ğŸ¬ Extrait du duel Ã©pique:${NC}"
                    grep -E "(HERO|SAY|ABILITY)" "$scenario_file" | head -10
                    echo -e "${YELLOW}... (plus de contenu disponible)${NC}"
                fi
            else
                echo -e "${RED}âŒ ScÃ©nario non trouvÃ©: $scenario_file${NC}"
            fi
            ;;
            
        *)
            echo -e "${YELLOW}ğŸ” Recherche du scÃ©nario: $command${NC}"
            local found=false
            
            # Chercher dans les fichiers .hots
            if [ -d "game_assets/scenarios/hots" ]; then
                for file in game_assets/scenarios/hots/*.hots; do
                    if [[ "$(basename "$file" .hots)" == *"$command"* ]]; then
                        echo -e "${GREEN}âœ… ScÃ©nario HOTS trouvÃ©: $(basename "$file")${NC}"
                        echo -e "${CYAN}ğŸ“Š Analyse:${NC}"
                        wc -l "$file"
                        echo -e "${CYAN}ğŸ¬ AperÃ§u:${NC}"
                        head -10 "$file"
                        found=true
                        break
                    fi
                done
            fi
            
            # Chercher dans les fichiers JSON
            if [ ! "$found" = true ] && [ -d "game_assets/scenarios" ]; then
                for file in game_assets/scenarios/*.json; do
                    if [[ "$(basename "$file" .json)" == *"$command"* ]]; then
                        echo -e "${GREEN}âœ… ScÃ©nario JSON trouvÃ©: $(basename "$file")${NC}"
                        echo -e "${CYAN}ğŸ“Š Analyse:${NC}"
                        wc -l "$file"
                        echo -e "${CYAN}ğŸ¬ AperÃ§u:${NC}"
                        head -10 "$file"
                        found=true
                        break
                    fi
                done
            fi
            
            if [ ! "$found" = true ]; then
                echo -e "${RED}âŒ ScÃ©nario '$command' non trouvÃ©${NC}"
                echo -e "${YELLOW}ğŸ’¡ Utilisez './hots scenario list' pour voir les scÃ©narios disponibles${NC}"
            fi
            ;;
    esac
}

# Fonction principale
case "${1:-help}" in
    "start")
        if [ "$2" = "essential" ]; then
            start_essential_services
        else
            start_services
        fi
        ;;
    "stop")
        stop_services
        ;;
    "restart")
        restart_services
        ;;
    "status")
        show_status
        ;;
    "test")
        run_test_suite "$2"
        ;;
    "playwright")
        echo -e "${PURPLE}ğŸ­ PLAYWRIGHT UNIVERSE TEST${NC}"
        echo "============================="
        echo ""
        echo -e "${YELLOW}ğŸš€ Lancement tests Playwright sur toutes les interfaces...${NC}"
        
        # Quick test des interfaces principales
        echo -e "${CYAN}ğŸ“Š Test rapide des URLs principales:${NC}"
        
        interfaces=(
            "http://localhost:8000/portail-100-html-interfaces.html|ğŸŒ€ Portail Ultime"
            "http://localhost:8000/vince-vega-hexagon-battlefield.html|â¬¡ Hexagon Battlefield"
            "http://localhost:8000/omega-zero-trilogie-visuelle.html|âš”ï¸ OmegaZero Trilogie"
            "http://localhost:9000/dashboard.html|ğŸ“Š Dashboard 9000"
            "http://localhost:8003|ğŸ›ï¸ Panopticon GRUT"
            "http://localhost:3000|âš›ï¸ React Frontend"
            "http://localhost:8080/api/health|ğŸ”§ Backend Health"
        )
        
        success_count=0
        total_count=${#interfaces[@]}
        
        for interface in "${interfaces[@]}"; do
            url=$(echo "$interface" | cut -d'|' -f1)
            name=$(echo "$interface" | cut -d'|' -f2)
            
            echo -n "  Testing $name... "
            
            if curl -s -f --connect-timeout 3 "$url" > /dev/null 2>&1; then
                echo -e "${GREEN}âœ… OK${NC}"
                ((success_count++))
            else
                echo -e "${RED}âŒ FAILED${NC}"
            fi
        done
        
        echo ""
        echo -e "${CYAN}ğŸ“Š RÃ©sultats Playwright Universe:${NC}"
        echo -e "  âœ… SuccÃ¨s: $success_count/$total_count"
        echo -e "  ğŸ“ˆ Taux: $((success_count * 100 / total_count))%"
        
        if [ $success_count -eq $total_count ]; then
            echo -e "${GREEN}ğŸ‰ TOUS LES TESTS PLAYWRIGHT PASSÃ‰S !${NC}"
            echo -e "${PURPLE}âš¡ Hexagon Battlefield: BESTAGON CONFIRMED${NC}"
            echo -e "${PURPLE}ğŸŒ€ Interface Fusion: READY FOR HEISENBERG${NC}"
        else
            echo -e "${YELLOW}âš ï¸ Certaines interfaces nÃ©cessitent attention${NC}"
            echo -e "${CYAN}ğŸ’¡ Utilisez './hots start' pour dÃ©marrer tous les services${NC}"
        fi
        
        # Ouvrir le portail si tout fonctionne
        if [ $success_count -ge 4 ] && command -v open >/dev/null 2>&1; then
            echo -e "${CYAN}ğŸŒ€ Ouverture du Portail Ultime...${NC}"
            open "http://localhost:8000/portail-100-html-interfaces.html" 2>/dev/null &
        fi
        ;;
    "generate")
        generate_md_docs
        ;;
    "translate")
        if [ "$2" = "health" ]; then
            echo -e "${GREEN}ğŸ¥ Test santÃ© services de traduction...${NC}"
            echo -e "${BLUE}ğŸ” Backend Java Translation Services:${NC}"
            curl -s -X GET "http://localhost:8080/api/translate/health" | python3 -m json.tool || echo "âŒ Backend non disponible"
            echo ""
            echo -e "${BLUE}ğŸ” Python Translation Service:${NC}"
            python3 MUSEUM/scripts-collection/test-smart-translation.py
        elif [ "$2" = "test" ]; then
            echo -e "${GREEN}ğŸ§ª Test complet systÃ¨me traduction hybride...${NC}"
            echo -e "${CYAN}ğŸŒŸ Tests: MagicFormulaEngine + ScenarioTranslationService + Python Bridge${NC}"
            python3 MUSEUM/scripts-collection/test-smart-translation.py
        else
            translate_scenario "$2"
        fi
        ;;
    "map")
        manage_maps "$2" "$3"
        ;;
    "replay")
        manage_replays "$2" "$3"
        ;;
    "demo")
        if [ "$2" = "noob" ]; then
            # MODE NOOB - DÃ©monstration pour dÃ©butants
            echo -e "${PURPLE}ğŸ® HEROES OF TIME - DÃ‰MO POUR NOOBS${NC}"
            echo "======================================="
            echo -e "${CYAN}ğŸ›‹ï¸ Jean-Grofignon: DÃ©mo ultra-simple pour joueurs lambda !${NC}"
            echo ""
            if [ -f "./hots-demo-noob.sh" ]; then
                bash ./hots-demo-noob.sh
            else
                echo -e "${RED}âŒ Script hots-demo-noob.sh non trouvÃ©${NC}"
                exit 1
            fi
            exit 0
        elif [ "$2" = "quick" ]; then
            # MODE QUICK - DÃ©monstration rapide automatique
            echo -e "${PURPLE}ğŸ® HEROES OF TIME - DÃ‰MO ZFC QUICK MODE${NC}"
            echo "========================================="
            echo -e "${CYAN}ğŸš€ DÃ©monstration rapide - Pas de pauses${NC}"
        else
            # MODE Ã‰PIQUE PAR DÃ‰FAUT - Replay interactif
            echo -e "${PURPLE}ğŸ® HEROES OF TIME - DÃ‰MONSTRATION ZFC Ã‰PIQUE${NC}"
            echo "=============================================="
            echo -e "${CYAN}ğŸš€ Mode Replay Ã‰pique - ScÃ©nario ZFC avec pauses dramatiques${NC}"
        fi
        
        echo ""
        
        # VÃ©rifier si les services sont dÃ©jÃ  actifs
        echo -e "${BLUE}ğŸ” VÃ©rification des services...${NC}"
        if curl -s http://localhost:8080/api/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Backend dÃ©jÃ  actif${NC}"
        else
            echo -e "${YELLOW}âš™ï¸  DÃ©marrage du Backend...${NC}"
            start_essential_services
            if [ $? -ne 0 ]; then
                echo -e "${RED}âŒ Erreur dÃ©marrage services${NC}"
                exit 1
            fi
        fi
        
        # Ouvrir l'interface 8000 avec paramÃ¨tre auto-replay
        echo -e "${YELLOW}ğŸŒ Ouverture Interface Temporal Engine avec Auto-Replay...${NC}"
        if command -v open >/dev/null 2>&1; then
            # macOS  
            open "http://localhost:8000?demo=auto&scenario=zfc" 2>/dev/null &
        elif command -v xdg-open >/dev/null 2>&1; then
            # Linux
            xdg-open "http://localhost:8000?demo=auto&scenario=zfc" 2>/dev/null &
        fi
        
        if [ "$2" = "quick" ]; then
            # MODE QUICK - Version rapide automatique
            echo ""
            echo -e "${PURPLE}âš¡ DÃ‰MONSTRATION ZFC QUICK MODE${NC}"
            echo "================================"
            echo -e "${CYAN}ğŸ“– ScÃ©nario : 4 joueurs simultanÃ©s sur Nexus Temporal Chaos${NC}"
            echo ""
            
            echo -e "${GREEN}ğŸ¯ PHASES AUTOMATIQUES (MODE QUICK)...${NC}"
            echo -e "${PURPLE}âš¡ PHASE 1${NC} : Actions simultanÃ©es â†’ 4 zones ZFC crÃ©Ã©es (73ms)"
            echo -e "${PURPLE}ğŸ›ï¸  PHASE 2${NC} : TrinitÃ© rÃ©sout conflits â†’ Duels Ã©piques + Dragons"
            echo -e "${PURPLE}ğŸ‘» PHASE 3${NC} : Shadow actions â†’ 94.3% prÃ©cision prÃ©dictive"
            echo -e "${PURPLE}ğŸš€ PHASE 4${NC} : Pathfinding Q* â†’ 36.5% succÃ¨s Excalibur via T67"
            echo -e "${PURPLE}âš¡ PHASE 5${NC} : Chaos maximal â†’ 8 zones actives simultanÃ©es"
            sleep 1
            
            echo ""
            echo -e "${GREEN}ğŸ† RÃ‰SULTATS : Morgana ğŸ¥‡ | Arthur ğŸ¥ˆ | Lysandrel ğŸ¥‰ | Ragnar ğŸ¥´${NC}"
            echo -e "${PURPLE}ğŸ“Š PERFORMANCE : ZFC 73ms | WebSocket 34ms | FPS 60 | PrÃ©cision 94%${NC}"
        else
            # MODE Ã‰PIQUE - Script interactif complet
            echo ""
            echo -e "${GREEN}ğŸ¬ LANCEMENT REPLAY Ã‰PIQUE INTERACTIF...${NC}"
            
            if [ -f "scripts/demo/demo-zfc-epic-replay.sh" ]; then
                bash "scripts/demo/demo-zfc-epic-replay.sh"
            else
                echo -e "${RED}âŒ Script de dÃ©mo Ã©pique non trouvÃ©${NC}"
                echo -e "${YELLOW}ğŸ’¡ Passage en mode quick...${NC}"
                # Fallback vers quick mode
                echo -e "${PURPLE}âš¡ DÃ‰MONSTRATION ZFC QUICK MODE (FALLBACK)${NC}"
                echo -e "${GREEN}ğŸ¯ PHASES AUTOMATIQUES...${NC}"
                echo -e "${PURPLE}âš¡ Actions simultanÃ©es â†’ ğŸ›ï¸ TrinitÃ© â†’ ğŸ‘» Shadow â†’ ğŸš€ Q* â†’ âš¡ Chaos${NC}"
                sleep 2
                echo -e "${GREEN}ğŸ† ZFC RÃ‰VOLUTION DÃ‰MONTRÃ‰E !${NC}"
            fi
        fi
        
        echo ""
        echo -e "${CYAN}ğŸ® INTERFACE OUVERTE :${NC}"
        echo "  ğŸ“Š Frontend Temporal Engine : http://localhost:8000"
        echo ""
        echo -e "${YELLOW}ğŸ’¡ Autres interfaces disponibles :${NC}"
        echo "  ğŸ¯ Dashboard : http://localhost:8000/dashboard.html"
        echo "  âš”ï¸  Interface Temporelle : http://localhost:5174"
        echo ""
        
        echo -e "${GREEN}âœ… DÃ‰MONSTRATION ZFC COMPLÃˆTE !${NC}"
        echo -e "${PURPLE}ğŸ® SystÃ¨me gaming asynchrone rÃ©volutionnaire dÃ©montrÃ©e !${NC}"
        echo -e "${YELLOW}ğŸ’¡ Usage: ./hots demo (Ã©pique) ou ./hots demo quick (rapide)${NC}"
        ;;
    "editor")
        launch_visual_editor
        ;;
    "admin")
        launch_admin_interface
        ;;
    "test-uis")
        run_test_suite "ui"
        ;;
    "worldstate")
        echo -e "${BLUE}ğŸŒ World State Graph - Visualisation Ã©tat mondial${NC}"
        echo "================================="
        echo ""
        echo -e "${GREEN}ğŸ¯ Tests World State Graph API:${NC}"
        
        # Test backend connection
        if curl -s http://localhost:8080/api/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Backend connectÃ©${NC}"
            
            echo -e "${YELLOW}ğŸ“Š Test endpoints World State Graph:${NC}"
            echo -e "${CYAN}  ğŸŒ GET /api/world-state-graph/graph${NC}"
            curl -s "http://localhost:8080/api/world-state-graph/graph" | head -3
            
            echo -e "${CYAN}  ğŸ‘¥ GET /api/world-state-graph/player-nodes${NC}"
            curl -s "http://localhost:8080/api/world-state-graph/player-nodes" | head -3
            
            echo -e "${CYAN}  ğŸ§  GET /api/world-state-graph/ai-decisions${NC}"
            curl -s "http://localhost:8080/api/world-state-graph/ai-decisions" | head -3
            
            echo ""
            echo -e "${GREEN}ğŸ›ï¸ Panopticon GRUT avec World State Graph:${NC}"
            echo "  ğŸ“Š http://localhost:8001 (React Dashboard)"
            
            if command -v open >/dev/null 2>&1; then
                open "http://localhost:8001" 2>/dev/null &
            fi
        else
            echo -e "${RED}âŒ Backend non connectÃ© - DÃ©marrez avec ./hots start${NC}"
        fi
        ;;
    "multi-realm")
        echo -e "${BLUE}ğŸŒŒ Multi Realm Manager - Gestion des realms${NC}"
        echo "=========================================="
        echo ""
        echo -e "${GREEN}ğŸ¯ Tests Multi Realm API:${NC}"
        
        if curl -s http://localhost:8080/api/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Backend connectÃ©${NC}"
            
            echo -e "${YELLOW}ğŸŒŒ Test endpoints Multi Realm:${NC}"
            echo -e "${CYAN}  ğŸŒ GET /api/multi-realm/realms${NC}"
            curl -s "http://localhost:8080/api/multi-realm/realms" | head -5
            
            echo -e "${CYAN}  ğŸ‘ï¸ GET /api/multi-realm/sixth-dimension${NC}"
            curl -s "http://localhost:8080/api/multi-realm/sixth-dimension" | head -3
            
            echo -e "${CYAN}  ğŸ”« POST /api/multi-realm/vince-shoots-opus${NC}"
            curl -s -X POST "http://localhost:8080/api/multi-realm/vince-shoots-opus" | head -3
            
            echo ""
            echo -e "${GREEN}ğŸ›ï¸ GRUT Vision Multi Realm validÃ©e !${NC}"
        else
            echo -e "${RED}âŒ Backend non connectÃ© - DÃ©marrez avec ./hots start${NC}"
        fi
        ;;
    "benedikt")
        echo -e "${BLUE}ğŸŒ€ Benedikt Conulbrurcus - Tests tÃ©lÃ©portation${NC}"
        echo "=============================================="
        echo ""
        echo -e "${GREEN}ğŸ¯ Tests formules Benedikt:${NC}"
        
        if curl -s http://localhost:8080/api/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Backend connectÃ©${NC}"
            
            echo -e "${YELLOW}ğŸŒ€ Test formules tÃ©lÃ©portation Benedikt:${NC}"
            
            echo -e "${CYAN}  ğŸŒ€ BENEDIKT_CIRCLE_TELEPORT${NC}"
            curl -s -X POST "http://localhost:8080/api/magic-formulas/execute" \
                -H "Content-Type: application/json" \
                -d '{"formulaType": "SIMPLE", "formulaName": "BENEDIKT_CIRCLE_TELEPORT", "parameters": {}}' | head -3
            
            echo -e "${CYAN}  ğŸŒ€ BENEDIKT_MULTI_TELEPORT${NC}"
            curl -s -X POST "http://localhost:8080/api/magic-formulas/execute" \
                -H "Content-Type: application/json" \
                -d '{"formulaType": "SIMPLE", "formulaName": "BENEDIKT_MULTI_TELEPORT", "parameters": {}}' | head -3
            
            echo -e "${CYAN}  ğŸŒ€ BENEDIKT_COSMIC_CIRCLES${NC}"
            curl -s -X POST "http://localhost:8080/api/magic-formulas/execute" \
                -H "Content-Type: application/json" \
                -d '{"formulaType": "SIMPLE", "formulaName": "BENEDIKT_COSMIC_CIRCLES", "parameters": {}}' | head -3
            
            echo ""
            echo -e "${GREEN}ğŸŒ€ BENEDIKT CONULBRURCUS : TÃ©lÃ©portation cosmique validÃ©e !${NC}"
        else
            echo -e "${RED}âŒ Backend non connectÃ© - DÃ©marrez avec ./hots start${NC}"
        fi
        ;;
    "debug")
        echo -e "${BLUE}ğŸ› Mode debug actif - Lancement de la compilation avec debug info...${NC}"
        if [ -d "backend" ]; then
            cd backend
            echo -e "${YELLOW}ğŸ”§ Compilation avec debug info...${NC}"
            mvn clean compile -e -X > ../debug-compile.log 2>&1
            if [ $? -eq 0 ]; then
                echo -e "${GREEN}âœ… Compilation rÃ©ussie avec debug info${NC}"
                echo -e "${CYAN}ğŸ“‹ Logs sauvegardÃ©s dans: debug-compile.log${NC}"
            else
                echo -e "${RED}âŒ Erreurs de compilation dÃ©tectÃ©es${NC}"
                echo -e "${YELLOW}ğŸ“‹ VÃ©rifiez debug-compile.log pour les dÃ©tails${NC}"
                tail -20 ../debug-compile.log
            fi
            cd ..
        else
            echo -e "${RED}âŒ Dossier backend non trouvÃ©${NC}"
        fi
        ;;
    "compile")
        echo -e "${BLUE}ğŸ”§ Compilation backend avec debug info...${NC}"
        if [ -d "backend" ]; then
            cd backend
            echo -e "${YELLOW}ğŸ§¹ Nettoyage...${NC}"
            mvn clean
            echo -e "${YELLOW}ğŸ”§ Compilation avec debug...${NC}"
            mvn compile -e -X -Dorg.slf4j.simpleLogger.defaultLogLevel=debug
            if [ $? -eq 0 ]; then
                echo -e "${GREEN}âœ… Compilation rÃ©ussie${NC}"
                echo -e "${CYAN}ğŸ“‹ PrÃªt pour le dÃ©marrage en mode debug${NC}"
            else
                echo -e "${RED}âŒ Erreurs de compilation${NC}"
                echo -e "${YELLOW}ğŸ’¡ Utilisez './hots debug' pour plus de dÃ©tails${NC}"
            fi
            cd ..
        else
            echo -e "${RED}âŒ Dossier backend non trouvÃ©${NC}"
        fi
        ;;
    "logs")
        echo -e "${BLUE}ğŸ“‹ Affichage des logs en temps rÃ©el...${NC}"
        echo -e "${YELLOW}ğŸ’¡ Appuyez sur Ctrl+C pour arrÃªter${NC}"
        echo ""
        
        # Logs backend
        if [ -f "backend.log" ]; then
            echo -e "${CYAN}ğŸ”§ Logs Backend:${NC}"
            tail -f backend.log &
        fi
        
        # Logs debug
        if [ -f "debug-compile.log" ]; then
            echo -e "${CYAN}ğŸ› Logs Debug:${NC}"
            tail -f debug-compile.log &
        fi
        
        # Attendre l'interruption
        wait
        ;;
    "scenario")
        manage_scenarios "$2" "$3"
        ;;
    "vince")
        echo -e "${PURPLE}ğŸ”« Lancement de Vince's Process Annihilator !${NC}"
        echo -e "${YELLOW}ğŸ’€ 'Say hello to my little friend... the SIGKILL!'${NC}"
        echo ""
        
        if [ -x "scripts/vince-process-annihilator.sh" ]; then
            ./scripts/vince-process-annihilator.sh
        else
            echo -e "${RED}âŒ Script vince-process-annihilator.sh non trouvÃ© ou non exÃ©cutable${NC}"
            echo -e "${YELLOW}ğŸ’¡ VÃ©rifiez scripts/vince-process-annihilator.sh${NC}"
        fi
        ;;
    "walter")
        echo -e "${BLUE}ğŸ³ Activation du Walter's Anti-Vince Protocol !${NC}"
        echo -e "${YELLOW}ğŸ’€ 'This aggression will not stand, man!'${NC}"
        echo ""
        
        if [ -x "scripts/walter-anti-vince-protocol.sh" ]; then
            ./scripts/walter-anti-vince-protocol.sh
        else
            echo -e "${RED}âŒ Script walter-anti-vince-protocol.sh non trouvÃ© ou non exÃ©cutable${NC}"
            echo -e "${YELLOW}ğŸ’¡ VÃ©rifiez scripts/walter-anti-vince-protocol.sh${NC}"
        fi
        ;;
    "save")
        # Sauvegarde manuelle
        if [ -z "$2" ]; then
            echo -e "${RED}âŒ Nom de sauvegarde requis${NC}"
            echo -e "${YELLOW}Usage: ./hots save <nom_sauvegarde> [game_id] [player_id]${NC}"
            exit 1
        fi
        
        SAVE_NAME="$2"
        GAME_ID="${3:-1}"
        PLAYER_ID="${4:-player1}"
        
        echo -e "${BLUE}ğŸ’¾ Sauvegarde de la partie...${NC}"
        RESPONSE=$(curl -s -X POST "http://localhost:8080/api/persistence/games/$GAME_ID/save" \
            -H "Content-Type: application/json" \
            -d "{\"playerId\": \"$PLAYER_ID\", \"saveName\": \"$SAVE_NAME\", \"description\": \"Sauvegarde manuelle\"}")
        
        if echo "$RESPONSE" | jq -e '.success == true' > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Partie sauvegardÃ©e: $SAVE_NAME${NC}"
            echo "$RESPONSE" | jq -r '.message'
        else
            echo -e "${RED}âŒ Erreur sauvegarde${NC}"
            echo "$RESPONSE" | jq -r '.error // "Erreur inconnue"'
        fi
        ;;
    "load")
        # Charger une sauvegarde
        if [ -z "$2" ]; then
            echo -e "${RED}âŒ ID ou nom de sauvegarde requis${NC}"
            echo -e "${YELLOW}Usage: ./hots load <save_id_ou_nom> [player_id]${NC}"
            exit 1
        fi
        
        SAVE_ID="$2"
        PLAYER_ID="${3:-player1}"
        
        echo -e "${BLUE}ğŸ“‚ Chargement de la sauvegarde...${NC}"
        
        # Si c'est un nombre, charger par ID
        if [[ "$SAVE_ID" =~ ^[0-9]+$ ]]; then
            RESPONSE=$(curl -s -X POST "http://localhost:8080/api/persistence/saves/$SAVE_ID/load" \
                -H "Content-Type: application/json" \
                -d "{\"playerId\": \"$PLAYER_ID\"}")
        else
            # Sinon, chercher par nom (Ã  implÃ©menter cÃ´tÃ© backend si nÃ©cessaire)
            echo -e "${YELLOW}âš ï¸  Chargement par nom non encore implÃ©mentÃ©${NC}"
            echo -e "${YELLOW}ğŸ’¡ Utilisez './hots list-saves' pour voir les IDs${NC}"
            exit 1
        fi
        
        if echo "$RESPONSE" | jq -e '.success == true' > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Partie chargÃ©e avec succÃ¨s${NC}"
            echo "$RESPONSE" | jq -r '.message'
        else
            echo -e "${RED}âŒ Erreur chargement${NC}"
            echo "$RESPONSE" | jq -r '.error // "Erreur inconnue"'
        fi
        ;;
    "list-saves")
        # Lister les sauvegardes
        PLAYER_ID="${2:-player1}"
        
        echo -e "${BLUE}ğŸ“‹ Liste des sauvegardes pour $PLAYER_ID:${NC}"
        echo ""
        
        RESPONSE=$(curl -s "http://localhost:8080/api/persistence/saves?playerId=$PLAYER_ID")
        
        if echo "$RESPONSE" | jq -e '.success == true' > /dev/null 2>&1; then
            COUNT=$(echo "$RESPONSE" | jq -r '.count')
            echo -e "${GREEN}âœ… $COUNT sauvegarde(s) trouvÃ©e(s)${NC}"
            echo ""
            
            echo "$RESPONSE" | jq -r '.saves[] | 
                "ID: \(.id) | \(.saveName)" +
                "\n  Tour: \(.turnNumber) | " +
                (if .isAutoSave then "ğŸ”„ Auto-save" else "ğŸ’¾ Manuelle" end) +
                "\n  CrÃ©Ã©e: \(.createdAt) | DerniÃ¨re: \(.lastPlayedAt)" +
                "\n  " + (.description // "Pas de description") +
                "\n"'
        else
            echo -e "${RED}âŒ Erreur rÃ©cupÃ©ration sauvegardes${NC}"
            echo "$RESPONSE" | jq -r '.error // "Erreur inconnue"'
        fi
        ;;
    "excalibur-vega")
        # DÃ‰MO EXCALIBUR VS VINCE VEGA - Version lente visuelle pour Jean-Grofignon
        echo -e "${PURPLE}ğŸ—¡ï¸âš¡ HEROES OF TIME - EXCALIBUR VS VINCE VEGA${NC}"
        echo "=================================================="
        echo -e "${CYAN}ğŸ›‹ï¸ Jean-Grofignon: DÃ©mo version lente visuelle sur port 8000 !${NC}"
        echo ""
        
        # VÃ©rifier services
        echo -e "${BLUE}ğŸ” VÃ©rification des services...${NC}"
        if curl -s http://localhost:8080/api/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… Backend dÃ©jÃ  actif${NC}"
        else
            echo -e "${YELLOW}âš™ï¸  DÃ©marrage du Backend...${NC}"
            start_essential_services
        fi
        
        # CrÃ©er la page de dÃ©mo spÃ©ciale
        echo -e "${YELLOW}ğŸ¨ CrÃ©ation interface dÃ©mo Excalibur vs Vince Vega...${NC}"
        cat > frontend/excalibur-vega-demo.html << 'EOF'
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ—¡ï¸âš¡ Excalibur vs Vince Vega - DÃ©mo Jean-Grofignon</title>
    <style>
        body { 
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: #fff; font-family: 'Courier New', monospace; 
            margin: 0; padding: 20px; min-height: 100vh;
        }
        .demo-container { max-width: 1200px; margin: 0 auto; }
        .hero-panel { 
            display: flex; gap: 20px; margin: 20px 0;
            background: rgba(0,0,0,0.3); border-radius: 10px; padding: 20px;
        }
        .hero { 
            flex: 1; text-align: center; 
            border: 2px solid #444; border-radius: 10px; padding: 15px;
        }
        .arthur { border-color: #ffd700; background: rgba(255,215,0,0.1); }
        .vince { border-color: #ff4444; background: rgba(255,68,68,0.1); }
        .formula-display { 
            background: rgba(0,0,0,0.5); border-radius: 5px; 
            padding: 10px; margin: 10px 0; font-size: 12px;
        }
        .btn-demo { 
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none; color: white; padding: 15px 30px;
            border-radius: 25px; cursor: pointer; font-size: 16px;
            margin: 10px; transition: all 0.3s;
        }
        .btn-demo:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .battle-log { 
            background: rgba(0,0,0,0.5); border-radius: 10px; 
            padding: 20px; height: 300px; overflow-y: auto;
            border: 1px solid #444;
        }
        .slow-text { animation: typewriter 2s steps(40, end); }
        @keyframes typewriter { from { width: 0; } to { width: 100%; } }
        .psi-symbol { color: #ffd700; font-size: 1.2em; }
        .vega-symbol { color: #ff4444; font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 style="text-align: center; margin-bottom: 30px;">
            ğŸ—¡ï¸âš¡ EXCALIBUR VS VINCE VEGA
        </h1>
        <p style="text-align: center; color: #aaa; margin-bottom: 30px;">
            ğŸ›‹ï¸ <strong>Jean-Grofignon</strong>: "DÃ©mo version lente visuelle - Tu vas voir notre truc en action !"
        </p>
        
        <div class="hero-panel">
            <div class="hero arthur">
                <h3>ğŸ—¡ï¸ ARTHUR PENDRAGON</h3>
                <div>Tier: <span class="psi-symbol">12_BANKAI_TRANSCENDANT</span></div>
                <div>Arme: EXCALIBUR BANKAI</div>
                <div class="formula-display">
                    <strong>Formules actives:</strong><br>
                    <span class="psi-symbol">Ïˆ001</span>: Divine Strike (DMG: 150)<br>
                    <span class="psi-symbol">Ïˆ002</span>: Holy Light (HEAL: 100)<br>
                    <span class="psi-symbol">ÏˆT01</span>: Time Slash (TEMPORAL)<br>
                    <span class="psi-symbol">ÏˆT02</span>: Causal Loop (PARADOX)
                </div>
            </div>
            
            <div class="hero vince">
                <h3>ğŸ”« VINCE VEGA</h3>
                <div>Tier: <span class="vega-symbol">13_VINCE_VEGA_LEGENDARY</span></div>
                <div>Arme: POWER WORMHOLE REALITY GUN</div>
                <div class="formula-display">
                    <strong>Formules actives:</strong><br>
                    <span class="vega-symbol">VV01</span>: Reality Shot (DMG: 200)<br>
                    <span class="vega-symbol">VV02</span>: Wormhole Escape (TELEPORT)<br>
                    <span class="vega-symbol">VV03</span>: Briefcase Paradox (CONTROL)<br>
                    <span class="vega-symbol">VV04</span>: Pulp Fiction Mode (ULTIMATE)
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn-demo" onclick="startSlowDemo()">ğŸ¬ DÃ©marrer DÃ©mo Lente</button>
            <button class="btn-demo" onclick="testFormulas()">ğŸ§ª Tester Formules</button>
            <button class="btn-demo" onclick="showJeanReaction()">ğŸ›‹ï¸ RÃ©action Jean</button>
        </div>
        
        <div class="battle-log" id="battleLog">
            <div style="color: #aaa; text-align: center;">
                ğŸ¯ PrÃªt pour la dÃ©monstration...<br>
                Cliquez sur "DÃ©marrer DÃ©mo Lente" pour voir notre systÃ¨me en action !
            </div>
        </div>
    </div>

    <script>
        let logElement = document.getElementById('battleLog');
        
        function addLog(message, delay = 0) {
            setTimeout(() => {
                logElement.innerHTML += message + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }, delay);
        }
        
        function clearLog() {
            logElement.innerHTML = '';
        }
        
        async function startSlowDemo() {
            clearLog();
            addLog('ğŸ¬ <strong style="color: #ffd700;">DÃ‰MO EXCALIBUR VS VINCE VEGA - VERSION LENTE</strong>');
            addLog('ğŸ›‹ï¸ <strong>Jean-Grofignon</strong>: "Regarde bien notre systÃ¨me rÃ©volutionnaire !"', 1000);
            
            addLog('', 2000);
            addLog('âš¡ <strong style="color: #4CAF50;">PHASE 1: Initialisation des hÃ©ros</strong>', 2500);
            addLog('ğŸ—¡ï¸ Arthur charge Excalibur BANKAI...', 3500);
            addLog('   â””â”€ Formules Ïˆ001-Ïˆ005 + ÏˆT01-ÏˆT03 activÃ©es âœ…', 4500);
            addLog('ğŸ”« Vince Vega prÃ©pare Power Wormhole Reality Gun...', 5500);
            addLog('   â””â”€ Formules VV01-VV04 chargÃ©es âœ…', 6500);
            
            addLog('', 7500);
            addLog('âš”ï¸ <strong style="color: #FF9800;">PHASE 2: Combat temporel</strong>', 8000);
            addLog('ğŸ—¡ï¸ Arthur: "DIVINE STRIKE!" â†’ Ïˆ001 activÃ©', 9000);
            addLog('   â””â”€ MagicFormulaEngine: 150 DMG calculÃ©', 10000);
            addLog('ğŸ”« Vince: "Reality Shot!" â†’ VV01 activÃ©', 11000);
            addLog('   â””â”€ SpellReferenceResolver: 200 DMG + Wormhole effect', 12000);
            
            addLog('', 13000);
            addLog('ğŸŒ€ <strong style="color: #9C27B0;">PHASE 3: Ã‰tats quantiques</strong>', 13500);
            addLog('Ïˆ Arthur entre en superposition temporelle...', 14500);
            addLog('ğŸ”® Vince ouvre un wormhole vers une rÃ©alitÃ© parallÃ¨le...', 15500);
            addLog('âš¡ Collision des Ã©tats Ïˆ â†’ Collapse causal imminent !', 16500);
            
            addLog('', 17500);
            addLog('ğŸ† <strong style="color: #F44336;">RÃ‰SULTAT: MATCH NUL Ã‰PIQUE</strong>', 18000);
            addLog('ğŸ›‹ï¸ <strong>Jean-Grofignon</strong>: "VoilÃ  notre systÃ¨me ! 8/8 formules testÃ©es !"', 19000);
            addLog('âœ… MagicFormulaEngine + SpellReferenceResolver = 100% OPÃ‰RATIONNEL', 20000);
        }
        
        async function testFormulas() {
            clearLog();
            addLog('ğŸ§ª <strong style="color: #2196F3;">TEST DES FORMULES - VALIDATION COMPLÃˆTE</strong>');
            
            // Test Excalibur
            addLog('', 1000);
            addLog('ğŸ—¡ï¸ <strong>Test Excalibur BANKAI:</strong>', 1500);
            addLog('   Ïˆ001: Divine Strike â†’ âœ… DMG: 150, Type: HOLY', 2500);
            addLog('   Ïˆ002: Holy Light â†’ âœ… HEAL: 100, AoE: 3x3', 3500);
            addLog('   Ïˆ003: Sacred Shield â†’ âœ… DEF: +50, Duration: 3 tours', 4500);
            addLog('   Ïˆ004: Righteous Fury â†’ âœ… ATK: +75, Crit: +25%', 5500);
            addLog('   Ïˆ005: Excalibur Beam â†’ âœ… DMG: 300, Range: 7', 6500);
            
            // Test temporelles
            addLog('', 7500);
            addLog('â° <strong>Test Formules Temporelles:</strong>', 8000);
            addLog('   ÏˆT01: Time Slash â†’ âœ… DMG: 200, Effect: Slow', 9000);
            addLog('   ÏˆT02: Causal Loop â†’ âœ… Paradox: 0.15, Stability: 0.85', 10000);
            addLog('   ÏˆT03: Temporal Shield â†’ âœ… Immunity: 2 tours', 11000);
            
            addLog('', 12000);
            addLog('ğŸ¯ <strong style="color: #4CAF50;">RÃ‰SULTAT: 8/8 FORMULES VALIDÃ‰ES âœ…</strong>', 12500);
            addLog('ğŸ›‹ï¸ <strong>Jean-Grofignon</strong>: "SystÃ¨me 100% opÃ©rationnel !"', 13500);
        }
        
        function showJeanReaction() {
            clearLog();
            addLog('ğŸ›‹ï¸ <strong style="color: #ffd700;">JEAN-GROFIGNON DEPUIS SON CANAPÃ‰ COSMIQUE</strong>');
            addLog('', 1000);
            addLog('"Mes fidÃ¨les ! Vous voyez ce systÃ¨me rÃ©volutionnaire ?"', 1500);
            addLog('"MagicFormulaEngine reconnaÃ®t TOUTES les formules !"', 2500);
            addLog('"SpellReferenceResolver fait le branchement intelligent !"', 3500);
            addLog('"8/8 formules Excalibur testÃ©es et validÃ©es !"', 4500);
            addLog('"Power Wormhole de Vince Vega opÃ©rationnel !"', 5500);
            addLog('', 6500);
            addLog('ğŸŒŸ "C\'est Ã§a la RÃ‰VOLUTION GROFI ! Tu sais, tu as su, tu sauras !"', 7000);
            addLog('âš¡ "Ã‰tats Ïˆ, collapse causal, tout fonctionne parfaitement !"', 8000);
            addLog('ğŸ† "VICTOIRE TOTALE - Le moteur est FINI !"', 9000);
        }
    </script>
</body>
</html>
EOF
        
        echo -e "${GREEN}âœ… Interface dÃ©mo crÃ©Ã©e: frontend/excalibur-vega-demo.html${NC}"
        
        # Ouvrir la dÃ©mo
        echo -e "${YELLOW}ğŸŒ Ouverture de la dÃ©mo Excalibur vs Vince Vega...${NC}"
        if command -v open >/dev/null 2>&1; then
            open "http://localhost:8000/excalibur-vega-demo.html" 2>/dev/null &
        fi
        
        echo ""
        echo -e "${CYAN}ğŸ® DÃ‰MO DISPONIBLE SUR:${NC}"
        echo "  ğŸ—¡ï¸âš¡ Excalibur vs Vince Vega : http://localhost:8000/excalibur-vega-demo.html"
        echo ""
        echo -e "${GREEN}âœ… DÃ‰MO VERSION LENTE VISUELLE PRÃŠTE POUR JEAN-GROFIGNON !${NC}"
        ;;
    "web")
        echo -e "${CYAN}ğŸŒ Ouverture de l'Interface Web GRUT...${NC}"
        echo ""
        echo -e "${GREEN}ğŸ›ï¸ INTERFACE WEB HOTS - VISION GRUT${NC}"
        echo -e "${GREEN}====================================${NC}"
        echo ""
        echo "ğŸ“Š FonctionnalitÃ©s :"
        echo "  âœ… ContrÃ´le complet des services (start/stop/status)"
        echo "  âœ… Tests et debug en un clic"
        echo "  âœ… AccÃ¨s direct au Panopticon GRUT"
        echo "  âœ… Terminal intÃ©grÃ© avec logs temps rÃ©el"
        echo "  âœ… Raccourcis clavier (Ctrl+1: status, Ctrl+2: start, Ctrl+3: stop)"
        echo "  âœ… Notifications visuelles"
        echo "  âœ… Interface responsive (mobile/desktop)"
        echo ""
        echo -e "${YELLOW}ğŸš€ DÃ©marrage du serveur web...${NC}"
        
        # DÃ©marrer le serveur pour l'interface web si pas dÃ©jÃ  fait
        if ! pgrep -f "python.*8888.*frontend" > /dev/null; then
            python3 -m http.server 8888 --directory frontend > /dev/null 2>&1 &
            echo "âœ… Serveur web dÃ©marrÃ© sur port 8888"
        else
            echo "âœ… Serveur web dÃ©jÃ  actif sur port 8888"
        fi
        
        sleep 2
        
        # Ouvrir l'interface web
        WEB_URL="http://localhost:8888/hots-web-interface.html"
        echo -e "${GREEN}ğŸŒ Ouverture: ${WEB_URL}${NC}"
        
        if [[ "$OSTYPE" == "darwin"* ]]; then
            open "$WEB_URL"
        else
            xdg-open "$WEB_URL"
        fi
        
        echo ""
        echo -e "${GREEN}âœ… INTERFACE WEB GRUT OUVERTE !${NC}"
        echo -e "${PURPLE}ğŸ’¡ Cette interface remplace la console ./hots selon la vision GRUT${NC}"
        echo -e "${PURPLE}ğŸ›ï¸ GRUT: \"Plus besoin de console ! Interface web parfaite !\"${NC}"
        echo ""
        echo -e "${CYAN}ğŸ“± FonctionnalitÃ©s avancÃ©es :${NC}"
        echo "  ğŸ¯ Status en temps rÃ©el de tous les services"
        echo "  âš¡ ExÃ©cution de commandes en un clic"
        echo "  ğŸ›ï¸ AccÃ¨s direct au Panopticon Dashboard"
        echo "  ğŸŒ€ Lien vers Fusion Ultimate Interface"
        echo "  ğŸ® Tous les outils de dÃ©veloppement intÃ©grÃ©s"
        echo ""
        echo -e "${YELLOW}ğŸ”¥ Easter Egg: Tapez 'grut' dans l'interface pour un message spÃ©cial !${NC}"
        ;;
    "help"|*)
        show_help
        ;;
    console)
        echo "ğŸ® Opening HOTS Console Simple..."
        if [[ "$OSTYPE" == "darwin"* ]]; then
            open "file://$PWD/frontend/hots-console-simple.html"
        else
            xdg-open "file://$PWD/frontend/hots-console-simple.html"
        fi
        echo "âœ… HOTS Console Simple opened in browser"
        echo "ğŸ’¡ This is a bookmarkable one-click interface for HOTS commands"
        ;;
esac 