#!/bin/bash

# üï∞Ô∏è Heroes of Time - Hook Post-Commit pour Mise √† Jour Automatique du Contexte
# Ce script est ex√©cut√© automatiquement apr√®s chaque commit

echo "üîÑ Hook post-commit: Mise √† jour du contexte Cursor..."

# V√©rifier si le script de mise √† jour existe
if [ -f "update-cursor-context.sh" ]; then
    # Obtenir les informations du dernier commit
    LAST_COMMIT_MSG=$(git log -1 --pretty=format:"%s")
    LAST_COMMIT_FILES=$(git diff-tree --no-commit-id --name-only -r HEAD)
    
    echo "üìù Dernier commit: $LAST_COMMIT_MSG"
    echo "üìÅ Fichiers modifi√©s: $LAST_COMMIT_FILES"
    
    # Analyser les types de changements et mettre √† jour le contexte
    if echo "$LAST_COMMIT_FILES" | grep -q "\.java$"; then
        ./update-cursor-context.sh add-history "Modifications Java: $LAST_COMMIT_MSG"
    elif echo "$LAST_COMMIT_FILES" | grep -q "pom\.xml"; then
        ./update-cursor-context.sh add-history "Mise √† jour Maven: $LAST_COMMIT_MSG"
    elif echo "$LAST_COMMIT_FILES" | grep -q "TEMPORAL_ARTIFACTS\.json"; then
        ./update-cursor-context.sh add-history "Artefacts temporels modifi√©s: $LAST_COMMIT_MSG"
    elif echo "$LAST_COMMIT_FILES" | grep -q "\.md$"; then
        ./update-cursor-context.sh add-history "Documentation mise √† jour: $LAST_COMMIT_MSG"
    else
        ./update-cursor-context.sh add-history "Commit: $LAST_COMMIT_MSG"
    fi
    
    echo "‚úÖ Contexte Cursor mis √† jour automatiquement"
else
    echo "‚ö†Ô∏è  Script update-cursor-context.sh non trouv√©"
fi

echo "üéÆ Hook post-commit termin√©"