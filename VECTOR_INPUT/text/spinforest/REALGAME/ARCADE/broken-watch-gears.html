<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöó TEMPORAL DRIFT - Broken Watch</title>
    <style>
        body {
            margin: 0;
            background: linear-gradient(135deg, #0a0a0a, #2c1810, #1a0f0a);
            color: #e8d5b7;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .game-header {
            background: rgba(138, 43, 226, 0.2);
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #8A2BE2;
        }
        
        .game-header h1 {
            margin: 0;
            color: #FFD700;
            font-size: 1.5em;
            text-shadow: 0 0 10px #FFD700;
        }
        
        .objective {
            margin: 5px 0;
            color: #FFA500;
            font-size: 1em;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            background: 
                radial-gradient(circle at 30% 40%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(184, 134, 11, 0.2) 0%, transparent 40%),
                linear-gradient(135deg, #0a0a0a, #2c1810);
        }
        
        .watch-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, #1a1a1a 30%, #333 70%, #555 100%);
            border: 8px solid #B8860B;
            box-shadow: 
                0 0 30px rgba(184, 134, 11, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.8);
            position: relative;
        }
        
        .watch-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: radial-gradient(circle, #2a2a2a, #1a1a1a);
            border: 2px solid #444;
        }
        
        .hour-markers {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .hour-marker {
            position: absolute;
            width: 2px;
            height: 20px;
            background: #B8860B;
            left: 50%;
            top: 10px;
            transform-origin: 1px 115px;
        }
        
        .gear {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: conic-gradient(from 0deg, #B8860B, #FFD700, #B8860B, #DAA520);
            border: 2px solid #8B7D6B;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2a2a2a;
            user-select: none;
        }
        
        .gear::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: radial-gradient(circle, #1a1a1a, #333);
            border: 1px solid #555;
        }
        
        .gear-number {
            position: relative;
            z-index: 2;
            font-size: 1.2em;
            text-shadow: 0 0 5px #FFD700;
        }
        
        .gear.correct {
            animation: pulse-correct 0.5s ease;
            border-color: #28a745;
            box-shadow: 0 0 15px #28a745;
        }
        
        .gear.wrong {
            animation: shake 0.5s ease;
            border-color: #dc3545;
            box-shadow: 0 0 15px #dc3545;
        }
        
        @keyframes pulse-correct {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .gear-1 { top: 80px; left: 120px; width: 60px; height: 60px; }
        .gear-2 { top: 50px; right: 80px; width: 50px; height: 50px; }
        .gear-3 { bottom: 100px; left: 90px; width: 70px; height: 70px; }
        .gear-4 { bottom: 60px; right: 100px; width: 55px; height: 55px; }
        
        .watch-hands {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 80px;
            background: linear-gradient(to bottom, #FFD700, #B8860B);
            transform-origin: 50% 100%;
            border-radius: 2px;
            transition: transform 0.5s ease;
        }
        
        .watch-hands::after {
            content: '';
            position: absolute;
            top: 20px;
            left: -1px;
            width: 6px;
            height: 50px;
            background: linear-gradient(to bottom, #FFA500, #B8860B);
            border-radius: 3px;
            transform-origin: 50% 100%;
        }
        
        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #FFD700;
            border-radius: 50%;
            border: 2px solid #B8860B;
            z-index: 10;
            box-shadow: 0 0 10px #FFD700;
        }
        
        .game-ui {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #8A2BE2;
        }
        
        .timer {
            font-size: 1.2em;
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .target-time {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .game-complete {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #28a745;
            display: none;
            z-index: 100;
        }
        
        .game-failed {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #dc3545;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üöó BROKEN WATCH - R√©paration Temporelle</h1>
            <div class="objective">Remettez l'horloge √† l'heure en alignant les engrenages</div>
        </div>
        
        <div class="game-area">
            <div class="watch-container">
                <div class="watch-face">
                    <div class="hour-markers"></div>
                    
                    <div class="gear gear-1" data-gear="1">
                        <div class="gear-number">3</div>
                    </div>
                    <div class="gear gear-2" data-gear="2">
                        <div class="gear-number">6</div>
                    </div>
                    <div class="gear gear-3" data-gear="3">
                        <div class="gear-number">9</div>
                    </div>
                    <div class="gear gear-4" data-gear="4">
                        <div class="gear-number">12</div>
                    </div>
                    
                    <div class="watch-hands" id="watchHands"></div>
                    <div class="center-dot"></div>
                </div>
            </div>
            
            <div class="game-ui">
                <div class="timer" id="timer">60s</div>
                <div class="target-time" id="targetTime">Heure cible: 3:15</div>
                <div style="color: #888; font-size: 0.8em; margin-top: 10px;">
                    Cliquez sur les engrenages<br>
                    dans le bon ordre
                </div>
            </div>
        </div>
        
        <div class="game-complete" id="gameComplete">
            <h2>‚è∞ HORLOGE R√âPAR√âE !</h2>
            <p>Le temps s'√©coule √† nouveau normalement</p>
            <div style="margin-top: 15px; color: #FFD700;">
                R√©compenses: +75 XP, +25 Gold
            </div>
        </div>
        
        <div class="game-failed" id="gameFailed">
            <h2>‚è∞ TEMPS √âCOUL√â</h2>
            <p>L'horloge reste bris√©e</p>
            <div style="margin-top: 15px; color: #888;">
                Aucune r√©compense
            </div>
        </div>
    </div>
    
    <script>
        class BrokenWatchGame {
            constructor() {
                this.timeLeft = 60;
                this.gameRunning = true;
                this.sequence = [3, 6, 9, 12]; // Ordre correct
                this.playerSequence = [];
                this.targetHour = 3;
                this.targetMinute = 15;
                this.currentRotation = 0;
                
                this.createHourMarkers();
                this.setupGears();
                this.startTimer();
                this.updateClock();
            }
            
            createHourMarkers() {
                const markersContainer = document.querySelector('.hour-markers');
                for (let i = 0; i < 12; i++) {
                    const marker = document.createElement('div');
                    marker.className = 'hour-marker';
                    marker.style.transform = `translateX(-50%) rotate(${i * 30}deg)`;
                    markersContainer.appendChild(marker);
                }
            }
            
            setupGears() {
                const gears = document.querySelectorAll('.gear');
                gears.forEach(gear => {
                    gear.addEventListener('click', (e) => this.handleGearClick(e));
                });
            }
            
            handleGearClick(e) {
                if (!this.gameRunning) return;
                
                const gear = e.currentTarget;
                const gearNumber = parseInt(gear.querySelector('.gear-number').textContent);
                
                this.playerSequence.push(gearNumber);
                
                // V√©rifier si le choix est correct √† cette √©tape
                const currentIndex = this.playerSequence.length - 1;
                if (this.playerSequence[currentIndex] === this.sequence[currentIndex]) {
                    gear.classList.add('correct');
                    setTimeout(() => gear.classList.remove('correct'), 500);
                    
                    // Faire tourner l'horloge
                    this.currentRotation += 90; // 90¬∞ par gear correct
                    this.updateClock();
                    
                    // V√©rifier victoire
                    if (this.playerSequence.length === this.sequence.length) {
                        this.checkWinCondition();
                    }
                } else {
                    gear.classList.add('wrong');
                    setTimeout(() => gear.classList.remove('wrong'), 500);
                    
                    // Reset s√©quence
                    this.playerSequence = [];
                    this.currentRotation = 0;
                    this.updateClock();
                }
            }
            
            updateClock() {
                const hands = document.getElementById('watchHands');
                hands.style.transform = `translate(-50%, -50%) rotate(${this.currentRotation}deg)`;
            }
            
            checkWinCondition() {
                // L'horloge est r√©par√©e si toute la s√©quence est correcte
                const angle = this.currentRotation % 360;
                const targetAngle = (this.targetHour * 30 + this.targetMinute * 0.5) % 360; // 3:15 = 97.5¬∞
                
                // Tol√©rance de ¬±15¬∞
                if (Math.abs(angle - targetAngle) < 15 || Math.abs(angle - targetAngle - 360) < 15) {
                    this.gameWin();
                } else {
                    // Continuer √† ajuster
                    setTimeout(() => {
                        this.playerSequence = [];
                    }, 1000);
                }
            }
            
            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    document.getElementById('timer').textContent = `${this.timeLeft}s`;
                    
                    if (this.timeLeft <= 10) {
                        document.getElementById('timer').style.color = '#ff4757';
                    }
                    
                    if (this.timeLeft <= 0) {
                        this.gameTimeout();
                    }
                }, 1000);
            }
            
            gameWin() {
                this.gameRunning = false;
                clearInterval(this.timerInterval);
                
                document.getElementById('gameComplete').style.display = 'block';
                
                // Effet final - horloge qui brille
                const watchContainer = document.querySelector('.watch-container');
                watchContainer.style.boxShadow = '0 0 50px #FFD700, inset 0 0 20px rgba(255, 215, 0, 0.3)';
                
                // Notifier parent
                setTimeout(() => {
                    this.sendResult(true, 1500);
                }, 2000);
            }
            
            gameTimeout() {
                this.gameRunning = false;
                clearInterval(this.timerInterval);
                
                document.getElementById('gameFailed').style.display = 'block';
                
                // Notifier parent
                setTimeout(() => {
                    this.sendResult(false, 0);
                }, 2000);
            }
            
            sendResult(success, score) {
                const result = {
                    type: 'arcade:result',
                    gameId: 'BROKEN_WATCH',
                    success: success,
                    score: score,
                    rewards: success ? [
                        { kind: 'xp', qty: 75 },
                        { kind: 'gold', qty: 25 }
                    ] : []
                };
                
                // PostMessage au parent
                if (window.parent !== window) {
                    window.parent.postMessage(result, '*');
                }
                
                console.log('üöó Game result:', result);
            }
        }
        
        // D√©marrer le jeu
        new BrokenWatchGame();
    </script>
</body>
</html>
