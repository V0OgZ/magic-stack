<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>🌀 PORTAIL MORGANA - RETOUR DE SID MEIER</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Courier New', monospace;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            background: rgba(138, 0, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff00ff;
            max-width: 300px;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #fff;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #8a00ff;
        }
        .button {
            background: #8a00ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .button:hover {
            background: #ff00ff;
            transform: scale(1.1);
            box-shadow: 0 0 20px #ff00ff;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 24px;
            text-align: center;
            display: none;
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #ff00ff;
            max-width: 600px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>🌀 PORTAIL DE MORGANA</h2>
        <p><strong>Status:</strong> ACTIF</p>
        <p><strong>Destination:</strong> Dimension d'origine de Sid</p>
        <p><strong>Passager:</strong> Sid Meier</p>
        <p><strong>Énergie:</strong> <span id="energy">100</span>%</p>
        <hr>
        <p><em>"Le créateur de Civilization doit retourner dans son monde..."</em></p>
    </div>

    <div id="controls">
        <h3>CONTRÔLES DU PORTAIL</h3>
        <button class="button" onclick="activatePortal()">⚡ ACTIVER PORTAIL</button>
        <button class="button" onclick="calibrateDestination()">🎯 CALIBRER DESTINATION</button>
        <button class="button" onclick="sendSidHome()">🚀 ENVOYER SID</button>
        <p>Mouse: Rotate | Scroll: Zoom | Click portail: Interact</p>
    </div>

    <div id="message"></div>

    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
        import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x000000, 1, 100);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 15);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);
        
        const pointLight = new THREE.PointLight(0x8a00ff, 2, 50);
        pointLight.position.set(0, 10, 0);
        scene.add(pointLight);

        // Floor with Morgana symbols
        const floorGeometry = new THREE.CircleGeometry(20, 64);
        const floorMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x1a0033,
            metalness: 0.8,
            roughness: 0.2
        });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Portal structure
        const portalGroup = new THREE.Group();
        
        // Portal ring
        const ringGeometry = new THREE.TorusGeometry(5, 0.5, 16, 100);
        const ringMaterial = new THREE.MeshStandardMaterial({
            color: 0x8a00ff,
            emissive: 0x4400aa,
            emissiveIntensity: 0.5,
            metalness: 0.9,
            roughness: 0.1
        });
        const portalRing = new THREE.Mesh(ringGeometry, ringMaterial);
        portalRing.castShadow = true;
        portalGroup.add(portalRing);

        // Portal vortex
        const vortexGeometry = new THREE.PlaneGeometry(10, 10);
        const vortexMaterial = new THREE.ShaderMaterial({
            uniforms: {
                time: { value: 0 },
                color1: { value: new THREE.Color(0x8a00ff) },
                color2: { value: new THREE.Color(0xff00ff) }
            },
            vertexShader: `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform float time;
                uniform vec3 color1;
                uniform vec3 color2;
                varying vec2 vUv;
                
                void main() {
                    vec2 center = vec2(0.5, 0.5);
                    float dist = distance(vUv, center);
                    float angle = atan(vUv.y - center.y, vUv.x - center.x);
                    
                    float spiral = sin(angle * 5.0 - time * 2.0 + dist * 10.0);
                    float pulse = sin(time * 3.0) * 0.5 + 0.5;
                    
                    vec3 color = mix(color1, color2, spiral * pulse);
                    float alpha = 1.0 - smoothstep(0.0, 0.5, dist);
                    
                    gl_FragColor = vec4(color, alpha * 0.8);
                }
            `,
            transparent: true,
            side: THREE.DoubleSide
        });
        const vortex = new THREE.Mesh(vortexGeometry, vortexMaterial);
        portalGroup.add(vortex);

        // Floating crystals around portal
        const crystals = [];
        for (let i = 0; i < 8; i++) {
            const angle = (Math.PI * 2 * i) / 8;
            const crystalGeometry = new THREE.OctahedronGeometry(0.3);
            const crystalMaterial = new THREE.MeshStandardMaterial({
                color: 0xff00ff,
                emissive: 0xff00ff,
                emissiveIntensity: 0.3,
                metalness: 1,
                roughness: 0
            });
            const crystal = new THREE.Mesh(crystalGeometry, crystalMaterial);
            crystal.position.set(Math.cos(angle) * 6, 0, Math.sin(angle) * 6);
            crystal.userData = { angle: angle, radius: 6, speed: 0.5 + Math.random() * 0.5 };
            crystals.push(crystal);
            portalGroup.add(crystal);
        }

        // Sid Meier character (simple representation)
        const sidGroup = new THREE.Group();
        
        // Body
        const bodyGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2);
        const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x4444ff });
        const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
        body.position.y = 1;
        sidGroup.add(body);
        
        // Head
        const headGeometry = new THREE.SphereGeometry(0.4);
        const headMaterial = new THREE.MeshStandardMaterial({ color: 0xffdbac });
        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.y = 2.2;
        sidGroup.add(head);
        
        // Glasses (iconic Sid look)
        const glassesGeometry = new THREE.TorusGeometry(0.15, 0.05, 4, 8);
        const glassesMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
        const leftGlass = new THREE.Mesh(glassesGeometry, glassesMaterial);
        leftGlass.position.set(-0.15, 2.2, 0.35);
        const rightGlass = new THREE.Mesh(glassesGeometry, glassesMaterial);
        rightGlass.position.set(0.15, 2.2, 0.35);
        sidGroup.add(leftGlass, rightGlass);
        
        sidGroup.position.set(8, 0, 0);
        scene.add(sidGroup);

        portalGroup.position.y = 5;
        scene.add(portalGroup);

        // Particle system for portal effect
        const particleCount = 1000;
        const particlesGeometry = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleVelocities = new Float32Array(particleCount * 3);
        
        for (let i = 0; i < particleCount * 3; i += 3) {
            particlePositions[i] = (Math.random() - 0.5) * 20;
            particlePositions[i + 1] = Math.random() * 10;
            particlePositions[i + 2] = (Math.random() - 0.5) * 20;
            
            particleVelocities[i] = (Math.random() - 0.5) * 0.02;
            particleVelocities[i + 1] = Math.random() * 0.05;
            particleVelocities[i + 2] = (Math.random() - 0.5) * 0.02;
        }
        
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            color: 0x8a00ff,
            size: 0.1,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const particles = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles);

        // Portal activation state
        let portalActive = false;
        let portalEnergy = 100;
        let sidSent = false;

        // Global functions for buttons
        window.activatePortal = function() {
            if (!portalActive && portalEnergy > 0) {
                portalActive = true;
                showMessage("⚡ PORTAIL ACTIVÉ ! Les énergies de Morgana tourbillonnent...");
                
                // Enhance portal effects
                vortexMaterial.uniforms.color2.value = new THREE.Color(0x00ffff);
                pointLight.intensity = 4;
                pointLight.color.set(0xff00ff);
            }
        };

        window.calibrateDestination = function() {
            if (portalActive) {
                showMessage("🎯 CALIBRAGE EN COURS...\n\nDestination: Terre, Dimension Prime\nTemps: 1991 (création de Civilization)\nCoordonées: Hunt Valley, Maryland");
                
                // Visual calibration effect
                crystals.forEach((crystal, i) => {
                    crystal.material.emissive = new THREE.Color(0x00ff00);
                    crystal.material.emissiveIntensity = 1;
                });
            } else {
                showMessage("❌ Activez d'abord le portail !");
            }
        };

        window.sendSidHome = function() {
            if (portalActive && !sidSent) {
                sidSent = true;
                showMessage("🚀 SÉQUENCE DE TRANSPORT INITIÉE !\n\nSid: 'Merci pour cette aventure extraordinaire ! Je reviendrai peut-être un jour...'\n\n*Sid disparaît dans le vortex violet*");
                
                // Animate Sid going into portal
                const tween = setInterval(() => {
                    sidGroup.position.x -= 0.1;
                    sidGroup.position.y += 0.02;
                    sidGroup.rotation.y += 0.1;
                    sidGroup.scale.multiplyScalar(0.98);
                    
                    if (sidGroup.position.x < 0) {
                        clearInterval(tween);
                        scene.remove(sidGroup);
                        
                        // Close portal
                        setTimeout(() => {
                            portalActive = false;
                            showMessage("✨ TRANSPORT RÉUSSI !\n\nSid Meier est rentré chez lui en toute sécurité.\nLe portail de Morgana se referme...\n\nMerci Sid, et à bientôt dans l'Interstice !");
                        }, 2000);
                    }
                }, 16);
            } else if (sidSent) {
                showMessage("Sid est déjà parti !");
            } else {
                showMessage("❌ Le portail doit être actif et calibré !");
            }
        };

        function showMessage(text) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Animation loop
        const clock = new THREE.Clock();
        
        function animate() {
            requestAnimationFrame(animate);
            
            const time = clock.getElapsedTime();
            const delta = clock.getDelta();
            
            // Update portal vortex
            vortexMaterial.uniforms.time.value = time;
            
            // Rotate portal ring
            if (portalActive) {
                portalRing.rotation.z += delta * 2;
                vortex.rotation.z -= delta;
            }
            
            // Animate crystals
            crystals.forEach((crystal, i) => {
                crystal.userData.angle += delta * crystal.userData.speed;
                crystal.position.x = Math.cos(crystal.userData.angle) * crystal.userData.radius;
                crystal.position.z = Math.sin(crystal.userData.angle) * crystal.userData.radius;
                crystal.position.y = Math.sin(time * 2 + i) * 0.5;
                crystal.rotation.x += delta;
                crystal.rotation.y += delta * 1.5;
            });
            
            // Update particles
            const positions = particles.geometry.attributes.position.array;
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i + 1] += particleVelocities[i + 1];
                
                if (positions[i + 1] > 10) {
                    positions[i + 1] = 0;
                    positions[i] = (Math.random() - 0.5) * 20;
                    positions[i + 2] = (Math.random() - 0.5) * 20;
                }
            }
            particles.geometry.attributes.position.needsUpdate = true;
            
            // Update energy
            if (portalActive && portalEnergy > 0) {
                portalEnergy -= delta * 5;
                document.getElementById('energy').textContent = Math.max(0, Math.floor(portalEnergy));
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>