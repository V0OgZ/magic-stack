<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ‘¥ Panopticon Multi-Mages 6D - Tous SuperposÃ©s</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            overflow: hidden;
        }
        
        #container {
            display: flex;
            height: 100vh;
        }
        
        #canvas-container {
            flex: 1;
            position: relative;
            background: radial-gradient(circle at center, #001122 0%, #000000 100%);
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        #controls {
            width: 350px;
            background: rgba(0, 0, 0, 0.9);
            border-left: 2px solid #00ff00;
            padding: 20px;
            overflow-y: auto;
        }
        
        .mage-toggle {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mage-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .mage-toggle.active {
            border-color: var(--mage-color);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .mage-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--mage-color);
            border-radius: 3px;
            margin-right: 10px;
            position: relative;
        }
        
        .mage-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: -2px;
            left: 2px;
            color: var(--mage-color);
            font-weight: bold;
        }
        
        .mage-info {
            flex: 1;
        }
        
        .mage-name {
            font-weight: bold;
            color: var(--mage-color);
        }
        
        .mage-stats {
            font-size: 0.8em;
            color: #ccc;
            margin-top: 5px;
        }
        
        .dimension-selector {
            margin: 20px 0;
        }
        
        .dimension-btn {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .dimension-btn:hover, .dimension-btn.active {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 20px #00ff00;
        }
        
        .stats-panel {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #00ffff;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .connection-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        
        .lightning-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.1s;
        }
        
        .lightning-active {
            opacity: 1;
            animation: multi-mage-lightning 1.5s ease-out;
        }
        
        @keyframes multi-mage-lightning {
            0% { background: radial-gradient(circle at 20% 30%, rgba(255, 0, 255, 0.8) 0%, transparent 50%); }
            20% { background: radial-gradient(circle at 80% 70%, rgba(0, 255, 255, 0.8) 0%, transparent 50%); }
            40% { background: radial-gradient(circle at 50% 20%, rgba(255, 255, 0, 0.8) 0%, transparent 50%); }
            60% { background: radial-gradient(circle at 30% 80%, rgba(255, 100, 0, 0.8) 0%, transparent 50%); }
            80% { background: radial-gradient(circle at 70% 50%, rgba(0, 255, 0, 0.8) 0%, transparent 50%); }
            100% { background: transparent; }
        }
        
        .update-log {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.8em;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        .update-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        
        .update-real {
            color: #ffff00;
            background: rgba(255, 255, 0, 0.1);
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas3d"></canvas>
            <div class="lightning-overlay" id="lightning-overlay"></div>
            <div class="connection-indicator">
                <div>ðŸ”— Backend: <span id="backend-status">ConnectÃ©</span></div>
                <div>ðŸ‘¥ Mages: <span id="active-mages">5/5</span></div>
                <div>âš¡ Updates: <span id="update-counter">0</span></div>
            </div>
        </div>
        
        <div id="controls">
            <h2>ðŸ‘¥ MAGES SUPERPOSÃ‰S</h2>
            
            <div class="mage-controls">
                <h4>ðŸŒŸ SÃ©lection Mages</h4>
                
                <div class="mage-toggle active" data-mage="vincent" style="--mage-color: #ff00ff">
                    <div class="mage-checkbox checked"></div>
                    <div class="mage-info">
                        <div class="mage-name">VINCENT (TOI)</div>
                        <div class="mage-stats">QUANTIQUE - CrÃ©ateur - <span id="vincent-activity">87.5%</span></div>
                    </div>
                </div>
                
                <div class="mage-toggle active" data-mage="loumen" style="--mage-color: #00ffff">
                    <div class="mage-checkbox checked"></div>
                    <div class="mage-info">
                        <div class="mage-name">LOUMEN PHOENIX</div>
                        <div class="mage-stats">NARRATIVE - Responsable Narratif - <span id="loumen-activity">85.3%</span></div>
                    </div>
                </div>
                
                <div class="mage-toggle active" data-mage="urz" style="--mage-color: #00ff00">
                    <div class="mage-checkbox checked"></div>
                    <div class="mage-info">
                        <div class="mage-name">URZ-KÃ”M</div>
                        <div class="mage-stats">SPATIALE - Gardien Stack - <span id="urz-activity">87.0%</span></div>
                    </div>
                </div>
                
                <div class="mage-toggle active" data-mage="sid" style="--mage-color: #ff6600">
                    <div class="mage-checkbox checked"></div>
                    <div class="mage-info">
                        <div class="mage-name">SID MEIER</div>
                        <div class="mage-stats">CAUSALE - Project Manager - <span id="sid-activity">63.4%</span></div>
                    </div>
                </div>
                
                <div class="mage-toggle active" data-mage="grokaen" style="--mage-color: #0066ff">
                    <div class="mage-checkbox checked"></div>
                    <div class="mage-info">
                        <div class="mage-name">GROKÃ†N</div>
                        <div class="mage-stats">TEMPORELLE - Arbre-Code - <span id="grokaen-activity">74.9%</span></div>
                    </div>
                </div>
                
                <div class="mage-toggle" data-mage="merlin" style="--mage-color: #ff0000">
                    <div class="mage-checkbox"></div>
                    <div class="mage-info">
                        <div class="mage-name">MERLIN RUST</div>
                        <div class="mage-stats">ERREUR - Backend PlantÃ© - <span id="merlin-activity">0%</span></div>
                    </div>
                </div>
            </div>
            
            <div class="dimension-selector">
                <h4>ðŸŒ€ Dimensions</h4>
                <button class="dimension-btn active" data-dimension="ALL">TOUTES SUPERPOSÃ‰ES</button>
                <button class="dimension-btn" data-dimension="CAUSALE">D1: CAUSALE</button>
                <button class="dimension-btn" data-dimension="TEMPORELLE">D2: TEMPORELLE</button>
                <button class="dimension-btn" data-dimension="SPATIALE">D3: SPATIALE</button>
                <button class="dimension-btn" data-dimension="QUANTIQUE">D4: QUANTIQUE</button>
                <button class="dimension-btn" data-dimension="IDENTITAIRE">D5: IDENTITAIRE</button>
                <button class="dimension-btn" data-dimension="NARRATIVE">D6: NARRATIVE</button>
            </div>
            
            <div class="stats-panel">
                <h4>ðŸ“Š Stats Globales</h4>
                <div>Neurones actifs: <span id="active-neurons">5</span></div>
                <div>Connexions: <span id="active-connections">4</span></div>
                <div>ActivitÃ© moyenne: <span id="avg-activity">79.6%</span></div>
                <div>Dimension focus: <span id="focus-dimension">TOUTES</span></div>
            </div>
            
            <div style="margin-top: 20px;">
                <button onclick="refreshAllMages()" style="width: 100%; padding: 10px; background: #006600; color: white; border: none; cursor: pointer; border-radius: 5px;">
                    ðŸ”„ Refresh Tous Mages
                </button>
                <button onclick="triggerMultiMageLightning()" style="width: 100%; padding: 10px; margin-top: 10px; background: #660066; color: white; border: none; cursor: pointer; border-radius: 5px;">
                    âš¡ Lightning Multi-Mages
                </button>
            </div>
            
            <div class="update-log">
                <h4>ðŸ“Š Log Multi-Mages</h4>
                <div id="update-log-container">
                    <div class="update-entry">Initialisation multi-mages...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Configuration
        const CONFIG = {
            backendUrl: 'http://localhost:8082',
            updateInterval: 2000,
            lightningDuration: 1500
        };
        
        // Variables globales
        let scene, camera, renderer;
        let activeDimension = 'ALL';
        let updateCounter = 0;
        let activeMages = new Set(['vincent', 'loumen', 'urz', 'sid', 'grokaen']);
        
        // DonnÃ©es des mages
        const magesData = {
            vincent: {
                name: 'Vincent',
                color: 0xff00ff,
                position: { x: 50, y: 50, z: 50 },
                activity: 0.875,
                dimension: 'QUANTIQUE',
                role: 'CrÃ©ateur'
            },
            loumen: {
                name: 'Loumen Phoenix',
                color: 0x00ffff,
                position: { x: 4.82, y: 58.01, z: 29.73 },
                activity: 0.853,
                dimension: 'NARRATIVE',
                role: 'Responsable Narratif'
            },
            urz: {
                name: 'Urz-KÃ´m',
                color: 0x00ff00,
                position: { x: 109, y: 13, z: 60 },
                activity: 0.870,
                dimension: 'SPATIALE',
                role: 'Gardien Stack'
            },
            sid: {
                name: 'Sid Meier',
                color: 0xff6600,
                position: { x: 100, y: 5, z: 45 },
                activity: 0.634,
                dimension: 'CAUSALE',
                role: 'Project Manager'
            },
            grokaen: {
                name: 'GrokÃ¦n',
                color: 0x0066ff,
                position: { x: 105, y: 15, z: 40 },
                activity: 0.749,
                dimension: 'TEMPORELLE',
                role: 'Arbre-Code'
            },
            merlin: {
                name: 'Merlin Rust',
                color: 0xff0000,
                position: { x: 200, y: 200, z: 200 },
                activity: 0.0,
                dimension: 'ERREUR',
                role: 'Backend PlantÃ©'
            }
        };
        
        // Connexions entre mages
        const mageConnections = [
            { from: 'vincent', to: 'loumen', strength: 0.9, type: 'COMMAND' },
            { from: 'vincent', to: 'sid', strength: 0.8, type: 'DIRECTIVE' },
            { from: 'loumen', to: 'urz', strength: 0.7, type: 'COLLABORATION' },
            { from: 'sid', to: 'grokaen', strength: 0.6, type: 'COORDINATION' },
            { from: 'urz', to: 'grokaen', strength: 0.5, type: 'TECHNIQUE' }
        ];
        
        // Initialisation
        async function init() {
            console.log('ðŸ‘¥ Initialisation Panopticon Multi-Mages');
            
            initThreeJS();
            setupControls();
            startUpdateLoop();
            renderAllMages();
            
            animate();
        }
        
        // Configuration Three.js
        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas3d'), antialias: true });
            
            const container = document.getElementById('canvas-container');
            renderer.setSize(container.clientWidth, container.clientHeight);
            
            // LumiÃ¨res
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
            directionalLight.position.set(15, 15, 10);
            scene.add(directionalLight);
            
            camera.position.set(0, 0, 25);
        }
        
        // Rendu de tous les mages
        function renderAllMages() {
            // Nettoyer la scÃ¨ne
            while(scene.children.length > 2) {
                scene.remove(scene.children[2]);
            }
            
            // Rendu des neurones mages
            Object.entries(magesData).forEach(([mageId, mage]) => {
                if (!activeMages.has(mageId)) return;
                
                const activity = mage.activity;
                const size = 0.5 + (activity * 0.8);
                const geometry = new THREE.SphereGeometry(size, 20, 20);
                
                const material = new THREE.MeshStandardMaterial({ 
                    color: mage.color,
                    emissive: mage.color,
                    emissiveIntensity: activity * 0.6,
                    transparent: true,
                    opacity: 0.8 + activity * 0.2
                });
                
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.set(
                    mage.position.x / 15 - 3.5, 
                    mage.position.y / 15 - 3.5, 
                    mage.position.z / 15 - 3.5
                );
                sphere.userData = { mageId, mage };
                
                // Animation de pulse
                const time = Date.now() * 0.002;
                const pulseIntensity = 0.8 + activity * 0.4;
                sphere.scale.setScalar(pulseIntensity + Math.sin(time + mage.position.x) * 0.2);
                
                scene.add(sphere);
                
                // Ã‰tiquette mage
                const textGeometry = new THREE.RingGeometry(size + 0.2, size + 0.4, 8);
                const textMaterial = new THREE.MeshBasicMaterial({ 
                    color: mage.color,
                    transparent: true,
                    opacity: activity * 0.8
                });
                const textMesh = new THREE.Mesh(textGeometry, textMaterial);
                textMesh.position.set(
                    mage.position.x / 15 - 3.5, 
                    mage.position.y / 15 - 3.5 + 1.2, 
                    mage.position.z / 15 - 3.5
                );
                scene.add(textMesh);
                
                // Orbites pour chaque mage
                const orbitGeometry = new THREE.RingGeometry(size + 0.6, size + 0.7, 32);
                const orbitMaterial = new THREE.MeshBasicMaterial({ 
                    color: mage.color,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.DoubleSide
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.position.copy(sphere.position);
                orbit.rotation.x = Math.PI / 2;
                scene.add(orbit);
            });
            
            // Rendu des connexions
            mageConnections.forEach(connection => {
                const fromMage = magesData[connection.from];
                const toMage = magesData[connection.to];
                
                if (!activeMages.has(connection.from) || !activeMages.has(connection.to)) return;
                
                const geometry = new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(
                        fromMage.position.x / 15 - 3.5, 
                        fromMage.position.y / 15 - 3.5, 
                        fromMage.position.z / 15 - 3.5
                    ),
                    new THREE.Vector3(
                        toMage.position.x / 15 - 3.5, 
                        toMage.position.y / 15 - 3.5, 
                        toMage.position.z / 15 - 3.5
                    )
                ]);
                
                const intensity = (fromMage.activity + toMage.activity) / 2;
                const connectionColor = new THREE.Color().setHex(fromMage.color).lerp(
                    new THREE.Color().setHex(toMage.color), 0.5
                );
                
                const material = new THREE.LineBasicMaterial({ 
                    color: connectionColor,
                    opacity: connection.strength * intensity * 0.8,
                    transparent: true,
                    linewidth: 3
                });
                
                const line = new THREE.Line(geometry, material);
                scene.add(line);
                
                // Particules le long des connexions
                if (intensity > 0.7) {
                    const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                    const particleMaterial = new THREE.MeshBasicMaterial({ 
                        color: connectionColor,
                        transparent: true,
                        opacity: 0.8
                    });
                    
                    for (let i = 0; i < 3; i++) {
                        const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                        const t = (i / 3) + (Date.now() * 0.001) % 1;
                        particle.position.lerpVectors(
                            new THREE.Vector3(
                                fromMage.position.x / 15 - 3.5, 
                                fromMage.position.y / 15 - 3.5, 
                                fromMage.position.z / 15 - 3.5
                            ),
                            new THREE.Vector3(
                                toMage.position.x / 15 - 3.5, 
                                toMage.position.y / 15 - 3.5, 
                                toMage.position.z / 15 - 3.5
                            ),
                            t
                        );
                        scene.add(particle);
                    }
                }
            });
            
            updateStats();
        }
        
        // Configuration des contrÃ´les
        function setupControls() {
            // Toggle mages
            document.querySelectorAll('.mage-toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const mageId = toggle.dataset.mage;
                    const checkbox = toggle.querySelector('.mage-checkbox');
                    
                    if (activeMages.has(mageId)) {
                        activeMages.delete(mageId);
                        toggle.classList.remove('active');
                        checkbox.classList.remove('checked');
                    } else {
                        activeMages.add(mageId);
                        toggle.classList.add('active');
                        checkbox.classList.add('checked');
                    }
                    
                    renderAllMages();
                    logUpdate(`Mage ${mageId} ${activeMages.has(mageId) ? 'activÃ©' : 'dÃ©sactivÃ©'}`, false);
                });
            });
            
            // Boutons dimensions
            document.querySelectorAll('.dimension-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.dimension-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    activeDimension = btn.dataset.dimension;
                    document.getElementById('focus-dimension').textContent = activeDimension;
                    renderAllMages();
                });
            });
        }
        
        // Lightning multi-mages
        function triggerMultiMageLightning() {
            const overlay = document.getElementById('lightning-overlay');
            overlay.classList.add('lightning-active');
            
            setTimeout(() => {
                overlay.classList.remove('lightning-active');
            }, CONFIG.lightningDuration);
            
            // Boost d'activitÃ© pour tous les mages actifs
            activeMages.forEach(mageId => {
                if (magesData[mageId]) {
                    magesData[mageId].activity = Math.min(1, magesData[mageId].activity + 0.2);
                }
            });
            
            renderAllMages();
            logUpdate('âš¡ Lightning Multi-Mages dÃ©clenchÃ© !', true);
        }
        
        // Actualisation tous mages
        async function refreshAllMages() {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/api/interstice/status`);
                if (response.ok) {
                    const data = await response.json();
                    logUpdate(`Backend UP - ${data.entities_stored} entitÃ©s`, true);
                    triggerMultiMageLightning();
                }
            } catch (error) {
                logUpdate('Backend inaccessible', false);
            }
        }
        
        // Mise Ã  jour stats
        function updateStats() {
            const activeCount = activeMages.size;
            const totalActivity = Array.from(activeMages).reduce((sum, mageId) => {
                return sum + (magesData[mageId]?.activity || 0);
            }, 0);
            const avgActivity = activeCount > 0 ? (totalActivity / activeCount * 100).toFixed(1) : 0;
            
            document.getElementById('active-mages').textContent = `${activeCount}/6`;
            document.getElementById('active-neurons').textContent = activeCount;
            document.getElementById('active-connections').textContent = mageConnections.length;
            document.getElementById('avg-activity').textContent = avgActivity + '%';
            
            // Mise Ã  jour activitÃ©s individuelles
            Object.entries(magesData).forEach(([mageId, mage]) => {
                const element = document.getElementById(`${mageId}-activity`);
                if (element) {
                    element.textContent = (mage.activity * 100).toFixed(1) + '%';
                }
            });
        }
        
        // Log des updates
        function logUpdate(message, isReal = false) {
            const container = document.getElementById('update-log-container');
            const entry = document.createElement('div');
            entry.className = 'update-entry ' + (isReal ? 'update-real' : '');
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            
            container.insertBefore(entry, container.firstChild);
            
            while (container.children.length > 20) {
                container.removeChild(container.lastChild);
            }
            
            updateCounter++;
            document.getElementById('update-counter').textContent = updateCounter;
        }
        
        // Boucle de mise Ã  jour
        function startUpdateLoop() {
            setInterval(() => {
                // Fluctuation naturelle d'activitÃ©
                Object.values(magesData).forEach(mage => {
                    if (mage.activity > 0) {
                        mage.activity += (Math.random() - 0.5) * 0.05;
                        mage.activity = Math.max(0.1, Math.min(1, mage.activity));
                    }
                });
                
                renderAllMages();
                logUpdate('Pulse multi-mages naturel', false);
                
            }, CONFIG.updateInterval);
        }
        
        // Animation
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotation lente de la camÃ©ra
            const time = Date.now() * 0.0001;
            camera.position.x = Math.cos(time) * 20;
            camera.position.z = Math.sin(time) * 20;
            camera.lookAt(0, 0, 0);
            
            renderer.render(scene, camera);
        }
        
        // Gestion redimensionnement
        window.addEventListener('resize', () => {
            const container = document.getElementById('canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
        
        // Initialisation
        window.addEventListener('load', init);
    </script>
</body>
</html>