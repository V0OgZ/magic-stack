<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Ballon Cube - Monde Cubique 2D+Temps</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(to bottom, #87CEEB 0%, #98D982 50%, #8B7355 100%);
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #gameCanvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* HUD */
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 100;
        }

        .hud-title {
            color: #FFD700;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .hud-stat {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            min-width: 200px;
        }

        .hud-label {
            color: #aaa;
        }

        .hud-value {
            color: #0ff;
            font-weight: bold;
        }

        /* Inventory */
        .inventory {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            z-index: 100;
        }

        .inv-slot {
            width: 50px;
            height: 50px;
            border: 2px solid #666;
            background: rgba(100, 100, 100, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inv-slot:hover {
            border-color: #FFD700;
            transform: scale(1.1);
        }

        .inv-slot.selected {
            border-color: #0ff;
            background: rgba(0, 255, 255, 0.2);
        }

        /* Timeline */
        .timeline {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
        }

        .time-display {
            font-size: 24px;
            color: #FFD700;
            text-align: center;
            margin-bottom: 10px;
        }

        .time-controls {
            display: flex;
            gap: 5px;
        }

        .time-btn {
            background: #444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .time-btn:hover {
            background: #666;
        }

        /* Agent List */
        .agents-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
        }

        .agent-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
        }

        .agent-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .agent-icon {
            font-size: 20px;
            margin-right: 10px;
        }

        .agent-name {
            flex: 1;
        }

        .agent-time {
            color: #0ff;
            font-size: 12px;
        }

        /* Instructions */
        .instructions {
            position: absolute;
            bottom: 80px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
            z-index: 100;
        }

        .instructions div {
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- HUD -->
    <div class="hud">
        <div class="hud-title">üéÆ Ballon Cube</div>
        <div class="hud-stat">
            <span class="hud-label">Position:</span>
            <span class="hud-value" id="playerPos">0, 0</span>
        </div>
        <div class="hud-stat">
            <span class="hud-label">Chunk:</span>
            <span class="hud-value" id="chunkPos">0, 0</span>
        </div>
        <div class="hud-stat">
            <span class="hud-label">Agents:</span>
            <span class="hud-value" id="agentCount">0</span>
        </div>
        <div class="hud-stat">
            <span class="hud-label">FPS:</span>
            <span class="hud-value" id="fps">60</span>
        </div>
    </div>

    <!-- Timeline -->
    <div class="timeline">
        <div class="time-display" id="timeDisplay">T = 0</div>
        <div class="time-controls">
            <button class="time-btn" onclick="timeControl('rewind')">‚è™</button>
            <button class="time-btn" onclick="timeControl('pause')">‚è∏Ô∏è</button>
            <button class="time-btn" onclick="timeControl('play')">‚ñ∂Ô∏è</button>
            <button class="time-btn" onclick="timeControl('forward')">‚è©</button>
        </div>
    </div>

    <!-- Inventory -->
    <div class="inventory">
        <div class="inv-slot selected" data-block="grass">üå±</div>
        <div class="inv-slot" data-block="stone">ü™®</div>
        <div class="inv-slot" data-block="wood">ü™µ</div>
        <div class="inv-slot" data-block="water">üíß</div>
        <div class="inv-slot" data-block="crystal">üíé</div>
        <div class="inv-slot" data-block="portal">üåÄ</div>
        <div class="inv-slot" data-block="delete">‚ùå</div>
    </div>

    <!-- Agents Panel -->
    <div class="agents-panel">
        <div style="color: #FFD700; font-size: 16px; margin-bottom: 10px;">ü§ñ Agents</div>
        <div id="agentsList"></div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <div>üñ±Ô∏è Clic gauche: Placer bloc</div>
        <div>üñ±Ô∏è Clic droit: D√©truire bloc</div>
        <div>‚å®Ô∏è WASD/Fl√®ches: D√©placer</div>
        <div>‚å®Ô∏è Espace: Sauter</div>
        <div>‚å®Ô∏è 1-7: S√©lectionner bloc</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Configuration
        const BLOCK_SIZE = 32;
        const WORLD_WIDTH = 30;
        const WORLD_HEIGHT = 20;
        const CANVAS_WIDTH = WORLD_WIDTH * BLOCK_SIZE;
        const CANVAS_HEIGHT = WORLD_HEIGHT * BLOCK_SIZE;
        
        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HEIGHT;

        // √âtat du jeu
        let worldTime = 0;
        let timeSpeed = 1;
        let isPaused = false;
        let selectedBlock = 'grass';
        let camera = { x: 0, y: 0 };
        let frameCount = 0;
        let lastTime = performance.now();

        // Joueur
        const player = {
            x: WORLD_WIDTH / 2,
            y: WORLD_HEIGHT / 2,
            vx: 0,
            vy: 0,
            icon: 'üßô‚Äç‚ôÇÔ∏è',
            name: 'Vincent',
            deltaT: 1.0
        };

        // Monde (grille 2D)
        const world = [];
        for (let y = 0; y < WORLD_HEIGHT; y++) {
            world[y] = [];
            for (let x = 0; x < WORLD_WIDTH; x++) {
                // G√©n√©rer terrain de base
                if (y === WORLD_HEIGHT - 1) {
                    world[y][x] = { type: 'stone', t: 0 };
                } else if (y >= WORLD_HEIGHT - 3) {
                    world[y][x] = { type: 'dirt', t: 0 };
                } else if (y === WORLD_HEIGHT - 4 && Math.random() < 0.3) {
                    world[y][x] = { type: 'grass', t: 0 };
                } else {
                    world[y][x] = null;
                }
            }
        }

        // Agents IA
        const agents = [
            { id: 'opus', name: 'OPUS', icon: 'üìú', x: 10, y: 10, vx: 0.5, vy: 0, t: 0, deltaT: 1.0, color: '#FFD700' },
            { id: 'merlin', name: 'Merlin', icon: 'üßô', x: 15, y: 12, vx: -0.3, vy: 0, t: -5, deltaT: 0.8, color: '#9932CC' },
            { id: 'lumen', name: 'LUMEN', icon: 'üïØÔ∏è', x: 20, y: 14, vx: 0.2, vy: 0, t: 0, deltaT: 1.2, color: '#FF6347' },
            { id: 'urz', name: 'URZ-K√îM', icon: 'üêª', x: 5, y: 15, vx: 0.4, vy: 0, t: 0, deltaT: 0.7, color: '#8B4513' },
            { id: 'grut', name: 'GRUT', icon: 'üëÅÔ∏è', x: 25, y: 10, vx: -0.6, vy: 0, t: 5, deltaT: 1.5, color: '#FF1493' },
            { id: 'grufaen', name: 'GRUFAEN', icon: 'üß†', x: 12, y: 13, vx: 0.3, vy: 0, t: 0, deltaT: 1.0, color: '#9370DB' }
        ];

        // Blocks types
        const blockTypes = {
            grass: { color: '#4CAF50', icon: 'üå±' },
            stone: { color: '#9E9E9E', icon: 'ü™®' },
            dirt: { color: '#8D6E63', icon: 'üü´' },
            wood: { color: '#795548', icon: 'ü™µ' },
            water: { color: '#2196F3', icon: 'üíß' },
            crystal: { color: '#E91E63', icon: 'üíé' },
            portal: { color: '#9C27B0', icon: 'üåÄ' }
        };

        // Dessiner un bloc
        function drawBlock(x, y, block) {
            if (!block) return;
            
            const type = blockTypes[block.type];
            if (!type) return;

            const screenX = x * BLOCK_SIZE;
            const screenY = y * BLOCK_SIZE;

            // Couleur de base avec effet temporel
            const timeFactor = Math.sin(worldTime * 0.05 + x + y) * 0.1;
            ctx.fillStyle = type.color;
            ctx.globalAlpha = 0.8 + timeFactor;
            ctx.fillRect(screenX, screenY, BLOCK_SIZE, BLOCK_SIZE);

            // Bordure
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.strokeRect(screenX, screenY, BLOCK_SIZE, BLOCK_SIZE);

            // Ic√¥ne
            ctx.globalAlpha = 1;
            ctx.font = '20px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(type.icon, screenX + BLOCK_SIZE/2, screenY + BLOCK_SIZE/2);
        }

        // Dessiner un agent
        function drawAgent(agent) {
            const screenX = agent.x * BLOCK_SIZE;
            const screenY = agent.y * BLOCK_SIZE;

            // Halo temporel
            if (agent.t !== 0) {
                const gradient = ctx.createRadialGradient(
                    screenX + BLOCK_SIZE/2, screenY + BLOCK_SIZE/2, 0,
                    screenX + BLOCK_SIZE/2, screenY + BLOCK_SIZE/2, BLOCK_SIZE
                );
                const hue = agent.t > 0 ? 0 : 240; // Rouge futur, Bleu pass√©
                gradient.addColorStop(0, `hsla(${hue}, 100%, 50%, 0.3)`);
                gradient.addColorStop(1, `hsla(${hue}, 100%, 50%, 0)`);
                ctx.fillStyle = gradient;
                ctx.fillRect(screenX, screenY, BLOCK_SIZE, BLOCK_SIZE);
            }

            // Agent icon
            ctx.font = '24px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(agent.icon, screenX + BLOCK_SIZE/2, screenY + BLOCK_SIZE/2);

            // Nom
            ctx.fillStyle = '#FFF';
            ctx.font = '10px monospace';
            ctx.fillText(agent.name, screenX + BLOCK_SIZE/2, screenY - 5);

            // Indicateur temporel
            if (agent.t !== 0) {
                ctx.fillStyle = agent.t > 0 ? '#FF6347' : '#4169E1';
                ctx.font = '8px monospace';
                ctx.fillText(`T=${agent.t.toFixed(1)}`, screenX + BLOCK_SIZE/2, screenY + BLOCK_SIZE + 10);
            }
        }

        // Update agents
        function updateAgents(dt) {
            agents.forEach(agent => {
                // Update time
                if (!isPaused) {
                    agent.t += agent.deltaT * dt * timeSpeed;
                }

                // Mouvement simple
                agent.x += agent.vx * dt;
                
                // Rebondir aux bords
                if (agent.x <= 0 || agent.x >= WORLD_WIDTH - 1) {
                    agent.vx *= -1;
                    agent.x = Math.max(0, Math.min(WORLD_WIDTH - 1, agent.x));
                }

                // Gravit√© simple
                let onGround = false;
                const blockBelow = world[Math.floor(agent.y + 1)]?.[Math.floor(agent.x)];
                if (blockBelow || agent.y >= WORLD_HEIGHT - 1) {
                    onGround = true;
                    agent.vy = 0;
                } else {
                    agent.vy += 0.5 * dt; // Gravit√©
                }

                agent.y += agent.vy * dt;
                agent.y = Math.max(0, Math.min(WORLD_HEIGHT - 1, agent.y));

                // Saut al√©atoire
                if (onGround && Math.random() < 0.01) {
                    agent.vy = -0.5;
                }
            });
        }

        // Update agents list
        function updateAgentsList() {
            const list = document.getElementById('agentsList');
            list.innerHTML = agents.map(agent => `
                <div class="agent-item">
                    <span class="agent-icon">${agent.icon}</span>
                    <span class="agent-name">${agent.name}</span>
                    <span class="agent-time">T=${agent.t.toFixed(1)}</span>
                </div>
            `).join('');
            
            document.getElementById('agentCount').textContent = agents.length;
        }

        // Contr√¥les clavier
        const keys = {};
        document.addEventListener('keydown', e => keys[e.key] = true);
        document.addEventListener('keyup', e => keys[e.key] = false);

        function updatePlayer(dt) {
            // Mouvement horizontal
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) player.vx = -5;
            else if (keys['ArrowRight'] || keys['d'] || keys['D']) player.vx = 5;
            else player.vx *= 0.8; // Friction

            player.x += player.vx * dt;
            player.x = Math.max(0, Math.min(WORLD_WIDTH - 1, player.x));

            // Gravit√© et saut
            const blockBelow = world[Math.floor(player.y + 1)]?.[Math.floor(player.x)];
            if (blockBelow || player.y >= WORLD_HEIGHT - 1) {
                player.vy = 0;
                if (keys[' '] || keys['ArrowUp'] || keys['w'] || keys['W']) {
                    player.vy = -10; // Saut
                }
            } else {
                player.vy += 20 * dt; // Gravit√©
            }

            player.y += player.vy * dt;
            player.y = Math.max(0, Math.min(WORLD_HEIGHT - 1, player.y));

            // Update HUD
            document.getElementById('playerPos').textContent = 
                `${Math.floor(player.x)}, ${Math.floor(player.y)}`;
            document.getElementById('chunkPos').textContent = 
                `${Math.floor(player.x / 10)}, ${Math.floor(player.y / 10)}`;
        }

        // Souris
        canvas.addEventListener('click', e => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / BLOCK_SIZE);
            const y = Math.floor((e.clientY - rect.top) / BLOCK_SIZE);
            
            if (x >= 0 && x < WORLD_WIDTH && y >= 0 && y < WORLD_HEIGHT) {
                if (selectedBlock === 'delete') {
                    world[y][x] = null;
                } else {
                    world[y][x] = { type: selectedBlock, t: worldTime };
                }
            }
        });

        canvas.addEventListener('contextmenu', e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / BLOCK_SIZE);
            const y = Math.floor((e.clientY - rect.top) / BLOCK_SIZE);
            
            if (x >= 0 && x < WORLD_WIDTH && y >= 0 && y < WORLD_HEIGHT) {
                world[y][x] = null;
            }
        });

        // Inventory selection
        document.querySelectorAll('.inv-slot').forEach(slot => {
            slot.addEventListener('click', () => {
                document.querySelector('.inv-slot.selected')?.classList.remove('selected');
                slot.classList.add('selected');
                selectedBlock = slot.dataset.block;
            });
        });

        // Time controls
        function timeControl(action) {
            switch(action) {
                case 'pause': isPaused = !isPaused; break;
                case 'play': isPaused = false; timeSpeed = 1; break;
                case 'rewind': timeSpeed = -2; break;
                case 'forward': timeSpeed = 2; break;
            }
        }

        // Animation loop
        function animate() {
            frameCount++;
            const now = performance.now();
            const dt = Math.min((now - lastTime) / 1000, 0.1); // Delta time en secondes
            lastTime = now;

            // Update FPS
            if (frameCount % 30 === 0) {
                document.getElementById('fps').textContent = Math.round(1000 / (dt * 1000));
            }

            // Clear
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Update
            if (!isPaused) {
                worldTime += dt * timeSpeed;
                document.getElementById('timeDisplay').textContent = `T = ${worldTime.toFixed(1)}`;
            }

            updatePlayer(dt);
            updateAgents(dt);

            // Draw world
            for (let y = 0; y < WORLD_HEIGHT; y++) {
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    if (world[y][x]) {
                        drawBlock(x, y, world[y][x]);
                    }
                }
            }

            // Draw agents
            agents.forEach(drawAgent);

            // Draw player
            drawAgent(player);

            // Update UI
            if (frameCount % 60 === 0) {
                updateAgentsList();
            }

            requestAnimationFrame(animate);
        }

        // Number keys for inventory
        document.addEventListener('keydown', e => {
            if (e.key >= '1' && e.key <= '7') {
                const slots = document.querySelectorAll('.inv-slot');
                const index = parseInt(e.key) - 1;
                if (slots[index]) {
                    slots[index].click();
                }
            }
        });

        // Start
        updateAgentsList();
        animate();
    </script>
</body>
</html>
