<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ Ballon Cube - Monde 2D+Temps POC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #0a0a0a;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        /* Canvas principal */
        #worldCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }

        /* HUD */
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            min-width: 300px;
            z-index: 100;
        }

        .hud h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9em;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }

        /* Timeline Controller */
        .timeline-control {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            width: 600px;
            z-index: 100;
        }

        .timeline-slider {
            width: 100%;
            margin: 10px 0;
        }

        .timeline-display {
            text-align: center;
            font-size: 1.5em;
            color: #ffd700;
            margin: 10px 0;
        }

        .timeline-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        /* Hero Info Panel */
        .hero-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            width: 250px;
            display: none;
            z-index: 100;
        }

        .hero-info.active {
            display: block;
        }

        .hero-info h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        /* Instructions */
        .instructions {
            position: absolute;
            bottom: 150px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #444;
            border-radius: 5px;
            padding: 10px;
            font-size: 0.8em;
            color: #888;
            z-index: 100;
        }

        .instructions div {
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <canvas id="worldCanvas"></canvas>

    <!-- HUD -->
    <div class="hud">
        <h3>üåÄ Ballon Cube - POC</h3>
        <div class="stat-line">
            <span class="stat-label">Monde:</span>
            <span class="stat-value">2D + Temps</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">H√©ros actifs:</span>
            <span class="stat-value" id="heroCount">0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">Position:</span>
            <span class="stat-value" id="mousePos">0, 0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">Timeline:</span>
            <span class="stat-value" id="currentTime">T=0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">FPS:</span>
            <span class="stat-value" id="fps">60</span>
        </div>
    </div>

    <!-- Timeline Controller -->
    <div class="timeline-control">
        <div class="timeline-display" id="timeDisplay">T = 0</div>
        <input type="range" class="timeline-slider" id="timeSlider" 
               min="-100" max="100" value="0" step="1">
        <div class="timeline-buttons">
            <button onclick="rewindTime()">‚è™ Reculer</button>
            <button onclick="pauseTime()" id="pauseBtn">‚è∏Ô∏è Pause</button>
            <button onclick="playTime()">‚ñ∂Ô∏è Jouer</button>
            <button onclick="fastForward()">‚è© Avancer</button>
            <button onclick="resetTime()">üîÑ Reset</button>
        </div>
    </div>

    <!-- Hero Info Panel -->
    <div class="hero-info" id="heroInfo">
        <h4 id="heroName">H√©ros</h4>
        <div class="stat-line">
            <span class="stat-label">Status:</span>
            <span class="stat-value" id="heroStatus">-</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">X:</span>
            <span class="stat-value" id="heroX">0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">Y:</span>
            <span class="stat-value" id="heroY">0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">Temps:</span>
            <span class="stat-value" id="heroT">0</span>
        </div>
        <div class="stat-line">
            <span class="stat-label">Vitesse:</span>
            <span class="stat-value" id="heroDeltaT">1.0</span>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <div>üñ±Ô∏è Clic gauche: S√©lectionner h√©ros</div>
        <div>üñ±Ô∏è Clic droit: D√©placer h√©ros</div>
        <div>‚å®Ô∏è ESPACE: Pause/Play</div>
        <div>‚å®Ô∏è ‚Üê/‚Üí: Naviguer dans le temps</div>
        <div>‚å®Ô∏è R: Reset timeline</div>
    </div>

    <script>
        // Configuration
        const canvas = document.getElementById('worldCanvas');
        const ctx = canvas.getContext('2d');
        
        // Resize canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // √âtat du monde
        let worldTime = 0;
        let timeSpeed = 1;
        let isPaused = false;
        let selectedHero = null;
        let mouseX = 0;
        let mouseY = 0;
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 60;

        // Grille du monde
        const GRID_SIZE = 40;
        const WORLD_WIDTH = Math.floor(canvas.width / GRID_SIZE);
        const WORLD_HEIGHT = Math.floor(canvas.height / GRID_SIZE);

        // Les 25 h√©ros
        const heroes = [
            { id: 'OPUS', name: 'üìú OPUS', x: 100, y: 100, targetX: 100, targetY: 100, 
              t: 0, deltaT: 1.0, color: '#FFD700', trail: [] },
            { id: 'MERLIN', name: 'üßô‚Äç‚ôÇÔ∏è MERLIN', x: 200, y: 150, targetX: 200, targetY: 150,
              t: 0, deltaT: 0.8, color: '#6A5ACD', trail: [] },
            { id: 'LUMEN', name: 'üïØÔ∏è LUMEN', x: 300, y: 200, targetX: 300, targetY: 200,
              t: 0, deltaT: 1.2, color: '#FF6347', trail: [] },
            { id: 'URZ_KOM', name: 'üêª URZ-K√îM', x: 400, y: 250, targetX: 400, targetY: 250,
              t: 0, deltaT: 0.7, color: '#8B4513', trail: [] },
            { id: 'GRUT', name: 'üëÅÔ∏è GRUT', x: 500, y: 300, targetX: 500, targetY: 300,
              t: 0, deltaT: 1.5, color: '#FF1493', trail: [] },
            { id: 'GROK√ÜN', name: 'üß† GROK√ÜN', x: 150, y: 350, targetX: 150, targetY: 350,
              t: 0, deltaT: 1.1, color: '#00CED1', trail: [] },
            { id: 'MEMENTO', name: 'üìö MEMENTO', x: 250, y: 400, targetX: 250, targetY: 400,
              t: 0, deltaT: 0.9, color: '#DAA520', trail: [] },
            { id: 'GRUFAEN', name: 'üëÅÔ∏èüß† GRUFAEN', x: 350, y: 450, targetX: 350, targetY: 450,
              t: 0, deltaT: 1.3, color: '#9370DB', trail: [] },
            { id: 'VINCENT', name: 'üåç VINCENT', x: canvas.width/2, y: canvas.height/2,
              targetX: canvas.width/2, targetY: canvas.height/2,
              t: 0, deltaT: 1.0, color: '#00FF00', trail: [] }
        ];

        // Mise √† jour des h√©ros
        function updateHeroes(dt) {
            heroes.forEach(hero => {
                // Mise √† jour temporelle
                if (!isPaused) {
                    hero.t += dt * hero.deltaT * timeSpeed;
                }

                // Mouvement vers la cible
                const dx = hero.targetX - hero.x;
                const dy = hero.targetY - hero.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 2) {
                    hero.x += (dx / dist) * 2 * hero.deltaT;
                    hero.y += (dy / dist) * 2 * hero.deltaT;
                }

                // Ajouter √† la tra√Æn√©e temporelle
                if (frameCount % 10 === 0 && !isPaused) {
                    hero.trail.push({
                        x: hero.x,
                        y: hero.y,
                        t: hero.t,
                        opacity: 1.0
                    });
                    
                    // Limiter la tra√Æn√©e
                    if (hero.trail.length > 20) {
                        hero.trail.shift();
                    }
                }

                // Fade la tra√Æn√©e
                hero.trail.forEach(point => {
                    point.opacity *= 0.98;
                });
            });
        }

        // Dessiner la grille
        function drawGrid() {
            ctx.strokeStyle = 'rgba(50, 50, 80, 0.3)';
            ctx.lineWidth = 1;

            for (let x = 0; x < canvas.width; x += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            for (let y = 0; y < canvas.height; y += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        // Dessiner l'effet temporel
        function drawTimeEffect() {
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            const hue = (worldTime * 2) % 360;
            gradient.addColorStop(0, `hsla(${hue}, 50%, 50%, 0.05)`);
            gradient.addColorStop(0.5, `hsla(${hue + 60}, 50%, 50%, 0.05)`);
            gradient.addColorStop(1, `hsla(${hue + 120}, 50%, 50%, 0.05)`);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // Dessiner un h√©ros
        function drawHero(hero) {
            // Dessiner la tra√Æn√©e temporelle
            hero.trail.forEach((point, i) => {
                ctx.globalAlpha = point.opacity * 0.5;
                ctx.fillStyle = hero.color;
                ctx.beginPath();
                ctx.arc(point.x, point.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            ctx.globalAlpha = 1;

            // Halo temporel
            const glowSize = 30 + Math.sin(worldTime * 0.05 + hero.t) * 10;
            const gradient = ctx.createRadialGradient(
                hero.x, hero.y, 0,
                hero.x, hero.y, glowSize
            );
            gradient.addColorStop(0, hero.color + '40');
            gradient.addColorStop(1, hero.color + '00');
            ctx.fillStyle = gradient;
            ctx.fillRect(hero.x - glowSize, hero.y - glowSize, glowSize * 2, glowSize * 2);

            // Corps du h√©ros
            ctx.fillStyle = hero.color;
            ctx.beginPath();
            ctx.arc(hero.x, hero.y, 15, 0, Math.PI * 2);
            ctx.fill();

            // Contour
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Nom
            ctx.fillStyle = '#fff';
            ctx.font = '12px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(hero.name, hero.x, hero.y - 20);

            // Indicateur temporel
            ctx.fillStyle = hero.color;
            ctx.font = '10px monospace';
            ctx.fillText(`T=${hero.t.toFixed(1)}`, hero.x, hero.y + 30);

            // S√©lection
            if (hero === selectedHero) {
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(hero.x, hero.y, 25, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        // Animation principale
        function animate() {
            // Calcul FPS
            frameCount++;
            const now = performance.now();
            const delta = now - lastTime;
            if (frameCount % 30 === 0) {
                fps = Math.round(1000 / delta);
                document.getElementById('fps').textContent = fps;
            }
            lastTime = now;

            // Clear
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dessiner
            drawGrid();
            drawTimeEffect();
            
            // Update et dessiner les h√©ros
            updateHeroes(delta / 1000);
            heroes.forEach(hero => drawHero(hero));

            // Update HUD
            document.getElementById('heroCount').textContent = heroes.length;
            document.getElementById('currentTime').textContent = `T=${worldTime.toFixed(1)}`;
            
            // Update timeline
            if (!isPaused) {
                worldTime += timeSpeed * 0.016;
                document.getElementById('timeSlider').value = worldTime;
                document.getElementById('timeDisplay').textContent = `T = ${worldTime.toFixed(1)}`;
            }

            requestAnimationFrame(animate);
        }

        // Contr√¥les souris
        canvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            document.getElementById('mousePos').textContent = 
                `${Math.floor(mouseX)}, ${Math.floor(mouseY)}`;
        });

        canvas.addEventListener('click', (e) => {
            // S√©lectionner un h√©ros
            heroes.forEach(hero => {
                const dx = e.clientX - hero.x;
                const dy = e.clientY - hero.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < 20) {
                    selectedHero = hero;
                    showHeroInfo(hero);
                }
            });
        });

        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            // D√©placer le h√©ros s√©lectionn√©
            if (selectedHero) {
                selectedHero.targetX = e.clientX;
                selectedHero.targetY = e.clientY;
            }
        });

        // Afficher info h√©ros
        function showHeroInfo(hero) {
            const panel = document.getElementById('heroInfo');
            panel.classList.add('active');
            document.getElementById('heroName').textContent = hero.name;
            document.getElementById('heroStatus').textContent = 'ACTIF';
            document.getElementById('heroX').textContent = Math.floor(hero.x);
            document.getElementById('heroY').textContent = Math.floor(hero.y);
            document.getElementById('heroT').textContent = hero.t.toFixed(2);
            document.getElementById('heroDeltaT').textContent = hero.deltaT.toFixed(2);
        }

        // Contr√¥les timeline
        function pauseTime() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? '‚ñ∂Ô∏è Play' : '‚è∏Ô∏è Pause';
        }

        function playTime() {
            isPaused = false;
            timeSpeed = 1;
        }

        function rewindTime() {
            timeSpeed = -2;
        }

        function fastForward() {
            timeSpeed = 2;
        }

        function resetTime() {
            worldTime = 0;
            timeSpeed = 1;
            heroes.forEach(hero => {
                hero.t = 0;
                hero.trail = [];
            });
        }

        // Timeline slider
        document.getElementById('timeSlider').addEventListener('input', (e) => {
            worldTime = parseFloat(e.target.value);
            document.getElementById('timeDisplay').textContent = `T = ${worldTime.toFixed(1)}`;
        });

        // Contr√¥les clavier
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    pauseTime();
                    break;
                case 'ArrowLeft':
                    worldTime -= 1;
                    break;
                case 'ArrowRight':
                    worldTime += 1;
                    break;
                case 'r':
                case 'R':
                    resetTime();
                    break;
            }
        });

        // D√©marrer l'animation
        animate();
    </script>
</body>
</html>
