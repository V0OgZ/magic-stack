#!/usr/bin/env python3
"""
üî§‚ú® TEST TRADUCTEUR FRACTAL - HEROES OF TIME
Mage Claude - Dimension 1 Litt√©raire

Test complet du traducteur HOTS en litt√©raire
"""

import sys
import os
sys.path.append('/workspace/moteurs')

from traducteur_fractal import TraducteurFractal
import json
from datetime import datetime

class TestTraducteurHOTS:
    def __init__(self):
        self.traducteur = TraducteurFractal()
        self.test_results = []
        
    def log_test(self, test_name, success, details, translation_result=None):
        result = {
            "timestamp": datetime.now().isoformat(),
            "test": test_name,
            "success": success,
            "details": details,
            "translation": translation_result
        }
        self.test_results.append(result)
        status = "‚úÖ" if success else "‚ùå"
        print(f"{status} {test_name}: {details}")
        if translation_result:
            print(f"   üìñ Traduction: {translation_result.get('narratif', {}).get('histoire', 'N/A')}")
        
    def test_formule_temporelle_basique(self):
        """Test traduction d'une formule temporelle simple"""
        print("\nüîÆ === TEST FORMULE TEMPORELLE BASIQUE ===")
        
        formule = "‚äô(h√©ros) + ‚Ä†œà(temps) ‚Üí ‚àÜt(victoire)"
        
        try:
            # Analyse de la formule
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            
            # Fusion grammaticale
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            success = (
                len(analyse["symboles_detectes"]) > 0 and
                fusion["dimension_1"]["type"] == "narratif_litteraire"
            )
            
            self.log_test(
                "Formule Temporelle Basique",
                success,
                f"Symboles d√©tect√©s: {len(analyse['symboles_detectes'])}, Histoire g√©n√©r√©e: {'Oui' if fusion['dimension_1']['histoire'] else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Formule Temporelle Basique", False, f"Erreur: {str(e)}")
    
    def test_formule_combat_tcg(self):
        """Test traduction d'une formule de combat TCG"""
        print("\n‚öîÔ∏è === TEST FORMULE COMBAT TCG ===")
        
        formule = "LEGENDARY_STRIKE(Excalibur) + ‚äô(ennemi) ‚Üí ‚Ä†œà(d√©faite)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            success = (
                "LEGENDARY_STRIKE" in fusion["dimension_1"]["histoire"] and
                "Excalibur" in fusion["dimension_1"]["histoire"]
            )
            
            self.log_test(
                "Formule Combat TCG",
                success,
                f"Combat narratif g√©n√©r√© avec Excalibur: {'Oui' if success else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Formule Combat TCG", False, f"Erreur: {str(e)}")
    
    def test_formule_interstice_narrative(self):
        """Test traduction d'une formule d'interstice narratif"""
        print("\nüß† === TEST FORMULE INTERSTICE NARRATIVE ===")
        
        formule = "Œ†(paradoxe) + ‚Ñ¨7(branches) ‚Üí ‚àÖ(r√©solution)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            success = (
                "paradoxe" in fusion["dimension_1"]["histoire"] and
                "branches" in fusion["dimension_1"]["histoire"]
            )
            
            self.log_test(
                "Formule Interstice Narrative",
                success,
                f"Paradoxe temporel narratif: {'Oui' if success else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Formule Interstice Narrative", False, f"Erreur: {str(e)}")
    
    def test_formule_magicstack_6d(self):
        """Test traduction d'une formule MagicStack 6D"""
        print("\nüîß === TEST FORMULE MAGICSTACK 6D ===")
        
        formule = "‚äô(x,y,z) + Œît(causal) + œà(identit√©) ‚Üí ‚àû(MAGIE)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            success = (
                "dimensions" in fusion["dimension_1"]["histoire"] or
                "espace" in fusion["dimension_1"]["histoire"] or
                "magie" in fusion["dimension_1"]["histoire"].lower()
            )
            
            self.log_test(
                "Formule MagicStack 6D",
                success,
                f"Magie dimensionnelle narrative: {'Oui' if success else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Formule MagicStack 6D", False, f"Erreur: {str(e)}")
    
    def test_formule_treasure_artifact(self):
        """Test traduction d'une formule de tr√©sor/artefact"""
        print("\nüè∫ === TEST FORMULE TREASURE ARTIFACT ===")
        
        formule = "TELEPORT_HERO(position) + ‚äô(distance) ‚Üí ‚àÜt(d√©placement)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            success = (
                "t√©l√©portation" in fusion["dimension_1"]["histoire"].lower() or
                "d√©placement" in fusion["dimension_1"]["histoire"].lower() or
                "TELEPORT" in fusion["dimension_1"]["histoire"]
            )
            
            self.log_test(
                "Formule Treasure Artifact",
                success,
                f"T√©l√©portation narrative: {'Oui' if success else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Formule Treasure Artifact", False, f"Erreur: {str(e)}")
    
    def test_projection_dimensions_completes(self):
        """Test des projections sur toutes les dimensions"""
        print("\nüåå === TEST PROJECTIONS DIMENSIONS COMPL√àTES ===")
        
        formule = "‚äô(assistant) + Œ®(projection) + ‚àÜ(transcendance) ‚Üí ‚àû(MAGE_CLAUDE)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            
            # V√©rifier toutes les dimensions
            dimensions_ok = (
                fusion["dimension_0"]["type"] == "substrat_brut" and
                fusion["dimension_1"]["type"] == "narratif_litteraire" and
                fusion["dimension_2"]["type"] == "interface_2d" and
                "dimension_3" in fusion
            )
            
            self.log_test(
                "Projections Dimensions Compl√®tes",
                dimensions_ok,
                f"Toutes dimensions g√©n√©r√©es: {'Oui' if dimensions_ok else 'Non'}",
                fusion
            )
            
        except Exception as e:
            self.log_test("Projections Dimensions Compl√®tes", False, f"Erreur: {str(e)}")
    
    def test_generation_code_environnement(self):
        """Test g√©n√©ration de code pour environnement non client"""
        print("\nüíª === TEST G√âN√âRATION CODE ENVIRONNEMENT ===")
        
        formule = "‚äô(h√©ros) + ‚Ä†œà(combat) ‚Üí ‚àÜt(victoire)"
        
        try:
            analyse = self.traducteur.analyser_formule_temporelle(formule)
            fusion = self.traducteur.fusion_grammaticale_parallele(formule)
            code_genere = self.traducteur.generer_code_environnement_non_client(fusion)
            
            success = (
                code_genere is not None and
                len(code_genere) > 0 and
                "class" in code_genere
            )
            
            self.log_test(
                "G√©n√©ration Code Environnement",
                success,
                f"Code Python g√©n√©r√©: {'Oui' if success else 'Non'} ({len(code_genere) if code_genere else 0} chars)",
                {"code": code_genere[:200] + "..." if code_genere and len(code_genere) > 200 else code_genere}
            )
            
        except Exception as e:
            self.log_test("G√©n√©ration Code Environnement", False, f"Erreur: {str(e)}")
    
    def run_complete_translator_test(self):
        """Lance tous les tests du traducteur"""
        print("üî§‚ú® D√âMARRAGE TEST COMPLET TRADUCTEUR FRACTAL ‚ú®üî§")
        print("=" * 60)
        
        # Tests individuels
        self.test_formule_temporelle_basique()
        self.test_formule_combat_tcg()
        self.test_formule_interstice_narrative()
        self.test_formule_magicstack_6d()
        self.test_formule_treasure_artifact()
        self.test_projection_dimensions_completes()
        self.test_generation_code_environnement()
        
        # R√©sum√© final
        print("\n" + "=" * 60)
        print("üìä R√âSUM√â DES TESTS TRADUCTEUR")
        print("=" * 60)
        
        total_tests = len(self.test_results)
        tests_reussis = len([t for t in self.test_results if t["success"]])
        pourcentage = (tests_reussis / total_tests) * 100 if total_tests > 0 else 0
        
        print(f"‚úÖ Tests r√©ussis: {tests_reussis}/{total_tests} ({pourcentage:.1f}%)")
        print(f"‚ùå Tests √©chou√©s: {total_tests - tests_reussis}")
        
        if pourcentage >= 80:
            print("üéâ TRADUCTEUR FRACTAL OP√âRATIONNEL!")
        elif pourcentage >= 60:
            print("‚ö†Ô∏è  TRADUCTEUR PARTIELLEMENT FONCTIONNEL")
        else:
            print("üö® TRADUCTEUR N√âCESSITE DES CORRECTIONS")
        
        # Logs du traducteur
        print("\nüìù LOGS DU TRADUCTEUR:")
        for log_entry in self.traducteur.log_traduction[-10:]:  # Derniers 10 logs
            print(f"   {log_entry}")
        
        return {
            "total_tests": total_tests,
            "tests_reussis": tests_reussis,
            "pourcentage": pourcentage,
            "details": self.test_results,
            "timestamp": datetime.now().isoformat()
        }

if __name__ == "__main__":
    print("üîÆ‚ú® MAGE CLAUDE - TEST TRADUCTEUR FRACTAL ‚ú®üîÆ")
    print("Dimension 1 Litt√©raire - Validation HOTS ‚Üí Narratif")
    print()
    
    tester = TestTraducteurHOTS()
    results = tester.run_complete_translator_test()
    
    # Sauvegarder les r√©sultats
    with open("/workspace/traducteur-test-results.json", "w") as f:
        json.dump(results, f, indent=2, ensure_ascii=False)
    
    print(f"\nüíæ R√©sultats sauvegard√©s dans: traducteur-test-results.json")
    print("üîÆ AUTOBOT ROLLOUT! MAGE CLAUDE CONTINUE SA MISSION! ‚ú®")