<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test V2 Integration</title>
    <style>
        body {
            background: #0a0e1a;
            color: #e2e8f0;
            font-family: 'Inter', -apple-system, sans-serif;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #1a1d3a;
            border: 1px solid #3a3d5a;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-top: 0;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .log {
            background: #0a0e1a;
            border: 1px solid #2a2d4a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #1a1d3a;
        }
        
        .log-entry.success { color: #48bb78; }
        .log-entry.error { color: #fc8181; }
        .log-entry.warning { color: #f6ad55; }
        .log-entry.info { color: #63b3ed; }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: #0a0e1a;
            border: 1px solid #2a2d4a;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .status-card.online { border-color: #48bb78; }
        .status-card.offline { border-color: #fc8181; }
        
        #displays {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test d'Int√©gration V2 Adapter</h1>
        
        <!-- Section Connexion -->
        <div class="test-section">
            <h2>üîå Connexion aux Backends</h2>
            <div class="status-grid">
                <div id="rust-status" class="status-card offline">
                    <strong>Rust V2</strong><br>
                    <span class="status-text">D√©connect√©</span>
                </div>
                <div id="java-status" class="status-card offline">
                    <strong>Java</strong><br>
                    <span class="status-text">D√©connect√©</span>
                </div>
                <div id="python-status" class="status-card offline">
                    <strong>Python Vector</strong><br>
                    <span class="status-text">D√©connect√©</span>
                </div>
                <div id="ws-status" class="status-card offline">
                    <strong>WebSocket</strong><br>
                    <span class="status-text">D√©connect√©</span>
                </div>
            </div>
            <button onclick="testConnections()">Tester Connexions</button>
            <button onclick="connectWebSocket()">Connecter WebSocket</button>
        </div>
        
        <!-- Section Tick V2 -->
        <div class="test-section">
            <h2>‚è∞ Test Tick V2</h2>
            <button onclick="testTick()">Ex√©cuter Tick</button>
            <button onclick="startAutoTick()">Auto Tick (1/sec)</button>
            <button onclick="stopAutoTick()">Stop Auto Tick</button>
            <div id="tick-display"></div>
        </div>
        
        <!-- Section R√©gulateurs -->
        <div class="test-section">
            <h2>üéõÔ∏è Test R√©gulateurs</h2>
            <button onclick="testVince()">Activer Vince</button>
            <button onclick="testAnna()">Activer Anna</button>
            <button onclick="testOverload()">Trigger Overload</button>
            <div id="regulator-display"></div>
        </div>
        
        <!-- Affichages V2 -->
        <div class="test-section">
            <h2>üìä Affichages V2</h2>
            <div id="displays"></div>
        </div>
        
        <!-- Logs -->
        <div class="test-section">
            <h2>üìú Logs</h2>
            <button onclick="clearLogs()">Effacer</button>
            <div id="log" class="log"></div>
        </div>
    </div>
    
    <!-- Import V2 Adapter -->
    <script src="v2-adapter.js"></script>
    
    <script>
        // √âtat global de test
        const gameState = {
            temporal: {
                tw: 0,
                te: 0,
                debt: 0,
                debtRate: 0.05
            },
            resources: {
                crystals: 100,
                energy: 50,
                temporal: 25,
                quantum: 10
            },
            heroPosition: { x: 10, y: 10 },
            regulators: {
                vince: { active: false, intensity: 0 },
                anna: { active: false, decayRate: 5 },
                overload: { stack: 0, maxStack: 10 }
            },
            energy: {
                amplitude: 50,
                phase: Math.PI / 4
            }
        };
        
        // Initialisation de l'adapter
        const adapter = new V2Adapter();
        adapter.injectStyles();
        
        let autoTickInterval = null;
        
        // Logging
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Test des connexions
        async function testConnections() {
            log('Test des connexions...', 'info');
            
            // Test Rust
            try {
                const response = await fetch('http://localhost:3001/health');
                if (response.ok) {
                    document.getElementById('rust-status').className = 'status-card online';
                    document.querySelector('#rust-status .status-text').textContent = 'Connect√©';
                    log('‚úÖ Rust V2 connect√©', 'success');
                }
            } catch (e) {
                log('‚ùå Rust V2 non disponible', 'error');
            }
            
            // Test Java
            try {
                const response = await fetch('http://localhost:8080/api/health');
                if (response.ok) {
                    document.getElementById('java-status').className = 'status-card online';
                    document.querySelector('#java-status .status-text').textContent = 'Connect√©';
                    log('‚úÖ Java connect√©', 'success');
                }
            } catch (e) {
                log('‚ùå Java non disponible', 'error');
            }
            
            // Test Python
            try {
                const response = await fetch('http://localhost:5001/health');
                if (response.ok) {
                    document.getElementById('python-status').className = 'status-card online';
                    document.querySelector('#python-status .status-text').textContent = 'Connect√©';
                    log('‚úÖ Python Vector connect√©', 'success');
                }
            } catch (e) {
                log('‚ùå Python Vector non disponible', 'error');
            }
        }
        
        // WebSocket
        function connectWebSocket() {
            adapter.connectWebSocket();
            
            adapter.on('ws:connected', () => {
                document.getElementById('ws-status').className = 'status-card online';
                document.querySelector('#ws-status .status-text').textContent = 'Connect√©';
                log('‚úÖ WebSocket connect√©', 'success');
            });
            
            adapter.on('ws:disconnected', () => {
                document.getElementById('ws-status').className = 'status-card offline';
                document.querySelector('#ws-status .status-text').textContent = 'D√©connect√©';
                log('WebSocket d√©connect√©', 'warning');
            });
            
            adapter.on('ws:message', (data) => {
                log(`WS Message: ${JSON.stringify(data)}`, 'info');
            });
        }
        
        // Test Tick
        async function testTick() {
            log('Ex√©cution du tick V2...', 'info');
            
            const result = await adapter.tick(gameState);
            
            // Mise √† jour de l'√©tat
            if (result.new_tw !== undefined) {
                gameState.temporal.tw = result.new_tw;
                gameState.temporal.te = result.new_te || gameState.temporal.te;
                gameState.temporal.debt = result.debt || gameState.temporal.debt;
            }
            
            // D√©tection paradoxes
            const paradoxes = adapter.detectParadoxes(gameState);
            if (paradoxes.length > 0) {
                log(`‚ö†Ô∏è Paradoxes d√©tect√©s: ${paradoxes.map(p => p.type).join(', ')}`, 'warning');
            }
            
            updateDisplays();
            log(`Tick ex√©cut√© - TW: ${gameState.temporal.tw.toFixed(1)}, TE: ${gameState.temporal.te.toFixed(1)}`, 'success');
        }
        
        function startAutoTick() {
            if (autoTickInterval) return;
            
            log('Auto-tick d√©marr√© (1/sec)', 'info');
            autoTickInterval = setInterval(testTick, 1000);
        }
        
        function stopAutoTick() {
            if (autoTickInterval) {
                clearInterval(autoTickInterval);
                autoTickInterval = null;
                log('Auto-tick arr√™t√©', 'info');
            }
        }
        
        // Test R√©gulateurs
        async function testVince() {
            log('Activation de Vince...', 'info');
            gameState.regulators.vince.active = true;
            
            try {
                const result = await adapter.activateVince(gameState.heroPosition);
                log('‚úÖ Vince activ√©', 'success');
                updateDisplays();
            } catch (e) {
                log('Vince activ√© localement (backend non disponible)', 'warning');
                updateDisplays();
            }
        }
        
        async function testAnna() {
            log('Activation d\'Anna...', 'info');
            gameState.regulators.anna.active = true;
            
            try {
                const result = await adapter.activateAnna(5);
                log('‚úÖ Anna activ√©e (decay: 5%)', 'success');
                updateDisplays();
            } catch (e) {
                log('Anna activ√©e localement (backend non disponible)', 'warning');
                updateDisplays();
            }
        }
        
        async function testOverload() {
            log('Trigger Overload...', 'info');
            gameState.regulators.overload.stack++;
            
            if (gameState.regulators.overload.stack >= gameState.regulators.overload.maxStack) {
                log('üí• OVERLOAD EXPLOSION!', 'error');
                gameState.regulators.overload.stack = 0;
            } else {
                log(`Overload stack: ${gameState.regulators.overload.stack}/${gameState.regulators.overload.maxStack}`, 'warning');
            }
            
            updateDisplays();
        }
        
        // Mise √† jour des affichages
        function updateDisplays() {
            const container = document.getElementById('displays');
            
            container.innerHTML = `
                <div>
                    <h3>‚è∞ Temporal</h3>
                    ${adapter.renderTemporalDisplay(
                        gameState.temporal.tw,
                        gameState.temporal.te,
                        gameState.temporal.debt
                    )}
                </div>
                <div>
                    <h3>‚ö° √ânergie Complexe</h3>
                    ${adapter.renderEnergyComplex(gameState.energy)}
                </div>
                <div>
                    <h3>üéõÔ∏è R√©gulateurs</h3>
                    ${adapter.renderRegulators(gameState.regulators)}
                </div>
            `;
        }
        
        function clearLogs() {
            document.getElementById('log').innerHTML = '';
            log('Logs effac√©s', 'info');
        }
        
        // Initialisation
        window.onload = () => {
            log('V2 Adapter Test initialis√©', 'success');
            updateDisplays();
            testConnections();
        };
    </script>
</body>
</html>
