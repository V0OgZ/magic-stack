## 📜 LOG 15 AOÛT 2025 — JOUR 43

### 🎯 Objectifs (Jour 43)
- Consolidation prod (Rust + Java) et hygiène VPS
- Parité HTML/React (3 scénarios) avec traceHash stable
- UI: surface traceHash + effets/sons, presets Spells Lab

### 🛠️ Ops/VPS
- Créer services systemd: `magic-rust.service` (3001) et `magic-java.service` (8082); Restart=always; healthcheck sur `/health` et `/api/health`.
- Fix port conflicts: s'assurer d'un seul serveur Rust (release) en prod; script `prestart` qui tue doublons par port.
- Cron/système: sync nocturne (3h) déjà en place; ajouter check 200 pour `/FRONTPAGE/spells-lab.html`.

### 🔧 Backend
- `/api/magic/cast` mode `apply`: retourner `world_diff` (stub struct), conserver `traceHash` idem `simulate`.
- Tests d’intégration (5 seeds): même inputs ⇒ même `traceHash` (Java↔Rust). 
- `FormulaRegistryService`: exposer `/api/magic/formulas` (Java) en proxy du Vector DB.
- Logs: corrélation `traceHash` + `requestId`.

### 🖥️ Frontend (React unified)
- QuickCast Panel: afficher `traceHash` dans le panneau debug; 
- Parity Page: charger/rejouer 3 traces JSONL, comparer snapshot final aux références; statut PASS/FAIL.
- Respect SPA nav sans changement d’URL [[memory:6172786]].

### 🧪 Parité (3 scénarios)
- scenario1_hero_movement
- scenario2_portal_collapse
- scenario3_buff_chain
- Export HTML → `test_snapshots.json` et comparer côté React.

### 🧪 E2E/CI rapide
- Playwright minimal: Spells Lab POST `/api/magic/cast` ⇒ 200 + `traceHash` présent.
- Smoke: `/api/health`, `/api/magic/health`, Rust `/health` ⇒ 200.

### 🚀 Livrables fin de journée
- Systemd units + doc d’exploitation (start/stop/journalctl)
- 5 tests d’intégration `traceHash` verts
- Parity page PASS (3 scénarios) et `traceHash` visible en UI
- Changelog JOUR 43 + tag


