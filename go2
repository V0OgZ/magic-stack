#!/bin/bash

# ðŸš€ GO2 - Script PROPRE et SIMPLE pour Vincent
# BasÃ© sur l'ARCHITECTURE RÃ‰ELLE

# Couleurs
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
RED='\033[0;31m'
NC='\033[0m'

# Fonction pour vÃ©rifier un port
check_port() {
    nc -z localhost $1 2>/dev/null
    return $?
}

# Commande
COMMAND=$1

case "$COMMAND" in
    "status"|"s")
        echo -e "${BLUE}ðŸ“Š STATUT DES SERVICES${NC}"
        echo "========================"
        echo ""
        
        echo -e "${CYAN}ðŸŽ® Frontend (1 seule app!):${NC}"
        check_port 5175 && echo -e "  ${GREEN}âœ…${NC} Magic Stack Unified (5175)" || echo -e "  ${RED}âŒ${NC} Magic Stack Unified (5175)"
        
        echo ""
        echo -e "${CYAN}âš™ï¸ Backend:${NC}"
        check_port 3001 && echo -e "  ${GREEN}âœ…${NC} Rust Backend (3001)" || echo -e "  ${RED}âŒ${NC} Rust Backend (3001)"
        check_port 8080 && echo -e "  ${GREEN}âœ…${NC} Java Backend (8080)" || echo -e "  ${RED}âŒ${NC} Java Backend (8080)"
        check_port 5001 && echo -e "  ${GREEN}âœ…${NC} Python Vector DB (5001)" || echo -e "  ${RED}âŒ${NC} Python Vector DB (5001)"
        check_port 8001 && echo -e "  ${GREEN}âœ…${NC} WebSocket (8001)" || echo -e "  ${RED}âŒ${NC} WebSocket (8001)"
        check_port 7500 && echo -e "  ${GREEN}âœ…${NC} Vector DB Service (7500)" || echo -e "  ${RED}âŒ${NC} Vector DB Service (7500)"
        check_port 7501 && echo -e "  ${GREEN}âœ…${NC} LLM Clippy Service (7501)" || echo -e "  ${RED}âŒ${NC} LLM Clippy Service (7501)"
        echo ""
        ;;
        
    "start"|"")
        echo -e "${GREEN}ðŸš€ Lancement de l'app React...${NC}"
        
        # VÃ©rifier si dÃ©jÃ  lancÃ©e
        if check_port 5175; then
            echo -e "${YELLOW}App dÃ©jÃ  lancÃ©e sur port 5175${NC}"
        else
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            echo -e "${GREEN}âœ… App lancÃ©e!${NC}"
            sleep 3
        fi
        
        # Ouvrir la page
        open "http://localhost:5175/"
        ;;
        
    "game"|"g")
        echo -e "${GREEN}ðŸŽ® Ouverture du jeu unifiÃ©...${NC}"
        
        # Lancer l'app si pas dÃ©jÃ  fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/unified"
        ;;
        
    "combat"|"c")
        echo -e "${YELLOW}âš”ï¸ Ouverture du combat IA...${NC}"
        
        # Lancer l'app si pas dÃ©jÃ  fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/combat"
        ;;
        
    "chasse"|"ch")
        echo -e "${MAGENTA}ðŸ—ºï¸ Ouverture de la Chasse Temporelle...${NC}"
        
        # Lancer l'app si pas dÃ©jÃ  fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/chasse-mega"
        ;;
        
    "admin"|"a")
        echo -e "${CYAN}ðŸŽ›ï¸ Ouverture du panneau admin...${NC}"
        ./ADMIN_PANEL.sh
        ;;
        
    "stop")
        echo -e "${RED}ðŸ›‘ ArrÃªt de l'app...${NC}"
        
        # Tuer le process sur le port 5175
        lsof -ti:5175 | xargs kill -9 2>/dev/null
        
        echo -e "${GREEN}âœ… App arrÃªtÃ©e${NC}"
        ;;
        
    "help"|"h")
        echo -e "${CYAN}GO2 - Script SIMPLE${NC}"
        echo ""
        echo -e "${BLUE}Commandes:${NC}"
        echo -e "  ${GREEN}start${NC}  - Lance l'app React (port 5175)"
        echo -e "  ${GREEN}game${NC}   - Ouvre l'Ã©diteur unifiÃ©"
        echo -e "  ${GREEN}combat${NC} - Ouvre le combat IA"
        echo -e "  ${GREEN}chasse${NC} - Ouvre la chasse temporelle"
        echo -e "  ${GREEN}admin${NC}  - Ouvre TOUT (HTML + React)"
        echo -e "  ${GREEN}status${NC} - Montre l'Ã©tat des services"
        echo -e "  ${GREEN}stop${NC}   - ArrÃªte l'app"
        echo ""
        echo -e "${BLUE}Architecture:${NC}"
        echo "  â€¢ 1 app React sur port 5175"
        echo "  â€¢ Des HTML statiques (pas de serveur)"
        echo "  â€¢ 6 backends (Rust, Java, Python, etc.)"
        ;;
        
    *)
        echo -e "${RED}Commande inconnue: $COMMAND${NC}"
        echo "Tapez: ./go2 help"
        ;;
esac
