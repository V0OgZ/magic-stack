#!/bin/bash

# 🚀 GO2 - Script PROPRE et SIMPLE pour Vincent
# Basé sur l'ARCHITECTURE RÉELLE

# Couleurs
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
RED='\033[0;31m'
NC='\033[0m'

# Fonction pour vérifier un port
check_port() {
    nc -z localhost $1 2>/dev/null
    return $?
}

# Commande
COMMAND=$1

case "$COMMAND" in
    "status"|"s")
        echo -e "${BLUE}📊 STATUT DES SERVICES${NC}"
        echo "========================"
        echo ""
        
        echo -e "${CYAN}🎮 Frontend (1 seule app!):${NC}"
        check_port 5175 && echo -e "  ${GREEN}✅${NC} Magic Stack Unified (5175)" || echo -e "  ${RED}❌${NC} Magic Stack Unified (5175)"
        
        echo ""
        echo -e "${CYAN}⚙️ Backend:${NC}"
        check_port 3001 && echo -e "  ${GREEN}✅${NC} Rust Backend (3001)" || echo -e "  ${RED}❌${NC} Rust Backend (3001)"
        check_port 8080 && echo -e "  ${GREEN}✅${NC} Java Backend (8080)" || echo -e "  ${RED}❌${NC} Java Backend (8080)"
        check_port 5001 && echo -e "  ${GREEN}✅${NC} Python Vector DB (5001)" || echo -e "  ${RED}❌${NC} Python Vector DB (5001)"
        check_port 8001 && echo -e "  ${GREEN}✅${NC} WebSocket (8001)" || echo -e "  ${RED}❌${NC} WebSocket (8001)"
        check_port 7500 && echo -e "  ${GREEN}✅${NC} Vector DB Service (7500)" || echo -e "  ${RED}❌${NC} Vector DB Service (7500)"
        check_port 7501 && echo -e "  ${GREEN}✅${NC} LLM Clippy Service (7501)" || echo -e "  ${RED}❌${NC} LLM Clippy Service (7501)"
        echo ""
        ;;
        
    "start"|"")
        echo -e "${GREEN}🚀 Lancement de l'app React...${NC}"
        
        # Vérifier si déjà lancée
        if check_port 5175; then
            echo -e "${YELLOW}App déjà lancée sur port 5175${NC}"
        else
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            echo -e "${GREEN}✅ App lancée!${NC}"
            sleep 3
        fi
        
        # Ouvrir la page
        open "http://localhost:5175/"
        ;;
        
    "game"|"g")
        echo -e "${GREEN}🎮 Ouverture du jeu unifié...${NC}"
        
        # Lancer l'app si pas déjà fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/unified"
        ;;
        
    "combat"|"c")
        echo -e "${YELLOW}⚔️ Ouverture du combat IA...${NC}"
        
        # Lancer l'app si pas déjà fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/combat"
        ;;
        
    "chasse"|"ch")
        echo -e "${MAGENTA}🗺️ Ouverture de la Chasse Temporelle...${NC}"
        
        # Lancer l'app si pas déjà fait
        if ! check_port 5175; then
            cd /Volumes/HOT_DEV/Magic/magic-stack/apps/magic-stack-unified
            npm run dev &
            sleep 3
        fi
        
        open "http://localhost:5175/chasse-mega"
        ;;
        
    "admin"|"a")
        echo -e "${CYAN}🎛️ Ouverture du panneau admin...${NC}"
        ./ADMIN_PANEL.sh
        ;;
        
    "stop")
        echo -e "${RED}🛑 Arrêt de l'app...${NC}"
        
        # Tuer le process sur le port 5175
        lsof -ti:5175 | xargs kill -9 2>/dev/null
        
        echo -e "${GREEN}✅ App arrêtée${NC}"
        ;;
        
    "help"|"h")
        echo -e "${CYAN}GO2 - Script SIMPLE${NC}"
        echo ""
        echo -e "${BLUE}Commandes:${NC}"
        echo -e "  ${GREEN}start${NC}  - Lance l'app React (port 5175)"
        echo -e "  ${GREEN}game${NC}   - Ouvre l'éditeur unifié"
        echo -e "  ${GREEN}combat${NC} - Ouvre le combat IA"
        echo -e "  ${GREEN}chasse${NC} - Ouvre la chasse temporelle"
        echo -e "  ${GREEN}admin${NC}  - Ouvre TOUT (HTML + React)"
        echo -e "  ${GREEN}status${NC} - Montre l'état des services"
        echo -e "  ${GREEN}stop${NC}   - Arrête l'app"
        echo ""
        echo -e "${BLUE}Architecture:${NC}"
        echo "  • 1 app React sur port 5175"
        echo "  • Des HTML statiques (pas de serveur)"
        echo "  • 6 backends (Rust, Java, Python, etc.)"
        ;;
        
    *)
        echo -e "${RED}Commande inconnue: $COMMAND${NC}"
        echo "Tapez: ./go2 help"
        ;;
esac
